{"ast":null,"code":"import _objectSpread from\"/Users/joshuakaufman/untitled folder 3/orchestrator/dashboard/client/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useEffect}from'react';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const PricingManagementPage=()=>{var _productGroups$formDa,_productGroups$formDa2,_showDataProvenance$d,_showDataProvenance$d3,_showDataProvenance$d4,_showRuleHistory$data,_showRuleHistory$data2;const[rules,setRules]=useState([]);const[missingProducts,setMissingProducts]=useState([]);const[schemaVersion,setSchemaVersion]=useState('1.0.0');const[productGroups,setProductGroups]=useState({});const[productsStructure,setProductsStructure]=useState({});// New products structure from API\nconst[loading,setLoading]=useState(true);const[error,setError]=useState(null);const[searchTerm,setSearchTerm]=useState('');const[expandedProducts,setExpandedProducts]=useState(new Set());const[expandedCountries,setExpandedCountries]=useState(new Set());const[showCreateModal,setShowCreateModal]=useState(false);const[editingRule,setEditingRule]=useState(null);const[addingCountryFor,setAddingCountryFor]=useState(null);const[products,setProducts]=useState([]);const[countries,setCountries]=useState([]);const[showDataProvenance,setShowDataProvenance]=useState(null);// For showing underlying data\n// Rule history state\nconst[showRuleHistory,setShowRuleHistory]=useState(null);const[ruleHistory,setRuleHistory]=useState({});// Edit rule state\nconst[showEditModal,setShowEditModal]=useState(false);const[editFormData,setEditFormData]=useState({rule_id:'',product_id:'',price_usd:'',start_date:'',countries:[]});// Form state for creating rules\nconst[formData,setFormData]=useState({product_id:'',price_usd:'',start_date:'',countries:[]});// Smart defaults and loading states\nconst[suggestedPrice,setSuggestedPrice]=useState(null);const[loadingPrice,setLoadingPrice]=useState(false);const[countrySelectAll,setCountrySelectAll]=useState(false);// Trial activity data from backend\nconst[trialActivityData,setTrialActivityData]=useState({});// Auto-repair notification state\nconst[autoRepairNotification,setAutoRepairNotification]=useState(null);// Load pricing rules and dropdown data\nuseEffect(()=>{loadPricingRules();loadDropdownData();},[]);// Group rules by product and country when rules change\nuseEffect(()=>{if(rules.length>0||missingProducts.length>0){groupRulesByProductAndCountry();}},[rules,missingProducts]);// Auto-expand logic when data loads\nuseEffect(()=>{if(Object.keys(productGroups).length>0){// Keep products collapsed by default - only expand if search matches\nif(searchTerm){const matchingProducts=Object.keys(productGroups).filter(productId=>productId.toLowerCase().includes(searchTerm.toLowerCase()));setExpandedProducts(new Set(matchingProducts));}else{setExpandedProducts(new Set());// Collapsed by default\n}// Countries don't need expand/collapse state anymore - they're always shown when product is expanded\nsetExpandedCountries(new Set());}},[productGroups,searchTerm]);// Keep country select all state in sync\nuseEffect(()=>{if(countries.length>0){setCountrySelectAll(formData.countries.length===countries.length&&formData.countries.length>0);}},[formData.countries,countries]);const loadPricingRules=async()=>{try{setLoading(true);const response=await fetch('/api/pricing/rules');const data=await response.json();if(data.success){setRules(data.data.rules||[]);// Handle both old and new schema formats\nif(data.data.missing_products){setMissingProducts(data.data.missing_products);}if(data.data.schema_version){setSchemaVersion(data.data.schema_version);}// Store the new products structure from API\nif(data.data.products){setProductsStructure(data.data.products);}// Store trial activity data from backend\nif(data.data.trial_activity_data){setTrialActivityData(data.data.trial_activity_data);}// Handle auto-repair notifications\nif(data.data.auto_repair_count&&data.data.auto_repair_count>0){setAutoRepairNotification({type:'success',message:\"\\u2705 Auto-repaired \".concat(data.data.auto_repair_count,\" pricing rules with missing end dates\"),timestamp:Date.now()});// Auto-hide notification after 8 seconds\nsetTimeout(()=>{setAutoRepairNotification(null);},8000);}}else{setError(data.error||'Failed to load pricing rules');}}catch(err){setError('Network error loading pricing rules');console.error('Error loading pricing rules:',err);}finally{setLoading(false);}};const forceRepairRules=async()=>{try{setLoading(true);const response=await fetch('/api/pricing/repair-rules',{method:'POST'});const data=await response.json();if(data.success){setAutoRepairNotification({type:'success',message:\"\\uD83D\\uDD27 \".concat(data.message),timestamp:Date.now()});// Reload data after repair\nsetTimeout(()=>{loadPricingRules();},1000);}else{setError(data.error||'Failed to repair rules');}}catch(err){setError('Network error during rule repair');console.error('Error repairing rules:',err);}finally{setLoading(false);}};const loadDropdownData=async()=>{try{const[productsRes,countriesRes]=await Promise.all([fetch('/api/pricing/products'),fetch('/api/pricing/countries')]);const[productsData,countriesData]=await Promise.all([productsRes.json(),countriesRes.json()]);if(productsData.success&&productsData.data&&productsData.data.products){const productList=productsData.data.products.map(p=>p.product_id);setProducts(productList);}if(countriesData.success&&countriesData.data&&countriesData.data.countries){const countryList=countriesData.data.countries.map(c=>c.country_code);setCountries(countryList);}}catch(err){console.error('Error loading dropdown data:',err);setProducts([]);setCountries([]);}};const loadDataProvenance=async ruleId=>{try{const response=await fetch(\"/api/pricing/rules/\".concat(ruleId,\"/provenance\"));const data=await response.json();if(data.success){setShowDataProvenance({ruleId,data:data.data});}else{console.error('Failed to load data provenance:',data.error);}}catch(err){console.error('Error loading data provenance:',err);}};const loadRuleHistory=async productId=>{try{const response=await fetch(\"/api/pricing/rules/\".concat(productId,\"/history\"));const data=await response.json();if(data.success){setShowRuleHistory({productId,data:data.data});}else{console.error('Failed to load rule history:',data.error);}}catch(err){console.error('Error loading rule history:',err);}};const openEditModal=rule=>{setEditFormData({rule_id:rule.rule_id,product_id:rule.product_id,price_usd:rule.price_usd.toString(),start_date:rule.start_date,countries:[...rule.countries]});setEditingRule(rule);setShowEditModal(true);};const updateRule=async e=>{e.preventDefault();try{const response=await fetch(\"/api/pricing/rules/\".concat(editFormData.rule_id,\"?simple_edit=true\"),{method:'PUT',headers:{'Content-Type':'application/json'},body:JSON.stringify({product_id:editFormData.product_id,price_usd:parseFloat(editFormData.price_usd),start_date:editFormData.start_date,countries:editFormData.countries})});const data=await response.json();if(data.success){setShowEditModal(false);setEditingRule(null);setEditFormData({rule_id:'',product_id:'',price_usd:'',start_date:'',countries:[]});// Reload all data to ensure consistency\nloadPricingRules();setError(null);}else{setError(data.error||'Failed to update rule');}}catch(err){setError('Network error updating rule');console.error('Error updating rule:',err);}};const groupRulesByProductAndCountry=()=>{const groups={};// Group existing rules by product and country\nrules.forEach(rule=>{const productId=rule.product_id;if(!groups[productId]){groups[productId]={totalRules:0,countries:{},allCountries:[],mostRecentPricingUpdate:null,// When pricing was last changed (start_date)\nhasMissingRules:false};}groups[productId].totalRules++;// Track most recent pricing update (start_date) - when pricing was actually changed\nconst pricingStartDate=new Date(rule.start_date);if(!groups[productId].mostRecentPricingUpdate||pricingStartDate>groups[productId].mostRecentPricingUpdate){groups[productId].mostRecentPricingUpdate=pricingStartDate;}rule.countries.forEach(country=>{if(!groups[productId].countries[country]){groups[productId].countries[country]={rules:[],priceRange:{min:Infinity,max:-Infinity},hasActive:false,hasFuture:false,hasHistorical:false};groups[productId].allCountries.push(country);}const countryData=groups[productId].countries[country];countryData.rules.push(rule);// Update price range\ncountryData.priceRange.min=Math.min(countryData.priceRange.min,rule.price_usd);countryData.priceRange.max=Math.max(countryData.priceRange.max,rule.price_usd);// Determine rule status for country\nconst now=new Date();const startDate=new Date(rule.start_date);const endDate=rule.end_date?new Date(rule.end_date):null;if(endDate&&now>endDate){countryData.hasHistorical=true;}else if(now>=startDate&&(!endDate||now<=endDate)){countryData.hasActive=true;}else{countryData.hasFuture=true;}});});// Add missing products and update trial activity for all products\nmissingProducts.forEach(missingProduct=>{const productId=missingProduct.product_id;const trialActivityDate=new Date(missingProduct.last_trial||missingProduct.last_conversion);if(!groups[productId]){groups[productId]={totalRules:0,countries:{},allCountries:[],mostRecentPricingUpdate:trialActivityDate,mostRecentTrialActivity:trialActivityDate,hasMissingRules:true,missingProductInfo:missingProduct};}else{// Product exists with rules - update trial activity and mark as having missing rules if needed\ngroups[productId].hasMissingRules=true;groups[productId].missingProductInfo=missingProduct;// Update with trial activity date - this is key for proper sorting\nif(!groups[productId].mostRecentTrialActivity||trialActivityDate>groups[productId].mostRecentTrialActivity){groups[productId].mostRecentTrialActivity=trialActivityDate;}// Also update pricing update if trial activity is more recent\nif(!groups[productId].mostRecentPricingUpdate||trialActivityDate>groups[productId].mostRecentPricingUpdate){groups[productId].mostRecentPricingUpdate=trialActivityDate;}}});// Update all products with accurate trial activity data from backend\nObject.keys(groups).forEach(productId=>{if(trialActivityData[productId]){const activityInfo=trialActivityData[productId];const activityDate=new Date(activityInfo.most_recent_activity);// Update with the accurate trial activity date\ngroups[productId].mostRecentTrialActivity=activityDate;groups[productId].totalTrialEvents=activityInfo.total_events;// If this product doesn't have pricing rules, also update the pricing update date\nif(groups[productId].totalRules===0){groups[productId].mostRecentPricingUpdate=activityDate;}}});// For products with rules but no trial activity data, use pricing date as trial activity\nObject.values(groups).forEach(product=>{if(!product.mostRecentTrialActivity&&product.mostRecentPricingUpdate){product.mostRecentTrialActivity=product.mostRecentPricingUpdate;}});// Fix any infinite values in price ranges\nObject.values(groups).forEach(product=>{Object.values(product.countries).forEach(countryData=>{if(countryData.priceRange.min===Infinity){countryData.priceRange.min=0;}if(countryData.priceRange.max===-Infinity){countryData.priceRange.max=0;}});});setProductGroups(groups);};const toggleProductExpansion=productId=>{const newExpanded=new Set(expandedProducts);if(newExpanded.has(productId)){newExpanded.delete(productId);}else{newExpanded.add(productId);}setExpandedProducts(newExpanded);};const deleteRule=async ruleId=>{if(!window.confirm('Are you sure you want to delete this pricing rule?')){return;}try{const response=await fetch(\"/api/pricing/rules/\".concat(ruleId,\"?hard_delete=true\"),{method:'DELETE'});const data=await response.json();if(data.success){// Remove the rule from frontend state immediately\nsetRules(rules.filter(rule=>rule.rule_id!==ruleId));// Also reload all data to ensure consistency across all affected areas\nloadPricingRules();}else{setError(data.error||'Failed to delete rule');}}catch(err){setError('Network error deleting rule');console.error('Error deleting rule:',err);}};const createRule=async e=>{e.preventDefault();try{const response=await fetch('/api/pricing/rules',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({product_id:formData.product_id,price_usd:parseFloat(formData.price_usd),start_date:formData.start_date,countries:formData.countries})});const data=await response.json();if(data.success){setShowCreateModal(false);setFormData({product_id:'',price_usd:'',start_date:'',countries:[]});loadPricingRules();}else{setError(data.error||'Failed to create rule');}}catch(err){setError('Network error creating rule');console.error('Error creating rule:',err);}};const roundToNearestPricePoint=price=>{// Round to nearest $5 increment, then subtract $0.01 to make it .99\nconst nearestFive=Math.round(price/5)*5;const finalPrice=nearestFive-0.01;// Ensure minimum price of $4.99\nreturn Math.max(4.99,finalPrice);};const fetchSuggestedPrice=async productId=>{if(!productId)return;setLoadingPrice(true);try{const response=await fetch(\"/api/pricing/products/\".concat(productId,\"/most-recent-conversion-price\"));const data=await response.json();if(data.success){// Round the suggested price to nearest $5 increment minus $0.01\nconst roundedPrice=roundToNearestPricePoint(data.data.suggested_price);setSuggestedPrice(_objectSpread(_objectSpread({},data.data),{},{suggested_price:roundedPrice,original_price:data.data.suggested_price,note:\"Rounded from $\".concat(data.data.suggested_price,\" to $\").concat(roundedPrice,\" (\").concat(data.data.note,\")\")}));setFormData(prev=>_objectSpread(_objectSpread({},prev),{},{price_usd:roundedPrice.toString()}));}else{setSuggestedPrice(null);}}catch(err){console.error('Error fetching suggested price:',err);setSuggestedPrice(null);}finally{setLoadingPrice(false);}};const handleCountrySelectAll=()=>{if(countrySelectAll){// Deselect all\nsetFormData(_objectSpread(_objectSpread({},formData),{},{countries:[]}));setCountrySelectAll(false);}else{// Select all\nsetFormData(_objectSpread(_objectSpread({},formData),{},{countries:[...countries]}));setCountrySelectAll(true);}};const getDefaultStartDate=productId=>{// Check if this product has any existing rules\nconst existingRules=rules.filter(rule=>rule.product_id===productId);if(existingRules.length===0){// First rule for this product - default to Jan 1 2024\nreturn'2024-01-01';}else{// Subsequent rule - leave empty\nreturn'';}};const openCreateModal=function(){let productId=arguments.length>0&&arguments[0]!==undefined?arguments[0]:'';const defaultStartDate=productId?getDefaultStartDate(productId):'';setFormData({product_id:productId,price_usd:'',start_date:defaultStartDate,countries:[...countries]// Auto-select all countries by default\n});// Reset smart defaults\nsetSuggestedPrice(null);setCountrySelectAll(true);// Set to true since we're selecting all countries\n// If we have a specific product, fetch suggested price\nif(productId){fetchSuggestedPrice(productId);}setShowCreateModal(true);};const formatDate=dateStr=>{if(!dateStr)return'Ongoing';return new Date(dateStr).toLocaleDateString();};const getRuleStatusColor=function(rule){let countryRules=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;const now=new Date();const startDate=new Date(rule.start_date);let endDate=rule.end_date?new Date(rule.end_date):null;// If no explicit end date and we have country rules, calculate effective end date\nif(!endDate&&countryRules&&Array.isArray(countryRules)){// Find the next rule that starts after this rule\nconst sortedRules=countryRules.filter(r=>r.rule_id!==rule.rule_id)// Exclude current rule\n.sort((a,b)=>new Date(a.start_date)-new Date(b.start_date));const nextRule=sortedRules.find(r=>new Date(r.start_date)>startDate);if(nextRule){// This rule effectively ends the day before the next rule starts\nconst nextStartDate=new Date(nextRule.start_date);endDate=new Date(nextStartDate.getTime()-24*60*60*1000);// Previous day\n}}if(endDate&&now>endDate){return'bg-gray-100 border-gray-300 text-gray-600';// Historical\n}else if(now>=startDate&&(!endDate||now<=endDate)){return'bg-green-100 border-green-300 text-green-800';// Active\n}else{return'bg-blue-100 border-blue-300 text-blue-800';// Future\n}};const getRuleStatusLabel=function(rule){let countryRules=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;const now=new Date();const startDate=new Date(rule.start_date);let endDate=rule.end_date?new Date(rule.end_date):null;// If no explicit end date and we have country rules, calculate effective end date\nif(!endDate&&countryRules&&Array.isArray(countryRules)){// Find the next rule that starts after this rule\nconst sortedRules=countryRules.filter(r=>r.rule_id!==rule.rule_id)// Exclude current rule\n.sort((a,b)=>new Date(a.start_date)-new Date(b.start_date));const nextRule=sortedRules.find(r=>new Date(r.start_date)>startDate);if(nextRule){// This rule effectively ends the day before the next rule starts\nconst nextStartDate=new Date(nextRule.start_date);endDate=new Date(nextStartDate.getTime()-24*60*60*1000);// Previous day\n}}if(endDate&&now>endDate){return'Historical';}else if(now>=startDate&&(!endDate||now<=endDate)){return'Active';}else{return'Future';}};const formatPriceRange=countryData=>{if(countryData.priceRange.min===countryData.priceRange.max){return\"$\".concat(countryData.priceRange.min);}return\"$\".concat(countryData.priceRange.min,\" - $\").concat(countryData.priceRange.max);};const getPriceProgression=product=>{if(!product||!product.countries||Object.keys(product.countries).length===0){return[];}// Get all rules across all countries for this product\nconst allRules=[];Object.values(product.countries).forEach(countryData=>{allRules.push(...countryData.rules);});// Remove duplicates (same rule might appear in multiple countries)\nconst uniqueRules=allRules.filter((rule,index,self)=>index===self.findIndex(r=>r.rule_id===rule.rule_id));// Sort by start date to show progression\nconst sortedRules=uniqueRules.sort((a,b)=>new Date(a.start_date)-new Date(b.start_date));// Create price progression - show unique price points in chronological order\nconst priceProgression=[];let lastPrice=null;sortedRules.forEach(rule=>{if(rule.price_usd!==lastPrice){priceProgression.push({price:rule.price_usd,date:rule.start_date,ruleId:rule.rule_id});lastPrice=rule.price_usd;}});return priceProgression;};const sortCountriesByRecentActivity=(countries,productCountries)=>{/**\n     * Sort countries by most recent rule update, then alphabetically\n     * @param {Array} countries - Array of country codes\n     * @param {Object} productCountries - Product countries data with rules\n     * @returns {Array} Sorted country codes\n     */// More detailed debugging\nconsole.log('🔍 sortCountriesByRecentActivity called with:',{countriesCount:countries.length,firstFewCountries:countries.slice(0,5),hasProductCountries:!!productCountries,productCountriesKeys:Object.keys(productCountries||{}).slice(0,5)});const sortedCountries=countries.sort((a,b)=>{const countryA=productCountries[a];const countryB=productCountries[b];// Get the most recent rule start date for each country\nconst getMostRecentRuleDate=countryData=>{if(!countryData||!countryData.rules||countryData.rules.length===0){return null;}// Rules are already sorted with newest first, so take the first one\nreturn new Date(countryData.rules[0].start_date);};const dateA=getMostRecentRuleDate(countryA);const dateB=getMostRecentRuleDate(countryB);// If both have dates, sort by most recent first\nif(dateA&&dateB){const dateDiff=dateB-dateA;// Most recent first\nif(dateDiff!==0)return dateDiff;}// If only one has a date, prioritize it\nif(dateA&&!dateB)return-1;if(!dateA&&dateB)return 1;// If both have same date or no dates, sort alphabetically\nreturn a.localeCompare(b);});// Show the results\nif(countries.includes('US')){console.log('🎯 Final sorted countries (first 10):',sortedCountries.slice(0,10));const usIndex=sortedCountries.indexOf('US');const adIndex=sortedCountries.indexOf('AD');const aeIndex=sortedCountries.indexOf('AE');console.log(\"\\uD83D\\uDCCD Positions - US: \".concat(usIndex+1,\", AD: \").concat(adIndex+1,\", AE: \").concat(aeIndex+1));// Show the most recent rule for US, AD, AE\nif(productCountries['US']&&productCountries['US'].rules&&productCountries['US'].rules[0]){console.log(\"\\uD83C\\uDDFA\\uD83C\\uDDF8 US most recent rule:\",productCountries['US'].rules[0].start_date,\"$\".concat(productCountries['US'].rules[0].price_usd));}if(productCountries['AD']&&productCountries['AD'].rules&&productCountries['AD'].rules[0]){console.log(\"\\uD83C\\uDDE6\\uD83C\\uDDE9 AD most recent rule:\",productCountries['AD'].rules[0].start_date,\"$\".concat(productCountries['AD'].rules[0].price_usd));}}return sortedCountries;};// Filter and sort products based on search and most recent trial activity\nconst filteredProducts=Object.keys(productGroups).filter(productId=>productId.toLowerCase().includes(searchTerm.toLowerCase())).sort((a,b)=>{const productA=productGroups[a];const productB=productGroups[b];// First, separate products with rules vs missing rules\nconst aMissingRules=(productA===null||productA===void 0?void 0:productA.hasMissingRules)||false;const bMissingRules=(productB===null||productB===void 0?void 0:productB.hasMissingRules)||false;// Products with rules come first, missing rules go to bottom\nif(aMissingRules&&!bMissingRules)return 1;// A has missing rules, goes to bottom\nif(!aMissingRules&&bMissingRules)return-1;// B has missing rules, goes to bottom\n// Within each group, sort by most recent trial activity (more urgent trials first)\nconst dateA=productA===null||productA===void 0?void 0:productA.mostRecentTrialActivity;const dateB=productB===null||productB===void 0?void 0:productB.mostRecentTrialActivity;if(!dateA&&!dateB)return a.localeCompare(b);// Fallback to alphabetical\nif(!dateA)return 1;// Products without trial dates go to the end of their group\nif(!dateB)return-1;return dateB-dateA;// Most recent trial activity first within each group\n});if(loading){return/*#__PURE__*/_jsx(\"div\",{className:\"container mx-auto p-6\",children:/*#__PURE__*/_jsx(\"div\",{className:\"flex justify-center items-center h-64\",children:/*#__PURE__*/_jsx(\"div\",{className:\"text-lg\",children:\"Loading pricing rules...\"})})});}return/*#__PURE__*/_jsxs(\"div\",{className:\"container mx-auto p-6\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"mb-6\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h1\",{className:\"text-3xl font-bold mb-2\",children:\"Pricing Management\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-600 dark:text-gray-400\",children:\"Manage product pricing across different countries and time periods\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-right\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"inline-flex items-center px-3 py-1 rounded-full text-sm font-medium \".concat(schemaVersion==='2.0.0'?'bg-green-100 text-green-800 dark:bg-green-800 dark:text-green-200':'bg-blue-100 text-blue-800 dark:bg-blue-800 dark:text-blue-200'),children:[\"Schema v\",schemaVersion]}),schemaVersion==='2.0.0'&&missingProducts.length>0&&/*#__PURE__*/_jsx(\"div\",{className:\"mt-1 text-xs text-red-600 dark:text-red-400\",children:\"Enhanced with missing product detection\"})]})]})}),autoRepairNotification&&/*#__PURE__*/_jsx(\"div\",{className:\"bg-emerald-50 border border-emerald-200 dark:border-emerald-800 text-emerald-800 dark:text-emerald-200 px-4 py-3 rounded-xl mb-4 shadow-sm\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-3\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-8 h-8 rounded-full bg-emerald-500 flex items-center justify-center\",children:/*#__PURE__*/_jsx(\"svg\",{className:\"w-4 h-4 text-white\",fill:\"currentColor\",viewBox:\"0 0 20 20\",children:/*#__PURE__*/_jsx(\"path\",{fillRule:\"evenodd\",d:\"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z\",clipRule:\"evenodd\"})})}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"font-semibold\",children:autoRepairNotification.message}),/*#__PURE__*/_jsx(\"p\",{className:\"text-sm opacity-80\",children:\"End dates have been automatically calculated based on newer rules\"})]})]}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setAutoRepairNotification(null),className:\"text-emerald-600 hover:text-emerald-800 dark:text-emerald-400 dark:hover:text-emerald-300 transition-colors\",children:/*#__PURE__*/_jsx(\"svg\",{className:\"w-5 h-5\",fill:\"currentColor\",viewBox:\"0 0 20 20\",children:/*#__PURE__*/_jsx(\"path\",{fillRule:\"evenodd\",d:\"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z\",clipRule:\"evenodd\"})})})]})}),error&&/*#__PURE__*/_jsxs(\"div\",{className:\"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4\",children:[error,/*#__PURE__*/_jsx(\"button\",{onClick:()=>setError(null),className:\"float-right text-red-700 hover:text-red-900\",children:\"\\xD7\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"bg-white dark:bg-gray-800 rounded-lg shadow-md p-4 mb-6\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-wrap gap-4 items-center justify-between\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"flex-1 min-w-64\",children:/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"Search by product ID...\",value:searchTerm,onChange:e=>setSearchTerm(e.target.value),className:\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700\"})}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex gap-2\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>openCreateModal(),className:\"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md\",children:\"Create Rule\"}),/*#__PURE__*/_jsx(\"button\",{onClick:forceRepairRules,className:\"bg-orange-600 hover:bg-orange-700 text-white px-4 py-2 rounded-md\",disabled:loading,children:\"\\uD83D\\uDD27 Fix \\\"Ongoing\\\" Rules\"}),/*#__PURE__*/_jsx(\"button\",{onClick:loadPricingRules,className:\"bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-md\",children:\"Refresh\"})]})]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-6 gap-4 mb-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white dark:bg-gray-800 rounded-lg shadow-md p-4\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-2xl font-bold text-blue-600\",children:filteredProducts.length}),/*#__PURE__*/_jsx(\"div\",{className:\"text-sm text-gray-600 dark:text-gray-400\",children:\"Products\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white dark:bg-gray-800 rounded-lg shadow-md p-4\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-2xl font-bold text-green-600\",children:filteredProducts.reduce((sum,productId)=>{var _productGroups$produc;return sum+(((_productGroups$produc=productGroups[productId])===null||_productGroups$produc===void 0?void 0:_productGroups$produc.totalRules)||0);},0)}),/*#__PURE__*/_jsx(\"div\",{className:\"text-sm text-gray-600 dark:text-gray-400\",children:\"Total Rules\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white dark:bg-gray-800 rounded-lg shadow-md p-4\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-2xl font-bold \".concat(filteredProducts.filter(productId=>{var _productGroups$produc2;return(_productGroups$produc2=productGroups[productId])===null||_productGroups$produc2===void 0?void 0:_productGroups$produc2.hasMissingRules;}).length>0?'text-red-600':'text-gray-400'),children:filteredProducts.filter(productId=>{var _productGroups$produc3;return(_productGroups$produc3=productGroups[productId])===null||_productGroups$produc3===void 0?void 0:_productGroups$produc3.hasMissingRules;}).length}),/*#__PURE__*/_jsx(\"div\",{className:\"text-sm text-gray-600 dark:text-gray-400\",children:\"Missing Rules\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white dark:bg-gray-800 rounded-lg shadow-md p-4\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-2xl font-bold text-purple-600\",children:[...new Set(filteredProducts.flatMap(productId=>{var _productGroups$produc4;return((_productGroups$produc4=productGroups[productId])===null||_productGroups$produc4===void 0?void 0:_productGroups$produc4.allCountries)||[];}))].length}),/*#__PURE__*/_jsx(\"div\",{className:\"text-sm text-gray-600 dark:text-gray-400\",children:\"Countries\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white dark:bg-gray-800 rounded-lg shadow-md p-4\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-2xl font-bold text-orange-600\",children:(()=>{const thirtyDaysAgo=new Date();thirtyDaysAgo.setDate(thirtyDaysAgo.getDate()-30);return filteredProducts.filter(productId=>{var _productGroups$produc5;const lastUpdate=(_productGroups$produc5=productGroups[productId])===null||_productGroups$produc5===void 0?void 0:_productGroups$produc5.mostRecentPricingUpdate;return lastUpdate&&lastUpdate>thirtyDaysAgo;}).length;})()}),/*#__PURE__*/_jsx(\"div\",{className:\"text-sm text-gray-600 dark:text-gray-400\",children:\"Recent Updates\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white dark:bg-gray-800 rounded-lg shadow-md p-4\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-2xl font-bold text-indigo-600\",children:filteredProducts.filter(productId=>expandedProducts.has(productId)).length}),/*#__PURE__*/_jsx(\"div\",{className:\"text-sm text-gray-600 dark:text-gray-400\",children:\"Expanded\"})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"space-y-4\",children:filteredProducts.length===0?/*#__PURE__*/_jsx(\"div\",{className:\"bg-white dark:bg-gray-800 rounded-lg shadow-md p-8 text-center text-gray-500 dark:text-gray-400\",children:Object.keys(productGroups).length===0?'No pricing rules found':'No products match your search criteria'}):filteredProducts.map(productId=>{var _product$mostRecentTr;const product=productGroups[productId];const isExpanded=expandedProducts.has(productId);return/*#__PURE__*/_jsxs(\"div\",{className:\"group relative overflow-hidden transition-all duration-300 ease-out \".concat(product.hasMissingRules?'bg-gradient-to-br from-rose-50 to-red-50 dark:from-red-950/30 dark:to-red-900/20 border-2 border-rose-200 dark:border-red-800/50 shadow-lg shadow-red-100/50 dark:shadow-red-900/20':'bg-white dark:bg-slate-900 border border-slate-200/60 dark:border-slate-700/50 shadow-sm hover:shadow-xl hover:shadow-slate-200/30 dark:hover:shadow-slate-900/30',\" rounded-2xl backdrop-blur-sm\"),children:[/*#__PURE__*/_jsxs(\"div\",{className:\"relative p-6 border-b cursor-pointer transition-all duration-200 \".concat(product.hasMissingRules?'border-rose-200/70 dark:border-red-800/40 hover:bg-gradient-to-br hover:from-rose-100 hover:to-red-100 dark:hover:from-red-950/40 dark:hover:to-red-900/30':'border-slate-200/60 dark:border-slate-700/50 hover:bg-slate-50/70 dark:hover:bg-slate-800/50'),onClick:()=>toggleProductExpansion(productId),children:[product.hasMissingRules&&/*#__PURE__*/_jsxs(\"div\",{className:\"absolute top-0 left-0 right-0 bg-gradient-to-r from-rose-500 to-red-500 text-white text-xs font-semibold px-4 py-2 flex items-center gap-2\",children:[/*#__PURE__*/_jsx(\"svg\",{className:\"w-4 h-4\",fill:\"currentColor\",viewBox:\"0 0 20 20\",children:/*#__PURE__*/_jsx(\"path\",{fillRule:\"evenodd\",d:\"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z\",clipRule:\"evenodd\"})}),/*#__PURE__*/_jsx(\"span\",{children:\"MISSING PRICING RULES \\u2014 URGENT ACTION REQUIRED\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"\".concat(product.hasMissingRules?'mt-8':'',\" flex items-center justify-between\"),children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex-1 min-w-0\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-4 mb-3\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-2xl font-bold tracking-tight \".concat(product.hasMissingRules?'text-red-900 dark:text-red-100':'text-slate-900 dark:text-slate-100'),children:productId}),/*#__PURE__*/_jsx(\"div\",{className:\"flex items-center gap-2\",children:/*#__PURE__*/_jsx(\"div\",{className:\"inline-flex items-center gap-1.5 px-3 py-1 rounded-full text-xs font-semibold transition-all \".concat(product.hasMissingRules?'bg-red-500 text-white shadow-md':'bg-emerald-100 text-emerald-800 dark:bg-emerald-900/30 dark:text-emerald-300'),children:product.hasMissingRules?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"svg\",{className:\"w-3 h-3\",fill:\"currentColor\",viewBox:\"0 0 20 20\",children:/*#__PURE__*/_jsx(\"path\",{fillRule:\"evenodd\",d:\"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z\",clipRule:\"evenodd\"})}),\"Missing Rules\"]}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"svg\",{className:\"w-3 h-3\",fill:\"currentColor\",viewBox:\"0 0 20 20\",children:/*#__PURE__*/_jsx(\"path\",{fillRule:\"evenodd\",d:\"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z\",clipRule:\"evenodd\"})}),\"Active Rules\"]})})})]}),product.hasMissingRules&&product.missingProductInfo?/*#__PURE__*/_jsx(\"div\",{className:\"mb-4 p-4 bg-white/90 dark:bg-slate-800/90 backdrop-blur-sm border border-red-200/50 dark:border-red-800/50 rounded-xl shadow-sm\",children:/*#__PURE__*/_jsx(\"div\",{className:\"space-y-2\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-start gap-3\",children:[/*#__PURE__*/_jsx(\"svg\",{className:\"w-5 h-5 text-red-500 mt-0.5 flex-shrink-0\",fill:\"currentColor\",viewBox:\"0 0 20 20\",children:/*#__PURE__*/_jsx(\"path\",{fillRule:\"evenodd\",d:\"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z\",clipRule:\"evenodd\"})}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-sm font-semibold text-red-900 dark:text-red-100 mb-1\",children:\"Active trials without pricing rules detected\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-2 gap-x-4 gap-y-1 text-xs text-red-800 dark:text-red-200\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"span\",{className:\"font-medium\",children:product.missingProductInfo.trial_count}),\" trial events\"]}),/*#__PURE__*/_jsxs(\"div\",{children:[\"First: \",/*#__PURE__*/_jsx(\"span\",{className:\"font-medium\",children:formatDate(product.missingProductInfo.first_trial)})]}),/*#__PURE__*/_jsxs(\"div\",{children:[\"Latest: \",/*#__PURE__*/_jsx(\"span\",{className:\"font-medium\",children:formatDate(product.missingProductInfo.last_trial)})]}),/*#__PURE__*/_jsx(\"div\",{className:\"col-span-2 mt-1 text-red-700 dark:text-red-300 font-medium\",children:\"\\u26A0\\uFE0F Revenue analysis incomplete without pricing rules\"})]})]})]})})}):/*#__PURE__*//* Normal product metrics */_jsxs(\"div\",{className:\"flex items-center gap-6 mb-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-2\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-2 h-2 rounded-full bg-blue-500\"}),/*#__PURE__*/_jsxs(\"span\",{className:\"text-sm font-medium text-slate-700 dark:text-slate-300\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"font-bold text-slate-900 dark:text-slate-100\",children:product.totalRules}),\" rules\"]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-2\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-2 h-2 rounded-full bg-purple-500\"}),/*#__PURE__*/_jsxs(\"span\",{className:\"text-sm font-medium text-slate-700 dark:text-slate-300\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"font-bold text-slate-900 dark:text-slate-100\",children:product.allCountries.length}),\" countries\"]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-2\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-2 h-2 rounded-full bg-emerald-500\"}),/*#__PURE__*/_jsxs(\"span\",{className:\"text-sm font-medium text-slate-700 dark:text-slate-300\",children:[\"Last activity: \",/*#__PURE__*/_jsx(\"span\",{className:\"font-bold text-slate-900 dark:text-slate-100\",children:formatDate((_product$mostRecentTr=product.mostRecentTrialActivity)===null||_product$mostRecentTr===void 0?void 0:_product$mostRecentTr.toISOString().split('T')[0])})]})]})]}),!product.hasMissingRules&&product.allCountries.length>0&&/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-wrap gap-1.5 mb-4\",children:[sortCountriesByRecentActivity([...product.allCountries],product.countries).slice(0,12).map(country=>/*#__PURE__*/_jsx(\"span\",{className:\"inline-flex items-center px-2.5 py-1 rounded-lg text-xs font-medium bg-blue-50 text-blue-700 border border-blue-200/50 dark:bg-blue-900/30 dark:text-blue-300 dark:border-blue-800/50 transition-colors hover:bg-blue-100 dark:hover:bg-blue-900/50\",children:country},country)),product.allCountries.length>12&&/*#__PURE__*/_jsxs(\"span\",{className:\"inline-flex items-center px-2.5 py-1 rounded-lg text-xs font-medium bg-slate-100 text-slate-600 border border-slate-200/50 dark:bg-slate-800 dark:text-slate-400 dark:border-slate-700\",children:[\"+\",product.allCountries.length-12,\" more\"]})]}),!product.hasMissingRules&&(()=>{const priceProgression=getPriceProgression(product);return priceProgression.length>0&&/*#__PURE__*/_jsxs(\"div\",{className:\"p-4 bg-gradient-to-br from-slate-50 to-slate-100/50 dark:from-slate-800/50 dark:to-slate-900/50 rounded-xl border border-slate-200/50 dark:border-slate-700/50 backdrop-blur-sm\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-2 mb-3\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-2\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-6 h-6 rounded-lg bg-gradient-to-br from-emerald-500 to-green-600 flex items-center justify-center\",children:/*#__PURE__*/_jsx(\"svg\",{className:\"w-3.5 h-3.5 text-white\",fill:\"none\",stroke:\"currentColor\",viewBox:\"0 0 24 24\",children:/*#__PURE__*/_jsx(\"path\",{strokeLinecap:\"round\",strokeLinejoin:\"round\",strokeWidth:2,d:\"M13 7h8m0 0v8m0-8l-8 8-4-4-6 6\"})})}),/*#__PURE__*/_jsx(\"h4\",{className:\"text-sm font-bold text-slate-800 dark:text-slate-200\",children:\"Price Evolution\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"flex-1\"}),/*#__PURE__*/_jsxs(\"span\",{className:\"text-xs font-medium text-slate-500 dark:text-slate-400 bg-white/70 dark:bg-slate-800/70 px-2 py-1 rounded-md\",children:[priceProgression.length,\" changes\"]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"flex items-center gap-3 overflow-x-auto pb-2\",style:{scrollbarWidth:'thin'},children:priceProgression.map((point,index)=>/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-3 flex-shrink-0\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-center group\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"relative\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"text-xl font-black text-emerald-700 dark:text-emerald-400 mb-0.5 group-hover:scale-105 transition-transform\",children:[\"$\",point.price]}),/*#__PURE__*/_jsx(\"div\",{className:\"text-xs font-medium text-slate-500 dark:text-slate-400 bg-white/80 dark:bg-slate-800/80 px-2 py-0.5 rounded-md shadow-sm\",children:formatDate(point.date)})]})}),index<priceProgression.length-1&&/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-8 h-0.5 bg-gradient-to-r from-slate-300 to-slate-400 dark:from-slate-600 dark:to-slate-500 rounded-full\"}),/*#__PURE__*/_jsx(\"svg\",{className:\"w-3 h-3 text-slate-400 dark:text-slate-500 -ml-1\",fill:\"currentColor\",viewBox:\"0 0 20 20\",children:/*#__PURE__*/_jsx(\"path\",{fillRule:\"evenodd\",d:\"M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z\",clipRule:\"evenodd\"})})]})]},point.ruleId))})]});})()]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-3 ml-6\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:e=>{e.stopPropagation();openCreateModal(productId);},className:\"group relative overflow-hidden px-5 py-2.5 rounded-xl text-sm font-semibold transition-all duration-200 transform hover:scale-105 active:scale-95 shadow-lg \".concat(product.hasMissingRules?'bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white shadow-red-200 dark:shadow-red-900/30':'bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white shadow-blue-200 dark:shadow-blue-900/30'),children:/*#__PURE__*/_jsxs(\"div\",{className:\"relative z-10 flex items-center gap-2\",children:[/*#__PURE__*/_jsx(\"svg\",{className:\"w-4 h-4\",fill:\"none\",stroke:\"currentColor\",viewBox:\"0 0 24 24\",children:/*#__PURE__*/_jsx(\"path\",{strokeLinecap:\"round\",strokeLinejoin:\"round\",strokeWidth:2,d:\"M12 6v6m0 0v6m0-6h6m-6 0H6\"})}),product.hasMissingRules?'Create First Rule':'Add Rule']})}),!product.hasMissingRules&&/*#__PURE__*/_jsx(\"button\",{onClick:e=>{e.stopPropagation();loadRuleHistory(productId);},className:\"group relative overflow-hidden px-5 py-2.5 rounded-xl text-sm font-semibold transition-all duration-200 transform hover:scale-105 active:scale-95 bg-gradient-to-r from-slate-600 to-slate-700 hover:from-slate-700 hover:to-slate-800 text-white shadow-lg shadow-slate-200 dark:shadow-slate-900/30\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"relative z-10 flex items-center gap-2\",children:[/*#__PURE__*/_jsx(\"svg\",{className:\"w-4 h-4\",fill:\"none\",stroke:\"currentColor\",viewBox:\"0 0 24 24\",children:/*#__PURE__*/_jsx(\"path\",{strokeLinecap:\"round\",strokeLinejoin:\"round\",strokeWidth:2,d:\"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z\"})}),\"History\"]})}),/*#__PURE__*/_jsx(\"div\",{className:\"flex items-center justify-center w-10 h-10 rounded-xl bg-slate-100 dark:bg-slate-800 group-hover:bg-slate-200 dark:group-hover:bg-slate-700 transition-colors\",children:/*#__PURE__*/_jsx(\"svg\",{className:\"w-5 h-5 text-slate-600 dark:text-slate-400 transform transition-transform duration-200 \".concat(isExpanded?'rotate-180':''),fill:\"none\",stroke:\"currentColor\",viewBox:\"0 0 24 24\",children:/*#__PURE__*/_jsx(\"path\",{strokeLinecap:\"round\",strokeLinejoin:\"round\",strokeWidth:2,d:\"M19 9l-7 7-7-7\"})})})]})]})]}),isExpanded&&/*#__PURE__*/_jsx(\"div\",{className:\"p-6 bg-gradient-to-br from-slate-50/50 to-white dark:from-slate-800/50 dark:to-slate-900/50\",children:/*#__PURE__*/_jsx(\"div\",{className:\"space-y-6\",children:sortCountriesByRecentActivity([...product.allCountries],product.countries).map(country=>{const countryData=product.countries[country];return/*#__PURE__*/_jsxs(\"div\",{className:\"group relative overflow-hidden bg-white dark:bg-slate-800/90 border border-slate-200/60 dark:border-slate-700/50 rounded-2xl shadow-sm hover:shadow-lg transition-all duration-300 backdrop-blur-sm\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"relative p-6 bg-gradient-to-r from-slate-50 via-white to-slate-50 dark:from-slate-800/80 dark:via-slate-800/60 dark:to-slate-800/80 border-b border-slate-200/60 dark:border-slate-700/50\",children:/*#__PURE__*/_jsx(\"div\",{className:\"flex items-center justify-between\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-3\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-12 h-12 rounded-xl bg-gradient-to-br from-blue-500 to-indigo-600 flex items-center justify-center shadow-lg shadow-blue-200/50 dark:shadow-blue-900/30\",children:/*#__PURE__*/_jsx(\"span\",{className:\"text-white font-bold text-lg\",children:country.slice(0,2).toUpperCase()})}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h4\",{className:\"text-2xl font-bold text-slate-900 dark:text-slate-100\",children:country}),/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-slate-600 dark:text-slate-400\",children:\"Pricing timeline\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-3 px-4 py-2 bg-white/70 dark:bg-slate-800/70 backdrop-blur-sm rounded-xl border border-slate-200/50 dark:border-slate-700/50 shadow-sm\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-2 h-2 rounded-full bg-blue-500\"}),/*#__PURE__*/_jsxs(\"span\",{className:\"text-sm font-semibold text-slate-700 dark:text-slate-300\",children:[countryData.rules.length,\" rules\"]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-3 px-4 py-2 bg-gradient-to-r from-emerald-50 to-green-50 dark:from-emerald-900/30 dark:to-green-900/30 backdrop-blur-sm rounded-xl border border-emerald-200/50 dark:border-emerald-800/50 shadow-sm\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-2 h-2 rounded-full bg-emerald-500\"}),/*#__PURE__*/_jsx(\"span\",{className:\"text-lg font-black text-emerald-700 dark:text-emerald-400\",children:formatPriceRange(countryData)})]})]})]})})}),/*#__PURE__*/_jsxs(\"div\",{className:\"p-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-3 mb-6\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-8 h-8 rounded-xl bg-gradient-to-br from-slate-600 to-slate-700 flex items-center justify-center shadow-md\",children:/*#__PURE__*/_jsx(\"svg\",{className:\"w-4 h-4 text-white\",fill:\"none\",stroke:\"currentColor\",viewBox:\"0 0 24 24\",children:/*#__PURE__*/_jsx(\"path\",{strokeLinecap:\"round\",strokeLinejoin:\"round\",strokeWidth:2,d:\"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z\"})})}),/*#__PURE__*/_jsx(\"h5\",{className:\"text-lg font-bold text-slate-800 dark:text-slate-200\",children:\"Chronological Pricing History\"}),/*#__PURE__*/_jsx(\"div\",{className:\"flex-1 h-px bg-gradient-to-r from-slate-200 to-transparent dark:from-slate-700\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"relative\",children:/*#__PURE__*/_jsx(\"div\",{className:\"flex gap-6 overflow-x-auto pb-4 scrollbar-hide\",style:{scrollbarWidth:'none'},children:countryData.rules.map((rule,index)=>{const status=getRuleStatusLabel(rule,countryData.rules);const isActive=status==='Active';const isFuture=status==='Future';const isHistorical=status==='Historical';return/*#__PURE__*/_jsxs(\"div\",{className:\"relative flex-shrink-0 w-80 group/card transition-all duration-300 hover:scale-105\",children:[index<countryData.rules.length-1&&/*#__PURE__*/_jsx(\"div\",{className:\"absolute top-1/2 -right-3 z-10 w-6 h-px bg-gradient-to-r from-slate-300 via-slate-400 to-slate-300 dark:from-slate-600 dark:via-slate-500 dark:to-slate-600\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"relative overflow-hidden rounded-2xl shadow-lg transition-all duration-300 group-hover/card:shadow-xl \".concat(isActive?'bg-gradient-to-br from-emerald-50 via-green-50 to-emerald-100 dark:from-emerald-950/50 dark:via-emerald-900/30 dark:to-green-900/40 border-2 border-emerald-300/60 dark:border-emerald-700/50 shadow-emerald-200/50 dark:shadow-emerald-900/30':isFuture?'bg-gradient-to-br from-blue-50 via-sky-50 to-blue-100 dark:from-blue-950/50 dark:via-blue-900/30 dark:to-sky-900/40 border-2 border-blue-300/60 dark:border-blue-700/50 shadow-blue-200/50 dark:shadow-blue-900/30':'bg-gradient-to-br from-slate-50 via-gray-50 to-slate-100 dark:from-slate-800/50 dark:via-slate-900/30 dark:to-slate-800/40 border-2 border-slate-300/60 dark:border-slate-700/50 shadow-slate-200/50 dark:shadow-slate-900/30'),children:[/*#__PURE__*/_jsx(\"div\",{className:\"absolute top-0 left-0 right-0 h-1 bg-gradient-to-r from-transparent via-current to-transparent opacity-60\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"p-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between mb-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"inline-flex items-center gap-2 px-3 py-1.5 rounded-xl text-xs font-bold shadow-sm \".concat(isActive?'bg-emerald-500 text-white':isFuture?'bg-blue-500 text-white':'bg-slate-500 text-white'),children:[isActive&&/*#__PURE__*/_jsx(\"div\",{className:\"w-2 h-2 bg-white rounded-full animate-pulse\"}),isFuture&&/*#__PURE__*/_jsx(\"svg\",{className:\"w-3 h-3\",fill:\"currentColor\",viewBox:\"0 0 20 20\",children:/*#__PURE__*/_jsx(\"path\",{fillRule:\"evenodd\",d:\"M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z\",clipRule:\"evenodd\"})}),isHistorical&&/*#__PURE__*/_jsx(\"svg\",{className:\"w-3 h-3\",fill:\"currentColor\",viewBox:\"0 0 20 20\",children:/*#__PURE__*/_jsx(\"path\",{fillRule:\"evenodd\",d:\"M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z\",clipRule:\"evenodd\"})}),status.toUpperCase()]}),/*#__PURE__*/_jsx(\"div\",{className:\"text-xs font-mono text-slate-500 dark:text-slate-400 bg-white/80 dark:bg-slate-800/80 px-2 py-1 rounded-lg\",children:rule.rule_id.slice(-8)})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mb-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"text-4xl font-black text-slate-900 dark:text-slate-100 mb-2 tracking-tight\",children:[\"$\",rule.price_usd]}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-sm font-semibold \".concat(isActive?'text-emerald-700 dark:text-emerald-300':isFuture?'text-blue-700 dark:text-blue-300':'text-slate-600 dark:text-slate-400'),children:[formatDate(rule.start_date),/*#__PURE__*/_jsx(\"span\",{className:\"mx-2 opacity-60\",children:\"\\u2192\"}),formatDate(rule.end_date)||/*#__PURE__*/_jsxs(\"span\",{className:\"inline-flex items-center gap-1 \".concat(isActive?'text-emerald-600':'text-slate-500'),children:[isActive&&/*#__PURE__*/_jsx(\"div\",{className:\"w-1.5 h-1.5 bg-emerald-500 rounded-full animate-pulse\"}),\"Ongoing\"]})]})]}),/*#__PURE__*/_jsx(\"button\",{onClick:e=>{e.stopPropagation();loadDataProvenance(rule.rule_id);},className:\"w-full group/btn relative overflow-hidden px-4 py-3 rounded-xl text-sm font-semibold transition-all duration-200 transform hover:scale-105 active:scale-95 shadow-md hover:shadow-lg \".concat(isActive?'bg-emerald-600 hover:bg-emerald-700 text-white shadow-emerald-200 dark:shadow-emerald-900/50':isFuture?'bg-blue-600 hover:bg-blue-700 text-white shadow-blue-200 dark:shadow-blue-900/50':'bg-slate-600 hover:bg-slate-700 text-white shadow-slate-200 dark:shadow-slate-900/50'),children:/*#__PURE__*/_jsxs(\"div\",{className:\"relative z-10 flex items-center justify-center gap-2\",children:[/*#__PURE__*/_jsx(\"svg\",{className:\"w-4 h-4 transition-transform group-hover/btn:scale-110\",fill:\"none\",stroke:\"currentColor\",viewBox:\"0 0 24 24\",children:/*#__PURE__*/_jsx(\"path\",{strokeLinecap:\"round\",strokeLinejoin:\"round\",strokeWidth:2,d:\"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z\"})}),\"View Data Source\"]})})]})]})]},rule.rule_id);})})})]})]},country);})})})]},productId);})}),/*#__PURE__*/_jsxs(\"div\",{className:\"mt-6 text-sm text-gray-500 dark:text-gray-400 text-center\",children:[\"Pricing rules are organized by product and country for easy market management.\",/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsxs(\"span\",{className:\"inline-flex items-center gap-4 mt-2\",children:[/*#__PURE__*/_jsxs(\"span\",{className:\"flex items-center gap-1\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-3 h-3 bg-green-100 border border-green-300 rounded\"}),\"Active\"]}),/*#__PURE__*/_jsxs(\"span\",{className:\"flex items-center gap-1\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-3 h-3 bg-blue-100 border border-blue-300 rounded\"}),\"Future\"]}),/*#__PURE__*/_jsxs(\"span\",{className:\"flex items-center gap-1\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-3 h-3 bg-gray-100 border border-gray-300 rounded\"}),\"Historical\"]})]})]}),showCreateModal&&/*#__PURE__*/_jsx(\"div\",{className:\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white dark:bg-gray-800 rounded-xl shadow-2xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-hidden\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"p-6 border-b border-gray-200 dark:border-gray-700\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-xl font-bold text-gray-900 dark:text-gray-100\",children:\"\\u2795 Create New Pricing Rule\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setShowCreateModal(false),className:\"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300\",children:/*#__PURE__*/_jsx(\"svg\",{className:\"w-6 h-6\",fill:\"none\",stroke:\"currentColor\",viewBox:\"0 0 24 24\",children:/*#__PURE__*/_jsx(\"path\",{strokeLinecap:\"round\",strokeLinejoin:\"round\",strokeWidth:2,d:\"M6 18L18 6M6 6l12 12\"})})})]}),/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-gray-600 dark:text-gray-400 mt-2\",children:\"Create a new pricing rule for a product and countries\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"p-6 overflow-y-auto max-h-[70vh]\",children:/*#__PURE__*/_jsxs(\"form\",{onSubmit:createRule,className:\"space-y-6\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\",children:\"Product ID *\"}),/*#__PURE__*/_jsxs(\"select\",{value:formData.product_id,onChange:e=>{const newProductId=e.target.value;setFormData(_objectSpread(_objectSpread({},formData),{},{product_id:newProductId,start_date:getDefaultStartDate(newProductId)}));if(newProductId){fetchSuggestedPrice(newProductId);}else{setSuggestedPrice(null);}},className:\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-blue-500 focus:border-transparent\",required:true,children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"Select a product...\"}),products.map(product=>/*#__PURE__*/_jsx(\"option\",{value:product,children:product},product))]}),formData.product_id&&((_productGroups$formDa=productGroups[formData.product_id])===null||_productGroups$formDa===void 0?void 0:_productGroups$formDa.hasMissingRules)&&/*#__PURE__*/_jsxs(\"div\",{className:\"mt-2 p-3 bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded-lg\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-2 text-amber-800 dark:text-amber-200 text-sm\",children:[/*#__PURE__*/_jsx(\"svg\",{className:\"w-4 h-4\",fill:\"currentColor\",viewBox:\"0 0 20 20\",children:/*#__PURE__*/_jsx(\"path\",{fillRule:\"evenodd\",d:\"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z\",clipRule:\"evenodd\"})}),/*#__PURE__*/_jsx(\"span\",{className:\"font-medium\",children:\"First pricing rule for this product!\"})]}),((_productGroups$formDa2=productGroups[formData.product_id])===null||_productGroups$formDa2===void 0?void 0:_productGroups$formDa2.missingProductInfo)&&/*#__PURE__*/_jsxs(\"div\",{className:\"mt-1 text-xs text-amber-700 dark:text-amber-300\",children:[\"This product has \",productGroups[formData.product_id].missingProductInfo.trial_count,\" trial events but no pricing rules yet.\"]})]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\",children:\"Price (USD) *\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"relative\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none\",children:/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-500 dark:text-gray-400\",children:\"$\"})}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",step:\"0.01\",min:\"0\",value:formData.price_usd,onChange:e=>setFormData(_objectSpread(_objectSpread({},formData),{},{price_usd:e.target.value})),className:\"w-full pl-8 pr-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-blue-500 focus:border-transparent\",placeholder:\"29.99\",required:true}),loadingPrice&&/*#__PURE__*/_jsx(\"div\",{className:\"absolute inset-y-0 right-0 pr-3 flex items-center\",children:/*#__PURE__*/_jsxs(\"svg\",{className:\"animate-spin h-4 w-4 text-gray-400\",fill:\"none\",viewBox:\"0 0 24 24\",children:[/*#__PURE__*/_jsx(\"circle\",{className:\"opacity-25\",cx:\"12\",cy:\"12\",r:\"10\",stroke:\"currentColor\",strokeWidth:\"4\"}),/*#__PURE__*/_jsx(\"path\",{className:\"opacity-75\",fill:\"currentColor\",d:\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"})]})})]}),suggestedPrice&&/*#__PURE__*/_jsxs(\"div\",{className:\"mt-2 p-3 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-2 text-green-800 dark:text-green-200 text-sm\",children:[/*#__PURE__*/_jsx(\"svg\",{className:\"w-4 h-4\",fill:\"currentColor\",viewBox:\"0 0 20 20\",children:/*#__PURE__*/_jsx(\"path\",{fillRule:\"evenodd\",d:\"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z\",clipRule:\"evenodd\"})}),/*#__PURE__*/_jsxs(\"span\",{className:\"font-medium\",children:[\"Suggested: $\",suggestedPrice.suggested_price,\" from most recent conversion\"]})]}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:()=>setFormData(_objectSpread(_objectSpread({},formData),{},{price_usd:suggestedPrice.suggested_price.toString()})),className:\"text-xs bg-green-600 hover:bg-green-700 text-white px-2 py-1 rounded\",children:\"Use This\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"mt-1 text-xs text-green-700 dark:text-green-300\",children:suggestedPrice.note})]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\",children:\"Start Date *\"}),/*#__PURE__*/_jsx(\"input\",{type:\"date\",value:formData.start_date,onChange:e=>setFormData(_objectSpread(_objectSpread({},formData),{},{start_date:e.target.value})),className:\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-blue-500 focus:border-transparent\",required:true}),formData.product_id&&/*#__PURE__*/_jsx(\"div\",{className:\"mt-2 text-xs text-gray-600 dark:text-gray-400\",children:rules.filter(rule=>rule.product_id===formData.product_id).length===0?\"💡 First rule for this product - defaulted to Jan 1, 2024\":\"📅 Additional rule - choose when this pricing takes effect\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between mb-2\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700 dark:text-gray-300\",children:\"Countries *\"}),/*#__PURE__*/_jsxs(\"button\",{type:\"button\",onClick:handleCountrySelectAll,className:\"text-sm text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300 font-medium\",children:[countrySelectAll?'Deselect All':'Select All',\" (\",countries.length,\")\"]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"max-h-40 overflow-y-auto border border-gray-300 dark:border-gray-600 rounded-md p-3 bg-white dark:bg-gray-700 space-y-2\",children:countries.map(country=>/*#__PURE__*/_jsxs(\"label\",{className:\"flex items-center space-x-3 text-sm hover:bg-gray-50 dark:hover:bg-gray-600 p-1 rounded cursor-pointer\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"checkbox\",checked:formData.countries.includes(country),onChange:e=>{if(e.target.checked){const newCountries=[...formData.countries,country];setFormData(_objectSpread(_objectSpread({},formData),{},{countries:newCountries}));setCountrySelectAll(newCountries.length===countries.length);}else{const newCountries=formData.countries.filter(c=>c!==country);setFormData(_objectSpread(_objectSpread({},formData),{},{countries:newCountries}));setCountrySelectAll(false);}},className:\"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-700 dark:focus:ring-offset-gray-700 focus:ring-2 dark:bg-gray-600 dark:border-gray-500\"}),/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-900 dark:text-gray-100 font-medium\",children:country})]},country))}),/*#__PURE__*/_jsxs(\"div\",{className:\"mt-2 flex items-center justify-between text-xs\",children:[/*#__PURE__*/_jsxs(\"span\",{className:\"text-gray-500 dark:text-gray-400\",children:[formData.countries.length,\" of \",countries.length,\" countries selected\"]}),formData.countries.length>0&&/*#__PURE__*/_jsx(\"span\",{className:\"text-blue-600 dark:text-blue-400 font-medium\",children:\"\\u2713 Ready to create rule\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex gap-3 pt-6 border-t border-gray-200 dark:border-gray-700\",children:[/*#__PURE__*/_jsx(\"button\",{type:\"submit\",disabled:!formData.product_id||!formData.price_usd||!formData.start_date||formData.countries.length===0,className:\"flex-1 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed text-white px-6 py-3 rounded-lg font-medium transition-colors shadow-lg hover:shadow-xl\",children:\"Create Pricing Rule\"}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:()=>setShowCreateModal(false),className:\"flex-1 bg-gray-500 hover:bg-gray-600 text-white px-6 py-3 rounded-lg font-medium transition-colors\",children:\"Cancel\"})]})]})})]})}),showEditModal&&editingRule&&/*#__PURE__*/_jsx(\"div\",{className:\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white dark:bg-gray-800 rounded-xl shadow-2xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-hidden\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"p-6 border-b border-gray-200 dark:border-gray-700\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-xl font-bold text-gray-900 dark:text-gray-100\",children:\"\\u270F\\uFE0F Edit Pricing Rule\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>{setShowEditModal(false);setEditingRule(null);},className:\"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300\",children:/*#__PURE__*/_jsx(\"svg\",{className:\"w-6 h-6\",fill:\"none\",stroke:\"currentColor\",viewBox:\"0 0 24 24\",children:/*#__PURE__*/_jsx(\"path\",{strokeLinecap:\"round\",strokeLinejoin:\"round\",strokeWidth:2,d:\"M6 18L18 6M6 6l12 12\"})})})]}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-sm text-gray-600 dark:text-gray-400 mt-2\",children:[\"Modify pricing rule for \",editFormData.product_id,\" \\u2022 Rule ID: \",editFormData.rule_id]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"p-6 overflow-y-auto max-h-[70vh]\",children:/*#__PURE__*/_jsxs(\"form\",{onSubmit:updateRule,className:\"space-y-6\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\",children:\"Rule ID (Read-only)\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:editFormData.rule_id,disabled:true,className:\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-gray-100 dark:bg-gray-600 text-gray-500 dark:text-gray-400\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\",children:\"Product ID (Read-only)\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:editFormData.product_id,disabled:true,className:\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-gray-100 dark:bg-gray-600 text-gray-500 dark:text-gray-400\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-xs text-gray-500 mt-1\",children:\"Product ID cannot be changed to maintain data integrity\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\",children:\"Price (USD) *\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"relative\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none\",children:/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-500 dark:text-gray-400\",children:\"$\"})}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",step:\"0.01\",min:\"0\",value:editFormData.price_usd,onChange:e=>setEditFormData(_objectSpread(_objectSpread({},editFormData),{},{price_usd:e.target.value})),className:\"w-full pl-8 pr-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-blue-500 focus:border-transparent\",required:true})]}),editingRule&&editFormData.price_usd!==editingRule.price_usd.toString()&&/*#__PURE__*/_jsxs(\"div\",{className:\"mt-2 text-sm text-amber-600 dark:text-amber-400\",children:[\"\\u26A0\\uFE0F Changing from $\",editingRule.price_usd,\" to $\",editFormData.price_usd]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\",children:\"Start Date *\"}),/*#__PURE__*/_jsx(\"input\",{type:\"date\",value:editFormData.start_date,onChange:e=>setEditFormData(_objectSpread(_objectSpread({},editFormData),{},{start_date:e.target.value})),className:\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-blue-500 focus:border-transparent\",required:true}),editingRule&&editFormData.start_date!==editingRule.start_date&&/*#__PURE__*/_jsxs(\"div\",{className:\"mt-2 text-sm text-amber-600 dark:text-amber-400\",children:[\"\\u26A0\\uFE0F Changing from \",formatDate(editingRule.start_date),\" to \",formatDate(editFormData.start_date)]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between mb-2\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700 dark:text-gray-300\",children:\"Countries *\"}),/*#__PURE__*/_jsxs(\"button\",{type:\"button\",onClick:()=>{if(editFormData.countries.length===countries.length){setEditFormData(_objectSpread(_objectSpread({},editFormData),{},{countries:[]}));}else{setEditFormData(_objectSpread(_objectSpread({},editFormData),{},{countries:[...countries]}));}},className:\"text-sm text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300 font-medium\",children:[editFormData.countries.length===countries.length?'Deselect All':'Select All',\" (\",countries.length,\")\"]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"max-h-40 overflow-y-auto border border-gray-300 dark:border-gray-600 rounded-md p-3 bg-white dark:bg-gray-700 space-y-2\",children:countries.map(country=>/*#__PURE__*/_jsxs(\"label\",{className:\"flex items-center space-x-3 text-sm hover:bg-gray-50 dark:hover:bg-gray-600 p-1 rounded cursor-pointer\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"checkbox\",checked:editFormData.countries.includes(country),onChange:e=>{if(e.target.checked){setEditFormData(_objectSpread(_objectSpread({},editFormData),{},{countries:[...editFormData.countries,country]}));}else{setEditFormData(_objectSpread(_objectSpread({},editFormData),{},{countries:editFormData.countries.filter(c=>c!==country)}));}},className:\"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500\"}),/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-900 dark:text-gray-100 font-medium\",children:country})]},country))}),/*#__PURE__*/_jsxs(\"div\",{className:\"mt-2 flex items-center justify-between text-xs\",children:[/*#__PURE__*/_jsxs(\"span\",{className:\"text-gray-500 dark:text-gray-400\",children:[editFormData.countries.length,\" of \",countries.length,\" countries selected\"]}),editingRule&&JSON.stringify(editFormData.countries.sort())!==JSON.stringify(editingRule.countries.sort())&&/*#__PURE__*/_jsx(\"span\",{className:\"text-amber-600 dark:text-amber-400 font-medium\",children:\"\\u26A0\\uFE0F Countries modified\"})]})]}),editingRule&&(editFormData.price_usd!==editingRule.price_usd.toString()||editFormData.start_date!==editingRule.start_date||JSON.stringify(editFormData.countries.sort())!==JSON.stringify(editingRule.countries.sort()))&&/*#__PURE__*/_jsxs(\"div\",{className:\"p-4 bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded-lg\",children:[/*#__PURE__*/_jsx(\"h4\",{className:\"font-medium text-amber-800 dark:text-amber-200 mb-2\",children:\"\\uD83D\\uDCDD Changes Summary\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-sm text-amber-700 dark:text-amber-300 space-y-1\",children:[editFormData.price_usd!==editingRule.price_usd.toString()&&/*#__PURE__*/_jsxs(\"div\",{children:[\"\\u2022 Price: $\",editingRule.price_usd,\" \\u2192 $\",editFormData.price_usd]}),editFormData.start_date!==editingRule.start_date&&/*#__PURE__*/_jsxs(\"div\",{children:[\"\\u2022 Start Date: \",formatDate(editingRule.start_date),\" \\u2192 \",formatDate(editFormData.start_date)]}),JSON.stringify(editFormData.countries.sort())!==JSON.stringify(editingRule.countries.sort())&&/*#__PURE__*/_jsxs(\"div\",{children:[\"\\u2022 Countries: \",editingRule.countries.length,\" \\u2192 \",editFormData.countries.length,\" selected\"]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex gap-3 pt-6 border-t border-gray-200 dark:border-gray-700\",children:[/*#__PURE__*/_jsx(\"button\",{type:\"submit\",disabled:!editFormData.price_usd||!editFormData.start_date||editFormData.countries.length===0,className:\"flex-1 bg-green-600 hover:bg-green-700 disabled:bg-gray-400 disabled:cursor-not-allowed text-white px-6 py-3 rounded-lg font-medium transition-colors shadow-lg hover:shadow-xl\",children:\"\\uD83D\\uDCBE Save Changes\"}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:()=>{setShowEditModal(false);setEditingRule(null);},className:\"flex-1 bg-gray-500 hover:bg-gray-600 text-white px-6 py-3 rounded-lg font-medium transition-colors\",children:\"Cancel\"})]})]})})]})}),showDataProvenance&&/*#__PURE__*/_jsx(\"div\",{className:\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white dark:bg-gray-800 rounded-xl shadow-2xl max-w-4xl max-h-[80vh] overflow-hidden\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"p-6 border-b border-gray-200 dark:border-gray-700\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between\",children:[/*#__PURE__*/_jsxs(\"h3\",{className:\"text-xl font-bold text-gray-900 dark:text-gray-100\",children:[\"\\uD83D\\uDCCA Data Provenance: Rule \",showDataProvenance.ruleId]}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setShowDataProvenance(null),className:\"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300\",children:/*#__PURE__*/_jsx(\"svg\",{className:\"w-6 h-6\",fill:\"none\",stroke:\"currentColor\",viewBox:\"0 0 24 24\",children:/*#__PURE__*/_jsx(\"path\",{strokeLinecap:\"round\",strokeLinejoin:\"round\",strokeWidth:2,d:\"M6 18L18 6M6 6l12 12\"})})})]}),/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-gray-600 dark:text-gray-400 mt-2\",children:\"This shows the underlying data that led to the creation of this pricing rule\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"p-6 overflow-y-auto max-h-[60vh]\",children:showDataProvenance.data?/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4\",children:[/*#__PURE__*/_jsx(\"h4\",{className:\"font-semibold text-blue-900 dark:text-blue-200 mb-2\",children:\"Rule Summary\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-2 gap-4 text-sm\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"span\",{className:\"font-medium\",children:\"Product:\"}),\" \",showDataProvenance.data.product_id]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"span\",{className:\"font-medium\",children:\"Countries:\"}),\" \",(_showDataProvenance$d=showDataProvenance.data.countries)===null||_showDataProvenance$d===void 0?void 0:_showDataProvenance$d.join(', ')]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"span\",{className:\"font-medium\",children:\"USD Price:\"}),\" $\",showDataProvenance.data.price_usd]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"span\",{className:\"font-medium\",children:\"Date Range:\"}),\" \",showDataProvenance.data.start_date,\" \\u2192 \",showDataProvenance.data.end_date||'ongoing']})]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"h4\",{className:\"font-semibold text-gray-900 dark:text-gray-100 mb-3\",children:[\"\\uD83D\\uDD0D Underlying Events (\",showDataProvenance.data.events_analyzed||0,\" events)\"]}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-gray-50 dark:bg-gray-900 rounded-lg p-4\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-sm text-gray-600 dark:text-gray-400 mb-3\",children:\"These are the actual pricing events from your database that led to this rule:\"}),/*#__PURE__*/_jsx(\"div\",{className:\"overflow-x-auto\",children:/*#__PURE__*/_jsxs(\"table\",{className:\"w-full text-xs\",children:[/*#__PURE__*/_jsx(\"thead\",{children:/*#__PURE__*/_jsxs(\"tr\",{className:\"bg-gray-200 dark:bg-gray-700\",children:[/*#__PURE__*/_jsx(\"th\",{className:\"p-2 text-left\",children:\"Trial Start\"}),/*#__PURE__*/_jsx(\"th\",{className:\"p-2 text-left\",children:\"Conversion\"}),/*#__PURE__*/_jsx(\"th\",{className:\"p-2 text-left\",children:\"Actual Price\"}),/*#__PURE__*/_jsx(\"th\",{className:\"p-2 text-left\",children:\"Country\"}),/*#__PURE__*/_jsx(\"th\",{className:\"p-2 text-left\",children:\"User ID\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:(showDataProvenance.data.sample_events||[]).map((event,index)=>{var _event$user_id;return/*#__PURE__*/_jsxs(\"tr\",{className:\"border-b border-gray-200 dark:border-gray-600\",children:[/*#__PURE__*/_jsx(\"td\",{className:\"p-2\",children:event.trial_start_date}),/*#__PURE__*/_jsx(\"td\",{className:\"p-2\",children:event.conversion_date}),/*#__PURE__*/_jsxs(\"td\",{className:\"p-2 font-mono\",children:[\"$\",event.actual_price]}),/*#__PURE__*/_jsx(\"td\",{className:\"p-2\",children:event.country}),/*#__PURE__*/_jsxs(\"td\",{className:\"p-2 font-mono text-xs\",children:[(_event$user_id=event.user_id)===null||_event$user_id===void 0?void 0:_event$user_id.substring(0,8),\"...\"]})]},index);})})]})})]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h4\",{className:\"font-semibold text-gray-900 dark:text-gray-100 mb-3\",children:\"\\uD83D\\uDCB0 Price Analysis\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-2 gap-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"bg-green-50 dark:bg-green-900/20 rounded-lg p-4\",children:[/*#__PURE__*/_jsx(\"h5\",{className:\"font-medium text-green-900 dark:text-green-200 mb-2\",children:\"Actual Prices Charged\"}),/*#__PURE__*/_jsx(\"div\",{className:\"text-sm space-y-1\",children:(showDataProvenance.data.actual_prices||[]).map((price,index)=>{var _showDataProvenance$d2;return/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between\",children:[/*#__PURE__*/_jsxs(\"span\",{className:\"font-mono\",children:[\"$\",price]}),/*#__PURE__*/_jsxs(\"span\",{className:\"text-xs text-gray-500\",children:[((_showDataProvenance$d2=showDataProvenance.data.price_counts)===null||_showDataProvenance$d2===void 0?void 0:_showDataProvenance$d2[price])||0,\" events\"]})]},index);})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-yellow-50 dark:bg-yellow-900/20 rounded-lg p-4\",children:[/*#__PURE__*/_jsx(\"h5\",{className:\"font-medium text-yellow-900 dark:text-yellow-200 mb-2\",children:\"USD Clustering\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-sm space-y-2\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"span\",{className:\"font-medium\",children:\"Target USD:\"}),\" $\",showDataProvenance.data.price_usd]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"span\",{className:\"font-medium\",children:\"Price Range:\"}),\" $\",((_showDataProvenance$d3=showDataProvenance.data.price_range)===null||_showDataProvenance$d3===void 0?void 0:_showDataProvenance$d3.min)||0,\" - $\",((_showDataProvenance$d4=showDataProvenance.data.price_range)===null||_showDataProvenance$d4===void 0?void 0:_showDataProvenance$d4.max)||0]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"span\",{className:\"font-medium\",children:\"Variance:\"}),\" \",showDataProvenance.data.price_variance||0,\"%\"]}),/*#__PURE__*/_jsx(\"div\",{className:\"text-xs text-gray-600 dark:text-gray-400\",children:\"Prices were clustered within 15% tolerance to account for FX fluctuations and rounding\"})]})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h4\",{className:\"font-semibold text-gray-900 dark:text-gray-100 mb-3\",children:\"\\uD83D\\uDD2C Detection Logic\"}),/*#__PURE__*/_jsx(\"div\",{className:\"bg-purple-50 dark:bg-purple-900/20 rounded-lg p-4\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"text-sm space-y-2\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"span\",{className:\"font-medium\",children:\"Method:\"}),\" \",showDataProvenance.data.detection_method||'USD price clustering']}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"span\",{className:\"font-medium\",children:\"Confidence:\"}),\" \",showDataProvenance.data.confidence_score||'High']}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"span\",{className:\"font-medium\",children:\"Notes:\"}),\" \",showDataProvenance.data.notes||'Auto-generated from conversion events']})]})})]})]}):/*#__PURE__*/_jsx(\"div\",{className:\"text-center py-8\",children:/*#__PURE__*/_jsx(\"div\",{className:\"text-gray-500 dark:text-gray-400\",children:\"Loading data provenance information...\"})})}),/*#__PURE__*/_jsx(\"div\",{className:\"p-6 border-t border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-900\",children:/*#__PURE__*/_jsx(\"div\",{className:\"flex justify-end\",children:/*#__PURE__*/_jsx(\"button\",{onClick:()=>setShowDataProvenance(null),className:\"px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded-md\",children:\"Close\"})})})]})}),showRuleHistory&&/*#__PURE__*/_jsx(\"div\",{className:\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white dark:bg-gray-800 rounded-xl shadow-2xl max-w-4xl w-full mx-4 max-h-[80vh] overflow-hidden\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"p-6 border-b border-gray-200 dark:border-gray-700\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between\",children:[/*#__PURE__*/_jsxs(\"h3\",{className:\"text-xl font-bold text-gray-900 dark:text-gray-100\",children:[\"\\uD83D\\uDCDC Rule History: \",showRuleHistory.productId]}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setShowRuleHistory(null),className:\"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300\",children:/*#__PURE__*/_jsx(\"svg\",{className:\"w-6 h-6\",fill:\"none\",stroke:\"currentColor\",viewBox:\"0 0 24 24\",children:/*#__PURE__*/_jsx(\"path\",{strokeLinecap:\"round\",strokeLinejoin:\"round\",strokeWidth:2,d:\"M6 18L18 6M6 6l12 12\"})})})]}),/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-gray-600 dark:text-gray-400 mt-2\",children:\"Complete chronological history of pricing rule changes (newest first)\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"p-6 overflow-y-auto max-h-[60vh]\",children:(_showRuleHistory$data=showRuleHistory.data)!==null&&_showRuleHistory$data!==void 0&&_showRuleHistory$data.history&&showRuleHistory.data.history.length>0?/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-3 gap-4 mb-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"bg-green-50 dark:bg-green-900/20 rounded-lg p-4 text-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-2xl font-bold text-green-600 dark:text-green-400\",children:showRuleHistory.data.history.filter(e=>e.action==='created').length}),/*#__PURE__*/_jsx(\"div\",{className:\"text-sm text-green-800 dark:text-green-300\",children:\"Rules Created\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4 text-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-2xl font-bold text-blue-600 dark:text-blue-400\",children:showRuleHistory.data.history.filter(e=>e.action==='updated').length}),/*#__PURE__*/_jsx(\"div\",{className:\"text-sm text-blue-800 dark:text-blue-300\",children:\"Rules Updated\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-red-50 dark:bg-red-900/20 rounded-lg p-4 text-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-2xl font-bold text-red-600 dark:text-red-400\",children:showRuleHistory.data.history.filter(e=>e.action==='deleted').length}),/*#__PURE__*/_jsx(\"div\",{className:\"text-sm text-red-800 dark:text-red-300\",children:\"Rules Deleted\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-4\",children:[/*#__PURE__*/_jsx(\"h4\",{className:\"text-lg font-semibold text-gray-900 dark:text-gray-100 mb-4\",children:\"\\uD83D\\uDCC5 Chronological History (Newest First)\"}),showRuleHistory.data.history.map((entry,index)=>{var _entry$rule_data$coun,_entry$rule_data$coun2,_entry$rule_data$coun3;// Check if this rule still exists and can be edited\nconst currentRule=rules.find(r=>r.rule_id===entry.rule_data.rule_id);const canEdit=entry.action!=='deleted'&&currentRule;return/*#__PURE__*/_jsxs(\"div\",{className:\"relative p-6 rounded-xl border-l-4 shadow-lg \".concat(entry.action==='created'?'bg-green-50 border-green-400 dark:bg-green-900/20':entry.action==='updated'?'bg-blue-50 border-blue-400 dark:bg-blue-900/20':'bg-red-50 border-red-400 dark:bg-red-900/20'),children:[index<showRuleHistory.data.history.length-1&&/*#__PURE__*/_jsx(\"div\",{className:\"absolute left-0 bottom-0 w-1 h-6 bg-gray-300 transform translate-y-full\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-start justify-between\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex-1\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-4 mb-3\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"px-3 py-1 text-sm font-bold rounded-full \".concat(entry.action==='created'?'bg-green-100 text-green-800':entry.action==='updated'?'bg-blue-100 text-blue-800':'bg-red-100 text-red-800'),children:entry.action==='created'?'✅ CREATED':entry.action==='updated'?'📝 UPDATED':'🗑️ DELETED'}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-xl font-bold text-gray-900 dark:text-gray-100\",children:[\"$\",entry.rule_data.price_usd]}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-sm font-medium text-gray-600 dark:text-gray-400 bg-gray-100 dark:bg-gray-700 px-3 py-1 rounded-full\",children:[(_entry$rule_data$coun=entry.rule_data.countries)===null||_entry$rule_data$coun===void 0?void 0:_entry$rule_data$coun.length,\" countries\"]}),/*#__PURE__*/_jsx(\"div\",{className:\"text-xs text-gray-500 bg-gray-100 px-2 py-1 rounded font-mono\",children:entry.rule_data.rule_id})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-2 gap-6 mb-4\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-sm font-medium text-gray-700 dark:text-gray-300\",children:\"Date Range\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-base text-gray-900 dark:text-gray-100\",children:[formatDate(entry.rule_data.start_date),\" \\u2192 \",formatDate(entry.rule_data.end_date)||'Ongoing']})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-sm font-medium text-gray-700 dark:text-gray-300\",children:\"Countries Applied\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-sm text-gray-900 dark:text-gray-100\",children:[(_entry$rule_data$coun2=entry.rule_data.countries)===null||_entry$rule_data$coun2===void 0?void 0:_entry$rule_data$coun2.slice(0,3).join(', '),((_entry$rule_data$coun3=entry.rule_data.countries)===null||_entry$rule_data$coun3===void 0?void 0:_entry$rule_data$coun3.length)>3&&\" +\".concat(entry.rule_data.countries.length-3,\" more\")]})]})]}),entry.user_notes&&/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white dark:bg-gray-800 p-3 rounded-lg border border-gray-200 dark:border-gray-600 mb-4\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\",children:\"Notes\"}),/*#__PURE__*/_jsx(\"div\",{className:\"text-sm text-gray-600 dark:text-gray-400\",children:entry.user_notes})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex gap-3\",children:[canEdit&&/*#__PURE__*/_jsx(\"button\",{onClick:()=>{setShowRuleHistory(null);// Close history modal\nopenEditModal(currentRule);// Open edit modal\n},className:\"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white text-sm font-medium rounded-lg transition-colors shadow-sm\",children:\"\\u270F\\uFE0F Edit This Rule\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>{setShowRuleHistory(null);loadDataProvenance(entry.rule_data.rule_id);},className:\"px-4 py-2 bg-green-600 hover:bg-green-700 text-white text-sm font-medium rounded-lg transition-colors shadow-sm\",children:\"\\uD83D\\uDCCA View Data Source\"}),canEdit&&/*#__PURE__*/_jsx(\"button\",{onClick:()=>{if(window.confirm(\"Are you sure you want to delete rule \".concat(entry.rule_data.rule_id,\"?\"))){deleteRule(entry.rule_data.rule_id);setShowRuleHistory(null);}},className:\"px-4 py-2 bg-red-600 hover:bg-red-700 text-white text-sm font-medium rounded-lg transition-colors shadow-sm\",children:\"\\uD83D\\uDDD1\\uFE0F Delete Rule\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-right text-sm text-gray-500 dark:text-gray-400 ml-6\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"font-medium\",children:new Date(entry.timestamp).toLocaleDateString()}),/*#__PURE__*/_jsx(\"div\",{children:new Date(entry.timestamp).toLocaleTimeString()}),!canEdit&&entry.action!=='deleted'&&/*#__PURE__*/_jsx(\"div\",{className:\"text-xs text-red-500 mt-1\",children:\"Rule no longer exists\"})]})]})]},entry.entry_id);})]})]}):/*#__PURE__*/_jsxs(\"div\",{className:\"text-center py-12\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-6xl mb-4\",children:\"\\uD83D\\uDCDC\"}),/*#__PURE__*/_jsx(\"div\",{className:\"text-xl font-medium text-gray-600 dark:text-gray-400 mb-2\",children:\"No Rule History Yet\"}),/*#__PURE__*/_jsx(\"div\",{className:\"text-sm text-gray-500 dark:text-gray-500\",children:\"Create your first pricing rule to start tracking changes\"})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"p-6 border-t border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-900\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between items-center\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"text-sm text-gray-600 dark:text-gray-400\",children:[((_showRuleHistory$data2=showRuleHistory.data)===null||_showRuleHistory$data2===void 0?void 0:_showRuleHistory$data2.total_count)||0,\" total changes tracked\"]}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setShowRuleHistory(null),className:\"px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded-lg font-medium\",children:\"Close History\"})]})})]})})]});};export default PricingManagementPage;","map":{"version":3,"names":["React","useState","useEffect","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","PricingManagementPage","_productGroups$formDa","_productGroups$formDa2","_showDataProvenance$d","_showDataProvenance$d3","_showDataProvenance$d4","_showRuleHistory$data","_showRuleHistory$data2","rules","setRules","missingProducts","setMissingProducts","schemaVersion","setSchemaVersion","productGroups","setProductGroups","productsStructure","setProductsStructure","loading","setLoading","error","setError","searchTerm","setSearchTerm","expandedProducts","setExpandedProducts","Set","expandedCountries","setExpandedCountries","showCreateModal","setShowCreateModal","editingRule","setEditingRule","addingCountryFor","setAddingCountryFor","products","setProducts","countries","setCountries","showDataProvenance","setShowDataProvenance","showRuleHistory","setShowRuleHistory","ruleHistory","setRuleHistory","showEditModal","setShowEditModal","editFormData","setEditFormData","rule_id","product_id","price_usd","start_date","formData","setFormData","suggestedPrice","setSuggestedPrice","loadingPrice","setLoadingPrice","countrySelectAll","setCountrySelectAll","trialActivityData","setTrialActivityData","autoRepairNotification","setAutoRepairNotification","loadPricingRules","loadDropdownData","length","groupRulesByProductAndCountry","Object","keys","matchingProducts","filter","productId","toLowerCase","includes","response","fetch","data","json","success","missing_products","schema_version","trial_activity_data","auto_repair_count","type","message","concat","timestamp","Date","now","setTimeout","err","console","forceRepairRules","method","productsRes","countriesRes","Promise","all","productsData","countriesData","productList","map","p","countryList","c","country_code","loadDataProvenance","ruleId","loadRuleHistory","openEditModal","rule","toString","updateRule","e","preventDefault","headers","body","JSON","stringify","parseFloat","groups","forEach","totalRules","allCountries","mostRecentPricingUpdate","hasMissingRules","pricingStartDate","country","priceRange","min","Infinity","max","hasActive","hasFuture","hasHistorical","push","countryData","Math","startDate","endDate","end_date","missingProduct","trialActivityDate","last_trial","last_conversion","mostRecentTrialActivity","missingProductInfo","activityInfo","activityDate","most_recent_activity","totalTrialEvents","total_events","values","product","toggleProductExpansion","newExpanded","has","delete","add","deleteRule","window","confirm","createRule","roundToNearestPricePoint","price","nearestFive","round","finalPrice","fetchSuggestedPrice","roundedPrice","suggested_price","_objectSpread","original_price","note","prev","handleCountrySelectAll","getDefaultStartDate","existingRules","openCreateModal","arguments","undefined","defaultStartDate","formatDate","dateStr","toLocaleDateString","getRuleStatusColor","countryRules","Array","isArray","sortedRules","r","sort","a","b","nextRule","find","nextStartDate","getTime","getRuleStatusLabel","formatPriceRange","getPriceProgression","allRules","uniqueRules","index","self","findIndex","priceProgression","lastPrice","date","sortCountriesByRecentActivity","productCountries","log","countriesCount","firstFewCountries","slice","hasProductCountries","productCountriesKeys","sortedCountries","countryA","countryB","getMostRecentRuleDate","dateA","dateB","dateDiff","localeCompare","usIndex","indexOf","adIndex","aeIndex","filteredProducts","productA","productB","aMissingRules","bMissingRules","className","children","fill","viewBox","fillRule","d","clipRule","onClick","placeholder","value","onChange","target","disabled","reduce","sum","_productGroups$produc","_productGroups$produc2","_productGroups$produc3","flatMap","_productGroups$produc4","thirtyDaysAgo","setDate","getDate","_productGroups$produc5","lastUpdate","_product$mostRecentTr","isExpanded","trial_count","first_trial","toISOString","split","stroke","strokeLinecap","strokeLinejoin","strokeWidth","style","scrollbarWidth","point","stopPropagation","toUpperCase","status","isActive","isFuture","isHistorical","onSubmit","newProductId","required","step","cx","cy","checked","newCountries","join","events_analyzed","sample_events","event","_event$user_id","trial_start_date","conversion_date","actual_price","user_id","substring","actual_prices","_showDataProvenance$d2","price_counts","price_range","price_variance","detection_method","confidence_score","notes","history","action","entry","_entry$rule_data$coun","_entry$rule_data$coun2","_entry$rule_data$coun3","currentRule","rule_data","canEdit","user_notes","toLocaleTimeString","entry_id","total_count"],"sources":["/Users/joshuakaufman/untitled folder 3/orchestrator/dashboard/client/src/pages/PricingManagementPage.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\n\nconst PricingManagementPage = () => {\n  const [rules, setRules] = useState([]);\n  const [missingProducts, setMissingProducts] = useState([]);\n  const [schemaVersion, setSchemaVersion] = useState('1.0.0');\n  const [productGroups, setProductGroups] = useState({});\n  const [productsStructure, setProductsStructure] = useState({}); // New products structure from API\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState(null);\n  const [searchTerm, setSearchTerm] = useState('');\n  const [expandedProducts, setExpandedProducts] = useState(new Set());\n  const [expandedCountries, setExpandedCountries] = useState(new Set());\n  const [showCreateModal, setShowCreateModal] = useState(false);\n  const [editingRule, setEditingRule] = useState(null);\n  const [addingCountryFor, setAddingCountryFor] = useState(null);\n  const [products, setProducts] = useState([]);\n  const [countries, setCountries] = useState([]);\n  const [showDataProvenance, setShowDataProvenance] = useState(null); // For showing underlying data\n  \n  // Rule history state\n  const [showRuleHistory, setShowRuleHistory] = useState(null);\n  const [ruleHistory, setRuleHistory] = useState({});\n  \n  // Edit rule state\n  const [showEditModal, setShowEditModal] = useState(false);\n  const [editFormData, setEditFormData] = useState({\n    rule_id: '',\n    product_id: '',\n    price_usd: '',\n    start_date: '',\n    countries: []\n  });\n  \n  // Form state for creating rules\n  const [formData, setFormData] = useState({\n    product_id: '',\n    price_usd: '',\n    start_date: '',\n    countries: []\n  });\n  \n  // Smart defaults and loading states\n  const [suggestedPrice, setSuggestedPrice] = useState(null);\n  const [loadingPrice, setLoadingPrice] = useState(false);\n  const [countrySelectAll, setCountrySelectAll] = useState(false);\n\n  // Trial activity data from backend\n  const [trialActivityData, setTrialActivityData] = useState({});\n  \n  // Auto-repair notification state\n  const [autoRepairNotification, setAutoRepairNotification] = useState(null);\n\n  // Load pricing rules and dropdown data\n  useEffect(() => {\n    loadPricingRules();\n    loadDropdownData();\n  }, []);\n\n  // Group rules by product and country when rules change\n  useEffect(() => {\n    if (rules.length > 0 || missingProducts.length > 0) {\n      groupRulesByProductAndCountry();\n    }\n  }, [rules, missingProducts]);\n\n  // Auto-expand logic when data loads\n  useEffect(() => {\n    if (Object.keys(productGroups).length > 0) {\n      // Keep products collapsed by default - only expand if search matches\n      if (searchTerm) {\n        const matchingProducts = Object.keys(productGroups).filter(productId =>\n          productId.toLowerCase().includes(searchTerm.toLowerCase())\n        );\n        setExpandedProducts(new Set(matchingProducts));\n      } else {\n        setExpandedProducts(new Set()); // Collapsed by default\n      }\n      \n      // Countries don't need expand/collapse state anymore - they're always shown when product is expanded\n      setExpandedCountries(new Set());\n    }\n  }, [productGroups, searchTerm]);\n\n  // Keep country select all state in sync\n  useEffect(() => {\n    if (countries.length > 0) {\n      setCountrySelectAll(formData.countries.length === countries.length && formData.countries.length > 0);\n    }\n  }, [formData.countries, countries]);\n\n  const loadPricingRules = async () => {\n    try {\n      setLoading(true);\n      const response = await fetch('/api/pricing/rules');\n      const data = await response.json();\n      \n      if (data.success) {\n        setRules(data.data.rules || []);\n        // Handle both old and new schema formats\n        if (data.data.missing_products) {\n          setMissingProducts(data.data.missing_products);\n        }\n        if (data.data.schema_version) {\n          setSchemaVersion(data.data.schema_version);\n        }\n        // Store the new products structure from API\n        if (data.data.products) {\n          setProductsStructure(data.data.products);\n        }\n        // Store trial activity data from backend\n        if (data.data.trial_activity_data) {\n          setTrialActivityData(data.data.trial_activity_data);\n        }\n        \n        // Handle auto-repair notifications\n        if (data.data.auto_repair_count && data.data.auto_repair_count > 0) {\n          setAutoRepairNotification({\n            type: 'success',\n            message: `✅ Auto-repaired ${data.data.auto_repair_count} pricing rules with missing end dates`,\n            timestamp: Date.now()\n          });\n          \n          // Auto-hide notification after 8 seconds\n          setTimeout(() => {\n            setAutoRepairNotification(null);\n          }, 8000);\n        }\n      } else {\n        setError(data.error || 'Failed to load pricing rules');\n      }\n    } catch (err) {\n      setError('Network error loading pricing rules');\n      console.error('Error loading pricing rules:', err);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const forceRepairRules = async () => {\n    try {\n      setLoading(true);\n      const response = await fetch('/api/pricing/repair-rules', {\n        method: 'POST'\n      });\n      const data = await response.json();\n      \n      if (data.success) {\n        setAutoRepairNotification({\n          type: 'success',\n          message: `🔧 ${data.message}`,\n          timestamp: Date.now()\n        });\n        \n        // Reload data after repair\n        setTimeout(() => {\n          loadPricingRules();\n        }, 1000);\n      } else {\n        setError(data.error || 'Failed to repair rules');\n      }\n    } catch (err) {\n      setError('Network error during rule repair');\n      console.error('Error repairing rules:', err);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const loadDropdownData = async () => {\n    try {\n      const [productsRes, countriesRes] = await Promise.all([\n        fetch('/api/pricing/products'),\n        fetch('/api/pricing/countries')\n      ]);\n      \n      const [productsData, countriesData] = await Promise.all([\n        productsRes.json(),\n        countriesRes.json()\n      ]);\n\n      if (productsData.success && productsData.data && productsData.data.products) {\n        const productList = productsData.data.products.map(p => p.product_id);\n        setProducts(productList);\n      }\n      \n      if (countriesData.success && countriesData.data && countriesData.data.countries) {\n        const countryList = countriesData.data.countries.map(c => c.country_code);\n        setCountries(countryList);\n      }\n    } catch (err) {\n      console.error('Error loading dropdown data:', err);\n      setProducts([]);\n      setCountries([]);\n    }\n  };\n\n  const loadDataProvenance = async (ruleId) => {\n    try {\n      const response = await fetch(`/api/pricing/rules/${ruleId}/provenance`);\n      const data = await response.json();\n      \n      if (data.success) {\n        setShowDataProvenance({\n          ruleId,\n          data: data.data\n        });\n      } else {\n        console.error('Failed to load data provenance:', data.error);\n      }\n    } catch (err) {\n      console.error('Error loading data provenance:', err);\n    }\n  };\n\n  const loadRuleHistory = async (productId) => {\n    try {\n      const response = await fetch(`/api/pricing/rules/${productId}/history`);\n      const data = await response.json();\n      \n      if (data.success) {\n        setShowRuleHistory({\n          productId,\n          data: data.data\n        });\n      } else {\n        console.error('Failed to load rule history:', data.error);\n      }\n    } catch (err) {\n      console.error('Error loading rule history:', err);\n    }\n  };\n\n  const openEditModal = (rule) => {\n    setEditFormData({\n      rule_id: rule.rule_id,\n      product_id: rule.product_id,\n      price_usd: rule.price_usd.toString(),\n      start_date: rule.start_date,\n      countries: [...rule.countries]\n    });\n    setEditingRule(rule);\n    setShowEditModal(true);\n  };\n\n  const updateRule = async (e) => {\n    e.preventDefault();\n    \n    try {\n      const response = await fetch(`/api/pricing/rules/${editFormData.rule_id}?simple_edit=true`, {\n        method: 'PUT',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          product_id: editFormData.product_id,\n          price_usd: parseFloat(editFormData.price_usd),\n          start_date: editFormData.start_date,\n          countries: editFormData.countries\n        })\n      });\n      \n      const data = await response.json();\n      \n      if (data.success) {\n        setShowEditModal(false);\n        setEditingRule(null);\n        setEditFormData({\n          rule_id: '',\n          product_id: '',\n          price_usd: '',\n          start_date: '',\n          countries: []\n        });\n        // Reload all data to ensure consistency\n        loadPricingRules();\n        setError(null);\n      } else {\n        setError(data.error || 'Failed to update rule');\n      }\n    } catch (err) {\n      setError('Network error updating rule');\n      console.error('Error updating rule:', err);\n    }\n  };\n\n  const groupRulesByProductAndCountry = () => {\n    const groups = {};\n    \n    // Group existing rules by product and country\n    rules.forEach(rule => {\n      const productId = rule.product_id;\n      \n      if (!groups[productId]) {\n        groups[productId] = {\n          totalRules: 0,\n          countries: {},\n          allCountries: [],\n          mostRecentPricingUpdate: null,  // When pricing was last changed (start_date)\n          hasMissingRules: false\n        };\n      }\n      \n      groups[productId].totalRules++;\n      \n      // Track most recent pricing update (start_date) - when pricing was actually changed\n      const pricingStartDate = new Date(rule.start_date);\n      if (!groups[productId].mostRecentPricingUpdate || pricingStartDate > groups[productId].mostRecentPricingUpdate) {\n        groups[productId].mostRecentPricingUpdate = pricingStartDate;\n      }\n      \n      rule.countries.forEach(country => {\n        if (!groups[productId].countries[country]) {\n          groups[productId].countries[country] = {\n            rules: [],\n            priceRange: { min: Infinity, max: -Infinity },\n            hasActive: false,\n            hasFuture: false,\n            hasHistorical: false\n          };\n          groups[productId].allCountries.push(country);\n        }\n        \n        const countryData = groups[productId].countries[country];\n        countryData.rules.push(rule);\n        \n        // Update price range\n        countryData.priceRange.min = Math.min(countryData.priceRange.min, rule.price_usd);\n        countryData.priceRange.max = Math.max(countryData.priceRange.max, rule.price_usd);\n        \n        // Determine rule status for country\n        const now = new Date();\n        const startDate = new Date(rule.start_date);\n        const endDate = rule.end_date ? new Date(rule.end_date) : null;\n        \n        if (endDate && now > endDate) {\n          countryData.hasHistorical = true;\n        } else if (now >= startDate && (!endDate || now <= endDate)) {\n          countryData.hasActive = true;\n        } else {\n          countryData.hasFuture = true;\n        }\n      });\n    });\n    \n    // Add missing products and update trial activity for all products\n    missingProducts.forEach(missingProduct => {\n      const productId = missingProduct.product_id;\n      const trialActivityDate = new Date(missingProduct.last_trial || missingProduct.last_conversion);\n      \n      if (!groups[productId]) {\n        groups[productId] = {\n          totalRules: 0,\n          countries: {},\n          allCountries: [],\n          mostRecentPricingUpdate: trialActivityDate,\n          mostRecentTrialActivity: trialActivityDate,\n          hasMissingRules: true,\n          missingProductInfo: missingProduct\n        };\n      } else {\n        // Product exists with rules - update trial activity and mark as having missing rules if needed\n        groups[productId].hasMissingRules = true;\n        groups[productId].missingProductInfo = missingProduct;\n        \n        // Update with trial activity date - this is key for proper sorting\n        if (!groups[productId].mostRecentTrialActivity || trialActivityDate > groups[productId].mostRecentTrialActivity) {\n          groups[productId].mostRecentTrialActivity = trialActivityDate;\n        }\n        \n        // Also update pricing update if trial activity is more recent\n        if (!groups[productId].mostRecentPricingUpdate || trialActivityDate > groups[productId].mostRecentPricingUpdate) {\n          groups[productId].mostRecentPricingUpdate = trialActivityDate;\n        }\n      }\n    });\n    \n    // Update all products with accurate trial activity data from backend\n    Object.keys(groups).forEach(productId => {\n      if (trialActivityData[productId]) {\n        const activityInfo = trialActivityData[productId];\n        const activityDate = new Date(activityInfo.most_recent_activity);\n        \n        // Update with the accurate trial activity date\n        groups[productId].mostRecentTrialActivity = activityDate;\n        groups[productId].totalTrialEvents = activityInfo.total_events;\n        \n        // If this product doesn't have pricing rules, also update the pricing update date\n        if (groups[productId].totalRules === 0) {\n          groups[productId].mostRecentPricingUpdate = activityDate;\n        }\n      }\n    });\n    \n    // For products with rules but no trial activity data, use pricing date as trial activity\n    Object.values(groups).forEach(product => {\n      if (!product.mostRecentTrialActivity && product.mostRecentPricingUpdate) {\n        product.mostRecentTrialActivity = product.mostRecentPricingUpdate;\n      }\n    });\n    \n    // Fix any infinite values in price ranges\n    Object.values(groups).forEach(product => {\n      Object.values(product.countries).forEach(countryData => {\n        if (countryData.priceRange.min === Infinity) {\n          countryData.priceRange.min = 0;\n        }\n        if (countryData.priceRange.max === -Infinity) {\n          countryData.priceRange.max = 0;\n        }\n      });\n    });\n    \n    setProductGroups(groups);\n  };\n\n  const toggleProductExpansion = (productId) => {\n    const newExpanded = new Set(expandedProducts);\n    if (newExpanded.has(productId)) {\n      newExpanded.delete(productId);\n    } else {\n      newExpanded.add(productId);\n    }\n    setExpandedProducts(newExpanded);\n  };\n\n  const deleteRule = async (ruleId) => {\n    if (!window.confirm('Are you sure you want to delete this pricing rule?')) {\n      return;\n    }\n\n    try {\n      const response = await fetch(`/api/pricing/rules/${ruleId}?hard_delete=true`, {\n        method: 'DELETE'\n      });\n      \n      const data = await response.json();\n      \n      if (data.success) {\n        // Remove the rule from frontend state immediately\n        setRules(rules.filter(rule => rule.rule_id !== ruleId));\n        // Also reload all data to ensure consistency across all affected areas\n        loadPricingRules();\n      } else {\n        setError(data.error || 'Failed to delete rule');\n      }\n    } catch (err) {\n      setError('Network error deleting rule');\n      console.error('Error deleting rule:', err);\n    }\n  };\n\n  const createRule = async (e) => {\n    e.preventDefault();\n    \n    try {\n      const response = await fetch('/api/pricing/rules', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          product_id: formData.product_id,\n          price_usd: parseFloat(formData.price_usd),\n          start_date: formData.start_date,\n          countries: formData.countries\n        })\n      });\n      \n      const data = await response.json();\n      \n      if (data.success) {\n        setShowCreateModal(false);\n        setFormData({\n          product_id: '',\n          price_usd: '',\n          start_date: '',\n          countries: []\n        });\n        loadPricingRules();\n      } else {\n        setError(data.error || 'Failed to create rule');\n      }\n    } catch (err) {\n      setError('Network error creating rule');\n      console.error('Error creating rule:', err);\n    }\n  };\n\n  const roundToNearestPricePoint = (price) => {\n    // Round to nearest $5 increment, then subtract $0.01 to make it .99\n    const nearestFive = Math.round(price / 5) * 5;\n    const finalPrice = nearestFive - 0.01;\n    \n    // Ensure minimum price of $4.99\n    return Math.max(4.99, finalPrice);\n  };\n\n  const fetchSuggestedPrice = async (productId) => {\n    if (!productId) return;\n    \n    setLoadingPrice(true);\n    try {\n      const response = await fetch(`/api/pricing/products/${productId}/most-recent-conversion-price`);\n      const data = await response.json();\n      \n      if (data.success) {\n        // Round the suggested price to nearest $5 increment minus $0.01\n        const roundedPrice = roundToNearestPricePoint(data.data.suggested_price);\n        \n        setSuggestedPrice({\n          ...data.data,\n          suggested_price: roundedPrice,\n          original_price: data.data.suggested_price,\n          note: `Rounded from $${data.data.suggested_price} to $${roundedPrice} (${data.data.note})`\n        });\n        setFormData(prev => ({\n          ...prev,\n          price_usd: roundedPrice.toString()\n        }));\n      } else {\n        setSuggestedPrice(null);\n      }\n    } catch (err) {\n      console.error('Error fetching suggested price:', err);\n      setSuggestedPrice(null);\n    } finally {\n      setLoadingPrice(false);\n    }\n  };\n\n  const handleCountrySelectAll = () => {\n    if (countrySelectAll) {\n      // Deselect all\n      setFormData({...formData, countries: []});\n      setCountrySelectAll(false);\n    } else {\n      // Select all\n      setFormData({...formData, countries: [...countries]});\n      setCountrySelectAll(true);\n    }\n  };\n\n  const getDefaultStartDate = (productId) => {\n    // Check if this product has any existing rules\n    const existingRules = rules.filter(rule => rule.product_id === productId);\n    \n    if (existingRules.length === 0) {\n      // First rule for this product - default to Jan 1 2024\n      return '2024-01-01';\n    } else {\n      // Subsequent rule - leave empty\n      return '';\n    }\n  };\n\n  const openCreateModal = (productId = '') => {\n    const defaultStartDate = productId ? getDefaultStartDate(productId) : '';\n    \n    setFormData({\n      product_id: productId,\n      price_usd: '',\n      start_date: defaultStartDate,\n      countries: [...countries] // Auto-select all countries by default\n    });\n    \n    // Reset smart defaults\n    setSuggestedPrice(null);\n    setCountrySelectAll(true); // Set to true since we're selecting all countries\n    \n    // If we have a specific product, fetch suggested price\n    if (productId) {\n      fetchSuggestedPrice(productId);\n    }\n    \n    setShowCreateModal(true);\n  };\n\n  const formatDate = (dateStr) => {\n    if (!dateStr) return 'Ongoing';\n    return new Date(dateStr).toLocaleDateString();\n  };\n\n  const getRuleStatusColor = (rule, countryRules = null) => {\n    const now = new Date();\n    const startDate = new Date(rule.start_date);\n    let endDate = rule.end_date ? new Date(rule.end_date) : null;\n\n    // If no explicit end date and we have country rules, calculate effective end date\n    if (!endDate && countryRules && Array.isArray(countryRules)) {\n      // Find the next rule that starts after this rule\n      const sortedRules = countryRules\n        .filter(r => r.rule_id !== rule.rule_id)  // Exclude current rule\n        .sort((a, b) => new Date(a.start_date) - new Date(b.start_date));\n      \n      const nextRule = sortedRules.find(r => new Date(r.start_date) > startDate);\n      if (nextRule) {\n        // This rule effectively ends the day before the next rule starts\n        const nextStartDate = new Date(nextRule.start_date);\n        endDate = new Date(nextStartDate.getTime() - 24 * 60 * 60 * 1000); // Previous day\n      }\n    }\n\n    if (endDate && now > endDate) {\n      return 'bg-gray-100 border-gray-300 text-gray-600'; // Historical\n    } else if (now >= startDate && (!endDate || now <= endDate)) {\n      return 'bg-green-100 border-green-300 text-green-800'; // Active\n    } else {\n      return 'bg-blue-100 border-blue-300 text-blue-800'; // Future\n    }\n  };\n\n  const getRuleStatusLabel = (rule, countryRules = null) => {\n    const now = new Date();\n    const startDate = new Date(rule.start_date);\n    let endDate = rule.end_date ? new Date(rule.end_date) : null;\n\n    // If no explicit end date and we have country rules, calculate effective end date\n    if (!endDate && countryRules && Array.isArray(countryRules)) {\n      // Find the next rule that starts after this rule\n      const sortedRules = countryRules\n        .filter(r => r.rule_id !== rule.rule_id)  // Exclude current rule\n        .sort((a, b) => new Date(a.start_date) - new Date(b.start_date));\n      \n      const nextRule = sortedRules.find(r => new Date(r.start_date) > startDate);\n      if (nextRule) {\n        // This rule effectively ends the day before the next rule starts\n        const nextStartDate = new Date(nextRule.start_date);\n        endDate = new Date(nextStartDate.getTime() - 24 * 60 * 60 * 1000); // Previous day\n      }\n    }\n\n    if (endDate && now > endDate) {\n      return 'Historical';\n    } else if (now >= startDate && (!endDate || now <= endDate)) {\n      return 'Active';\n    } else {\n      return 'Future';\n    }\n  };\n\n  const formatPriceRange = (countryData) => {\n    if (countryData.priceRange.min === countryData.priceRange.max) {\n      return `$${countryData.priceRange.min}`;\n    }\n    return `$${countryData.priceRange.min} - $${countryData.priceRange.max}`;\n  };\n\n  const getPriceProgression = (product) => {\n    if (!product || !product.countries || Object.keys(product.countries).length === 0) {\n      return [];\n    }\n    \n    // Get all rules across all countries for this product\n    const allRules = [];\n    Object.values(product.countries).forEach(countryData => {\n      allRules.push(...countryData.rules);\n    });\n    \n    // Remove duplicates (same rule might appear in multiple countries)\n    const uniqueRules = allRules.filter((rule, index, self) => \n      index === self.findIndex(r => r.rule_id === rule.rule_id)\n    );\n    \n    // Sort by start date to show progression\n    const sortedRules = uniqueRules.sort((a, b) => \n      new Date(a.start_date) - new Date(b.start_date)\n    );\n    \n    // Create price progression - show unique price points in chronological order\n    const priceProgression = [];\n    let lastPrice = null;\n    \n    sortedRules.forEach(rule => {\n      if (rule.price_usd !== lastPrice) {\n        priceProgression.push({\n          price: rule.price_usd,\n          date: rule.start_date,\n          ruleId: rule.rule_id\n        });\n        lastPrice = rule.price_usd;\n      }\n    });\n    \n    return priceProgression;\n  };\n\n  const sortCountriesByRecentActivity = (countries, productCountries) => {\n    /**\n     * Sort countries by most recent rule update, then alphabetically\n     * @param {Array} countries - Array of country codes\n     * @param {Object} productCountries - Product countries data with rules\n     * @returns {Array} Sorted country codes\n     */\n    \n    // More detailed debugging\n    console.log('🔍 sortCountriesByRecentActivity called with:', {\n      countriesCount: countries.length,\n      firstFewCountries: countries.slice(0, 5),\n      hasProductCountries: !!productCountries,\n      productCountriesKeys: Object.keys(productCountries || {}).slice(0, 5)\n    });\n    \n    const sortedCountries = countries.sort((a, b) => {\n      const countryA = productCountries[a];\n      const countryB = productCountries[b];\n      \n      // Get the most recent rule start date for each country\n      const getMostRecentRuleDate = (countryData) => {\n        if (!countryData || !countryData.rules || countryData.rules.length === 0) {\n          return null;\n        }\n        // Rules are already sorted with newest first, so take the first one\n        return new Date(countryData.rules[0].start_date);\n      };\n      \n      const dateA = getMostRecentRuleDate(countryA);\n      const dateB = getMostRecentRuleDate(countryB);\n      \n      // If both have dates, sort by most recent first\n      if (dateA && dateB) {\n        const dateDiff = dateB - dateA; // Most recent first\n        if (dateDiff !== 0) return dateDiff;\n      }\n      \n      // If only one has a date, prioritize it\n      if (dateA && !dateB) return -1;\n      if (!dateA && dateB) return 1;\n      \n      // If both have same date or no dates, sort alphabetically\n      return a.localeCompare(b);\n    });\n    \n    // Show the results\n    if (countries.includes('US')) {\n      console.log('🎯 Final sorted countries (first 10):', sortedCountries.slice(0, 10));\n      const usIndex = sortedCountries.indexOf('US');\n      const adIndex = sortedCountries.indexOf('AD');\n      const aeIndex = sortedCountries.indexOf('AE');\n      console.log(`📍 Positions - US: ${usIndex + 1}, AD: ${adIndex + 1}, AE: ${aeIndex + 1}`);\n      \n      // Show the most recent rule for US, AD, AE\n      if (productCountries['US'] && productCountries['US'].rules && productCountries['US'].rules[0]) {\n        console.log(`🇺🇸 US most recent rule:`, productCountries['US'].rules[0].start_date, `$${productCountries['US'].rules[0].price_usd}`);\n      }\n      if (productCountries['AD'] && productCountries['AD'].rules && productCountries['AD'].rules[0]) {\n        console.log(`🇦🇩 AD most recent rule:`, productCountries['AD'].rules[0].start_date, `$${productCountries['AD'].rules[0].price_usd}`);\n      }\n    }\n    \n    return sortedCountries;\n  };\n\n  // Filter and sort products based on search and most recent trial activity\n  const filteredProducts = Object.keys(productGroups)\n    .filter(productId =>\n      productId.toLowerCase().includes(searchTerm.toLowerCase())\n    )\n    .sort((a, b) => {\n      const productA = productGroups[a];\n      const productB = productGroups[b];\n      \n      // First, separate products with rules vs missing rules\n      const aMissingRules = productA?.hasMissingRules || false;\n      const bMissingRules = productB?.hasMissingRules || false;\n      \n      // Products with rules come first, missing rules go to bottom\n      if (aMissingRules && !bMissingRules) return 1;  // A has missing rules, goes to bottom\n      if (!aMissingRules && bMissingRules) return -1; // B has missing rules, goes to bottom\n      \n      // Within each group, sort by most recent trial activity (more urgent trials first)\n      const dateA = productA?.mostRecentTrialActivity;\n      const dateB = productB?.mostRecentTrialActivity;\n      \n      if (!dateA && !dateB) return a.localeCompare(b); // Fallback to alphabetical\n      if (!dateA) return 1; // Products without trial dates go to the end of their group\n      if (!dateB) return -1;\n      \n      return dateB - dateA; // Most recent trial activity first within each group\n    });\n\n  if (loading) {\n    return (\n      <div className=\"container mx-auto p-6\">\n        <div className=\"flex justify-center items-center h-64\">\n          <div className=\"text-lg\">Loading pricing rules...</div>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"container mx-auto p-6\">\n      {/* Header */}\n      <div className=\"mb-6\">\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <h1 className=\"text-3xl font-bold mb-2\">Pricing Management</h1>\n            <p className=\"text-gray-600 dark:text-gray-400\">\n              Manage product pricing across different countries and time periods\n            </p>\n          </div>\n          <div className=\"text-right\">\n            <div className={`inline-flex items-center px-3 py-1 rounded-full text-sm font-medium ${\n              schemaVersion === '2.0.0' \n                ? 'bg-green-100 text-green-800 dark:bg-green-800 dark:text-green-200'\n                : 'bg-blue-100 text-blue-800 dark:bg-blue-800 dark:text-blue-200'\n            }`}>\n              Schema v{schemaVersion}\n            </div>\n            {schemaVersion === '2.0.0' && missingProducts.length > 0 && (\n              <div className=\"mt-1 text-xs text-red-600 dark:text-red-400\">\n                Enhanced with missing product detection\n              </div>\n            )}\n          </div>\n        </div>\n      </div>\n\n      {/* Auto-Repair Notification */}\n      {autoRepairNotification && (\n        <div className=\"bg-emerald-50 border border-emerald-200 dark:border-emerald-800 text-emerald-800 dark:text-emerald-200 px-4 py-3 rounded-xl mb-4 shadow-sm\">\n          <div className=\"flex items-center justify-between\">\n            <div className=\"flex items-center gap-3\">\n              <div className=\"w-8 h-8 rounded-full bg-emerald-500 flex items-center justify-center\">\n                <svg className=\"w-4 h-4 text-white\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n                  <path fillRule=\"evenodd\" d=\"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z\" clipRule=\"evenodd\" />\n                </svg>\n              </div>\n              <div>\n                <p className=\"font-semibold\">{autoRepairNotification.message}</p>\n                <p className=\"text-sm opacity-80\">End dates have been automatically calculated based on newer rules</p>\n              </div>\n            </div>\n            <button \n              onClick={() => setAutoRepairNotification(null)}\n              className=\"text-emerald-600 hover:text-emerald-800 dark:text-emerald-400 dark:hover:text-emerald-300 transition-colors\"\n            >\n              <svg className=\"w-5 h-5\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n                <path fillRule=\"evenodd\" d=\"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z\" clipRule=\"evenodd\" />\n              </svg>\n            </button>\n          </div>\n        </div>\n      )}\n\n      {/* Error Display */}\n      {error && (\n        <div className=\"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4\">\n          {error}\n          <button \n            onClick={() => setError(null)}\n            className=\"float-right text-red-700 hover:text-red-900\"\n          >\n            ×\n          </button>\n        </div>\n      )}\n\n      {/* Controls Row */}\n      <div className=\"bg-white dark:bg-gray-800 rounded-lg shadow-md p-4 mb-6\">\n        <div className=\"flex flex-wrap gap-4 items-center justify-between\">\n          {/* Search */}\n          <div className=\"flex-1 min-w-64\">\n            <input\n              type=\"text\"\n              placeholder=\"Search by product ID...\"\n              value={searchTerm}\n              onChange={(e) => setSearchTerm(e.target.value)}\n              className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700\"\n            />\n          </div>\n\n          {/* Actions */}\n          <div className=\"flex gap-2\">\n            <button\n              onClick={() => openCreateModal()}\n              className=\"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md\"\n            >\n              Create Rule\n            </button>\n            <button\n              onClick={forceRepairRules}\n              className=\"bg-orange-600 hover:bg-orange-700 text-white px-4 py-2 rounded-md\"\n              disabled={loading}\n            >\n              🔧 Fix \"Ongoing\" Rules\n            </button>\n            <button\n              onClick={loadPricingRules}\n              className=\"bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-md\"\n            >\n              Refresh\n            </button>\n          </div>\n        </div>\n      </div>\n\n      {/* Summary Stats */}\n      <div className=\"grid grid-cols-1 md:grid-cols-6 gap-4 mb-6\">\n        <div className=\"bg-white dark:bg-gray-800 rounded-lg shadow-md p-4\">\n          <div className=\"text-2xl font-bold text-blue-600\">{filteredProducts.length}</div>\n          <div className=\"text-sm text-gray-600 dark:text-gray-400\">Products</div>\n        </div>\n        <div className=\"bg-white dark:bg-gray-800 rounded-lg shadow-md p-4\">\n          <div className=\"text-2xl font-bold text-green-600\">\n            {filteredProducts.reduce((sum, productId) => \n              sum + (productGroups[productId]?.totalRules || 0), 0\n            )}\n          </div>\n          <div className=\"text-sm text-gray-600 dark:text-gray-400\">Total Rules</div>\n        </div>\n        <div className=\"bg-white dark:bg-gray-800 rounded-lg shadow-md p-4\">\n          <div className={`text-2xl font-bold ${\n            filteredProducts.filter(productId => productGroups[productId]?.hasMissingRules).length > 0 \n              ? 'text-red-600' \n              : 'text-gray-400'\n          }`}>\n            {filteredProducts.filter(productId => productGroups[productId]?.hasMissingRules).length}\n          </div>\n          <div className=\"text-sm text-gray-600 dark:text-gray-400\">Missing Rules</div>\n        </div>\n        <div className=\"bg-white dark:bg-gray-800 rounded-lg shadow-md p-4\">\n          <div className=\"text-2xl font-bold text-purple-600\">\n            {[...new Set(filteredProducts.flatMap(productId => \n              productGroups[productId]?.allCountries || []\n            ))].length}\n          </div>\n          <div className=\"text-sm text-gray-600 dark:text-gray-400\">Countries</div>\n        </div>\n        <div className=\"bg-white dark:bg-gray-800 rounded-lg shadow-md p-4\">\n          <div className=\"text-2xl font-bold text-orange-600\">\n            {(() => {\n              const thirtyDaysAgo = new Date();\n              thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);\n              return filteredProducts.filter(productId => {\n                const lastUpdate = productGroups[productId]?.mostRecentPricingUpdate;\n                return lastUpdate && lastUpdate > thirtyDaysAgo;\n              }).length;\n            })()}\n          </div>\n          <div className=\"text-sm text-gray-600 dark:text-gray-400\">Recent Updates</div>\n        </div>\n        <div className=\"bg-white dark:bg-gray-800 rounded-lg shadow-md p-4\">\n          <div className=\"text-2xl font-bold text-indigo-600\">\n            {filteredProducts.filter(productId => expandedProducts.has(productId)).length}\n          </div>\n          <div className=\"text-sm text-gray-600 dark:text-gray-400\">Expanded</div>\n        </div>\n      </div>\n\n      {/* Products List */}\n      <div className=\"space-y-4\">\n        {filteredProducts.length === 0 ? (\n          <div className=\"bg-white dark:bg-gray-800 rounded-lg shadow-md p-8 text-center text-gray-500 dark:text-gray-400\">\n            {Object.keys(productGroups).length === 0 ? 'No pricing rules found' : 'No products match your search criteria'}\n          </div>\n        ) : (\n          filteredProducts.map(productId => {\n            const product = productGroups[productId];\n            const isExpanded = expandedProducts.has(productId);\n            \n            return (\n              <div key={productId} className={`group relative overflow-hidden transition-all duration-300 ease-out ${\n                product.hasMissingRules \n                  ? 'bg-gradient-to-br from-rose-50 to-red-50 dark:from-red-950/30 dark:to-red-900/20 border-2 border-rose-200 dark:border-red-800/50 shadow-lg shadow-red-100/50 dark:shadow-red-900/20' \n                  : 'bg-white dark:bg-slate-900 border border-slate-200/60 dark:border-slate-700/50 shadow-sm hover:shadow-xl hover:shadow-slate-200/30 dark:hover:shadow-slate-900/30'\n              } rounded-2xl backdrop-blur-sm`}>\n                {/* Product Header */}\n                <div \n                  className={`relative p-6 border-b cursor-pointer transition-all duration-200 ${\n                    product.hasMissingRules\n                      ? 'border-rose-200/70 dark:border-red-800/40 hover:bg-gradient-to-br hover:from-rose-100 hover:to-red-100 dark:hover:from-red-950/40 dark:hover:to-red-900/30'\n                      : 'border-slate-200/60 dark:border-slate-700/50 hover:bg-slate-50/70 dark:hover:bg-slate-800/50'\n                  }`}\n                  onClick={() => toggleProductExpansion(productId)}\n                >\n                  {/* Critical Alert Banner for Missing Rules */}\n                  {product.hasMissingRules && (\n                    <div className=\"absolute top-0 left-0 right-0 bg-gradient-to-r from-rose-500 to-red-500 text-white text-xs font-semibold px-4 py-2 flex items-center gap-2\">\n                      <svg className=\"w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n                        <path fillRule=\"evenodd\" d=\"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z\" clipRule=\"evenodd\" />\n                      </svg>\n                      <span>MISSING PRICING RULES — URGENT ACTION REQUIRED</span>\n                    </div>\n                  )}\n                  \n                  <div className={`${product.hasMissingRules ? 'mt-8' : ''} flex items-center justify-between`}>\n                    <div className=\"flex-1 min-w-0\">\n                      {/* Product ID with sophisticated typography */}\n                      <div className=\"flex items-center gap-4 mb-3\">\n                        <h3 className={`text-2xl font-bold tracking-tight ${\n                          product.hasMissingRules \n                            ? 'text-red-900 dark:text-red-100' \n                            : 'text-slate-900 dark:text-slate-100'\n                        }`}>\n                          {productId}\n                        </h3>\n                        \n                        {/* Enhanced status indicators */}\n                        <div className=\"flex items-center gap-2\">\n                          <div className={`inline-flex items-center gap-1.5 px-3 py-1 rounded-full text-xs font-semibold transition-all ${\n                            product.hasMissingRules\n                              ? 'bg-red-500 text-white shadow-md'\n                              : 'bg-emerald-100 text-emerald-800 dark:bg-emerald-900/30 dark:text-emerald-300'\n                          }`}>\n                            {product.hasMissingRules ? (\n                              <>\n                                <svg className=\"w-3 h-3\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n                                  <path fillRule=\"evenodd\" d=\"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z\" clipRule=\"evenodd\" />\n                                </svg>\n                                Missing Rules\n                              </>\n                            ) : (\n                              <>\n                                <svg className=\"w-3 h-3\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n                                  <path fillRule=\"evenodd\" d=\"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z\" clipRule=\"evenodd\" />\n                                </svg>\n                                Active Rules\n                              </>\n                            )}\n                          </div>\n                        </div>\n                      </div>\n                      \n                      {/* Missing rules detailed alert */}\n                      {product.hasMissingRules && product.missingProductInfo ? (\n                        <div className=\"mb-4 p-4 bg-white/90 dark:bg-slate-800/90 backdrop-blur-sm border border-red-200/50 dark:border-red-800/50 rounded-xl shadow-sm\">\n                          <div className=\"space-y-2\">\n                            <div className=\"flex items-start gap-3\">\n                              <svg className=\"w-5 h-5 text-red-500 mt-0.5 flex-shrink-0\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n                                <path fillRule=\"evenodd\" d=\"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z\" clipRule=\"evenodd\" />\n                              </svg>\n                              <div>\n                                <p className=\"text-sm font-semibold text-red-900 dark:text-red-100 mb-1\">\n                                  Active trials without pricing rules detected\n                                </p>\n                                <div className=\"grid grid-cols-2 gap-x-4 gap-y-1 text-xs text-red-800 dark:text-red-200\">\n                                  <div><span className=\"font-medium\">{product.missingProductInfo.trial_count}</span> trial events</div>\n                                  <div>First: <span className=\"font-medium\">{formatDate(product.missingProductInfo.first_trial)}</span></div>\n                                  <div>Latest: <span className=\"font-medium\">{formatDate(product.missingProductInfo.last_trial)}</span></div>\n                                  <div className=\"col-span-2 mt-1 text-red-700 dark:text-red-300 font-medium\">\n                                    ⚠️ Revenue analysis incomplete without pricing rules\n                                  </div>\n                                </div>\n                              </div>\n                            </div>\n                          </div>\n                        </div>\n                      ) : (\n                        /* Normal product metrics */\n                        <div className=\"flex items-center gap-6 mb-4\">\n                          <div className=\"flex items-center gap-2\">\n                            <div className=\"w-2 h-2 rounded-full bg-blue-500\"></div>\n                            <span className=\"text-sm font-medium text-slate-700 dark:text-slate-300\">\n                              <span className=\"font-bold text-slate-900 dark:text-slate-100\">{product.totalRules}</span> rules\n                            </span>\n                          </div>\n                          <div className=\"flex items-center gap-2\">\n                            <div className=\"w-2 h-2 rounded-full bg-purple-500\"></div>\n                            <span className=\"text-sm font-medium text-slate-700 dark:text-slate-300\">\n                              <span className=\"font-bold text-slate-900 dark:text-slate-100\">{product.allCountries.length}</span> countries\n                            </span>\n                          </div>\n                          <div className=\"flex items-center gap-2\">\n                            <div className=\"w-2 h-2 rounded-full bg-emerald-500\"></div>\n                            <span className=\"text-sm font-medium text-slate-700 dark:text-slate-300\">\n                              Last activity: <span className=\"font-bold text-slate-900 dark:text-slate-100\">{formatDate(product.mostRecentTrialActivity?.toISOString().split('T')[0])}</span>\n                            </span>\n                          </div>\n                        </div>\n                      )}\n                      \n                      {/* Enhanced country tags - only show if not missing rules */}\n                      {!product.hasMissingRules && product.allCountries.length > 0 && (\n                        <div className=\"flex flex-wrap gap-1.5 mb-4\">\n                          {sortCountriesByRecentActivity([...product.allCountries], product.countries).slice(0, 12).map(country => (\n                            <span \n                              key={country}\n                              className=\"inline-flex items-center px-2.5 py-1 rounded-lg text-xs font-medium bg-blue-50 text-blue-700 border border-blue-200/50 dark:bg-blue-900/30 dark:text-blue-300 dark:border-blue-800/50 transition-colors hover:bg-blue-100 dark:hover:bg-blue-900/50\"\n                            >\n                              {country}\n                            </span>\n                          ))}\n                          {product.allCountries.length > 12 && (\n                            <span className=\"inline-flex items-center px-2.5 py-1 rounded-lg text-xs font-medium bg-slate-100 text-slate-600 border border-slate-200/50 dark:bg-slate-800 dark:text-slate-400 dark:border-slate-700\">\n                              +{product.allCountries.length - 12} more\n                            </span>\n                          )}\n                        </div>\n                      )}\n\n                      {/* Beautiful Price Progression - only show if not missing rules */}\n                      {!product.hasMissingRules && (() => {\n                        const priceProgression = getPriceProgression(product);\n                        return priceProgression.length > 0 && (\n                          <div className=\"p-4 bg-gradient-to-br from-slate-50 to-slate-100/50 dark:from-slate-800/50 dark:to-slate-900/50 rounded-xl border border-slate-200/50 dark:border-slate-700/50 backdrop-blur-sm\">\n                            <div className=\"flex items-center gap-2 mb-3\">\n                              <div className=\"flex items-center gap-2\">\n                                <div className=\"w-6 h-6 rounded-lg bg-gradient-to-br from-emerald-500 to-green-600 flex items-center justify-center\">\n                                  <svg className=\"w-3.5 h-3.5 text-white\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M13 7h8m0 0v8m0-8l-8 8-4-4-6 6\" />\n                                  </svg>\n                                </div>\n                                <h4 className=\"text-sm font-bold text-slate-800 dark:text-slate-200\">Price Evolution</h4>\n                              </div>\n                              <div className=\"flex-1\"></div>\n                              <span className=\"text-xs font-medium text-slate-500 dark:text-slate-400 bg-white/70 dark:bg-slate-800/70 px-2 py-1 rounded-md\">\n                                {priceProgression.length} changes\n                              </span>\n                            </div>\n                            <div className=\"flex items-center gap-3 overflow-x-auto pb-2\" style={{scrollbarWidth: 'thin'}}>\n                              {priceProgression.map((point, index) => (\n                                <div key={point.ruleId} className=\"flex items-center gap-3 flex-shrink-0\">\n                                  <div className=\"text-center group\">\n                                    <div className=\"relative\">\n                                      <div className=\"text-xl font-black text-emerald-700 dark:text-emerald-400 mb-0.5 group-hover:scale-105 transition-transform\">\n                                        ${point.price}\n                                      </div>\n                                      <div className=\"text-xs font-medium text-slate-500 dark:text-slate-400 bg-white/80 dark:bg-slate-800/80 px-2 py-0.5 rounded-md shadow-sm\">\n                                        {formatDate(point.date)}\n                                      </div>\n                                    </div>\n                                  </div>\n                                  {index < priceProgression.length - 1 && (\n                                    <div className=\"flex items-center\">\n                                      <div className=\"w-8 h-0.5 bg-gradient-to-r from-slate-300 to-slate-400 dark:from-slate-600 dark:to-slate-500 rounded-full\"></div>\n                                      <svg className=\"w-3 h-3 text-slate-400 dark:text-slate-500 -ml-1\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n                                        <path fillRule=\"evenodd\" d=\"M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z\" clipRule=\"evenodd\" />\n                                      </svg>\n                                    </div>\n                                  )}\n                                </div>\n                              ))}\n                            </div>\n                          </div>\n                        );\n                      })()}\n                    </div>\n                    \n                    {/* Enhanced action buttons */}\n                    <div className=\"flex items-center gap-3 ml-6\">\n                      <button\n                        onClick={(e) => {\n                          e.stopPropagation();\n                          openCreateModal(productId);\n                        }}\n                        className={`group relative overflow-hidden px-5 py-2.5 rounded-xl text-sm font-semibold transition-all duration-200 transform hover:scale-105 active:scale-95 shadow-lg ${\n                          product.hasMissingRules\n                            ? 'bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white shadow-red-200 dark:shadow-red-900/30'\n                            : 'bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white shadow-blue-200 dark:shadow-blue-900/30'\n                        }`}\n                      >\n                        <div className=\"relative z-10 flex items-center gap-2\">\n                          <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 6v6m0 0v6m0-6h6m-6 0H6\" />\n                          </svg>\n                          {product.hasMissingRules ? 'Create First Rule' : 'Add Rule'}\n                        </div>\n                      </button>\n                      \n                      {/* Show Rules History Button */}\n                      {!product.hasMissingRules && (\n                        <button\n                          onClick={(e) => {\n                            e.stopPropagation();\n                            loadRuleHistory(productId);\n                          }}\n                          className=\"group relative overflow-hidden px-5 py-2.5 rounded-xl text-sm font-semibold transition-all duration-200 transform hover:scale-105 active:scale-95 bg-gradient-to-r from-slate-600 to-slate-700 hover:from-slate-700 hover:to-slate-800 text-white shadow-lg shadow-slate-200 dark:shadow-slate-900/30\"\n                        >\n                          <div className=\"relative z-10 flex items-center gap-2\">\n                            <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z\" />\n                            </svg>\n                            History\n                          </div>\n                        </button>\n                      )}\n                      \n                      {/* Elegant expand/collapse indicator */}\n                      <div className=\"flex items-center justify-center w-10 h-10 rounded-xl bg-slate-100 dark:bg-slate-800 group-hover:bg-slate-200 dark:group-hover:bg-slate-700 transition-colors\">\n                        <svg \n                          className={`w-5 h-5 text-slate-600 dark:text-slate-400 transform transition-transform duration-200 ${isExpanded ? 'rotate-180' : ''}`}\n                          fill=\"none\" \n                          stroke=\"currentColor\" \n                          viewBox=\"0 0 24 24\"\n                        >\n                          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 9l-7 7-7-7\" />\n                        </svg>\n                      </div>\n                    </div>\n                  </div>\n                </div>\n\n                {/* Country Breakdown */}\n                {isExpanded && (\n                  <div className=\"p-6 bg-gradient-to-br from-slate-50/50 to-white dark:from-slate-800/50 dark:to-slate-900/50\">\n                    <div className=\"space-y-6\">\n                      {sortCountriesByRecentActivity([...product.allCountries], product.countries).map(country => {\n                        const countryData = product.countries[country];\n                        \n                        return (\n                          <div key={country} className=\"group relative overflow-hidden bg-white dark:bg-slate-800/90 border border-slate-200/60 dark:border-slate-700/50 rounded-2xl shadow-sm hover:shadow-lg transition-all duration-300 backdrop-blur-sm\">\n                            {/* Country Header */}\n                            <div className=\"relative p-6 bg-gradient-to-r from-slate-50 via-white to-slate-50 dark:from-slate-800/80 dark:via-slate-800/60 dark:to-slate-800/80 border-b border-slate-200/60 dark:border-slate-700/50\">\n                              <div className=\"flex items-center justify-between\">\n                                <div className=\"flex items-center gap-6\">\n                                  <div className=\"flex items-center gap-3\">\n                                    <div className=\"w-12 h-12 rounded-xl bg-gradient-to-br from-blue-500 to-indigo-600 flex items-center justify-center shadow-lg shadow-blue-200/50 dark:shadow-blue-900/30\">\n                                      <span className=\"text-white font-bold text-lg\">{country.slice(0, 2).toUpperCase()}</span>\n                                    </div>\n                                    <div>\n                                      <h4 className=\"text-2xl font-bold text-slate-900 dark:text-slate-100\">{country}</h4>\n                                      <p className=\"text-sm text-slate-600 dark:text-slate-400\">Pricing timeline</p>\n                                    </div>\n                                  </div>\n                                  \n                                  <div className=\"flex items-center gap-4\">\n                                    <div className=\"flex items-center gap-3 px-4 py-2 bg-white/70 dark:bg-slate-800/70 backdrop-blur-sm rounded-xl border border-slate-200/50 dark:border-slate-700/50 shadow-sm\">\n                                      <div className=\"w-2 h-2 rounded-full bg-blue-500\"></div>\n                                      <span className=\"text-sm font-semibold text-slate-700 dark:text-slate-300\">\n                                        {countryData.rules.length} rules\n                                      </span>\n                                    </div>\n                                    \n                                    <div className=\"flex items-center gap-3 px-4 py-2 bg-gradient-to-r from-emerald-50 to-green-50 dark:from-emerald-900/30 dark:to-green-900/30 backdrop-blur-sm rounded-xl border border-emerald-200/50 dark:border-emerald-800/50 shadow-sm\">\n                                      <div className=\"w-2 h-2 rounded-full bg-emerald-500\"></div>\n                                      <span className=\"text-lg font-black text-emerald-700 dark:text-emerald-400\">\n                                        {formatPriceRange(countryData)}\n                                      </span>\n                                    </div>\n                                  </div>\n                                </div>\n                              </div>\n                            </div>\n\n                            {/* Enhanced Price Timeline */}\n                            <div className=\"p-6\">\n                              <div className=\"flex items-center gap-3 mb-6\">\n                                <div className=\"w-8 h-8 rounded-xl bg-gradient-to-br from-slate-600 to-slate-700 flex items-center justify-center shadow-md\">\n                                  <svg className=\"w-4 h-4 text-white\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z\" />\n                                  </svg>\n                                </div>\n                                <h5 className=\"text-lg font-bold text-slate-800 dark:text-slate-200\">\n                                  Chronological Pricing History\n                                </h5>\n                                <div className=\"flex-1 h-px bg-gradient-to-r from-slate-200 to-transparent dark:from-slate-700\"></div>\n                              </div>\n                              \n                              {/* Horizontal Timeline Cards */}\n                              <div className=\"relative\">\n                                <div className=\"flex gap-6 overflow-x-auto pb-4 scrollbar-hide\" style={{scrollbarWidth: 'none'}}>\n                                  {countryData.rules.map((rule, index) => {\n                                    const status = getRuleStatusLabel(rule, countryData.rules);\n                                    const isActive = status === 'Active';\n                                    const isFuture = status === 'Future';\n                                    const isHistorical = status === 'Historical';\n                                    \n                                    return (\n                                      <div \n                                        key={rule.rule_id}\n                                        className={`relative flex-shrink-0 w-80 group/card transition-all duration-300 hover:scale-105`}\n                                      >\n                                        {/* Timeline Connector */}\n                                        {index < countryData.rules.length - 1 && (\n                                          <div className=\"absolute top-1/2 -right-3 z-10 w-6 h-px bg-gradient-to-r from-slate-300 via-slate-400 to-slate-300 dark:from-slate-600 dark:via-slate-500 dark:to-slate-600\"></div>\n                                        )}\n                                        \n                                        <div className={`relative overflow-hidden rounded-2xl shadow-lg transition-all duration-300 group-hover/card:shadow-xl ${\n                                          isActive \n                                            ? 'bg-gradient-to-br from-emerald-50 via-green-50 to-emerald-100 dark:from-emerald-950/50 dark:via-emerald-900/30 dark:to-green-900/40 border-2 border-emerald-300/60 dark:border-emerald-700/50 shadow-emerald-200/50 dark:shadow-emerald-900/30' \n                                            : isFuture\n                                            ? 'bg-gradient-to-br from-blue-50 via-sky-50 to-blue-100 dark:from-blue-950/50 dark:via-blue-900/30 dark:to-sky-900/40 border-2 border-blue-300/60 dark:border-blue-700/50 shadow-blue-200/50 dark:shadow-blue-900/30'\n                                            : 'bg-gradient-to-br from-slate-50 via-gray-50 to-slate-100 dark:from-slate-800/50 dark:via-slate-900/30 dark:to-slate-800/40 border-2 border-slate-300/60 dark:border-slate-700/50 shadow-slate-200/50 dark:shadow-slate-900/30'\n                                        }`}>\n                                          {/* Status Indicator */}\n                                          <div className=\"absolute top-0 left-0 right-0 h-1 bg-gradient-to-r from-transparent via-current to-transparent opacity-60\"></div>\n                                          \n                                          <div className=\"p-6\">\n                                            {/* Rule Header */}\n                                            <div className=\"flex items-center justify-between mb-4\">\n                                              <div className={`inline-flex items-center gap-2 px-3 py-1.5 rounded-xl text-xs font-bold shadow-sm ${\n                                                isActive \n                                                  ? 'bg-emerald-500 text-white'\n                                                  : isFuture\n                                                  ? 'bg-blue-500 text-white'\n                                                  : 'bg-slate-500 text-white'\n                                              }`}>\n                                                {isActive && <div className=\"w-2 h-2 bg-white rounded-full animate-pulse\"></div>}\n                                                {isFuture && <svg className=\"w-3 h-3\" fill=\"currentColor\" viewBox=\"0 0 20 20\"><path fillRule=\"evenodd\" d=\"M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z\" clipRule=\"evenodd\" /></svg>}\n                                                {isHistorical && <svg className=\"w-3 h-3\" fill=\"currentColor\" viewBox=\"0 0 20 20\"><path fillRule=\"evenodd\" d=\"M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z\" clipRule=\"evenodd\" /></svg>}\n                                                {status.toUpperCase()}\n                                              </div>\n                                              \n                                              <div className=\"text-xs font-mono text-slate-500 dark:text-slate-400 bg-white/80 dark:bg-slate-800/80 px-2 py-1 rounded-lg\">\n                                                {rule.rule_id.slice(-8)}\n                                              </div>\n                                            </div>\n                                            \n                                            {/* Price Display */}\n                                            <div className=\"mb-6\">\n                                              <div className=\"text-4xl font-black text-slate-900 dark:text-slate-100 mb-2 tracking-tight\">\n                                                ${rule.price_usd}\n                                              </div>\n                                              <div className={`text-sm font-semibold ${\n                                                isActive \n                                                  ? 'text-emerald-700 dark:text-emerald-300' \n                                                  : isFuture\n                                                  ? 'text-blue-700 dark:text-blue-300'\n                                                  : 'text-slate-600 dark:text-slate-400'\n                                              }`}>\n                                                {formatDate(rule.start_date)} \n                                                <span className=\"mx-2 opacity-60\">→</span> \n                                                {formatDate(rule.end_date) || (\n                                                  <span className={`inline-flex items-center gap-1 ${isActive ? 'text-emerald-600' : 'text-slate-500'}`}>\n                                                    {isActive && <div className=\"w-1.5 h-1.5 bg-emerald-500 rounded-full animate-pulse\"></div>}\n                                                    Ongoing\n                                                  </span>\n                                                )}\n                                              </div>\n                                            </div>\n                                            \n                                            {/* Action Button */}\n                                            <button\n                                              onClick={(e) => {\n                                                e.stopPropagation();\n                                                loadDataProvenance(rule.rule_id);\n                                              }}\n                                              className={`w-full group/btn relative overflow-hidden px-4 py-3 rounded-xl text-sm font-semibold transition-all duration-200 transform hover:scale-105 active:scale-95 shadow-md hover:shadow-lg ${\n                                                isActive\n                                                  ? 'bg-emerald-600 hover:bg-emerald-700 text-white shadow-emerald-200 dark:shadow-emerald-900/50'\n                                                  : isFuture\n                                                  ? 'bg-blue-600 hover:bg-blue-700 text-white shadow-blue-200 dark:shadow-blue-900/50'\n                                                  : 'bg-slate-600 hover:bg-slate-700 text-white shadow-slate-200 dark:shadow-slate-900/50'\n                                              }`}\n                                            >\n                                              <div className=\"relative z-10 flex items-center justify-center gap-2\">\n                                                <svg className=\"w-4 h-4 transition-transform group-hover/btn:scale-110\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z\" />\n                                                </svg>\n                                                View Data Source\n                                              </div>\n                                            </button>\n                                          </div>\n                                        </div>\n                                      </div>\n                                    );\n                                  })}\n                                </div>\n                              </div>\n                            </div>\n                          </div>\n                        );\n                      })}\n                    </div>\n                  </div>\n                )}\n              </div>\n            );\n          })\n        )}\n      </div>\n\n      {/* Footer Info */}\n      <div className=\"mt-6 text-sm text-gray-500 dark:text-gray-400 text-center\">\n        Pricing rules are organized by product and country for easy market management.\n        <br />\n        <span className=\"inline-flex items-center gap-4 mt-2\">\n          <span className=\"flex items-center gap-1\">\n            <div className=\"w-3 h-3 bg-green-100 border border-green-300 rounded\"></div>\n            Active\n          </span>\n          <span className=\"flex items-center gap-1\">\n            <div className=\"w-3 h-3 bg-blue-100 border border-blue-300 rounded\"></div>\n            Future\n          </span>\n          <span className=\"flex items-center gap-1\">\n            <div className=\"w-3 h-3 bg-gray-100 border border-gray-300 rounded\"></div>\n            Historical\n          </span>\n        </span>\n      </div>\n\n      {/* Create Rule Modal */}\n      {showCreateModal && (\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50\">\n          <div className=\"bg-white dark:bg-gray-800 rounded-xl shadow-2xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-hidden\">\n            {/* Modal Header */}\n            <div className=\"p-6 border-b border-gray-200 dark:border-gray-700\">\n              <div className=\"flex items-center justify-between\">\n                <h3 className=\"text-xl font-bold text-gray-900 dark:text-gray-100\">\n                  ➕ Create New Pricing Rule\n                </h3>\n                <button\n                  onClick={() => setShowCreateModal(false)}\n                  className=\"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300\"\n                >\n                  <svg className=\"w-6 h-6\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\n                  </svg>\n                </button>\n              </div>\n              <p className=\"text-sm text-gray-600 dark:text-gray-400 mt-2\">\n                Create a new pricing rule for a product and countries\n              </p>\n            </div>\n\n            {/* Modal Content */}\n            <div className=\"p-6 overflow-y-auto max-h-[70vh]\">\n              <form onSubmit={createRule} className=\"space-y-6\">\n                {/* Product Selection */}\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                    Product ID *\n                  </label>\n                  <select\n                    value={formData.product_id}\n                    onChange={(e) => {\n                      const newProductId = e.target.value;\n                      setFormData({...formData, product_id: newProductId, start_date: getDefaultStartDate(newProductId)});\n                      if (newProductId) {\n                        fetchSuggestedPrice(newProductId);\n                      } else {\n                        setSuggestedPrice(null);\n                      }\n                    }}\n                    className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n                    required\n                  >\n                    <option value=\"\">Select a product...</option>\n                    {products.map(product => (\n                      <option key={product} value={product}>{product}</option>\n                    ))}\n                  </select>\n                  \n                  {/* Product hint for missing rules */}\n                  {formData.product_id && productGroups[formData.product_id]?.hasMissingRules && (\n                    <div className=\"mt-2 p-3 bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded-lg\">\n                      <div className=\"flex items-center gap-2 text-amber-800 dark:text-amber-200 text-sm\">\n                        <svg className=\"w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n                          <path fillRule=\"evenodd\" d=\"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z\" clipRule=\"evenodd\" />\n                        </svg>\n                        <span className=\"font-medium\">First pricing rule for this product!</span>\n                      </div>\n                      {productGroups[formData.product_id]?.missingProductInfo && (\n                        <div className=\"mt-1 text-xs text-amber-700 dark:text-amber-300\">\n                          This product has {productGroups[formData.product_id].missingProductInfo.trial_count} trial events but no pricing rules yet.\n                        </div>\n                      )}\n                    </div>\n                  )}\n                </div>\n\n                {/* Price with Smart Suggestions */}\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                    Price (USD) *\n                  </label>\n                  <div className=\"relative\">\n                    <div className=\"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none\">\n                      <span className=\"text-gray-500 dark:text-gray-400\">$</span>\n                    </div>\n                    <input\n                      type=\"number\"\n                      step=\"0.01\"\n                      min=\"0\"\n                      value={formData.price_usd}\n                      onChange={(e) => setFormData({...formData, price_usd: e.target.value})}\n                      className=\"w-full pl-8 pr-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n                      placeholder=\"29.99\"\n                      required\n                    />\n                    {loadingPrice && (\n                      <div className=\"absolute inset-y-0 right-0 pr-3 flex items-center\">\n                        <svg className=\"animate-spin h-4 w-4 text-gray-400\" fill=\"none\" viewBox=\"0 0 24 24\">\n                          <circle className=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" strokeWidth=\"4\"></circle>\n                          <path className=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"></path>\n                        </svg>\n                      </div>\n                    )}\n                  </div>\n                  \n                  {/* Smart Price Suggestion */}\n                  {suggestedPrice && (\n                    <div className=\"mt-2 p-3 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg\">\n                      <div className=\"flex items-center justify-between\">\n                        <div className=\"flex items-center gap-2 text-green-800 dark:text-green-200 text-sm\">\n                          <svg className=\"w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n                            <path fillRule=\"evenodd\" d=\"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z\" clipRule=\"evenodd\" />\n                          </svg>\n                          <span className=\"font-medium\">\n                            Suggested: ${suggestedPrice.suggested_price} from most recent conversion\n                          </span>\n                        </div>\n                        <button\n                          type=\"button\"\n                          onClick={() => setFormData({...formData, price_usd: suggestedPrice.suggested_price.toString()})}\n                          className=\"text-xs bg-green-600 hover:bg-green-700 text-white px-2 py-1 rounded\"\n                        >\n                          Use This\n                        </button>\n                      </div>\n                      <div className=\"mt-1 text-xs text-green-700 dark:text-green-300\">\n                        {suggestedPrice.note}\n                      </div>\n                    </div>\n                  )}\n                </div>\n\n                {/* Start Date with Smart Default */}\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                    Start Date *\n                  </label>\n                  <input\n                    type=\"date\"\n                    value={formData.start_date}\n                    onChange={(e) => setFormData({...formData, start_date: e.target.value})}\n                    className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n                    required\n                  />\n                  \n                  {/* Date context */}\n                  {formData.product_id && (\n                    <div className=\"mt-2 text-xs text-gray-600 dark:text-gray-400\">\n                      {rules.filter(rule => rule.product_id === formData.product_id).length === 0 \n                        ? \"💡 First rule for this product - defaulted to Jan 1, 2024\"\n                        : \"📅 Additional rule - choose when this pricing takes effect\"\n                      }\n                    </div>\n                  )}\n                </div>\n\n                {/* Countries with Select All */}\n                <div>\n                  <div className=\"flex items-center justify-between mb-2\">\n                    <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300\">\n                      Countries *\n                    </label>\n                    <button\n                      type=\"button\"\n                      onClick={handleCountrySelectAll}\n                      className=\"text-sm text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300 font-medium\"\n                    >\n                      {countrySelectAll ? 'Deselect All' : 'Select All'} ({countries.length})\n                    </button>\n                  </div>\n                  \n                  <div className=\"max-h-40 overflow-y-auto border border-gray-300 dark:border-gray-600 rounded-md p-3 bg-white dark:bg-gray-700 space-y-2\">\n                    {countries.map(country => (\n                      <label key={country} className=\"flex items-center space-x-3 text-sm hover:bg-gray-50 dark:hover:bg-gray-600 p-1 rounded cursor-pointer\">\n                        <input\n                          type=\"checkbox\"\n                          checked={formData.countries.includes(country)}\n                          onChange={(e) => {\n                            if (e.target.checked) {\n                              const newCountries = [...formData.countries, country];\n                              setFormData({...formData, countries: newCountries});\n                              setCountrySelectAll(newCountries.length === countries.length);\n                            } else {\n                              const newCountries = formData.countries.filter(c => c !== country);\n                              setFormData({...formData, countries: newCountries});\n                              setCountrySelectAll(false);\n                            }\n                          }}\n                          className=\"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-700 dark:focus:ring-offset-gray-700 focus:ring-2 dark:bg-gray-600 dark:border-gray-500\"\n                        />\n                        <span className=\"text-gray-900 dark:text-gray-100 font-medium\">{country}</span>\n                      </label>\n                    ))}\n                  </div>\n                  \n                  <div className=\"mt-2 flex items-center justify-between text-xs\">\n                    <span className=\"text-gray-500 dark:text-gray-400\">\n                      {formData.countries.length} of {countries.length} countries selected\n                    </span>\n                    {formData.countries.length > 0 && (\n                      <span className=\"text-blue-600 dark:text-blue-400 font-medium\">\n                        ✓ Ready to create rule\n                      </span>\n                    )}\n                  </div>\n                </div>\n\n                {/* Form Actions */}\n                <div className=\"flex gap-3 pt-6 border-t border-gray-200 dark:border-gray-700\">\n                  <button\n                    type=\"submit\"\n                    disabled={!formData.product_id || !formData.price_usd || !formData.start_date || formData.countries.length === 0}\n                    className=\"flex-1 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed text-white px-6 py-3 rounded-lg font-medium transition-colors shadow-lg hover:shadow-xl\"\n                  >\n                    Create Pricing Rule\n                  </button>\n                  <button\n                    type=\"button\"\n                    onClick={() => setShowCreateModal(false)}\n                    className=\"flex-1 bg-gray-500 hover:bg-gray-600 text-white px-6 py-3 rounded-lg font-medium transition-colors\"\n                  >\n                    Cancel\n                  </button>\n                </div>\n              </form>\n            </div>\n          </div>\n        </div>\n      )}\n\n      {/* Edit Rule Modal */}\n      {showEditModal && editingRule && (\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50\">\n          <div className=\"bg-white dark:bg-gray-800 rounded-xl shadow-2xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-hidden\">\n            {/* Modal Header */}\n            <div className=\"p-6 border-b border-gray-200 dark:border-gray-700\">\n              <div className=\"flex items-center justify-between\">\n                <h3 className=\"text-xl font-bold text-gray-900 dark:text-gray-100\">\n                  ✏️ Edit Pricing Rule\n                </h3>\n                <button\n                  onClick={() => {\n                    setShowEditModal(false);\n                    setEditingRule(null);\n                  }}\n                  className=\"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300\"\n                >\n                  <svg className=\"w-6 h-6\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\n                  </svg>\n                </button>\n              </div>\n              <p className=\"text-sm text-gray-600 dark:text-gray-400 mt-2\">\n                Modify pricing rule for {editFormData.product_id} • Rule ID: {editFormData.rule_id}\n              </p>\n            </div>\n\n            {/* Modal Content */}\n            <div className=\"p-6 overflow-y-auto max-h-[70vh]\">\n              <form onSubmit={updateRule} className=\"space-y-6\">\n                {/* Rule ID Display */}\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                    Rule ID (Read-only)\n                  </label>\n                  <input\n                    type=\"text\"\n                    value={editFormData.rule_id}\n                    disabled\n                    className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-gray-100 dark:bg-gray-600 text-gray-500 dark:text-gray-400\"\n                  />\n                </div>\n\n                {/* Product ID Display (non-editable for safety) */}\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                    Product ID (Read-only)\n                  </label>\n                  <input\n                    type=\"text\"\n                    value={editFormData.product_id}\n                    disabled\n                    className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-gray-100 dark:bg-gray-600 text-gray-500 dark:text-gray-400\"\n                  />\n                  <p className=\"text-xs text-gray-500 mt-1\">\n                    Product ID cannot be changed to maintain data integrity\n                  </p>\n                </div>\n\n                {/* Price */}\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                    Price (USD) *\n                  </label>\n                  <div className=\"relative\">\n                    <div className=\"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none\">\n                      <span className=\"text-gray-500 dark:text-gray-400\">$</span>\n                    </div>\n                    <input\n                      type=\"number\"\n                      step=\"0.01\"\n                      min=\"0\"\n                      value={editFormData.price_usd}\n                      onChange={(e) => setEditFormData({...editFormData, price_usd: e.target.value})}\n                      className=\"w-full pl-8 pr-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n                      required\n                    />\n                  </div>\n                  {editingRule && editFormData.price_usd !== editingRule.price_usd.toString() && (\n                    <div className=\"mt-2 text-sm text-amber-600 dark:text-amber-400\">\n                      ⚠️ Changing from ${editingRule.price_usd} to ${editFormData.price_usd}\n                    </div>\n                  )}\n                </div>\n\n                {/* Start Date */}\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                    Start Date *\n                  </label>\n                  <input\n                    type=\"date\"\n                    value={editFormData.start_date}\n                    onChange={(e) => setEditFormData({...editFormData, start_date: e.target.value})}\n                    className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n                    required\n                  />\n                  {editingRule && editFormData.start_date !== editingRule.start_date && (\n                    <div className=\"mt-2 text-sm text-amber-600 dark:text-amber-400\">\n                      ⚠️ Changing from {formatDate(editingRule.start_date)} to {formatDate(editFormData.start_date)}\n                    </div>\n                  )}\n                </div>\n\n                {/* Countries */}\n                <div>\n                  <div className=\"flex items-center justify-between mb-2\">\n                    <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300\">\n                      Countries *\n                    </label>\n                    <button\n                      type=\"button\"\n                      onClick={() => {\n                        if (editFormData.countries.length === countries.length) {\n                          setEditFormData({...editFormData, countries: []});\n                        } else {\n                          setEditFormData({...editFormData, countries: [...countries]});\n                        }\n                      }}\n                      className=\"text-sm text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300 font-medium\"\n                    >\n                      {editFormData.countries.length === countries.length ? 'Deselect All' : 'Select All'} ({countries.length})\n                    </button>\n                  </div>\n                  \n                  <div className=\"max-h-40 overflow-y-auto border border-gray-300 dark:border-gray-600 rounded-md p-3 bg-white dark:bg-gray-700 space-y-2\">\n                    {countries.map(country => (\n                      <label key={country} className=\"flex items-center space-x-3 text-sm hover:bg-gray-50 dark:hover:bg-gray-600 p-1 rounded cursor-pointer\">\n                        <input\n                          type=\"checkbox\"\n                          checked={editFormData.countries.includes(country)}\n                          onChange={(e) => {\n                            if (e.target.checked) {\n                              setEditFormData({...editFormData, countries: [...editFormData.countries, country]});\n                            } else {\n                              setEditFormData({...editFormData, countries: editFormData.countries.filter(c => c !== country)});\n                            }\n                          }}\n                          className=\"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500\"\n                        />\n                        <span className=\"text-gray-900 dark:text-gray-100 font-medium\">{country}</span>\n                      </label>\n                    ))}\n                  </div>\n                  \n                  <div className=\"mt-2 flex items-center justify-between text-xs\">\n                    <span className=\"text-gray-500 dark:text-gray-400\">\n                      {editFormData.countries.length} of {countries.length} countries selected\n                    </span>\n                    {editingRule && JSON.stringify(editFormData.countries.sort()) !== JSON.stringify(editingRule.countries.sort()) && (\n                      <span className=\"text-amber-600 dark:text-amber-400 font-medium\">\n                        ⚠️ Countries modified\n                      </span>\n                    )}\n                  </div>\n                </div>\n\n                {/* Change Summary */}\n                {editingRule && (\n                  editFormData.price_usd !== editingRule.price_usd.toString() ||\n                  editFormData.start_date !== editingRule.start_date ||\n                  JSON.stringify(editFormData.countries.sort()) !== JSON.stringify(editingRule.countries.sort())\n                ) && (\n                  <div className=\"p-4 bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded-lg\">\n                    <h4 className=\"font-medium text-amber-800 dark:text-amber-200 mb-2\">\n                      📝 Changes Summary\n                    </h4>\n                    <div className=\"text-sm text-amber-700 dark:text-amber-300 space-y-1\">\n                      {editFormData.price_usd !== editingRule.price_usd.toString() && (\n                        <div>• Price: ${editingRule.price_usd} → ${editFormData.price_usd}</div>\n                      )}\n                      {editFormData.start_date !== editingRule.start_date && (\n                        <div>• Start Date: {formatDate(editingRule.start_date)} → {formatDate(editFormData.start_date)}</div>\n                      )}\n                      {JSON.stringify(editFormData.countries.sort()) !== JSON.stringify(editingRule.countries.sort()) && (\n                        <div>• Countries: {editingRule.countries.length} → {editFormData.countries.length} selected</div>\n                      )}\n                    </div>\n                  </div>\n                )}\n\n                {/* Form Actions */}\n                <div className=\"flex gap-3 pt-6 border-t border-gray-200 dark:border-gray-700\">\n                  <button\n                    type=\"submit\"\n                    disabled={!editFormData.price_usd || !editFormData.start_date || editFormData.countries.length === 0}\n                    className=\"flex-1 bg-green-600 hover:bg-green-700 disabled:bg-gray-400 disabled:cursor-not-allowed text-white px-6 py-3 rounded-lg font-medium transition-colors shadow-lg hover:shadow-xl\"\n                  >\n                    💾 Save Changes\n                  </button>\n                  <button\n                    type=\"button\"\n                    onClick={() => {\n                      setShowEditModal(false);\n                      setEditingRule(null);\n                    }}\n                    className=\"flex-1 bg-gray-500 hover:bg-gray-600 text-white px-6 py-3 rounded-lg font-medium transition-colors\"\n                  >\n                    Cancel\n                  </button>\n                </div>\n              </form>\n            </div>\n          </div>\n        </div>\n      )}\n\n      {/* Data Provenance Modal */}\n      {showDataProvenance && (\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50\">\n          <div className=\"bg-white dark:bg-gray-800 rounded-xl shadow-2xl max-w-4xl max-h-[80vh] overflow-hidden\">\n            {/* Modal Header */}\n            <div className=\"p-6 border-b border-gray-200 dark:border-gray-700\">\n              <div className=\"flex items-center justify-between\">\n                <h3 className=\"text-xl font-bold text-gray-900 dark:text-gray-100\">\n                  📊 Data Provenance: Rule {showDataProvenance.ruleId}\n                </h3>\n                <button\n                  onClick={() => setShowDataProvenance(null)}\n                  className=\"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300\"\n                >\n                  <svg className=\"w-6 h-6\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\n                  </svg>\n                </button>\n              </div>\n              <p className=\"text-sm text-gray-600 dark:text-gray-400 mt-2\">\n                This shows the underlying data that led to the creation of this pricing rule\n              </p>\n            </div>\n\n            {/* Modal Content */}\n            <div className=\"p-6 overflow-y-auto max-h-[60vh]\">\n              {showDataProvenance.data ? (\n                <div className=\"space-y-6\">\n                  {/* Rule Summary */}\n                  <div className=\"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4\">\n                    <h4 className=\"font-semibold text-blue-900 dark:text-blue-200 mb-2\">Rule Summary</h4>\n                    <div className=\"grid grid-cols-2 gap-4 text-sm\">\n                      <div>\n                        <span className=\"font-medium\">Product:</span> {showDataProvenance.data.product_id}\n                      </div>\n                      <div>\n                        <span className=\"font-medium\">Countries:</span> {showDataProvenance.data.countries?.join(', ')}\n                      </div>\n                      <div>\n                        <span className=\"font-medium\">USD Price:</span> ${showDataProvenance.data.price_usd}\n                      </div>\n                      <div>\n                        <span className=\"font-medium\">Date Range:</span> {showDataProvenance.data.start_date} → {showDataProvenance.data.end_date || 'ongoing'}\n                      </div>\n                    </div>\n                  </div>\n\n                  {/* Underlying Events */}\n                  <div>\n                    <h4 className=\"font-semibold text-gray-900 dark:text-gray-100 mb-3\">\n                      🔍 Underlying Events ({showDataProvenance.data.events_analyzed || 0} events)\n                    </h4>\n                    <div className=\"bg-gray-50 dark:bg-gray-900 rounded-lg p-4\">\n                      <div className=\"text-sm text-gray-600 dark:text-gray-400 mb-3\">\n                        These are the actual pricing events from your database that led to this rule:\n                      </div>\n                      \n                      {/* Events Table */}\n                      <div className=\"overflow-x-auto\">\n                        <table className=\"w-full text-xs\">\n                          <thead>\n                            <tr className=\"bg-gray-200 dark:bg-gray-700\">\n                              <th className=\"p-2 text-left\">Trial Start</th>\n                              <th className=\"p-2 text-left\">Conversion</th>\n                              <th className=\"p-2 text-left\">Actual Price</th>\n                              <th className=\"p-2 text-left\">Country</th>\n                              <th className=\"p-2 text-left\">User ID</th>\n                            </tr>\n                          </thead>\n                          <tbody>\n                            {(showDataProvenance.data.sample_events || []).map((event, index) => (\n                              <tr key={index} className=\"border-b border-gray-200 dark:border-gray-600\">\n                                <td className=\"p-2\">{event.trial_start_date}</td>\n                                <td className=\"p-2\">{event.conversion_date}</td>\n                                <td className=\"p-2 font-mono\">${event.actual_price}</td>\n                                <td className=\"p-2\">{event.country}</td>\n                                <td className=\"p-2 font-mono text-xs\">{event.user_id?.substring(0, 8)}...</td>\n                              </tr>\n                            ))}\n                          </tbody>\n                        </table>\n                      </div>\n                    </div>\n                  </div>\n\n                  {/* Price Analysis */}\n                  <div>\n                    <h4 className=\"font-semibold text-gray-900 dark:text-gray-100 mb-3\">\n                      💰 Price Analysis\n                    </h4>\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                      {/* Actual Prices Seen */}\n                      <div className=\"bg-green-50 dark:bg-green-900/20 rounded-lg p-4\">\n                        <h5 className=\"font-medium text-green-900 dark:text-green-200 mb-2\">Actual Prices Charged</h5>\n                        <div className=\"text-sm space-y-1\">\n                          {(showDataProvenance.data.actual_prices || []).map((price, index) => (\n                            <div key={index} className=\"flex justify-between\">\n                              <span className=\"font-mono\">${price}</span>\n                              <span className=\"text-xs text-gray-500\">\n                                {showDataProvenance.data.price_counts?.[price] || 0} events\n                              </span>\n                            </div>\n                          ))}\n                        </div>\n                      </div>\n\n                      {/* Clustering Logic */}\n                      <div className=\"bg-yellow-50 dark:bg-yellow-900/20 rounded-lg p-4\">\n                        <h5 className=\"font-medium text-yellow-900 dark:text-yellow-200 mb-2\">USD Clustering</h5>\n                        <div className=\"text-sm space-y-2\">\n                          <div>\n                            <span className=\"font-medium\">Target USD:</span> ${showDataProvenance.data.price_usd}\n                          </div>\n                          <div>\n                            <span className=\"font-medium\">Price Range:</span> ${showDataProvenance.data.price_range?.min || 0} - ${showDataProvenance.data.price_range?.max || 0}\n                          </div>\n                          <div>\n                            <span className=\"font-medium\">Variance:</span> {showDataProvenance.data.price_variance || 0}%\n                          </div>\n                          <div className=\"text-xs text-gray-600 dark:text-gray-400\">\n                            Prices were clustered within 15% tolerance to account for FX fluctuations and rounding\n                          </div>\n                        </div>\n                      </div>\n                    </div>\n                  </div>\n\n                  {/* Detection Logic */}\n                  <div>\n                    <h4 className=\"font-semibold text-gray-900 dark:text-gray-100 mb-3\">\n                      🔬 Detection Logic\n                    </h4>\n                    <div className=\"bg-purple-50 dark:bg-purple-900/20 rounded-lg p-4\">\n                      <div className=\"text-sm space-y-2\">\n                        <div>\n                          <span className=\"font-medium\">Method:</span> {showDataProvenance.data.detection_method || 'USD price clustering'}\n                        </div>\n                        <div>\n                          <span className=\"font-medium\">Confidence:</span> {showDataProvenance.data.confidence_score || 'High'}\n                        </div>\n                        <div>\n                          <span className=\"font-medium\">Notes:</span> {showDataProvenance.data.notes || 'Auto-generated from conversion events'}\n                        </div>\n                      </div>\n                    </div>\n                  </div>\n                </div>\n              ) : (\n                <div className=\"text-center py-8\">\n                  <div className=\"text-gray-500 dark:text-gray-400\">\n                    Loading data provenance information...\n                  </div>\n                </div>\n              )}\n            </div>\n\n            {/* Modal Footer */}\n            <div className=\"p-6 border-t border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-900\">\n              <div className=\"flex justify-end\">\n                <button\n                  onClick={() => setShowDataProvenance(null)}\n                  className=\"px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded-md\"\n                >\n                  Close\n                </button>\n              </div>\n            </div>\n          </div>\n        </div>\n      )}\n\n      {/* Rule History Modal */}\n      {showRuleHistory && (\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50\">\n          <div className=\"bg-white dark:bg-gray-800 rounded-xl shadow-2xl max-w-4xl w-full mx-4 max-h-[80vh] overflow-hidden\">\n            {/* Modal Header */}\n            <div className=\"p-6 border-b border-gray-200 dark:border-gray-700\">\n              <div className=\"flex items-center justify-between\">\n                <h3 className=\"text-xl font-bold text-gray-900 dark:text-gray-100\">\n                  📜 Rule History: {showRuleHistory.productId}\n                </h3>\n                <button\n                  onClick={() => setShowRuleHistory(null)}\n                  className=\"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300\"\n                >\n                  <svg className=\"w-6 h-6\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\n                  </svg>\n                </button>\n              </div>\n              <p className=\"text-sm text-gray-600 dark:text-gray-400 mt-2\">\n                Complete chronological history of pricing rule changes (newest first)\n              </p>\n            </div>\n\n            {/* Modal Content */}\n            <div className=\"p-6 overflow-y-auto max-h-[60vh]\">\n              {showRuleHistory.data?.history && showRuleHistory.data.history.length > 0 ? (\n                <div className=\"space-y-6\">\n                  {/* Summary Stats */}\n                  <div className=\"grid grid-cols-3 gap-4 mb-6\">\n                    <div className=\"bg-green-50 dark:bg-green-900/20 rounded-lg p-4 text-center\">\n                      <div className=\"text-2xl font-bold text-green-600 dark:text-green-400\">\n                        {showRuleHistory.data.history.filter(e => e.action === 'created').length}\n                      </div>\n                      <div className=\"text-sm text-green-800 dark:text-green-300\">Rules Created</div>\n                    </div>\n                    <div className=\"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4 text-center\">\n                      <div className=\"text-2xl font-bold text-blue-600 dark:text-blue-400\">\n                        {showRuleHistory.data.history.filter(e => e.action === 'updated').length}\n                      </div>\n                      <div className=\"text-sm text-blue-800 dark:text-blue-300\">Rules Updated</div>\n                    </div>\n                    <div className=\"bg-red-50 dark:bg-red-900/20 rounded-lg p-4 text-center\">\n                      <div className=\"text-2xl font-bold text-red-600 dark:text-red-400\">\n                        {showRuleHistory.data.history.filter(e => e.action === 'deleted').length}\n                      </div>\n                      <div className=\"text-sm text-red-800 dark:text-red-300\">Rules Deleted</div>\n                    </div>\n                  </div>\n\n                  {/* Rule History Timeline */}\n                  <div className=\"space-y-4\">\n                    <h4 className=\"text-lg font-semibold text-gray-900 dark:text-gray-100 mb-4\">\n                      📅 Chronological History (Newest First)\n                    </h4>\n                    \n                    {showRuleHistory.data.history.map((entry, index) => {\n                      // Check if this rule still exists and can be edited\n                      const currentRule = rules.find(r => r.rule_id === entry.rule_data.rule_id);\n                      const canEdit = entry.action !== 'deleted' && currentRule;\n                      \n                      return (\n                        <div \n                          key={entry.entry_id}\n                          className={`relative p-6 rounded-xl border-l-4 shadow-lg ${\n                            entry.action === 'created' ? 'bg-green-50 border-green-400 dark:bg-green-900/20' :\n                            entry.action === 'updated' ? 'bg-blue-50 border-blue-400 dark:bg-blue-900/20' :\n                            'bg-red-50 border-red-400 dark:bg-red-900/20'\n                          }`}\n                        >\n                          {/* Timeline connector */}\n                          {index < showRuleHistory.data.history.length - 1 && (\n                            <div className=\"absolute left-0 bottom-0 w-1 h-6 bg-gray-300 transform translate-y-full\"></div>\n                          )}\n                          \n                          <div className=\"flex items-start justify-between\">\n                            <div className=\"flex-1\">\n                              {/* Action Badge and Main Info */}\n                              <div className=\"flex items-center gap-4 mb-3\">\n                                <span className={`px-3 py-1 text-sm font-bold rounded-full ${\n                                  entry.action === 'created' ? 'bg-green-100 text-green-800' :\n                                  entry.action === 'updated' ? 'bg-blue-100 text-blue-800' :\n                                  'bg-red-100 text-red-800'\n                                }`}>\n                                  {entry.action === 'created' ? '✅ CREATED' :\n                                   entry.action === 'updated' ? '📝 UPDATED' : '🗑️ DELETED'}\n                                </span>\n                                \n                                <div className=\"text-xl font-bold text-gray-900 dark:text-gray-100\">\n                                  ${entry.rule_data.price_usd}\n                                </div>\n                                \n                                <div className=\"text-sm font-medium text-gray-600 dark:text-gray-400 bg-gray-100 dark:bg-gray-700 px-3 py-1 rounded-full\">\n                                  {entry.rule_data.countries?.length} countries\n                                </div>\n                                \n                                <div className=\"text-xs text-gray-500 bg-gray-100 px-2 py-1 rounded font-mono\">\n                                  {entry.rule_data.rule_id}\n                                </div>\n                              </div>\n                              \n                              {/* Rule Details Grid */}\n                              <div className=\"grid grid-cols-2 gap-6 mb-4\">\n                                <div>\n                                  <div className=\"text-sm font-medium text-gray-700 dark:text-gray-300\">Date Range</div>\n                                  <div className=\"text-base text-gray-900 dark:text-gray-100\">\n                                    {formatDate(entry.rule_data.start_date)} → {formatDate(entry.rule_data.end_date) || 'Ongoing'}\n                                  </div>\n                                </div>\n                                <div>\n                                  <div className=\"text-sm font-medium text-gray-700 dark:text-gray-300\">Countries Applied</div>\n                                  <div className=\"text-sm text-gray-900 dark:text-gray-100\">\n                                    {entry.rule_data.countries?.slice(0, 3).join(', ')}\n                                    {entry.rule_data.countries?.length > 3 && ` +${entry.rule_data.countries.length - 3} more`}\n                                  </div>\n                                </div>\n                              </div>\n                              \n                              {/* User Notes */}\n                              {entry.user_notes && (\n                                <div className=\"bg-white dark:bg-gray-800 p-3 rounded-lg border border-gray-200 dark:border-gray-600 mb-4\">\n                                  <div className=\"text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">Notes</div>\n                                  <div className=\"text-sm text-gray-600 dark:text-gray-400\">{entry.user_notes}</div>\n                                </div>\n                              )}\n                              \n                              {/* Action Buttons */}\n                              <div className=\"flex gap-3\">\n                                {canEdit && (\n                                  <button\n                                    onClick={() => {\n                                      setShowRuleHistory(null); // Close history modal\n                                      openEditModal(currentRule); // Open edit modal\n                                    }}\n                                    className=\"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white text-sm font-medium rounded-lg transition-colors shadow-sm\"\n                                  >\n                                    ✏️ Edit This Rule\n                                  </button>\n                                )}\n                                \n                                <button\n                                  onClick={() => {\n                                    setShowRuleHistory(null);\n                                    loadDataProvenance(entry.rule_data.rule_id);\n                                  }}\n                                  className=\"px-4 py-2 bg-green-600 hover:bg-green-700 text-white text-sm font-medium rounded-lg transition-colors shadow-sm\"\n                                >\n                                  📊 View Data Source\n                                </button>\n                                \n                                {canEdit && (\n                                  <button\n                                    onClick={() => {\n                                      if (window.confirm(`Are you sure you want to delete rule ${entry.rule_data.rule_id}?`)) {\n                                        deleteRule(entry.rule_data.rule_id);\n                                        setShowRuleHistory(null);\n                                      }\n                                    }}\n                                    className=\"px-4 py-2 bg-red-600 hover:bg-red-700 text-white text-sm font-medium rounded-lg transition-colors shadow-sm\"\n                                  >\n                                    🗑️ Delete Rule\n                                  </button>\n                                )}\n                              </div>\n                            </div>\n                            \n                            {/* Timestamp */}\n                            <div className=\"text-right text-sm text-gray-500 dark:text-gray-400 ml-6\">\n                              <div className=\"font-medium\">{new Date(entry.timestamp).toLocaleDateString()}</div>\n                              <div>{new Date(entry.timestamp).toLocaleTimeString()}</div>\n                              {!canEdit && entry.action !== 'deleted' && (\n                                <div className=\"text-xs text-red-500 mt-1\">Rule no longer exists</div>\n                              )}\n                            </div>\n                          </div>\n                        </div>\n                      );\n                    })}\n                  </div>\n                </div>\n              ) : (\n                <div className=\"text-center py-12\">\n                  <div className=\"text-6xl mb-4\">📜</div>\n                  <div className=\"text-xl font-medium text-gray-600 dark:text-gray-400 mb-2\">\n                    No Rule History Yet\n                  </div>\n                  <div className=\"text-sm text-gray-500 dark:text-gray-500\">\n                    Create your first pricing rule to start tracking changes\n                  </div>\n                </div>\n              )}\n            </div>\n\n            {/* Modal Footer */}\n            <div className=\"p-6 border-t border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-900\">\n              <div className=\"flex justify-between items-center\">\n                <div className=\"text-sm text-gray-600 dark:text-gray-400\">\n                  {showRuleHistory.data?.total_count || 0} total changes tracked\n                </div>\n                <button\n                  onClick={() => setShowRuleHistory(null)}\n                  className=\"px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded-lg font-medium\"\n                >\n                  Close History\n                </button>\n              </div>\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default PricingManagementPage; "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}