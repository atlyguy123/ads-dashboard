{"ast":null,"code":"var _jsxFileName = \"/Users/joshuakaufman/untitled folder 3/orchestrator/dashboard/client/src/components/conversion_probability/utils/conversionUtils.js\";\nimport React from 'react';\n\n// Timeframe options configuration\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport const timeframeOptions = [{\n  value: 'all',\n  label: 'All Time',\n  description: 'Analyze all historical data'\n}, {\n  value: '1month',\n  label: 'Last 1 Month',\n  description: 'Last 30 days'\n}, {\n  value: '3months',\n  label: 'Last 3 Months',\n  description: 'Last 90 days'\n}, {\n  value: '6months',\n  label: 'Last 6 Months',\n  description: 'Last 180 days'\n}, {\n  value: '1year',\n  label: 'Last 1 Year',\n  description: 'Last 365 days'\n}];\n\n// Helper function to calculate date range from timeframe\nexport const getDateRangeFromTimeframe = timeframe => {\n  if (timeframe === 'all') {\n    return {\n      start: null,\n      end: null\n    };\n  }\n  const end = new Date();\n  const start = new Date('2024-01-01'); // Always start from Jan 1, 2024 to ensure comprehensive coverage\n\n  // Note: We now always start from 2024-01-01 and go to today to ensure all products are included\n  // This prevents newer products from being excluded due to narrow date windows\n\n  return {\n    start: start.toISOString().split('T')[0],\n    end: end.toISOString().split('T')[0]\n  };\n};\n\n// Formatting functions\nexport const formatPercentage = value => {\n  return `${(value * 100).toFixed(2)}%`;\n};\nexport const formatDate = dateString => {\n  return new Date(dateString).toLocaleDateString();\n};\nexport const formatAppStore = store => {\n  const storeMap = {\n    'APP_STORE': 'App Store',\n    'PLAY_STORE': 'Play Store',\n    'STRIPE': 'Stripe'\n  };\n  return storeMap[store] || store;\n};\n\n// Format segment ID to show first4...last4 format\nexport const formatSegmentId = segmentId => {\n  if (!segmentId) return 'No ID';\n  if (segmentId.length <= 8) return segmentId;\n  return `${segmentId.slice(0, 4)}...${segmentId.slice(-4)}`;\n};\n\n// Helper function to generate consistent color from UUID\nconst getColorFromUUID = uuid => {\n  if (!uuid) return {\n    bg: 'bg-gray-100',\n    text: 'text-gray-800',\n    border: 'border-gray-200',\n    darkBg: 'dark:bg-gray-900',\n    darkText: 'dark:text-gray-200',\n    darkBorder: 'dark:border-gray-700'\n  };\n\n  // Create a simple hash from the UUID\n  let hash = 0;\n  for (let i = 0; i < uuid.length; i++) {\n    const char = uuid.charCodeAt(i);\n    hash = (hash << 5) - hash + char;\n    hash = hash & hash; // Convert to 32-bit integer\n  }\n\n  // Use the hash to select from a set of colors that work well together\n  const colors = [{\n    bg: 'bg-blue-100',\n    text: 'text-blue-800',\n    border: 'border-blue-200',\n    darkBg: 'dark:bg-blue-900',\n    darkText: 'dark:text-blue-200',\n    darkBorder: 'dark:border-blue-700'\n  }, {\n    bg: 'bg-green-100',\n    text: 'text-green-800',\n    border: 'border-green-200',\n    darkBg: 'dark:bg-green-900',\n    darkText: 'dark:text-green-200',\n    darkBorder: 'dark:border-green-700'\n  }, {\n    bg: 'bg-purple-100',\n    text: 'text-purple-800',\n    border: 'border-purple-200',\n    darkBg: 'dark:bg-purple-900',\n    darkText: 'dark:text-purple-200',\n    darkBorder: 'dark:border-purple-700'\n  }, {\n    bg: 'bg-red-100',\n    text: 'text-red-800',\n    border: 'border-red-200',\n    darkBg: 'dark:bg-red-900',\n    darkText: 'dark:text-red-200',\n    darkBorder: 'dark:border-red-700'\n  }, {\n    bg: 'bg-yellow-100',\n    text: 'text-yellow-800',\n    border: 'border-yellow-200',\n    darkBg: 'dark:bg-yellow-900',\n    darkText: 'dark:text-yellow-200',\n    darkBorder: 'dark:border-yellow-700'\n  }, {\n    bg: 'bg-indigo-100',\n    text: 'text-indigo-800',\n    border: 'border-indigo-200',\n    darkBg: 'dark:bg-indigo-900',\n    darkText: 'dark:text-indigo-200',\n    darkBorder: 'dark:border-indigo-700'\n  }, {\n    bg: 'bg-pink-100',\n    text: 'text-pink-800',\n    border: 'border-pink-200',\n    darkBg: 'dark:bg-pink-900',\n    darkText: 'dark:text-pink-200',\n    darkBorder: 'dark:border-pink-700'\n  }, {\n    bg: 'bg-cyan-100',\n    text: 'text-cyan-800',\n    border: 'border-cyan-200',\n    darkBg: 'dark:bg-cyan-900',\n    darkText: 'dark:text-cyan-200',\n    darkBorder: 'dark:border-cyan-700'\n  }, {\n    bg: 'bg-emerald-100',\n    text: 'text-emerald-800',\n    border: 'border-emerald-200',\n    darkBg: 'dark:bg-emerald-900',\n    darkText: 'dark:text-emerald-200',\n    darkBorder: 'dark:border-emerald-700'\n  }, {\n    bg: 'bg-orange-100',\n    text: 'text-orange-800',\n    border: 'border-orange-200',\n    darkBg: 'dark:bg-orange-900',\n    darkText: 'dark:text-orange-200',\n    darkBorder: 'dark:border-orange-700'\n  }];\n  const colorIndex = Math.abs(hash) % colors.length;\n  return colors[colorIndex];\n};\n\n// Create segment ID badge component\nexport const getSegmentIdBadge = (segmentId, label = 'Segment ID') => {\n  const colors = getColorFromUUID(segmentId);\n  return /*#__PURE__*/_jsxDEV(\"span\", {\n    className: `inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${colors.bg} ${colors.text} ${colors.darkBg} ${colors.darkText} ${colors.border} ${colors.darkBorder} border`,\n    children: [/*#__PURE__*/_jsxDEV(\"span\", {\n      className: \"mr-1\",\n      children: [label, \":\"]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 91,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n      className: \"font-mono\",\n      children: formatSegmentId(segmentId)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 92,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 90,\n    columnNumber: 5\n  }, this);\n};\n\n// Create rollup target ID badge component\nexport const getRollupTargetIdBadge = (targetSegmentId, label = 'Target') => {\n  const colors = getColorFromUUID(targetSegmentId);\n  return /*#__PURE__*/_jsxDEV(\"span\", {\n    className: `inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${colors.bg} ${colors.text} ${colors.darkBg} ${colors.darkText} ${colors.border} ${colors.darkBorder} border`,\n    children: [/*#__PURE__*/_jsxDEV(\"span\", {\n      className: \"mr-1\",\n      children: [\"\\u2192 \", label, \":\"]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 103,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n      className: \"font-mono\",\n      children: formatSegmentId(targetSegmentId)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 104,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 102,\n    columnNumber: 5\n  }, this);\n};\n\n// Load saved state from localStorage\nexport const loadSavedState = () => {\n  try {\n    const savedConfig = localStorage.getItem('conversionProbability_config');\n    const savedExpandedSections = localStorage.getItem('conversionProbability_expandedSections');\n    return {\n      config: savedConfig ? JSON.parse(savedConfig) : {\n        timeframe: 'all',\n        min_cohort_size: 50,\n        force_recalculate: false,\n        min_price_samples: 100\n      },\n      expandedSections: savedExpandedSections ? JSON.parse(savedExpandedSections) : {\n        propertyAnalysis: false,\n        analysisHierarchy: true\n      }\n    };\n  } catch (err) {\n    console.error('Error loading saved state:', err);\n    return {\n      config: {\n        timeframe: 'all',\n        min_cohort_size: 50,\n        force_recalculate: false,\n        min_price_samples: 100\n      },\n      expandedSections: {\n        propertyAnalysis: false,\n        analysisHierarchy: true\n      }\n    };\n  }\n};\n\n// Function to create segment-specific rollup data for individual segments\nexport const createSegmentRollupData = segment => {\n  // Check for any signs of rollup having occurred\n  const hasPropertiesDropped = segment.cohort.properties_dropped && segment.cohort.properties_dropped.length > 0;\n  const hasRollupTarget = segment.cohort.rollup_target;\n  const hasRollupReason = segment.cohort.rollup_reason;\n  const hasOriginalSize = segment.cohort.original_cohort_size && segment.cohort.original_cohort_size !== segment.cohort.cohort_size;\n  const hasAnyRollup = hasPropertiesDropped || hasRollupTarget || hasRollupReason || hasOriginalSize;\n  if (!hasAnyRollup) {\n    // Even when no rollup, return a valid structure showing this is a direct segment\n    return {\n      totalSegments: 1,\n      rolledUpSegments: 0,\n      calculatedSegments: 1,\n      rollupTargets: {},\n      segmentDetails: [{\n        segmentId: segment.cohort.segment_id || 'unknown',\n        productId: segment.cohort.product_id,\n        priceBucket: segment.cohort.price_bucket,\n        region: segment.cohort.region,\n        country: segment.cohort.country,\n        appStore: segment.cohort.app_store,\n        originalUsers: segment.cohort.cohort_size,\n        finalUsers: segment.cohort.cohort_size,\n        hasRollup: false,\n        rollupTarget: null,\n        rollupDescription: 'No rollup required - segment had sufficient data',\n        propertiesDropped: []\n      }]\n    };\n  }\n\n  // Build rollup information\n  const rollupTargetName = segment.cohort.rollup_target || 'Expanded Segment';\n  return {\n    totalSegments: 1,\n    // This represents 1 final segment\n    rolledUpSegments: 1,\n    // This segment had rollup applied\n    calculatedSegments: 0,\n    rollupTargets: {\n      [rollupTargetName]: [{\n        segmentId: segment.cohort.segment_id || 'unknown',\n        productId: segment.cohort.product_id,\n        priceBucket: segment.cohort.price_bucket,\n        region: segment.cohort.region,\n        country: segment.cohort.country,\n        appStore: segment.cohort.app_store,\n        originalUsers: segment.cohort.original_cohort_size || segment.cohort.cohort_size,\n        finalUsers: segment.cohort.cohort_size,\n        propertiesDropped: segment.cohort.properties_dropped || [],\n        rollupReason: segment.cohort.rollup_reason || 'Segment expanded for better statistics',\n        rollupTarget: segment.cohort.rollup_target_segment_id || segment.cohort.rollup_target\n      }]\n    },\n    segmentDetails: [{\n      segmentId: segment.cohort.segment_id || 'unknown',\n      productId: segment.cohort.product_id,\n      priceBucket: segment.cohort.price_bucket,\n      region: segment.cohort.region,\n      country: segment.cohort.country,\n      appStore: segment.cohort.app_store,\n      originalUsers: segment.cohort.original_cohort_size || segment.cohort.cohort_size,\n      finalUsers: segment.cohort.cohort_size,\n      hasRollup: true,\n      rollupTarget: segment.cohort.rollup_target_segment_id || rollupTargetName,\n      rollupDescription: segment.cohort.rollup_reason || 'Segment was expanded to include more data',\n      propertiesDropped: segment.cohort.properties_dropped || []\n    }]\n  };\n};\n\n// Helper function to generate status indicators with hover tooltips\nexport const getStatusIndicator = (passesThreshold, rollupInfo, level = 'segment', rollupTarget = null) => {\n  if (passesThreshold) {\n    return /*#__PURE__*/_jsxDEV(\"span\", {\n      className: \"px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200\",\n      children: \"\\u2705 PASSES\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 221,\n      columnNumber: 7\n    }, this);\n  }\n\n  // FIXED: Show the FINAL rollup target consistently with better fallback handling\n  let finalTarget = rollupTarget;\n\n  // If no rollup target provided, try to extract from rollup info\n  if (!finalTarget && rollupInfo) {\n    if (rollupInfo.rollupReasons && rollupInfo.rollupReasons.length > 0) {\n      finalTarget = rollupInfo.rollupReasons[0];\n    } else if (rollupInfo.rollupTarget) {\n      finalTarget = rollupInfo.rollupTarget;\n    }\n  }\n\n  // FIXED: Always provide a fallback if no target is found\n  if (!finalTarget || finalTarget.trim() === '') {\n    return /*#__PURE__*/_jsxDEV(\"span\", {\n      className: \"px-2 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200\",\n      children: \"\\u274C INSUFFICIENT DATA\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 242,\n      columnNumber: 7\n    }, this);\n  }\n\n  // FIXED: Normalize the final target to show simple, consistent names\n  let displayTarget = finalTarget;\n\n  // Normalize to simple names\n  if (finalTarget.includes('Country-wide')) {\n    displayTarget = finalTarget; // Keep country-wide as is\n  } else if (finalTarget.includes('Tier 1') || finalTarget.includes('tier1')) {\n    displayTarget = 'Tier 1';\n  } else if (finalTarget.includes('Tier 2') || finalTarget.includes('tier2')) {\n    displayTarget = 'Tier 2';\n  } else if (finalTarget.includes('Tier 3') || finalTarget.includes('tier3')) {\n    displayTarget = 'Tier 3';\n  } else if (finalTarget.includes('Tier 4') || finalTarget.includes('tier4')) {\n    displayTarget = 'Tier 4';\n  } else if (finalTarget.includes('$') && finalTarget.includes('-')) {\n    // Price bucket format like \"$95-$105\"\n    displayTarget = finalTarget;\n  } else {\n    // Default to showing the target as-is, but ensure it's not empty\n    displayTarget = finalTarget || 'Unknown Target';\n  }\n\n  // Show FINAL rollup target\n  const tooltipContent = rollupInfo ? /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"text-xs\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"font-medium mb-1\",\n      children: \"Rollup Details:\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 273,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      children: [\"\\u2022 Final destination: \", finalTarget]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 274,\n      columnNumber: 7\n    }, this), rollupInfo.finalUserCount && /*#__PURE__*/_jsxDEV(\"div\", {\n      children: [\"\\u2022 Final user count: \", rollupInfo.finalUserCount.toLocaleString()]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 276,\n      columnNumber: 9\n    }, this), rollupInfo.propertiesDropped && rollupInfo.propertiesDropped.length > 0 && /*#__PURE__*/_jsxDEV(\"div\", {\n      children: [\"\\u2022 Properties dropped: \", rollupInfo.propertiesDropped.join(', ')]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 279,\n      columnNumber: 9\n    }, this), rollupInfo.rollupReasons && rollupInfo.rollupReasons.length > 0 && /*#__PURE__*/_jsxDEV(\"div\", {\n      children: [\"\\u2022 Reason: \", rollupInfo.rollupReasons[0]]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 282,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 272,\n    columnNumber: 5\n  }, this) : null;\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"relative group\",\n    children: [/*#__PURE__*/_jsxDEV(\"span\", {\n      className: \"px-2 py-1 rounded-full text-xs font-medium bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-200 cursor-help\",\n      children: [\"\\u2192 \", displayTarget]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 289,\n      columnNumber: 7\n    }, this), tooltipContent && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-2 bg-gray-900 dark:bg-gray-100 text-white dark:text-gray-900 text-xs rounded-lg shadow-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none z-10 whitespace-nowrap max-w-xs\",\n      children: [tooltipContent, /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"absolute top-full left-1/2 transform -translate-x-1/2 border-4 border-transparent border-t-gray-900 dark:border-t-gray-100\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 297,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 295,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 288,\n    columnNumber: 5\n  }, this);\n};\nexport const buildHierarchicalStructure = (segments, minCohortSize) => {\n  // Economic tier mappings (updated to match backend with all 203 countries)\n  const economicTiers = {\n    // Tier 1: High-income developed countries (GDP per capita > $40,000)\n    'tier1_high_income': [\n    // North America & Oceania\n    'US', 'CA', 'AU', 'NZ',\n    // Western Europe\n    'GB', 'IE', 'DE', 'FR', 'NL', 'BE', 'AT', 'CH', 'LU', 'DK', 'SE', 'NO', 'FI', 'IS',\n    // Other high-income\n    'IL', 'SG', 'HK', 'QA', 'AE', 'KW', 'BH', 'OM', 'SA',\n    // Small wealthy territories & microstates\n    'MC', 'LI', 'AD', 'MT', 'CY', 'IM', 'JE', 'GG', 'GI', 'BM', 'SM', 'KY', 'VI', 'AW', 'TC', 'VG', 'BQ', 'SX', 'MF', 'PM', 'AX', 'CW',\n    // Overseas territories of wealthy countries\n    'MQ', 'GP', 'RE', 'FO', 'GL'],\n    // Tier 2: Upper-middle income & developed countries ($15,000-$40,000)\n    'tier2_upper_middle': [\n    // East Asia\n    'JP', 'KR', 'TW', 'MO',\n    // Southern & Eastern Europe  \n    'IT', 'ES', 'PT', 'GR', 'SI', 'CZ', 'SK', 'EE', 'LV', 'LT', 'HR', 'HU', 'PL', 'RO', 'BG', 'MT',\n    // Latin America (upper-middle)\n    'UY', 'CR', 'PA', 'PR',\n    // Other upper-middle\n    'BN', 'MV', 'SC', 'MU', 'BB', 'BS', 'TT'],\n    // Tier 3: Emerging economies & lower-middle income ($4,000-$15,000)\n    'tier3_emerging': [\n    // Latin America\n    'BR', 'MX', 'AR', 'CL', 'CO', 'PE', 'EC', 'DO', 'JM', 'PY', 'GT', 'SV', 'HN', 'NI', 'BZ', 'VE', 'BO', 'GY', 'SR',\n    // Asia-Pacific\n    'CN', 'TH', 'MY', 'RU', 'TR', 'KZ', 'AZ', 'GE', 'AM', 'BY', 'UZ', 'KG', 'TJ', 'MN', 'FJ', 'TO', 'VU', 'PG', 'TL',\n    // Africa (emerging)\n    'ZA', 'NA', 'BW', 'MU', 'SC',\n    // Europe (emerging)\n    'RS', 'ME', 'MK', 'AL', 'BA', 'MD', 'UA', 'XK',\n    // Caribbean\n    'LC', 'GD', 'KN', 'AG', 'DM'],\n    // Tier 4: Developing countries (GDP per capita < $4,000)\n    'tier4_developing': [\n    // South Asia\n    'IN', 'PK', 'BD', 'LK', 'NP', 'BT', 'AF', 'MV',\n    // Southeast Asia\n    'ID', 'PH', 'VN', 'MM', 'KH', 'LA',\n    // Middle East & North Africa\n    'EG', 'MA', 'TN', 'DZ', 'LY', 'SD', 'LB', 'JO', 'PS', 'SY', 'IQ', 'IR', 'YE',\n    // Sub-Saharan Africa\n    'NG', 'KE', 'GH', 'TZ', 'UG', 'ET', 'RW', 'ZM', 'ZW', 'MW', 'MZ', 'AO', 'CM', 'CI', 'SN', 'ML', 'BF', 'NE', 'TD', 'CF', 'CD', 'CG', 'GA', 'GQ', 'ST', 'CV', 'GM', 'GW', 'SL', 'LR', 'BJ', 'TG', 'GH', 'BI', 'DJ', 'SO', 'ER', 'SS', 'MR', 'MG', 'KM', 'MU', 'SZ', 'LS',\n    // Caribbean & Pacific (developing)\n    'HT', 'CU', 'NC', 'PF', 'AS', 'GU', 'FM', 'MH', 'PW', 'NR', 'TV', 'KI', 'SB', 'WS', 'ST', 'CV']\n  };\n  const getEconomicTier = country => {\n    for (const [tier, countries] of Object.entries(economicTiers)) {\n      if (countries.includes(country)) {\n        return `Tier ${tier.split('_')[0].replace('tier', '')}`;\n      }\n    }\n    return 'Tier 4';\n  };\n\n  // Helper function to generate deterministic segment ID based on segment properties\n  const generateSegmentId = properties => {\n    // Create a deterministic hash based on the segment properties\n    const propertyString = Object.keys(properties).sort().map(key => `${key}:${properties[key] || 'null'}`).join('|');\n\n    // Simple hash function for demo - in production you might want a more robust one\n    let hash = 0;\n    for (let i = 0; i < propertyString.length; i++) {\n      const char = propertyString.charCodeAt(i);\n      hash = (hash << 5) - hash + char;\n      hash = hash & hash; // Convert to 32-bit integer\n    }\n\n    // Convert to positive number and create a UUID-like string\n    const positiveHash = Math.abs(hash);\n    const segmentId = positiveHash.toString(16).padStart(8, '0');\n    return `${segmentId.slice(0, 4)}-${segmentId.slice(4, 8)}-seg-${Date.now().toString().slice(-4)}`;\n  };\n  const hierarchy = {};\n\n  // Group by Product + Store + Price (Level 1)\n  segments.forEach(segment => {\n    const productId = segment.product_id;\n    const appStore = segment.app_store || 'Unknown Store';\n    const priceRange = segment.price_bucket;\n    const country = segment.country || 'Unknown';\n    const region = segment.region;\n    const users = segment.user_count;\n\n    // Use the backend's rollup information directly\n    const hasSufficientData = segment.has_sufficient_data;\n    const propertiesDropped = segment.properties_dropped || [];\n    const rollupDescription = segment.rollup_description || '';\n    const rollupTarget = segment.rollup_target || null; // FINAL rollup target from backend\n    const finalUserCount = segment.final_user_count || users;\n    const accuracyScore = segment.accuracy_score || 'very_high';\n\n    // Get segment ID from backend or generate one\n    const originalSegmentId = segment.segment_id || generateSegmentId({\n      product_id: productId,\n      app_store: appStore,\n      price_bucket: priceRange,\n      country: country,\n      region: region\n    });\n    const economicTier = getEconomicTier(country);\n\n    // Initialize Product+Store+Price level (Level 1)\n    const level1Key = `${productId}|${appStore}|${priceRange}`;\n    if (!hierarchy[level1Key]) {\n      // Generate segment ID for Level 1 (Product+Store+Price)\n      const level1SegmentId = generateSegmentId({\n        product_id: productId,\n        app_store: appStore,\n        price_bucket: priceRange\n      });\n      hierarchy[level1Key] = {\n        productId: productId,\n        appStore: appStore,\n        priceRange: priceRange,\n        segmentId: level1SegmentId,\n        totalUsers: 0,\n        passesThreshold: false,\n        rollupInfo: {\n          hasRollups: false,\n          rolledUpSegments: 0,\n          totalSegments: 0,\n          rollupReasons: new Set(),\n          propertiesDropped: new Set(),\n          finalUserCount: 0,\n          rollupTarget: null,\n          rollupTargetSegmentId: null\n        },\n        economicTiers: {}\n      };\n    }\n    hierarchy[level1Key].totalUsers += users;\n    hierarchy[level1Key].rollupInfo.totalSegments += 1;\n    hierarchy[level1Key].rollupInfo.finalUserCount += finalUserCount;\n    if (!hasSufficientData || propertiesDropped.length > 0) {\n      hierarchy[level1Key].rollupInfo.hasRollups = true;\n      hierarchy[level1Key].rollupInfo.rolledUpSegments += 1;\n      if (rollupDescription) hierarchy[level1Key].rollupInfo.rollupReasons.add(rollupDescription);\n      if (rollupTarget) hierarchy[level1Key].rollupInfo.rollupTarget = rollupTarget;\n      propertiesDropped.forEach(prop => hierarchy[level1Key].rollupInfo.propertiesDropped.add(prop));\n    }\n\n    // Initialize economic tier level (Level 2)\n    const level2Key = `${level1Key}|${economicTier}`;\n    if (!hierarchy[level1Key].economicTiers[economicTier]) {\n      // Generate segment ID for Level 2 (Product+Store+Price+EconomicTier)\n      const level2SegmentId = generateSegmentId({\n        product_id: productId,\n        app_store: appStore,\n        price_bucket: priceRange,\n        economic_tier: economicTier\n      });\n      hierarchy[level1Key].economicTiers[economicTier] = {\n        tierName: economicTier,\n        segmentId: level2SegmentId,\n        totalUsers: 0,\n        passesThreshold: false,\n        rollupInfo: {\n          hasRollups: false,\n          rolledUpSegments: 0,\n          totalSegments: 0,\n          rollupReasons: new Set(),\n          propertiesDropped: new Set(),\n          finalUserCount: 0,\n          rollupTarget: null,\n          rollupTargetSegmentId: null\n        },\n        countries: {}\n      };\n    }\n    hierarchy[level1Key].economicTiers[economicTier].totalUsers += users;\n    hierarchy[level1Key].economicTiers[economicTier].rollupInfo.totalSegments += 1;\n    hierarchy[level1Key].economicTiers[economicTier].rollupInfo.finalUserCount += finalUserCount;\n    if (!hasSufficientData || propertiesDropped.length > 0) {\n      hierarchy[level1Key].economicTiers[economicTier].rollupInfo.hasRollups = true;\n      hierarchy[level1Key].economicTiers[economicTier].rollupInfo.rolledUpSegments += 1;\n      if (rollupDescription) hierarchy[level1Key].economicTiers[economicTier].rollupInfo.rollupReasons.add(rollupDescription);\n      if (rollupTarget) hierarchy[level1Key].economicTiers[economicTier].rollupInfo.rollupTarget = rollupTarget;\n      propertiesDropped.forEach(prop => hierarchy[level1Key].economicTiers[economicTier].rollupInfo.propertiesDropped.add(prop));\n    }\n\n    // Initialize country level (Level 3)\n    if (!hierarchy[level1Key].economicTiers[economicTier].countries[country]) {\n      // Generate segment ID for Level 3 (Product+Store+Price+EconomicTier+Country)\n      const level3SegmentId = generateSegmentId({\n        product_id: productId,\n        app_store: appStore,\n        price_bucket: priceRange,\n        economic_tier: economicTier,\n        country: country\n      });\n      hierarchy[level1Key].economicTiers[economicTier].countries[country] = {\n        countryName: country,\n        segmentId: level3SegmentId,\n        totalUsers: 0,\n        passesThreshold: false,\n        rollupInfo: {\n          hasRollups: false,\n          rolledUpSegments: 0,\n          totalSegments: 0,\n          rollupReasons: new Set(),\n          propertiesDropped: new Set(),\n          finalUserCount: 0,\n          rollupTarget: null,\n          rollupTargetSegmentId: null\n        },\n        regions: []\n      };\n    }\n    hierarchy[level1Key].economicTiers[economicTier].countries[country].totalUsers += users;\n    hierarchy[level1Key].economicTiers[economicTier].countries[country].rollupInfo.totalSegments += 1;\n    hierarchy[level1Key].economicTiers[economicTier].countries[country].rollupInfo.finalUserCount += finalUserCount;\n    if (!hasSufficientData || propertiesDropped.length > 0) {\n      hierarchy[level1Key].economicTiers[economicTier].countries[country].rollupInfo.hasRollups = true;\n      hierarchy[level1Key].economicTiers[economicTier].countries[country].rollupInfo.rolledUpSegments += 1;\n      if (rollupDescription) hierarchy[level1Key].economicTiers[economicTier].countries[country].rollupInfo.rollupReasons.add(rollupDescription);\n      if (rollupTarget) hierarchy[level1Key].economicTiers[economicTier].countries[country].rollupInfo.rollupTarget = rollupTarget;\n      propertiesDropped.forEach(prop => hierarchy[level1Key].economicTiers[economicTier].countries[country].rollupInfo.propertiesDropped.add(prop));\n    }\n\n    // Add region if it exists (Level 4)\n    if (region) {\n      // Use original segment ID from backend or generate Level 4 segment ID\n      const level4SegmentId = originalSegmentId;\n\n      // Determine rollup target segment ID based on rollup logic\n      let rollupTargetSegmentId = null;\n      if (!hasSufficientData || propertiesDropped.length > 0) {\n        // If this segment rolls up, determine which level it rolls up to\n        if (rollupTarget && rollupTarget.includes('Country-wide')) {\n          // Rolls up to country level (Level 3)\n          rollupTargetSegmentId = hierarchy[level1Key].economicTiers[economicTier].countries[country].segmentId;\n        } else if (rollupTarget && (rollupTarget.includes('Tier') || rollupTarget.includes('tier'))) {\n          // Rolls up to economic tier level (Level 2)\n          rollupTargetSegmentId = hierarchy[level1Key].economicTiers[economicTier].segmentId;\n        } else {\n          // Rolls up to product+store+price level (Level 1)\n          rollupTargetSegmentId = hierarchy[level1Key].segmentId;\n        }\n      }\n      hierarchy[level1Key].economicTiers[economicTier].countries[country].regions.push({\n        name: region,\n        segmentId: level4SegmentId,\n        rollupTargetSegmentId: rollupTargetSegmentId,\n        users: users,\n        passes: hasSufficientData && propertiesDropped.length === 0,\n        rollupTarget: rollupTarget,\n        rollupReason: rollupDescription,\n        accuracyScore: accuracyScore,\n        finalUserCount: finalUserCount,\n        originalUserCount: users,\n        propertiesDropped: propertiesDropped\n      });\n    }\n  });\n\n  // Calculate pass/fail status and assign rollup target segment IDs for each level\n  Object.keys(hierarchy).forEach(level1Key => {\n    const level1Data = hierarchy[level1Key];\n    level1Data.passesThreshold = level1Data.totalUsers >= minCohortSize;\n\n    // Convert Sets to Arrays for easier use in UI\n    level1Data.rollupInfo.rollupReasons = Array.from(level1Data.rollupInfo.rollupReasons);\n    level1Data.rollupInfo.propertiesDropped = Array.from(level1Data.rollupInfo.propertiesDropped);\n\n    // If Level 1 doesn't pass, it can't roll up anywhere (it's the ceiling)\n    if (!level1Data.passesThreshold) {\n      level1Data.rollupInfo.rollupTargetSegmentId = null; // Cannot roll up beyond this level\n    }\n    Object.keys(level1Data.economicTiers).forEach(tierName => {\n      const tierData = level1Data.economicTiers[tierName];\n      tierData.passesThreshold = tierData.totalUsers >= minCohortSize;\n\n      // Convert Sets to Arrays for easier use in UI\n      tierData.rollupInfo.rollupReasons = Array.from(tierData.rollupInfo.rollupReasons);\n      tierData.rollupInfo.propertiesDropped = Array.from(tierData.rollupInfo.propertiesDropped);\n\n      // If tier doesn't pass, it rolls up to Level 1 (Product+Store+Price)\n      if (!tierData.passesThreshold) {\n        tierData.rollupInfo.rollupTargetSegmentId = level1Data.segmentId;\n      }\n      Object.keys(tierData.countries).forEach(country => {\n        const countryData = tierData.countries[country];\n        countryData.passesThreshold = countryData.totalUsers >= minCohortSize;\n\n        // Convert Sets to Arrays for easier use in UI\n        countryData.rollupInfo.rollupReasons = Array.from(countryData.rollupInfo.rollupReasons);\n        countryData.rollupInfo.propertiesDropped = Array.from(countryData.rollupInfo.propertiesDropped);\n\n        // If country doesn't pass, it rolls up to Level 2 (Economic Tier)\n        if (!countryData.passesThreshold) {\n          countryData.rollupInfo.rollupTargetSegmentId = tierData.segmentId;\n        }\n      });\n    });\n  });\n  return hierarchy;\n};","map":{"version":3,"names":["React","jsxDEV","_jsxDEV","timeframeOptions","value","label","description","getDateRangeFromTimeframe","timeframe","start","end","Date","toISOString","split","formatPercentage","toFixed","formatDate","dateString","toLocaleDateString","formatAppStore","store","storeMap","formatSegmentId","segmentId","length","slice","getColorFromUUID","uuid","bg","text","border","darkBg","darkText","darkBorder","hash","i","char","charCodeAt","colors","colorIndex","Math","abs","getSegmentIdBadge","className","children","fileName","_jsxFileName","lineNumber","columnNumber","getRollupTargetIdBadge","targetSegmentId","loadSavedState","savedConfig","localStorage","getItem","savedExpandedSections","config","JSON","parse","min_cohort_size","force_recalculate","min_price_samples","expandedSections","propertyAnalysis","analysisHierarchy","err","console","error","createSegmentRollupData","segment","hasPropertiesDropped","cohort","properties_dropped","hasRollupTarget","rollup_target","hasRollupReason","rollup_reason","hasOriginalSize","original_cohort_size","cohort_size","hasAnyRollup","totalSegments","rolledUpSegments","calculatedSegments","rollupTargets","segmentDetails","segment_id","productId","product_id","priceBucket","price_bucket","region","country","appStore","app_store","originalUsers","finalUsers","hasRollup","rollupTarget","rollupDescription","propertiesDropped","rollupTargetName","rollupReason","rollup_target_segment_id","getStatusIndicator","passesThreshold","rollupInfo","level","finalTarget","rollupReasons","trim","displayTarget","includes","tooltipContent","finalUserCount","toLocaleString","join","buildHierarchicalStructure","segments","minCohortSize","economicTiers","getEconomicTier","tier","countries","Object","entries","replace","generateSegmentId","properties","propertyString","keys","sort","map","key","positiveHash","toString","padStart","now","hierarchy","forEach","priceRange","users","user_count","hasSufficientData","has_sufficient_data","rollup_description","final_user_count","accuracyScore","accuracy_score","originalSegmentId","economicTier","level1Key","level1SegmentId","totalUsers","hasRollups","Set","rollupTargetSegmentId","add","prop","level2Key","level2SegmentId","economic_tier","tierName","level3SegmentId","countryName","regions","level4SegmentId","push","name","passes","originalUserCount","level1Data","Array","from","tierData","countryData"],"sources":["/Users/joshuakaufman/untitled folder 3/orchestrator/dashboard/client/src/components/conversion_probability/utils/conversionUtils.js"],"sourcesContent":["import React from 'react';\n\n// Timeframe options configuration\nexport const timeframeOptions = [\n  { value: 'all', label: 'All Time', description: 'Analyze all historical data' },\n  { value: '1month', label: 'Last 1 Month', description: 'Last 30 days' },\n  { value: '3months', label: 'Last 3 Months', description: 'Last 90 days' },\n  { value: '6months', label: 'Last 6 Months', description: 'Last 180 days' },\n  { value: '1year', label: 'Last 1 Year', description: 'Last 365 days' }\n];\n\n// Helper function to calculate date range from timeframe\nexport const getDateRangeFromTimeframe = (timeframe) => {\n  if (timeframe === 'all') {\n    return { start: null, end: null };\n  }\n  \n  const end = new Date();\n  const start = new Date('2024-01-01'); // Always start from Jan 1, 2024 to ensure comprehensive coverage\n  \n  // Note: We now always start from 2024-01-01 and go to today to ensure all products are included\n  // This prevents newer products from being excluded due to narrow date windows\n  \n  return {\n    start: start.toISOString().split('T')[0],\n    end: end.toISOString().split('T')[0]\n  };\n};\n\n// Formatting functions\nexport const formatPercentage = (value) => {\n  return `${(value * 100).toFixed(2)}%`;\n};\n\nexport const formatDate = (dateString) => {\n  return new Date(dateString).toLocaleDateString();\n};\n\nexport const formatAppStore = (store) => {\n  const storeMap = {\n    'APP_STORE': 'App Store',\n    'PLAY_STORE': 'Play Store', \n    'STRIPE': 'Stripe'\n  };\n  return storeMap[store] || store;\n};\n\n// Format segment ID to show first4...last4 format\nexport const formatSegmentId = (segmentId) => {\n  if (!segmentId) return 'No ID';\n  if (segmentId.length <= 8) return segmentId;\n  return `${segmentId.slice(0, 4)}...${segmentId.slice(-4)}`;\n};\n\n// Helper function to generate consistent color from UUID\nconst getColorFromUUID = (uuid) => {\n  if (!uuid) return { bg: 'bg-gray-100', text: 'text-gray-800', border: 'border-gray-200', darkBg: 'dark:bg-gray-900', darkText: 'dark:text-gray-200', darkBorder: 'dark:border-gray-700' };\n  \n  // Create a simple hash from the UUID\n  let hash = 0;\n  for (let i = 0; i < uuid.length; i++) {\n    const char = uuid.charCodeAt(i);\n    hash = ((hash << 5) - hash) + char;\n    hash = hash & hash; // Convert to 32-bit integer\n  }\n  \n  // Use the hash to select from a set of colors that work well together\n  const colors = [\n    { bg: 'bg-blue-100', text: 'text-blue-800', border: 'border-blue-200', darkBg: 'dark:bg-blue-900', darkText: 'dark:text-blue-200', darkBorder: 'dark:border-blue-700' },\n    { bg: 'bg-green-100', text: 'text-green-800', border: 'border-green-200', darkBg: 'dark:bg-green-900', darkText: 'dark:text-green-200', darkBorder: 'dark:border-green-700' },\n    { bg: 'bg-purple-100', text: 'text-purple-800', border: 'border-purple-200', darkBg: 'dark:bg-purple-900', darkText: 'dark:text-purple-200', darkBorder: 'dark:border-purple-700' },\n    { bg: 'bg-red-100', text: 'text-red-800', border: 'border-red-200', darkBg: 'dark:bg-red-900', darkText: 'dark:text-red-200', darkBorder: 'dark:border-red-700' },\n    { bg: 'bg-yellow-100', text: 'text-yellow-800', border: 'border-yellow-200', darkBg: 'dark:bg-yellow-900', darkText: 'dark:text-yellow-200', darkBorder: 'dark:border-yellow-700' },\n    { bg: 'bg-indigo-100', text: 'text-indigo-800', border: 'border-indigo-200', darkBg: 'dark:bg-indigo-900', darkText: 'dark:text-indigo-200', darkBorder: 'dark:border-indigo-700' },\n    { bg: 'bg-pink-100', text: 'text-pink-800', border: 'border-pink-200', darkBg: 'dark:bg-pink-900', darkText: 'dark:text-pink-200', darkBorder: 'dark:border-pink-700' },\n    { bg: 'bg-cyan-100', text: 'text-cyan-800', border: 'border-cyan-200', darkBg: 'dark:bg-cyan-900', darkText: 'dark:text-cyan-200', darkBorder: 'dark:border-cyan-700' },\n    { bg: 'bg-emerald-100', text: 'text-emerald-800', border: 'border-emerald-200', darkBg: 'dark:bg-emerald-900', darkText: 'dark:text-emerald-200', darkBorder: 'dark:border-emerald-700' },\n    { bg: 'bg-orange-100', text: 'text-orange-800', border: 'border-orange-200', darkBg: 'dark:bg-orange-900', darkText: 'dark:text-orange-200', darkBorder: 'dark:border-orange-700' }\n  ];\n  \n  const colorIndex = Math.abs(hash) % colors.length;\n  return colors[colorIndex];\n};\n\n// Create segment ID badge component\nexport const getSegmentIdBadge = (segmentId, label = 'Segment ID') => {\n  const colors = getColorFromUUID(segmentId);\n  \n  return (\n    <span className={`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${colors.bg} ${colors.text} ${colors.darkBg} ${colors.darkText} ${colors.border} ${colors.darkBorder} border`}>\n      <span className=\"mr-1\">{label}:</span>\n      <span className=\"font-mono\">{formatSegmentId(segmentId)}</span>\n    </span>\n  );\n};\n\n// Create rollup target ID badge component\nexport const getRollupTargetIdBadge = (targetSegmentId, label = 'Target') => {\n  const colors = getColorFromUUID(targetSegmentId);\n  \n  return (\n    <span className={`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${colors.bg} ${colors.text} ${colors.darkBg} ${colors.darkText} ${colors.border} ${colors.darkBorder} border`}>\n      <span className=\"mr-1\">→ {label}:</span>\n      <span className=\"font-mono\">{formatSegmentId(targetSegmentId)}</span>\n    </span>\n  );\n};\n\n// Load saved state from localStorage\nexport const loadSavedState = () => {\n  try {\n    const savedConfig = localStorage.getItem('conversionProbability_config');\n    const savedExpandedSections = localStorage.getItem('conversionProbability_expandedSections');\n    \n    return {\n      config: savedConfig ? JSON.parse(savedConfig) : {\n        timeframe: 'all',\n        min_cohort_size: 50,\n        force_recalculate: false,\n        min_price_samples: 100\n      },\n      expandedSections: savedExpandedSections ? JSON.parse(savedExpandedSections) : {\n        propertyAnalysis: false,\n        analysisHierarchy: true\n      }\n    };\n  } catch (err) {\n    console.error('Error loading saved state:', err);\n    return {\n      config: {\n        timeframe: 'all',\n        min_cohort_size: 50,\n        force_recalculate: false,\n        min_price_samples: 100\n      },\n      expandedSections: {\n        propertyAnalysis: false,\n        analysisHierarchy: true\n      }\n    };\n  }\n};\n\n// Function to create segment-specific rollup data for individual segments\nexport const createSegmentRollupData = (segment) => {\n  // Check for any signs of rollup having occurred\n  const hasPropertiesDropped = segment.cohort.properties_dropped && segment.cohort.properties_dropped.length > 0;\n  const hasRollupTarget = segment.cohort.rollup_target;\n  const hasRollupReason = segment.cohort.rollup_reason;\n  const hasOriginalSize = segment.cohort.original_cohort_size && segment.cohort.original_cohort_size !== segment.cohort.cohort_size;\n  \n  const hasAnyRollup = hasPropertiesDropped || hasRollupTarget || hasRollupReason || hasOriginalSize;\n  \n  if (!hasAnyRollup) {\n    // Even when no rollup, return a valid structure showing this is a direct segment\n    return {\n      totalSegments: 1,\n      rolledUpSegments: 0,\n      calculatedSegments: 1,\n      rollupTargets: {},\n      segmentDetails: [{\n        segmentId: segment.cohort.segment_id || 'unknown',\n        productId: segment.cohort.product_id,\n        priceBucket: segment.cohort.price_bucket,\n        region: segment.cohort.region,\n        country: segment.cohort.country,\n        appStore: segment.cohort.app_store,\n        originalUsers: segment.cohort.cohort_size,\n        finalUsers: segment.cohort.cohort_size,\n        hasRollup: false,\n        rollupTarget: null,\n        rollupDescription: 'No rollup required - segment had sufficient data',\n        propertiesDropped: []\n      }]\n    };\n  }\n  \n  // Build rollup information\n  const rollupTargetName = segment.cohort.rollup_target || 'Expanded Segment';\n  \n  return {\n    totalSegments: 1, // This represents 1 final segment\n    rolledUpSegments: 1, // This segment had rollup applied\n    calculatedSegments: 0,\n    rollupTargets: {\n      [rollupTargetName]: [{\n        segmentId: segment.cohort.segment_id || 'unknown',\n        productId: segment.cohort.product_id,\n        priceBucket: segment.cohort.price_bucket,\n        region: segment.cohort.region,\n        country: segment.cohort.country,\n        appStore: segment.cohort.app_store,\n        originalUsers: segment.cohort.original_cohort_size || segment.cohort.cohort_size,\n        finalUsers: segment.cohort.cohort_size,\n        propertiesDropped: segment.cohort.properties_dropped || [],\n        rollupReason: segment.cohort.rollup_reason || 'Segment expanded for better statistics',\n        rollupTarget: segment.cohort.rollup_target_segment_id || segment.cohort.rollup_target\n      }]\n    },\n    segmentDetails: [{\n      segmentId: segment.cohort.segment_id || 'unknown',\n      productId: segment.cohort.product_id,\n      priceBucket: segment.cohort.price_bucket,\n      region: segment.cohort.region,\n      country: segment.cohort.country,\n      appStore: segment.cohort.app_store,\n      originalUsers: segment.cohort.original_cohort_size || segment.cohort.cohort_size,\n      finalUsers: segment.cohort.cohort_size,\n      hasRollup: true,\n      rollupTarget: segment.cohort.rollup_target_segment_id || rollupTargetName,\n      rollupDescription: segment.cohort.rollup_reason || 'Segment was expanded to include more data',\n      propertiesDropped: segment.cohort.properties_dropped || []\n    }]\n  };\n};\n\n// Helper function to generate status indicators with hover tooltips\nexport const getStatusIndicator = (passesThreshold, rollupInfo, level = 'segment', rollupTarget = null) => {\n  if (passesThreshold) {\n    return (\n      <span className=\"px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200\">\n        ✅ PASSES\n      </span>\n    );\n  }\n  \n  // FIXED: Show the FINAL rollup target consistently with better fallback handling\n  let finalTarget = rollupTarget;\n  \n  // If no rollup target provided, try to extract from rollup info\n  if (!finalTarget && rollupInfo) {\n    if (rollupInfo.rollupReasons && rollupInfo.rollupReasons.length > 0) {\n      finalTarget = rollupInfo.rollupReasons[0];\n    } else if (rollupInfo.rollupTarget) {\n      finalTarget = rollupInfo.rollupTarget;\n    }\n  }\n  \n  // FIXED: Always provide a fallback if no target is found\n  if (!finalTarget || finalTarget.trim() === '') {\n    return (\n      <span className=\"px-2 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200\">\n        ❌ INSUFFICIENT DATA\n      </span>\n    );\n  }\n  \n  // FIXED: Normalize the final target to show simple, consistent names\n  let displayTarget = finalTarget;\n  \n  // Normalize to simple names\n  if (finalTarget.includes('Country-wide')) {\n    displayTarget = finalTarget; // Keep country-wide as is\n  } else if (finalTarget.includes('Tier 1') || finalTarget.includes('tier1')) {\n    displayTarget = 'Tier 1';\n  } else if (finalTarget.includes('Tier 2') || finalTarget.includes('tier2')) {\n    displayTarget = 'Tier 2';\n  } else if (finalTarget.includes('Tier 3') || finalTarget.includes('tier3')) {\n    displayTarget = 'Tier 3';\n  } else if (finalTarget.includes('Tier 4') || finalTarget.includes('tier4')) {\n    displayTarget = 'Tier 4';\n  } else if (finalTarget.includes('$') && finalTarget.includes('-')) {\n    // Price bucket format like \"$95-$105\"\n    displayTarget = finalTarget;\n  } else {\n    // Default to showing the target as-is, but ensure it's not empty\n    displayTarget = finalTarget || 'Unknown Target';\n  }\n  \n  // Show FINAL rollup target\n  const tooltipContent = rollupInfo ? (\n    <div className=\"text-xs\">\n      <div className=\"font-medium mb-1\">Rollup Details:</div>\n      <div>• Final destination: {finalTarget}</div>\n      {rollupInfo.finalUserCount && (\n        <div>• Final user count: {rollupInfo.finalUserCount.toLocaleString()}</div>\n      )}\n      {rollupInfo.propertiesDropped && rollupInfo.propertiesDropped.length > 0 && (\n        <div>• Properties dropped: {rollupInfo.propertiesDropped.join(', ')}</div>\n      )}\n      {rollupInfo.rollupReasons && rollupInfo.rollupReasons.length > 0 && (\n        <div>• Reason: {rollupInfo.rollupReasons[0]}</div>\n      )}\n    </div>\n  ) : null;\n  \n  return (\n    <div className=\"relative group\">\n      <span className=\"px-2 py-1 rounded-full text-xs font-medium bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-200 cursor-help\">\n        → {displayTarget}\n      </span>\n      \n      {/* Hover tooltip */}\n      {tooltipContent && (\n        <div className=\"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-2 bg-gray-900 dark:bg-gray-100 text-white dark:text-gray-900 text-xs rounded-lg shadow-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none z-10 whitespace-nowrap max-w-xs\">\n          {tooltipContent}\n          <div className=\"absolute top-full left-1/2 transform -translate-x-1/2 border-4 border-transparent border-t-gray-900 dark:border-t-gray-100\"></div>\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport const buildHierarchicalStructure = (segments, minCohortSize) => {\n  // Economic tier mappings (updated to match backend with all 203 countries)\n  const economicTiers = {\n    // Tier 1: High-income developed countries (GDP per capita > $40,000)\n    'tier1_high_income': [\n      // North America & Oceania\n      'US', 'CA', 'AU', 'NZ',\n      // Western Europe\n      'GB', 'IE', 'DE', 'FR', 'NL', 'BE', 'AT', 'CH', 'LU', \n      'DK', 'SE', 'NO', 'FI', 'IS',\n      // Other high-income\n      'IL', 'SG', 'HK', 'QA', 'AE', 'KW', 'BH', 'OM', 'SA',\n      // Small wealthy territories & microstates\n      'MC', 'LI', 'AD', 'MT', 'CY', 'IM', 'JE', 'GG', 'GI', 'BM', 'SM',\n      'KY', 'VI', 'AW', 'TC', 'VG', 'BQ', 'SX', 'MF', 'PM', 'AX', 'CW',\n      // Overseas territories of wealthy countries\n      'MQ', 'GP', 'RE', 'FO', 'GL'\n    ],\n    \n    // Tier 2: Upper-middle income & developed countries ($15,000-$40,000)\n    'tier2_upper_middle': [\n      // East Asia\n      'JP', 'KR', 'TW', 'MO',\n      // Southern & Eastern Europe  \n      'IT', 'ES', 'PT', 'GR', 'SI', 'CZ', 'SK', 'EE', 'LV', 'LT',\n      'HR', 'HU', 'PL', 'RO', 'BG', 'MT',\n      // Latin America (upper-middle)\n      'UY', 'CR', 'PA', 'PR',\n      // Other upper-middle\n      'BN', 'MV', 'SC', 'MU', 'BB', 'BS', 'TT'\n    ],\n    \n    // Tier 3: Emerging economies & lower-middle income ($4,000-$15,000)\n    'tier3_emerging': [\n      // Latin America\n      'BR', 'MX', 'AR', 'CL', 'CO', 'PE', 'EC', 'DO', 'JM', 'PY', 'GT',\n      'SV', 'HN', 'NI', 'BZ', 'VE', 'BO', 'GY', 'SR',\n      // Asia-Pacific\n      'CN', 'TH', 'MY', 'RU', 'TR', 'KZ', 'AZ', 'GE', 'AM', 'BY',\n      'UZ', 'KG', 'TJ', 'MN', 'FJ', 'TO', 'VU', 'PG', 'TL',\n      // Africa (emerging)\n      'ZA', 'NA', 'BW', 'MU', 'SC',\n      // Europe (emerging)\n      'RS', 'ME', 'MK', 'AL', 'BA', 'MD', 'UA', 'XK',\n      // Caribbean\n      'LC', 'GD', 'KN', 'AG', 'DM'\n    ],\n    \n    // Tier 4: Developing countries (GDP per capita < $4,000)\n    'tier4_developing': [\n      // South Asia\n      'IN', 'PK', 'BD', 'LK', 'NP', 'BT', 'AF', 'MV',\n      // Southeast Asia\n      'ID', 'PH', 'VN', 'MM', 'KH', 'LA',\n      // Middle East & North Africa\n      'EG', 'MA', 'TN', 'DZ', 'LY', 'SD', 'LB', 'JO', 'PS', 'SY', 'IQ', 'IR', 'YE',\n      // Sub-Saharan Africa\n      'NG', 'KE', 'GH', 'TZ', 'UG', 'ET', 'RW', 'ZM', 'ZW', 'MW', 'MZ', 'AO',\n      'CM', 'CI', 'SN', 'ML', 'BF', 'NE', 'TD', 'CF', 'CD', 'CG', 'GA', 'GQ',\n      'ST', 'CV', 'GM', 'GW', 'SL', 'LR', 'BJ', 'TG', 'GH', 'BI', 'DJ', 'SO',\n      'ER', 'SS', 'MR', 'MG', 'KM', 'MU', 'SZ', 'LS',\n      // Caribbean & Pacific (developing)\n      'HT', 'CU', 'NC', 'PF', 'AS', 'GU', 'FM', 'MH', 'PW', 'NR', 'TV', 'KI',\n      'SB', 'WS', 'ST', 'CV'\n    ]\n  };\n\n  const getEconomicTier = (country) => {\n    for (const [tier, countries] of Object.entries(economicTiers)) {\n      if (countries.includes(country)) {\n        return `Tier ${tier.split('_')[0].replace('tier', '')}`;\n      }\n    }\n    return 'Tier 4';\n  };\n\n  // Helper function to generate deterministic segment ID based on segment properties\n  const generateSegmentId = (properties) => {\n    // Create a deterministic hash based on the segment properties\n    const propertyString = Object.keys(properties)\n      .sort()\n      .map(key => `${key}:${properties[key] || 'null'}`)\n      .join('|');\n    \n    // Simple hash function for demo - in production you might want a more robust one\n    let hash = 0;\n    for (let i = 0; i < propertyString.length; i++) {\n      const char = propertyString.charCodeAt(i);\n      hash = ((hash << 5) - hash) + char;\n      hash = hash & hash; // Convert to 32-bit integer\n    }\n    \n    // Convert to positive number and create a UUID-like string\n    const positiveHash = Math.abs(hash);\n    const segmentId = positiveHash.toString(16).padStart(8, '0');\n    return `${segmentId.slice(0, 4)}-${segmentId.slice(4, 8)}-seg-${Date.now().toString().slice(-4)}`;\n  };\n\n  const hierarchy = {};\n\n  // Group by Product + Store + Price (Level 1)\n  segments.forEach(segment => {\n    const productId = segment.product_id;\n    const appStore = segment.app_store || 'Unknown Store';\n    const priceRange = segment.price_bucket;\n    const country = segment.country || 'Unknown';\n    const region = segment.region;\n    const users = segment.user_count;\n    \n    // Use the backend's rollup information directly\n    const hasSufficientData = segment.has_sufficient_data;\n    const propertiesDropped = segment.properties_dropped || [];\n    const rollupDescription = segment.rollup_description || '';\n    const rollupTarget = segment.rollup_target || null; // FINAL rollup target from backend\n    const finalUserCount = segment.final_user_count || users;\n    const accuracyScore = segment.accuracy_score || 'very_high';\n    \n    // Get segment ID from backend or generate one\n    const originalSegmentId = segment.segment_id || generateSegmentId({\n      product_id: productId,\n      app_store: appStore,\n      price_bucket: priceRange,\n      country: country,\n      region: region\n    });\n    \n    const economicTier = getEconomicTier(country);\n\n    // Initialize Product+Store+Price level (Level 1)\n    const level1Key = `${productId}|${appStore}|${priceRange}`;\n    if (!hierarchy[level1Key]) {\n      // Generate segment ID for Level 1 (Product+Store+Price)\n      const level1SegmentId = generateSegmentId({\n        product_id: productId,\n        app_store: appStore,\n        price_bucket: priceRange\n      });\n      \n      hierarchy[level1Key] = {\n        productId: productId,\n        appStore: appStore,\n        priceRange: priceRange,\n        segmentId: level1SegmentId,\n        totalUsers: 0,\n        passesThreshold: false,\n        rollupInfo: {\n          hasRollups: false,\n          rolledUpSegments: 0,\n          totalSegments: 0,\n          rollupReasons: new Set(),\n          propertiesDropped: new Set(),\n          finalUserCount: 0,\n          rollupTarget: null,\n          rollupTargetSegmentId: null\n        },\n        economicTiers: {}\n      };\n    }\n    hierarchy[level1Key].totalUsers += users;\n    hierarchy[level1Key].rollupInfo.totalSegments += 1;\n    hierarchy[level1Key].rollupInfo.finalUserCount += finalUserCount;\n    \n    if (!hasSufficientData || propertiesDropped.length > 0) {\n      hierarchy[level1Key].rollupInfo.hasRollups = true;\n      hierarchy[level1Key].rollupInfo.rolledUpSegments += 1;\n      if (rollupDescription) hierarchy[level1Key].rollupInfo.rollupReasons.add(rollupDescription);\n      if (rollupTarget) hierarchy[level1Key].rollupInfo.rollupTarget = rollupTarget;\n      propertiesDropped.forEach(prop => hierarchy[level1Key].rollupInfo.propertiesDropped.add(prop));\n    }\n\n    // Initialize economic tier level (Level 2)\n    const level2Key = `${level1Key}|${economicTier}`;\n    if (!hierarchy[level1Key].economicTiers[economicTier]) {\n      // Generate segment ID for Level 2 (Product+Store+Price+EconomicTier)\n      const level2SegmentId = generateSegmentId({\n        product_id: productId,\n        app_store: appStore,\n        price_bucket: priceRange,\n        economic_tier: economicTier\n      });\n      \n      hierarchy[level1Key].economicTiers[economicTier] = {\n        tierName: economicTier,\n        segmentId: level2SegmentId,\n        totalUsers: 0,\n        passesThreshold: false,\n        rollupInfo: {\n          hasRollups: false,\n          rolledUpSegments: 0,\n          totalSegments: 0,\n          rollupReasons: new Set(),\n          propertiesDropped: new Set(),\n          finalUserCount: 0,\n          rollupTarget: null,\n          rollupTargetSegmentId: null\n        },\n        countries: {}\n      };\n    }\n    hierarchy[level1Key].economicTiers[economicTier].totalUsers += users;\n    hierarchy[level1Key].economicTiers[economicTier].rollupInfo.totalSegments += 1;\n    hierarchy[level1Key].economicTiers[economicTier].rollupInfo.finalUserCount += finalUserCount;\n    \n    if (!hasSufficientData || propertiesDropped.length > 0) {\n      hierarchy[level1Key].economicTiers[economicTier].rollupInfo.hasRollups = true;\n      hierarchy[level1Key].economicTiers[economicTier].rollupInfo.rolledUpSegments += 1;\n      if (rollupDescription) hierarchy[level1Key].economicTiers[economicTier].rollupInfo.rollupReasons.add(rollupDescription);\n      if (rollupTarget) hierarchy[level1Key].economicTiers[economicTier].rollupInfo.rollupTarget = rollupTarget;\n      propertiesDropped.forEach(prop => hierarchy[level1Key].economicTiers[economicTier].rollupInfo.propertiesDropped.add(prop));\n    }\n\n    // Initialize country level (Level 3)\n    if (!hierarchy[level1Key].economicTiers[economicTier].countries[country]) {\n      // Generate segment ID for Level 3 (Product+Store+Price+EconomicTier+Country)\n      const level3SegmentId = generateSegmentId({\n        product_id: productId,\n        app_store: appStore,\n        price_bucket: priceRange,\n        economic_tier: economicTier,\n        country: country\n      });\n      \n      hierarchy[level1Key].economicTiers[economicTier].countries[country] = {\n        countryName: country,\n        segmentId: level3SegmentId,\n        totalUsers: 0,\n        passesThreshold: false,\n        rollupInfo: {\n          hasRollups: false,\n          rolledUpSegments: 0,\n          totalSegments: 0,\n          rollupReasons: new Set(),\n          propertiesDropped: new Set(),\n          finalUserCount: 0,\n          rollupTarget: null,\n          rollupTargetSegmentId: null\n        },\n        regions: []\n      };\n    }\n    hierarchy[level1Key].economicTiers[economicTier].countries[country].totalUsers += users;\n    hierarchy[level1Key].economicTiers[economicTier].countries[country].rollupInfo.totalSegments += 1;\n    hierarchy[level1Key].economicTiers[economicTier].countries[country].rollupInfo.finalUserCount += finalUserCount;\n    \n    if (!hasSufficientData || propertiesDropped.length > 0) {\n      hierarchy[level1Key].economicTiers[economicTier].countries[country].rollupInfo.hasRollups = true;\n      hierarchy[level1Key].economicTiers[economicTier].countries[country].rollupInfo.rolledUpSegments += 1;\n      if (rollupDescription) hierarchy[level1Key].economicTiers[economicTier].countries[country].rollupInfo.rollupReasons.add(rollupDescription);\n      if (rollupTarget) hierarchy[level1Key].economicTiers[economicTier].countries[country].rollupInfo.rollupTarget = rollupTarget;\n      propertiesDropped.forEach(prop => hierarchy[level1Key].economicTiers[economicTier].countries[country].rollupInfo.propertiesDropped.add(prop));\n    }\n\n    // Add region if it exists (Level 4)\n    if (region) {\n      // Use original segment ID from backend or generate Level 4 segment ID\n      const level4SegmentId = originalSegmentId;\n      \n      // Determine rollup target segment ID based on rollup logic\n      let rollupTargetSegmentId = null;\n      if (!hasSufficientData || propertiesDropped.length > 0) {\n        // If this segment rolls up, determine which level it rolls up to\n        if (rollupTarget && rollupTarget.includes('Country-wide')) {\n          // Rolls up to country level (Level 3)\n          rollupTargetSegmentId = hierarchy[level1Key].economicTiers[economicTier].countries[country].segmentId;\n        } else if (rollupTarget && (rollupTarget.includes('Tier') || rollupTarget.includes('tier'))) {\n          // Rolls up to economic tier level (Level 2)\n          rollupTargetSegmentId = hierarchy[level1Key].economicTiers[economicTier].segmentId;\n        } else {\n          // Rolls up to product+store+price level (Level 1)\n          rollupTargetSegmentId = hierarchy[level1Key].segmentId;\n        }\n      }\n      \n      hierarchy[level1Key].economicTiers[economicTier].countries[country].regions.push({\n        name: region,\n        segmentId: level4SegmentId,\n        rollupTargetSegmentId: rollupTargetSegmentId,\n        users: users,\n        passes: hasSufficientData && propertiesDropped.length === 0,\n        rollupTarget: rollupTarget,\n        rollupReason: rollupDescription,\n        accuracyScore: accuracyScore,\n        finalUserCount: finalUserCount,\n        originalUserCount: users,\n        propertiesDropped: propertiesDropped\n      });\n    }\n  });\n\n  // Calculate pass/fail status and assign rollup target segment IDs for each level\n  Object.keys(hierarchy).forEach(level1Key => {\n    const level1Data = hierarchy[level1Key];\n    level1Data.passesThreshold = level1Data.totalUsers >= minCohortSize;\n    \n    // Convert Sets to Arrays for easier use in UI\n    level1Data.rollupInfo.rollupReasons = Array.from(level1Data.rollupInfo.rollupReasons);\n    level1Data.rollupInfo.propertiesDropped = Array.from(level1Data.rollupInfo.propertiesDropped);\n    \n    // If Level 1 doesn't pass, it can't roll up anywhere (it's the ceiling)\n    if (!level1Data.passesThreshold) {\n      level1Data.rollupInfo.rollupTargetSegmentId = null; // Cannot roll up beyond this level\n    }\n\n    Object.keys(level1Data.economicTiers).forEach(tierName => {\n      const tierData = level1Data.economicTiers[tierName];\n      tierData.passesThreshold = tierData.totalUsers >= minCohortSize;\n      \n      // Convert Sets to Arrays for easier use in UI\n      tierData.rollupInfo.rollupReasons = Array.from(tierData.rollupInfo.rollupReasons);\n      tierData.rollupInfo.propertiesDropped = Array.from(tierData.rollupInfo.propertiesDropped);\n      \n      // If tier doesn't pass, it rolls up to Level 1 (Product+Store+Price)\n      if (!tierData.passesThreshold) {\n        tierData.rollupInfo.rollupTargetSegmentId = level1Data.segmentId;\n      }\n\n      Object.keys(tierData.countries).forEach(country => {\n        const countryData = tierData.countries[country];\n        countryData.passesThreshold = countryData.totalUsers >= minCohortSize;\n        \n        // Convert Sets to Arrays for easier use in UI\n        countryData.rollupInfo.rollupReasons = Array.from(countryData.rollupInfo.rollupReasons);\n        countryData.rollupInfo.propertiesDropped = Array.from(countryData.rollupInfo.propertiesDropped);\n        \n        // If country doesn't pass, it rolls up to Level 2 (Economic Tier)\n        if (!countryData.passesThreshold) {\n          countryData.rollupInfo.rollupTargetSegmentId = tierData.segmentId;\n        }\n      });\n    });\n  });\n\n  return hierarchy;\n}; "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}