{"ast":null,"code":"import React,{useState,useMemo}from'react';import{TrendingUp,Users,DollarSign,Clock,Activity,AlertCircle,Database,Calculator,Target,User,Globe,Package}from'lucide-react';import EventTimelineTableV3 from'./EventTimelineTableV3';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const Stage3RevenueResultsV3=_ref=>{var _data$stage_results,_data$data,_data$data$stage_resu,_stage3Data,_userTimelines$select3,_userTimelines$select4,_userTimelines$select5,_userTimelines$select6,_userTimelines$select7;let{data}=_ref;const[selectedUser,setSelectedUser]=useState('');// Empty string means aggregate view\nconst[userSearchTerm,setUserSearchTerm]=useState('');const[selectedProductId,setSelectedProductId]=useState('');// NEW: Product selector state\n// Handle multiple API response formats for data access\nlet stage3Data=null;if(data!==null&&data!==void 0&&(_data$stage_results=data.stage_results)!==null&&_data$stage_results!==void 0&&_data$stage_results.stage3){// Direct format: pipelineData.stage_results.stage3\nstage3Data=data.stage_results.stage3;}else if(data!==null&&data!==void 0&&(_data$data=data.data)!==null&&_data$data!==void 0&&(_data$data$stage_resu=_data$data.stage_results)!==null&&_data$data$stage_resu!==void 0&&_data$data$stage_resu.stage3){// Nested format: pipelineData.data.stage_results.stage3\nstage3Data=data.data.stage_results.stage3;}const timelineResults=((_stage3Data=stage3Data)===null||_stage3Data===void 0?void 0:_stage3Data.timeline_results)||{};const aggregateStats=timelineResults.aggregate_stats||{};const userTimelines=timelineResults.user_timelines||{};// NEW: Backend now provides EventTimelineTable format data directly\nconst backendTimelineData=timelineResults.timeline_data||{};const backendUserDailyMetrics=timelineResults.user_daily_metrics||{};const backendUserTimelinesEvents=timelineResults.user_timelines_events||{};// 🔍 FRONTEND TIMELINE DEBUG: Log the data received from backend\nif(Object.keys(timelineResults).length>0){console.log('🔍 [FRONTEND TIMELINE DEBUG] Data received from backend:');console.log('🔍   - timeline_data dates:',backendTimelineData?Object.keys(backendTimelineData).length:0);console.log('🔍   - user_daily_metrics users:',backendUserDailyMetrics?Object.keys(backendUserDailyMetrics).length:0);console.log('🔍   - user_timelines_events users:',backendUserTimelinesEvents?Object.keys(backendUserTimelinesEvents).length:0);// ***** SEND THIS TO AI - DEBUG LOG #1 *****\nconsole.log('***** SEND THIS TO AI - DEBUG LOG #1 *****');console.log('ISSUE 2 DEBUG - Specific User Daily Metrics Check:');const debugUserId='$device:07BDA330-D882-45B2-946E-A2E81B011718';console.log('Target User ID:',debugUserId);console.log('User found in backendUserDailyMetrics:',debugUserId in backendUserDailyMetrics);if(backendUserDailyMetrics[debugUserId]){const userData=backendUserDailyMetrics[debugUserId];console.log('Available dates for user:',Object.keys(userData));const may27Data=userData['2025-05-27'];console.log('May 27th data exists:',may27Data?'YES':'NO');if(may27Data){console.log('May 27th COMPLETE data:',may27Data);console.log('trial_started:',may27Data.trial_started);console.log('trial_ended:',may27Data.trial_ended,'← Should be 1');console.log('trial_cancelled:',may27Data.trial_cancelled,'← Should be 1');console.log('trial_converted:',may27Data.trial_converted);console.log('trial_pending:',may27Data.trial_pending);}}else{console.log('User NOT FOUND in backendUserDailyMetrics!');console.log('Available users (first 5):',Object.keys(backendUserDailyMetrics).slice(0,5));}console.log('***** END DEBUG LOG #1 *****');// ***** SEND THIS TO AI - DEBUG LOG #2 *****\nconsole.log('***** SEND THIS TO AI - DEBUG LOG #2 *****');console.log('ISSUE 1 DEBUG - Product Selector Data Check:');console.log('User found in backendUserTimelinesEvents:',debugUserId in backendUserTimelinesEvents);if(backendUserTimelinesEvents[debugUserId]){const userData=backendUserTimelinesEvents[debugUserId];console.log('User timeline events structure keys:',Object.keys(userData));console.log('Has summary:','summary'in userData);if(userData.summary){console.log('Summary keys:',Object.keys(userData.summary));console.log('Has product_summaries:','product_summaries'in userData.summary);if(userData.summary.product_summaries){console.log('Product summaries keys:',Object.keys(userData.summary.product_summaries));console.log('Number of products:',Object.keys(userData.summary.product_summaries).length);console.log('COMPLETE product_summaries data:',userData.summary.product_summaries);}else{console.log('ERROR: product_summaries is missing from summary!');}}else{console.log('ERROR: summary is missing from user timeline events!');}}else{console.log('User NOT FOUND in backendUserTimelinesEvents!');console.log('Available users in backendUserTimelinesEvents (first 5):',Object.keys(backendUserTimelinesEvents).slice(0,5));}console.log('***** END DEBUG LOG #2 *****');// ***** SEND THIS TO AI - DEBUG LOG #3 *****\nconsole.log('***** SEND THIS TO AI - DEBUG LOG #3 *****');console.log('GENERAL DATA STRUCTURE CHECK:');console.log('backendTimelineData exists:',!!backendTimelineData);console.log('backendUserDailyMetrics exists:',!!backendUserDailyMetrics);console.log('backendUserTimelinesEvents exists:',!!backendUserTimelinesEvents);console.log('Number of users in backendUserDailyMetrics:',Object.keys(backendUserDailyMetrics).length);console.log('Number of users in backendUserTimelinesEvents:',Object.keys(backendUserTimelinesEvents).length);if(Object.keys(backendUserDailyMetrics).length>0){const firstUser=Object.keys(backendUserDailyMetrics)[0];const firstUserData=backendUserDailyMetrics[firstUser];const firstDate=Object.keys(firstUserData)[0];console.log('Sample user daily metrics structure:',{userId:firstUser,date:firstDate,metrics:firstUserData[firstDate]});}console.log('***** END DEBUG LOG #3 *****');if(backendTimelineData&&Object.keys(backendTimelineData).length>0){const sampleDate=Object.keys(backendTimelineData)[0];const sampleData=backendTimelineData[sampleDate];console.log(\"\\uD83D\\uDD0D   - Sample timeline_data[\".concat(sampleDate,\"]:\"));console.log('🔍     - trial_started:',sampleData.trial_started||0);console.log('🔍     - trial_converted:',sampleData.trial_converted||0);console.log('🔍     - revenue:',sampleData.revenue||0);console.log('🔍     - estimated_revenue:',sampleData.estimated_revenue||0);}if(backendUserDailyMetrics&&Object.keys(backendUserDailyMetrics).length>0){const sampleUser=Object.keys(backendUserDailyMetrics)[0];const sampleUserData=backendUserDailyMetrics[sampleUser];console.log(\"\\uD83D\\uDD0D   - Sample user_daily_metrics[\".concat(sampleUser,\"]:\"));console.log('🔍     - Dates available:',Object.keys(sampleUserData).length);if(Object.keys(sampleUserData).length>0){const sampleDate=Object.keys(sampleUserData)[0];const sampleDayData=sampleUserData[sampleDate];console.log(\"\\uD83D\\uDD0D     - Sample date[\".concat(sampleDate,\"]:\"));console.log('🔍       - trial_started:',sampleDayData.trial_started||0);console.log('🔍       - trial_converted:',sampleDayData.trial_converted||0);console.log('🔍       - revenue:',sampleDayData.revenue||0);console.log('🔍       - estimated_revenue:',sampleDayData.estimated_revenue||0);}}if(backendUserTimelinesEvents&&Object.keys(backendUserTimelinesEvents).length>0){const sampleEventsUser=Object.keys(backendUserTimelinesEvents)[0];const sampleEventsData=backendUserTimelinesEvents[sampleEventsUser];console.log(\"\\uD83D\\uDD0D   - Sample user_timelines_events[\".concat(sampleEventsUser,\"]:\"));console.log('🔍     - Structure keys:',Object.keys(sampleEventsData));console.log('🔍     - Events count:',sampleEventsData.events?sampleEventsData.events.length:0);console.log('🔍     - Products count:',sampleEventsData.products?Object.keys(sampleEventsData.products).length:0);if(sampleEventsData.summary){console.log('🔍     - Summary total_estimated_revenue:',sampleEventsData.summary.total_estimated_revenue||0);console.log('🔍     - Summary total_actual_revenue:',sampleEventsData.summary.total_actual_revenue||0);}}}// NEW: Detect users with multiple products\nconst usersWithMultipleProducts=useMemo(()=>{const multiProductUsers={};Object.entries(backendUserTimelinesEvents).forEach(_ref2=>{let[userId,userData]=_ref2;if(userData.summary&&userData.summary.product_summaries){const productIds=Object.keys(userData.summary.product_summaries);if(productIds.length>1){multiProductUsers[userId]=productIds;}}});return multiProductUsers;},[backendUserTimelinesEvents]);// NEW: Get available products for selected user\nconst availableProductsForUser=useMemo(()=>{if(!selectedUser||!backendUserTimelinesEvents[selectedUser]){return[];}const userData=backendUserTimelinesEvents[selectedUser];if(userData.summary&&userData.summary.product_summaries){return Object.keys(userData.summary.product_summaries);}return[];},[selectedUser,backendUserTimelinesEvents]);// NEW: Check if current user has multiple products\nconst selectedUserHasMultipleProducts=availableProductsForUser.length>1;// Process user list for dropdown with search filtering\nconst userList=useMemo(()=>{// FIXED: Use user_timelines_events for user list, which has consolidated user data\nconst usersSource=backendUserTimelinesEvents&&Object.keys(backendUserTimelinesEvents).length>0?backendUserTimelinesEvents:userTimelines;const users=Object.entries(usersSource).map(_ref3=>{let[userId,timelineData]=_ref3;// Handle both old and new data formats\nlet outcomeType='pending';let estimatedRevenue=0;let actualRevenue=0;if(timelineData.summary){// New consolidated format from backend fix\noutcomeType=timelineData.summary.outcome_type||'pending';estimatedRevenue=timelineData.summary.total_estimated_revenue||0;actualRevenue=timelineData.summary.total_actual_revenue||0;}else if(timelineData.outcome_type!==undefined){// Original format (user#product composite keys)\noutcomeType=timelineData.outcome_type||'pending';estimatedRevenue=timelineData.total_estimated_revenue||0;actualRevenue=timelineData.total_actual_revenue||0;}// NEW: Add indicator for multi-product users\nconst hasMultipleProducts=usersWithMultipleProducts[userId]?true:false;const productIndicator=hasMultipleProducts?' 📦':'';return{userId,timeline:timelineData,displayName:\"\".concat(userId.substring(0,8),\"... (\").concat(outcomeType,\")\").concat(productIndicator),fullId:userId,outcomeType,estimatedRevenue,actualRevenue,hasMultipleProducts};});// Filter based on search term\nif(userSearchTerm){return users.filter(user=>user.userId.toLowerCase().includes(userSearchTerm.toLowerCase())||user.outcomeType.toLowerCase().includes(userSearchTerm.toLowerCase()));}return users;},[userTimelines,backendUserTimelinesEvents,userSearchTerm,usersWithMultipleProducts]);if(!stage3Data){return/*#__PURE__*/_jsx(\"div\",{className:\"text-center py-8\",children:/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-500 dark:text-gray-400\",children:\"No Stage 3 data available. Run analysis to see revenue timeline results.\"})});}// Helper function to format numbers\nconst formatNumber=num=>{if(typeof num!=='number')return'0';return num.toLocaleString();};// Helper function to format currency\nconst formatCurrency=num=>{if(typeof num!=='number')return'$0';return'$'+num.toLocaleString(undefined,{minimumFractionDigits:2,maximumFractionDigits:2});};// Helper function to format percentages\nconst formatPercentage=(num,total)=>{if(!total||typeof num!=='number')return'0.0%';return(num/total*100).toFixed(1)+'%';};// Get the appropriate data for EventTimelineTable - backend provides it directly now\nconst getTimelineTableData=()=>{if(selectedUser&&backendUserDailyMetrics[selectedUser]){var _userTimelines$select,_userTimelines$select2;// Individual user view - create data structure for single user\nconst userDates=Object.keys(backendUserDailyMetrics[selectedUser]).sort();const userDailyData={};const userCumulativeData={};// Build daily metrics for selected user only\nuserDates.forEach(date=>{userDailyData[date]=backendUserDailyMetrics[selectedUser][date];});// Calculate cumulative metrics for individual user\nlet cumulativeCounters={trial_started:0,trial_ended:0,trial_converted:0,trial_cancelled:0,initial_purchase:0,subscription_cancelled:0,revenue:0,refund:0,refund_count:0,estimated_revenue:0};userDates.forEach(date=>{const dayData=userDailyData[date];// Update cumulative counters\nObject.keys(cumulativeCounters).forEach(key=>{if(key==='trial_pending'||key==='subscription_active'){// State-based metrics use current value, not cumulative\nuserCumulativeData[date]=userCumulativeData[date]||{};userCumulativeData[date][\"cumulative_\".concat(key)]=dayData[key]||0;}else{cumulativeCounters[key]+=dayData[key]||0;userCumulativeData[date]=userCumulativeData[date]||{};userCumulativeData[date][\"cumulative_\".concat(key)]=cumulativeCounters[key];}});// Add net revenue\nuserCumulativeData[date]['cumulative_revenue_net']=cumulativeCounters['revenue']-cumulativeCounters['refund'];});const individualResult={data:{dates:userDates,daily_metrics:userDailyData,cumulative_metrics:userCumulativeData,user_timelines:backendUserTimelinesEvents,user_daily_metrics:{[selectedUser]:backendUserDailyMetrics[selectedUser]},summary_stats:{total_users:1,total_estimated_revenue:((_userTimelines$select=userTimelines[selectedUser])===null||_userTimelines$select===void 0?void 0:_userTimelines$select.total_estimated_revenue)||0,total_actual_revenue:((_userTimelines$select2=userTimelines[selectedUser])===null||_userTimelines$select2===void 0?void 0:_userTimelines$select2.total_actual_revenue)||0}}};return individualResult;}// Aggregate view - calculate cumulative metrics from daily metrics\nconst aggregateDates=Object.keys(backendTimelineData).sort();const aggregateCumulativeMetrics={};// Initialize cumulative counters for aggregate view\nlet cumulativeCounters={trial_started:0,trial_ended:0,trial_converted:0,trial_cancelled:0,initial_purchase:0,subscription_cancelled:0,revenue:0,refund:0,refund_count:0};// Calculate cumulative metrics for each date\naggregateDates.forEach(date=>{const dayData=backendTimelineData[date]||{};// Update cumulative counters (for event-based metrics)\nObject.keys(cumulativeCounters).forEach(key=>{if(key in dayData&&typeof dayData[key]==='number'){cumulativeCounters[key]+=dayData[key];}});// Store cumulative data for this date\naggregateCumulativeMetrics[date]={// State-based metrics use current daily value (not cumulative)\ntrial_pending:dayData.trial_pending||0,subscription_active:dayData.subscription_active||0,estimated_revenue:dayData.estimated_revenue||0,// Event-based metrics use cumulative values\ncumulative_trial_started:cumulativeCounters.trial_started,cumulative_trial_ended:cumulativeCounters.trial_ended,cumulative_trial_converted:cumulativeCounters.trial_converted,cumulative_trial_cancelled:cumulativeCounters.trial_cancelled,cumulative_initial_purchase:cumulativeCounters.initial_purchase,cumulative_subscription_cancelled:cumulativeCounters.subscription_cancelled,cumulative_revenue:cumulativeCounters.revenue,cumulative_refund:cumulativeCounters.refund,cumulative_refund_count:cumulativeCounters.refund_count,cumulative_revenue_net:cumulativeCounters.revenue-cumulativeCounters.refund};});const aggregateResult={data:{dates:aggregateDates,daily_metrics:backendTimelineData,cumulative_metrics:aggregateCumulativeMetrics,user_timelines:backendUserTimelinesEvents,user_daily_metrics:backendUserDailyMetrics,summary_stats:aggregateStats}};return aggregateResult;};return/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-2 mb-6\",children:[/*#__PURE__*/_jsx(TrendingUp,{size:24,className:\"text-purple-600 dark:text-purple-400\"}),/*#__PURE__*/_jsx(\"h2\",{className:\"text-2xl font-bold text-gray-900 dark:text-white\",children:\"Stage 3: Revenue Timeline Generation Results\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"ml-auto flex items-center gap-1 text-purple-600 dark:text-purple-400 text-sm\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"\\u2713\"}),/*#__PURE__*/_jsx(\"span\",{children:\"Revenue Estimation & Timeline Projection\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mb-6 p-4 bg-gradient-to-r from-blue-50 to-purple-50 dark:from-blue-900/20 dark:to-purple-900/20 rounded-lg border border-blue-200 dark:border-blue-800\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-2 mb-3\",children:[/*#__PURE__*/_jsx(User,{size:20,className:\"text-blue-600 dark:text-blue-400\"}),/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg font-semibold text-gray-900 dark:text-white\",children:\"View Selection\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-2 gap-4\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\",children:\"Select User (or leave empty for aggregate)\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-2\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"Search by User ID or outcome...\",value:userSearchTerm,onChange:e=>setUserSearchTerm(e.target.value),className:\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white text-sm\"}),/*#__PURE__*/_jsxs(\"select\",{value:selectedUser,onChange:e=>{setSelectedUser(e.target.value);setSelectedProductId('');// Reset product selection when user changes\n},className:\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white text-sm\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"\\uD83C\\uDF0D Aggregate View (All Users)\"}),userList.map(user=>/*#__PURE__*/_jsxs(\"option\",{value:user.userId,children:[\"\\uD83D\\uDC64 \",user.displayName,\" - Est: \",formatCurrency(user.estimatedRevenue)]},user.userId))]})]}),selectedUser&&selectedUserHasMultipleProducts&&/*#__PURE__*/_jsxs(\"div\",{className:\"mt-3 p-3 bg-yellow-50 dark:bg-yellow-900/20 rounded-lg border border-yellow-200 dark:border-yellow-800\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-2 mb-2\",children:[/*#__PURE__*/_jsx(Package,{size:16,className:\"text-yellow-600 dark:text-yellow-400\"}),/*#__PURE__*/_jsx(\"span\",{className:\"text-sm font-medium text-yellow-800 dark:text-yellow-200\",children:\"Multiple Products Detected\"})]}),/*#__PURE__*/_jsxs(\"select\",{value:selectedProductId,onChange:e=>setSelectedProductId(e.target.value),className:\"w-full px-3 py-2 border border-yellow-300 dark:border-yellow-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white text-sm\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"\\uD83D\\uDCCA All Products (Combined)\"}),availableProductsForUser.map(productId=>/*#__PURE__*/_jsxs(\"option\",{value:productId,children:[\"\\uD83D\\uDCE6 \",productId]},productId))]}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-xs text-yellow-700 dark:text-yellow-300 mt-1\",children:[\"This user has trials for \",availableProductsForUser.length,\" different products. Select a specific product or view combined data.\"]})]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\",children:\"Current View\"}),/*#__PURE__*/_jsx(\"div\",{className:\"p-3 bg-white dark:bg-gray-800 rounded-md border border-gray-200 dark:border-gray-700\",children:selectedUser?/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-2 mb-1\",children:[/*#__PURE__*/_jsx(User,{size:16,className:\"text-blue-600 dark:text-blue-400\"}),/*#__PURE__*/_jsx(\"span\",{className:\"font-medium text-gray-900 dark:text-white\",children:\"Individual User\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-sm text-gray-600 dark:text-gray-400 break-all\",children:[\"ID: \",selectedUser]}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-sm text-gray-600 dark:text-gray-400\",children:[\"Status: \",((_userTimelines$select3=userTimelines[selectedUser])===null||_userTimelines$select3===void 0?void 0:_userTimelines$select3.outcome_type)||'pending']}),selectedUserHasMultipleProducts&&/*#__PURE__*/_jsxs(\"div\",{className:\"text-sm text-orange-600 dark:text-orange-400\",children:[\"Products: \",availableProductsForUser.length,\" (\",selectedProductId||'All',\")\"]})]}):/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-2 mb-1\",children:[/*#__PURE__*/_jsx(Globe,{size:16,className:\"text-green-600 dark:text-green-400\"}),/*#__PURE__*/_jsx(\"span\",{className:\"font-medium text-gray-900 dark:text-white\",children:\"Aggregate View\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-sm text-gray-600 dark:text-gray-400\",children:[\"Showing data for all \",Object.keys(userTimelines).length,\" users\"]}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-sm text-blue-600 dark:text-blue-400\",children:[\"Multi-product users: \",Object.keys(usersWithMultipleProducts).length]})]})})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"p-4 bg-purple-50 dark:bg-purple-900/20 rounded-lg border border-purple-200 dark:border-purple-800\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-2 mb-2\",children:[/*#__PURE__*/_jsx(Users,{size:20,className:\"text-purple-600 dark:text-purple-400\"}),/*#__PURE__*/_jsx(\"h3\",{className:\"font-semibold text-purple-900 dark:text-purple-200\",children:\"Users with Timelines\"})]}),/*#__PURE__*/_jsx(\"p\",{className:\"text-2xl font-bold text-purple-600 dark:text-purple-300\",children:selectedUser?'1':formatNumber(stage3Data.users_with_timelines||0)}),/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-purple-700 dark:text-purple-400\",children:selectedUser?'Individual view':'Revenue projections generated'})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"p-4 bg-green-50 dark:bg-green-900/20 rounded-lg border border-green-200 dark:border-green-800\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-2 mb-2\",children:[/*#__PURE__*/_jsx(DollarSign,{size:20,className:\"text-green-600 dark:text-green-400\"}),/*#__PURE__*/_jsx(\"h3\",{className:\"font-semibold text-green-900 dark:text-green-200\",children:\"Estimated Revenue\"})]}),/*#__PURE__*/_jsx(\"p\",{className:\"text-2xl font-bold text-green-600 dark:text-green-300\",children:selectedUser?formatCurrency(((_userTimelines$select4=userTimelines[selectedUser])===null||_userTimelines$select4===void 0?void 0:_userTimelines$select4.total_estimated_revenue)||0):formatCurrency(aggregateStats.total_estimated_revenue||0)}),/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-green-700 dark:text-green-400\",children:\"Based on conversion probabilities\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-800\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-2 mb-2\",children:[/*#__PURE__*/_jsx(Activity,{size:20,className:\"text-blue-600 dark:text-blue-400\"}),/*#__PURE__*/_jsx(\"h3\",{className:\"font-semibold text-blue-900 dark:text-blue-200\",children:\"Actual Revenue\"})]}),/*#__PURE__*/_jsx(\"p\",{className:\"text-2xl font-bold text-blue-600 dark:text-blue-300\",children:selectedUser?formatCurrency(((_userTimelines$select5=userTimelines[selectedUser])===null||_userTimelines$select5===void 0?void 0:_userTimelines$select5.total_actual_revenue)||0):formatCurrency(aggregateStats.total_actual_revenue||0)}),/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-blue-700 dark:text-blue-400\",children:\"From confirmed outcomes\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"p-4 bg-orange-50 dark:bg-orange-900/20 rounded-lg border border-orange-200 dark:border-orange-800\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-2 mb-2\",children:[/*#__PURE__*/_jsx(Clock,{size:20,className:\"text-orange-600 dark:text-orange-400\"}),/*#__PURE__*/_jsx(\"h3\",{className:\"font-semibold text-orange-900 dark:text-orange-200\",children:\"Timeline End\"})]}),/*#__PURE__*/_jsx(\"p\",{className:\"text-lg font-bold text-orange-600 dark:text-orange-300\",children:stage3Data.timeline_end_date||'N/A'}),/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-orange-700 dark:text-orange-400\",children:\"Projection end date\"})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"mb-6\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"p-4 bg-gradient-to-r from-green-50 to-blue-50 dark:from-green-900/20 dark:to-blue-900/20 rounded-lg border border-green-200 dark:border-green-800\",children:[/*#__PURE__*/_jsxs(\"h3\",{className:\"text-lg font-semibold text-gray-900 dark:text-white mb-3 flex items-center gap-2\",children:[/*#__PURE__*/_jsx(Calculator,{size:20,className:\"text-green-600 dark:text-green-400\"}),\"Revenue Calculation Using Event State Tracker\"]}),/*#__PURE__*/_jsx(\"div\",{className:\"bg-white dark:bg-gray-800 rounded-lg p-4 font-mono text-sm mb-4\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-3\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"text-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-lg font-bold text-gray-900 dark:text-white mb-2\",children:\"\\uD83D\\uDD35 Pre-Outcome (Trial Pending)\"}),/*#__PURE__*/_jsx(\"div\",{className:\"text-base text-blue-600 dark:text-blue-400\",children:\"estimated_revenue = conversion_probability \\xD7 (1 - refund_rate) \\xD7 price\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-lg font-bold text-gray-900 dark:text-white mb-2\",children:\"\\uD83D\\uDFE2 Post-Conversion (Subscription Active)\"}),/*#__PURE__*/_jsx(\"div\",{className:\"text-base text-green-600 dark:text-green-400\",children:\"revenue = price \\xD7 (1 - current_refund_rate)\"}),/*#__PURE__*/_jsx(\"div\",{className:\"text-xs text-gray-500 dark:text-gray-400\",children:\"current_refund_rate degrades linearly to 0% over 30 days\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-lg font-bold text-gray-900 dark:text-white mb-2\",children:\"\\uD83D\\uDD34 Post-Cancellation (Subscription Cancelled)\"}),/*#__PURE__*/_jsx(\"div\",{className:\"text-base text-red-600 dark:text-red-400\",children:\"revenue = $0.00\"})]})]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-sm text-gray-600 dark:text-gray-400\",children:[/*#__PURE__*/_jsx(\"strong\",{children:\"\\uD83D\\uDCC8 State Tracking:\"}),\"\\u2022 Backend uses event_state_tracker.py for proper event state management \\u2022 Trial states: started \\u2192 pending \\u2192 ended (converted/cancelled) \\u2022 Subscription states: active \\u2192 cancelled \\u2022 Revenue tracking includes actual event revenue and refunds\"]})]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"mb-6 p-4 bg-gradient-to-r from-purple-50 to-indigo-50 dark:from-purple-900/20 dark:to-indigo-900/20 rounded-lg border border-purple-200 dark:border-purple-800\",children:[/*#__PURE__*/_jsxs(\"h3\",{className:\"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2\",children:[/*#__PURE__*/_jsx(Target,{size:20,className:\"text-purple-600 dark:text-purple-400\"}),\"User & Segment Details\"]}),selectedUser?(()=>{// --- START: REPLACEMENT LOGIC ---\n// Get the complete, consolidated data for the selected user\nconst userEventsData=backendUserTimelinesEvents[selectedUser];// If there's no data for the selected user, show an error state.\nif(!userEventsData){return/*#__PURE__*/_jsxs(\"div\",{className:\"text-red-500 text-center\",children:[\"Error: No timeline event data found for user \",selectedUser,\".\"]});}// Extract segment info and properties directly from the new, correct data structure.\nconst segmentInfo=userEventsData.segment_info||{};const userProperties=segmentInfo.user_properties||{};// Extract metrics directly from the segment info\nconst effectiveSegmentMetrics=segmentInfo.conversion_metrics||{};// The rest of your display logic can now use these variables directly.\n// For example, to get the matched segment ID:\nconst matchedSegmentId=segmentInfo.matched_segment_id||segmentInfo.segment_id;// To get the final segment ID after rollup:\nconst finalSegmentId=segmentInfo.final_viable_segment_id||segmentInfo.segment_id;// To check if a rollup occurred:\nconst hasActualRollup=matchedSegmentId&&finalSegmentId&&matchedSegmentId!==finalSegmentId;// Extract segment properties from the correct sources\nlet matchedSegmentProperties=userProperties;let finalSegmentProperties=userProperties;let matchedLevel=0;let matchedUserCount=effectiveSegmentMetrics.sample_size||effectiveSegmentMetrics.cohort_size||'Unknown';let finalLevel=0;let finalUserCount=matchedUserCount;// --- END: REPLACEMENT LOGIC ---\nreturn/*#__PURE__*/_jsx(\"div\",{className:\"space-y-4\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 lg:grid-cols-5 gap-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"bg-gray-800 text-white p-4 rounded-lg text-sm\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"font-mono text-xs mb-3 text-blue-300 break-all\",children:selectedUser}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-xs text-gray-400 mb-3\",children:[\"Short: \",selectedUser.substring(0,8),\"...\"]}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-1 text-xs\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-400\",children:\"Product:\"}),\" \",userProperties.product_id||'N/A']}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-400\",children:\"Store:\"}),\" \",userProperties.app_store||'N/A']}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-400\",children:\"Price:\"}),\" \",userProperties.price_bucket||'N/A']}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-400\",children:\"Country:\"}),\" \",userProperties.country||'N/A']}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-400\",children:\"Economic Tier:\"}),\" \",userProperties.economic_tier||'N/A']}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-400\",children:\"Region:\"}),\" \",userProperties.region||'N/A']})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-gray-800 text-white p-4 rounded-lg text-sm\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"font-medium text-blue-300 mb-2 text-xs\",children:[\"ID: \",matchedSegmentId?matchedSegmentId.substring(0,8)+'...':'Unknown']}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-1 text-xs\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-400\",children:\"Product:\"}),\" \",matchedSegmentProperties.product_id||'N/A']}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-400\",children:\"Store:\"}),\" \",matchedSegmentProperties.app_store||'N/A']}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-400\",children:\"Price:\"}),\" \",matchedSegmentProperties.price_bucket||'N/A']}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-400\",children:\"Country:\"}),\" \",matchedSegmentProperties.country||'N/A']}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-400\",children:\"Economic Tier:\"}),\" \",matchedSegmentProperties.economic_tier||'N/A']}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-400\",children:\"Region:\"}),\" \",matchedSegmentProperties.region||'N/A']}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-400\",children:\"Level:\"}),\" \",matchedLevel]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-400\",children:\"Users:\"}),\" \",matchedUserCount]})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"bg-gray-800 text-white p-4 rounded-lg text-sm\",children:hasActualRollup?/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"font-medium text-green-300 mb-2 text-xs\",children:[\"ID: \",finalSegmentId?finalSegmentId.substring(0,8)+'...':'Unknown']}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-1 text-xs\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-400\",children:\"Product:\"}),\" \",finalSegmentProperties.product_id||'N/A']}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-400\",children:\"Store:\"}),\" \",finalSegmentProperties.app_store||'N/A']}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-400\",children:\"Price:\"}),\" \",finalSegmentProperties.price_bucket||'N/A']}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-400\",children:\"Country:\"}),\" \",finalSegmentProperties.country||'N/A']}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-400\",children:\"Economic Tier:\"}),\" \",finalSegmentProperties.economic_tier||'N/A']}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-400\",children:\"Region:\"}),\" \",finalSegmentProperties.region||'N/A']}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-400\",children:\"Level:\"}),\" \",finalLevel]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-400\",children:\"Users:\"}),\" \",finalUserCount]})]})]}):/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"font-medium text-blue-300 mb-2 text-xs\",children:[\"ID: \",finalSegmentId?finalSegmentId.substring(0,8)+'...':'Same as matched']}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-1 text-xs\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-400\",children:\"Product:\"}),\" \",finalSegmentProperties.product_id||'N/A']}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-400\",children:\"Store:\"}),\" \",finalSegmentProperties.app_store||'N/A']}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-400\",children:\"Price:\"}),\" \",finalSegmentProperties.price_bucket||'N/A']}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-400\",children:\"Country:\"}),\" \",finalSegmentProperties.country||'N/A']}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-400\",children:\"Economic Tier:\"}),\" \",finalSegmentProperties.economic_tier||'N/A']}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-400\",children:\"Region:\"}),\" \",finalSegmentProperties.region||'N/A']}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-400\",children:\"Level:\"}),\" \",finalLevel]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-400\",children:\"Users:\"}),\" \",finalUserCount]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"text-xs text-gray-500 mt-2 italic\",children:\"Direct match - no rollup applied\"})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"bg-gray-800 text-white p-4 rounded-lg text-sm\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-2 text-xs\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-400\",children:\"Trial Conv.:\"}),/*#__PURE__*/_jsxs(\"span\",{className:\"ml-1 text-green-300\",children:[((effectiveSegmentMetrics.trial_conversion_rate||0)*100).toFixed(1),\"%\"]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-400\",children:\"Refund:\"}),/*#__PURE__*/_jsxs(\"span\",{className:\"ml-1 text-red-300\",children:[((effectiveSegmentMetrics.trial_converted_to_refund_rate||0)*100).toFixed(1),\"%\"]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-400\",children:\"Init. Refund:\"}),/*#__PURE__*/_jsxs(\"span\",{className:\"ml-1 text-red-300\",children:[((effectiveSegmentMetrics.initial_purchase_to_refund_rate||0)*100).toFixed(1),\"%\"]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-400\",children:\"Renewal Refund:\"}),/*#__PURE__*/_jsxs(\"span\",{className:\"ml-1 text-red-300\",children:[((effectiveSegmentMetrics.renewal_to_refund_rate||0)*100).toFixed(1),\"%\"]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-400\",children:\"Sample size:\"}),/*#__PURE__*/_jsx(\"span\",{className:\"ml-1 text-blue-300\",children:finalUserCount})]})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"bg-gray-800 text-white p-4 rounded-lg text-sm\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"text-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"\\n                                                px-3 py-2 rounded-full text-xs font-medium\\n                                                \".concat(segmentInfo.accuracy_score==='high'?'bg-green-600 text-white':segmentInfo.accuracy_score==='medium'?'bg-yellow-600 text-white':'bg-red-600 text-white',\"\\n                                            \"),children:(segmentInfo.accuracy_score||'Unknown').toUpperCase()}),/*#__PURE__*/_jsx(\"div\",{className:\"text-xs text-gray-400 mt-2\",children:\"Prediction Accuracy\"})]})})]})});})():/*#__PURE__*/_jsx(\"div\",{className:\"text-gray-600 dark:text-gray-400 italic text-center py-8\",children:\"Select an individual user to view segment details\"})]}),stage3Data&&/*#__PURE__*/_jsxs(\"div\",{className:\"mb-6\",children:[/*#__PURE__*/_jsxs(\"h3\",{className:\"text-lg font-semibold text-gray-900 dark:text-white mb-4\",children:[selectedUser?\"Revenue Timeline for User \".concat(selectedUser.substring(0,16),\"...\"):'Aggregate Revenue Timeline',selectedUser&&selectedProductId&&/*#__PURE__*/_jsxs(\"span\",{className:\"text-sm text-gray-500 dark:text-gray-400 ml-2\",children:[\"(Product: \",selectedProductId,\")\"]})]}),/*#__PURE__*/_jsx(EventTimelineTableV3,{data:getTimelineTableData(),selectedUserId:selectedUser,selectedProductId:selectedProductId||(selectedUser?(_userTimelines$select6=userTimelines[selectedUser])===null||_userTimelines$select6===void 0?void 0:(_userTimelines$select7=_userTimelines$select6.user_properties)===null||_userTimelines$select7===void 0?void 0:_userTimelines$select7.product_id:null)})]}),stage3Data.error&&/*#__PURE__*/_jsxs(\"div\",{className:\"text-center py-8 bg-red-50 dark:bg-red-900/20 rounded-lg border border-red-200 dark:border-red-800\",children:[/*#__PURE__*/_jsx(AlertCircle,{size:48,className:\"mx-auto text-red-400 mb-4\"}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-red-600 dark:text-red-400 mb-2\",children:[\"Stage 3 Error: \",stage3Data.error]})]}),Object.keys(userTimelines).length===0&&!stage3Data.error&&/*#__PURE__*/_jsxs(\"div\",{className:\"text-center py-8 bg-gray-50 dark:bg-gray-700 rounded-lg\",children:[/*#__PURE__*/_jsx(TrendingUp,{size:48,className:\"mx-auto text-gray-400 mb-4\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-600 dark:text-gray-400 mb-2\",children:\"No revenue timeline data available\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-gray-500 dark:text-gray-500\",children:\"Run Stage 3 analysis to see revenue timeline projections\"})]})]});};export default Stage3RevenueResultsV3;","map":{"version":3,"names":["React","useState","useMemo","TrendingUp","Users","DollarSign","Clock","Activity","AlertCircle","Database","Calculator","Target","User","Globe","Package","EventTimelineTableV3","jsx","_jsx","jsxs","_jsxs","Stage3RevenueResultsV3","_ref","_data$stage_results","_data$data","_data$data$stage_resu","_stage3Data","_userTimelines$select3","_userTimelines$select4","_userTimelines$select5","_userTimelines$select6","_userTimelines$select7","data","selectedUser","setSelectedUser","userSearchTerm","setUserSearchTerm","selectedProductId","setSelectedProductId","stage3Data","stage_results","stage3","timelineResults","timeline_results","aggregateStats","aggregate_stats","userTimelines","user_timelines","backendTimelineData","timeline_data","backendUserDailyMetrics","user_daily_metrics","backendUserTimelinesEvents","user_timelines_events","Object","keys","length","console","log","debugUserId","userData","may27Data","trial_started","trial_ended","trial_cancelled","trial_converted","trial_pending","slice","summary","product_summaries","firstUser","firstUserData","firstDate","userId","date","metrics","sampleDate","sampleData","concat","revenue","estimated_revenue","sampleUser","sampleUserData","sampleDayData","sampleEventsUser","sampleEventsData","events","products","total_estimated_revenue","total_actual_revenue","usersWithMultipleProducts","multiProductUsers","entries","forEach","_ref2","productIds","availableProductsForUser","selectedUserHasMultipleProducts","userList","usersSource","users","map","_ref3","timelineData","outcomeType","estimatedRevenue","actualRevenue","outcome_type","undefined","hasMultipleProducts","productIndicator","timeline","displayName","substring","fullId","filter","user","toLowerCase","includes","className","children","formatNumber","num","toLocaleString","formatCurrency","minimumFractionDigits","maximumFractionDigits","formatPercentage","total","toFixed","getTimelineTableData","_userTimelines$select","_userTimelines$select2","userDates","sort","userDailyData","userCumulativeData","cumulativeCounters","initial_purchase","subscription_cancelled","refund","refund_count","dayData","key","individualResult","dates","daily_metrics","cumulative_metrics","summary_stats","total_users","aggregateDates","aggregateCumulativeMetrics","subscription_active","cumulative_trial_started","cumulative_trial_ended","cumulative_trial_converted","cumulative_trial_cancelled","cumulative_initial_purchase","cumulative_subscription_cancelled","cumulative_revenue","cumulative_refund","cumulative_refund_count","cumulative_revenue_net","aggregateResult","size","type","placeholder","value","onChange","e","target","productId","users_with_timelines","timeline_end_date","userEventsData","segmentInfo","segment_info","userProperties","user_properties","effectiveSegmentMetrics","conversion_metrics","matchedSegmentId","matched_segment_id","segment_id","finalSegmentId","final_viable_segment_id","hasActualRollup","matchedSegmentProperties","finalSegmentProperties","matchedLevel","matchedUserCount","sample_size","cohort_size","finalLevel","finalUserCount","product_id","app_store","price_bucket","country","economic_tier","region","trial_conversion_rate","trial_converted_to_refund_rate","initial_purchase_to_refund_rate","renewal_to_refund_rate","accuracy_score","toUpperCase","selectedUserId","error"],"sources":["/Users/joshuakaufman/untitled folder 3/orchestrator/dashboard/client/src/cohort-pipeline/components/Stage3RevenueResultsV3.js"],"sourcesContent":["import React, { useState, useMemo } from 'react';\nimport { TrendingUp, Users, DollarSign, Clock, Activity, AlertCircle, Database, Calculator, Target, User, Globe, Package } from 'lucide-react';\nimport EventTimelineTableV3 from './EventTimelineTableV3';\n\nconst Stage3RevenueResultsV3 = ({ data }) => {\n    const [selectedUser, setSelectedUser] = useState(''); // Empty string means aggregate view\n    const [userSearchTerm, setUserSearchTerm] = useState('');\n    const [selectedProductId, setSelectedProductId] = useState(''); // NEW: Product selector state\n    \n    // Handle multiple API response formats for data access\n    let stage3Data = null;\n    \n    if (data?.stage_results?.stage3) {\n        // Direct format: pipelineData.stage_results.stage3\n        stage3Data = data.stage_results.stage3;\n    } else if (data?.data?.stage_results?.stage3) {\n        // Nested format: pipelineData.data.stage_results.stage3\n        stage3Data = data.data.stage_results.stage3;\n    }\n\n    const timelineResults = stage3Data?.timeline_results || {};\n    const aggregateStats = timelineResults.aggregate_stats || {};\n    const userTimelines = timelineResults.user_timelines || {};\n    \n    // NEW: Backend now provides EventTimelineTable format data directly\n    const backendTimelineData = timelineResults.timeline_data || {};\n    const backendUserDailyMetrics = timelineResults.user_daily_metrics || {};\n    const backendUserTimelinesEvents = timelineResults.user_timelines_events || {};\n    \n    // 🔍 FRONTEND TIMELINE DEBUG: Log the data received from backend\n    if (Object.keys(timelineResults).length > 0) {\n        console.log('🔍 [FRONTEND TIMELINE DEBUG] Data received from backend:');\n        console.log('🔍   - timeline_data dates:', backendTimelineData ? Object.keys(backendTimelineData).length : 0);\n        console.log('🔍   - user_daily_metrics users:', backendUserDailyMetrics ? Object.keys(backendUserDailyMetrics).length : 0);\n        console.log('🔍   - user_timelines_events users:', backendUserTimelinesEvents ? Object.keys(backendUserTimelinesEvents).length : 0);\n        \n        // ***** SEND THIS TO AI - DEBUG LOG #1 *****\n        console.log('***** SEND THIS TO AI - DEBUG LOG #1 *****');\n        console.log('ISSUE 2 DEBUG - Specific User Daily Metrics Check:');\n        const debugUserId = '$device:07BDA330-D882-45B2-946E-A2E81B011718';\n        console.log('Target User ID:', debugUserId);\n        console.log('User found in backendUserDailyMetrics:', debugUserId in backendUserDailyMetrics);\n        \n        if (backendUserDailyMetrics[debugUserId]) {\n            const userData = backendUserDailyMetrics[debugUserId];\n            console.log('Available dates for user:', Object.keys(userData));\n            \n            const may27Data = userData['2025-05-27'];\n            console.log('May 27th data exists:', may27Data ? 'YES' : 'NO');\n            \n            if (may27Data) {\n                console.log('May 27th COMPLETE data:', may27Data);\n                console.log('trial_started:', may27Data.trial_started);\n                console.log('trial_ended:', may27Data.trial_ended, '← Should be 1');\n                console.log('trial_cancelled:', may27Data.trial_cancelled, '← Should be 1');\n                console.log('trial_converted:', may27Data.trial_converted);\n                console.log('trial_pending:', may27Data.trial_pending);\n            }\n        } else {\n            console.log('User NOT FOUND in backendUserDailyMetrics!');\n            console.log('Available users (first 5):', Object.keys(backendUserDailyMetrics).slice(0, 5));\n        }\n        console.log('***** END DEBUG LOG #1 *****');\n        \n        // ***** SEND THIS TO AI - DEBUG LOG #2 *****\n        console.log('***** SEND THIS TO AI - DEBUG LOG #2 *****');\n        console.log('ISSUE 1 DEBUG - Product Selector Data Check:');\n        console.log('User found in backendUserTimelinesEvents:', debugUserId in backendUserTimelinesEvents);\n        \n        if (backendUserTimelinesEvents[debugUserId]) {\n            const userData = backendUserTimelinesEvents[debugUserId];\n            console.log('User timeline events structure keys:', Object.keys(userData));\n            console.log('Has summary:', 'summary' in userData);\n            \n            if (userData.summary) {\n                console.log('Summary keys:', Object.keys(userData.summary));\n                console.log('Has product_summaries:', 'product_summaries' in userData.summary);\n                \n                if (userData.summary.product_summaries) {\n                    console.log('Product summaries keys:', Object.keys(userData.summary.product_summaries));\n                    console.log('Number of products:', Object.keys(userData.summary.product_summaries).length);\n                    console.log('COMPLETE product_summaries data:', userData.summary.product_summaries);\n                } else {\n                    console.log('ERROR: product_summaries is missing from summary!');\n                }\n            } else {\n                console.log('ERROR: summary is missing from user timeline events!');\n            }\n        } else {\n            console.log('User NOT FOUND in backendUserTimelinesEvents!');\n            console.log('Available users in backendUserTimelinesEvents (first 5):', Object.keys(backendUserTimelinesEvents).slice(0, 5));\n        }\n        console.log('***** END DEBUG LOG #2 *****');\n        \n        // ***** SEND THIS TO AI - DEBUG LOG #3 *****\n        console.log('***** SEND THIS TO AI - DEBUG LOG #3 *****');\n        console.log('GENERAL DATA STRUCTURE CHECK:');\n        console.log('backendTimelineData exists:', !!backendTimelineData);\n        console.log('backendUserDailyMetrics exists:', !!backendUserDailyMetrics);\n        console.log('backendUserTimelinesEvents exists:', !!backendUserTimelinesEvents);\n        console.log('Number of users in backendUserDailyMetrics:', Object.keys(backendUserDailyMetrics).length);\n        console.log('Number of users in backendUserTimelinesEvents:', Object.keys(backendUserTimelinesEvents).length);\n        \n        if (Object.keys(backendUserDailyMetrics).length > 0) {\n            const firstUser = Object.keys(backendUserDailyMetrics)[0];\n            const firstUserData = backendUserDailyMetrics[firstUser];\n            const firstDate = Object.keys(firstUserData)[0];\n            console.log('Sample user daily metrics structure:', {\n                userId: firstUser,\n                date: firstDate,\n                metrics: firstUserData[firstDate]\n            });\n        }\n        console.log('***** END DEBUG LOG #3 *****');\n        \n        if (backendTimelineData && Object.keys(backendTimelineData).length > 0) {\n            const sampleDate = Object.keys(backendTimelineData)[0];\n            const sampleData = backendTimelineData[sampleDate];\n            console.log(`🔍   - Sample timeline_data[${sampleDate}]:`);\n            console.log('🔍     - trial_started:', sampleData.trial_started || 0);\n            console.log('🔍     - trial_converted:', sampleData.trial_converted || 0);\n            console.log('🔍     - revenue:', sampleData.revenue || 0);\n            console.log('🔍     - estimated_revenue:', sampleData.estimated_revenue || 0);\n        }\n        \n        if (backendUserDailyMetrics && Object.keys(backendUserDailyMetrics).length > 0) {\n            const sampleUser = Object.keys(backendUserDailyMetrics)[0];\n            const sampleUserData = backendUserDailyMetrics[sampleUser];\n            console.log(`🔍   - Sample user_daily_metrics[${sampleUser}]:`);\n            console.log('🔍     - Dates available:', Object.keys(sampleUserData).length);\n            if (Object.keys(sampleUserData).length > 0) {\n                const sampleDate = Object.keys(sampleUserData)[0];\n                const sampleDayData = sampleUserData[sampleDate];\n                console.log(`🔍     - Sample date[${sampleDate}]:`);\n                console.log('🔍       - trial_started:', sampleDayData.trial_started || 0);\n                console.log('🔍       - trial_converted:', sampleDayData.trial_converted || 0);\n                console.log('🔍       - revenue:', sampleDayData.revenue || 0);\n                console.log('🔍       - estimated_revenue:', sampleDayData.estimated_revenue || 0);\n            }\n        }\n        \n        if (backendUserTimelinesEvents && Object.keys(backendUserTimelinesEvents).length > 0) {\n            const sampleEventsUser = Object.keys(backendUserTimelinesEvents)[0];\n            const sampleEventsData = backendUserTimelinesEvents[sampleEventsUser];\n            console.log(`🔍   - Sample user_timelines_events[${sampleEventsUser}]:`);\n            console.log('🔍     - Structure keys:', Object.keys(sampleEventsData));\n            console.log('🔍     - Events count:', sampleEventsData.events ? sampleEventsData.events.length : 0);\n            console.log('🔍     - Products count:', sampleEventsData.products ? Object.keys(sampleEventsData.products).length : 0);\n            if (sampleEventsData.summary) {\n                console.log('🔍     - Summary total_estimated_revenue:', sampleEventsData.summary.total_estimated_revenue || 0);\n                console.log('🔍     - Summary total_actual_revenue:', sampleEventsData.summary.total_actual_revenue || 0);\n            }\n        }\n    }\n    \n    // NEW: Detect users with multiple products\n    const usersWithMultipleProducts = useMemo(() => {\n        const multiProductUsers = {};\n        \n        Object.entries(backendUserTimelinesEvents).forEach(([userId, userData]) => {\n            if (userData.summary && userData.summary.product_summaries) {\n                const productIds = Object.keys(userData.summary.product_summaries);\n                if (productIds.length > 1) {\n                    multiProductUsers[userId] = productIds;\n                }\n            }\n        });\n        \n        return multiProductUsers;\n    }, [backendUserTimelinesEvents]);\n    \n    // NEW: Get available products for selected user\n    const availableProductsForUser = useMemo(() => {\n        if (!selectedUser || !backendUserTimelinesEvents[selectedUser]) {\n            return [];\n        }\n        \n        const userData = backendUserTimelinesEvents[selectedUser];\n        if (userData.summary && userData.summary.product_summaries) {\n            return Object.keys(userData.summary.product_summaries);\n        }\n        \n        return [];\n    }, [selectedUser, backendUserTimelinesEvents]);\n    \n    // NEW: Check if current user has multiple products\n    const selectedUserHasMultipleProducts = availableProductsForUser.length > 1;\n    \n    // Process user list for dropdown with search filtering\n    const userList = useMemo(() => {\n        // FIXED: Use user_timelines_events for user list, which has consolidated user data\n        const usersSource = backendUserTimelinesEvents && Object.keys(backendUserTimelinesEvents).length > 0 \n            ? backendUserTimelinesEvents \n            : userTimelines;\n        \n        const users = Object.entries(usersSource).map(([userId, timelineData]) => {\n            // Handle both old and new data formats\n            let outcomeType = 'pending';\n            let estimatedRevenue = 0;\n            let actualRevenue = 0;\n            \n            if (timelineData.summary) {\n                // New consolidated format from backend fix\n                outcomeType = timelineData.summary.outcome_type || 'pending';\n                estimatedRevenue = timelineData.summary.total_estimated_revenue || 0;\n                actualRevenue = timelineData.summary.total_actual_revenue || 0;\n            } else if (timelineData.outcome_type !== undefined) {\n                // Original format (user#product composite keys)\n                outcomeType = timelineData.outcome_type || 'pending';\n                estimatedRevenue = timelineData.total_estimated_revenue || 0;\n                actualRevenue = timelineData.total_actual_revenue || 0;\n            }\n            \n            // NEW: Add indicator for multi-product users\n            const hasMultipleProducts = usersWithMultipleProducts[userId] ? true : false;\n            const productIndicator = hasMultipleProducts ? ' 📦' : '';\n            \n            return {\n            userId,\n                timeline: timelineData,\n                displayName: `${userId.substring(0, 8)}... (${outcomeType})${productIndicator}`,\n            fullId: userId,\n                outcomeType,\n                estimatedRevenue,\n                actualRevenue,\n                hasMultipleProducts\n            };\n        });\n        \n        // Filter based on search term\n        if (userSearchTerm) {\n            return users.filter(user => \n                user.userId.toLowerCase().includes(userSearchTerm.toLowerCase()) ||\n                user.outcomeType.toLowerCase().includes(userSearchTerm.toLowerCase())\n            );\n        }\n        \n        return users;\n    }, [userTimelines, backendUserTimelinesEvents, userSearchTerm, usersWithMultipleProducts]);\n\n    if (!stage3Data) {\n        return (\n            <div className=\"text-center py-8\">\n                <p className=\"text-gray-500 dark:text-gray-400\">\n                    No Stage 3 data available. Run analysis to see revenue timeline results.\n                </p>\n            </div>\n        );\n    }\n\n    // Helper function to format numbers\n    const formatNumber = (num) => {\n        if (typeof num !== 'number') return '0';\n        return num.toLocaleString();\n    };\n\n    // Helper function to format currency\n    const formatCurrency = (num) => {\n        if (typeof num !== 'number') return '$0';\n        return '$' + num.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 });\n    };\n\n    // Helper function to format percentages\n    const formatPercentage = (num, total) => {\n        if (!total || typeof num !== 'number') return '0.0%';\n        return ((num / total) * 100).toFixed(1) + '%';\n    };\n    \n    // Get the appropriate data for EventTimelineTable - backend provides it directly now\n    const getTimelineTableData = () => {\n        if (selectedUser && backendUserDailyMetrics[selectedUser]) {\n            // Individual user view - create data structure for single user\n            const userDates = Object.keys(backendUserDailyMetrics[selectedUser]).sort();\n            const userDailyData = {};\n            const userCumulativeData = {};\n            \n            // Build daily metrics for selected user only\n            userDates.forEach(date => {\n                userDailyData[date] = backendUserDailyMetrics[selectedUser][date];\n            });\n            \n            // Calculate cumulative metrics for individual user\n            let cumulativeCounters = {\n                trial_started: 0,\n                trial_ended: 0,\n                trial_converted: 0,\n                trial_cancelled: 0,\n                initial_purchase: 0,\n                subscription_cancelled: 0,\n                revenue: 0,\n                refund: 0,\n                refund_count: 0,\n                estimated_revenue: 0\n            };\n            \n            userDates.forEach(date => {\n                const dayData = userDailyData[date];\n                \n                // Update cumulative counters\n                Object.keys(cumulativeCounters).forEach(key => {\n                    if (key === 'trial_pending' || key === 'subscription_active') {\n                        // State-based metrics use current value, not cumulative\n                        userCumulativeData[date] = userCumulativeData[date] || {};\n                        userCumulativeData[date][`cumulative_${key}`] = dayData[key] || 0;\n                    } else {\n                        cumulativeCounters[key] += (dayData[key] || 0);\n                        userCumulativeData[date] = userCumulativeData[date] || {};\n                        userCumulativeData[date][`cumulative_${key}`] = cumulativeCounters[key];\n                    }\n                });\n                \n                // Add net revenue\n                userCumulativeData[date]['cumulative_revenue_net'] = cumulativeCounters['revenue'] - cumulativeCounters['refund'];\n            });\n            \n            const individualResult = {\n                data: {\n                    dates: userDates,\n                    daily_metrics: userDailyData,\n                    cumulative_metrics: userCumulativeData,\n                    user_timelines: backendUserTimelinesEvents,\n                    user_daily_metrics: { [selectedUser]: backendUserDailyMetrics[selectedUser] },\n                    summary_stats: {\n                        total_users: 1,\n                        total_estimated_revenue: userTimelines[selectedUser]?.total_estimated_revenue || 0,\n                        total_actual_revenue: userTimelines[selectedUser]?.total_actual_revenue || 0\n                    }\n                }\n            };\n            \n            return individualResult;\n        }\n        \n        // Aggregate view - calculate cumulative metrics from daily metrics\n        const aggregateDates = Object.keys(backendTimelineData).sort();\n        const aggregateCumulativeMetrics = {};\n        \n        // Initialize cumulative counters for aggregate view\n        let cumulativeCounters = {\n            trial_started: 0,\n            trial_ended: 0,\n            trial_converted: 0,\n            trial_cancelled: 0,\n            initial_purchase: 0,\n            subscription_cancelled: 0,\n            revenue: 0,\n            refund: 0,\n            refund_count: 0\n        };\n        \n        // Calculate cumulative metrics for each date\n        aggregateDates.forEach(date => {\n            const dayData = backendTimelineData[date] || {};\n            \n            // Update cumulative counters (for event-based metrics)\n            Object.keys(cumulativeCounters).forEach(key => {\n                if (key in dayData && typeof dayData[key] === 'number') {\n                    cumulativeCounters[key] += dayData[key];\n                }\n            });\n            \n            // Store cumulative data for this date\n            aggregateCumulativeMetrics[date] = {\n                // State-based metrics use current daily value (not cumulative)\n                trial_pending: dayData.trial_pending || 0,\n                subscription_active: dayData.subscription_active || 0,\n                estimated_revenue: dayData.estimated_revenue || 0,\n                \n                // Event-based metrics use cumulative values\n                cumulative_trial_started: cumulativeCounters.trial_started,\n                cumulative_trial_ended: cumulativeCounters.trial_ended,\n                cumulative_trial_converted: cumulativeCounters.trial_converted,\n                cumulative_trial_cancelled: cumulativeCounters.trial_cancelled,\n                cumulative_initial_purchase: cumulativeCounters.initial_purchase,\n                cumulative_subscription_cancelled: cumulativeCounters.subscription_cancelled,\n                cumulative_revenue: cumulativeCounters.revenue,\n                cumulative_refund: cumulativeCounters.refund,\n                cumulative_refund_count: cumulativeCounters.refund_count,\n                cumulative_revenue_net: cumulativeCounters.revenue - cumulativeCounters.refund\n            };\n        });\n        \n        const aggregateResult = {\n            data: {\n                dates: aggregateDates,\n                daily_metrics: backendTimelineData,\n                cumulative_metrics: aggregateCumulativeMetrics,\n                user_timelines: backendUserTimelinesEvents,\n                user_daily_metrics: backendUserDailyMetrics,\n                summary_stats: aggregateStats\n            }\n        };\n        \n        return aggregateResult;\n    };\n\n    return (\n        <div className=\"bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6\">\n            <div className=\"flex items-center gap-2 mb-6\">\n                <TrendingUp size={24} className=\"text-purple-600 dark:text-purple-400\" />\n                <h2 className=\"text-2xl font-bold text-gray-900 dark:text-white\">\n                    Stage 3: Revenue Timeline Generation Results\n                </h2>\n                <div className=\"ml-auto flex items-center gap-1 text-purple-600 dark:text-purple-400 text-sm\">\n                    <span>✓</span>\n                    <span>Revenue Estimation & Timeline Projection</span>\n                </div>\n            </div>\n\n            {/* User Selection Controls */}\n            <div className=\"mb-6 p-4 bg-gradient-to-r from-blue-50 to-purple-50 dark:from-blue-900/20 dark:to-purple-900/20 rounded-lg border border-blue-200 dark:border-blue-800\">\n                <div className=\"flex items-center gap-2 mb-3\">\n                    <User size={20} className=\"text-blue-600 dark:text-blue-400\" />\n                    <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white\">View Selection</h3>\n                </div>\n                \n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                    {/* User Dropdown */}\n                    <div>\n                        <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                            Select User (or leave empty for aggregate)\n                        </label>\n                        <div className=\"space-y-2\">\n                            <input\n                                type=\"text\"\n                                placeholder=\"Search by User ID or outcome...\"\n                                value={userSearchTerm}\n                                onChange={(e) => setUserSearchTerm(e.target.value)}\n                                className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white text-sm\"\n                            />\n                            <select\n                                value={selectedUser}\n                                onChange={(e) => {\n                                    setSelectedUser(e.target.value);\n                                    setSelectedProductId(''); // Reset product selection when user changes\n                                }}\n                                className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white text-sm\"\n                            >\n                                <option value=\"\">🌍 Aggregate View (All Users)</option>\n                                {userList.map(user => (\n                                    <option key={user.userId} value={user.userId}>\n                                        👤 {user.displayName} - Est: {formatCurrency(user.estimatedRevenue)}\n                                    </option>\n                                ))}\n                            </select>\n                        </div>\n                        \n                        {/* NEW: Product Selector - Only show when user has multiple products */}\n                        {selectedUser && selectedUserHasMultipleProducts && (\n                            <div className=\"mt-3 p-3 bg-yellow-50 dark:bg-yellow-900/20 rounded-lg border border-yellow-200 dark:border-yellow-800\">\n                                <div className=\"flex items-center gap-2 mb-2\">\n                                    <Package size={16} className=\"text-yellow-600 dark:text-yellow-400\" />\n                                    <span className=\"text-sm font-medium text-yellow-800 dark:text-yellow-200\">\n                                        Multiple Products Detected\n                                    </span>\n                                </div>\n                                <select\n                                    value={selectedProductId}\n                                    onChange={(e) => setSelectedProductId(e.target.value)}\n                                    className=\"w-full px-3 py-2 border border-yellow-300 dark:border-yellow-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white text-sm\"\n                                >\n                                    <option value=\"\">📊 All Products (Combined)</option>\n                                    {availableProductsForUser.map(productId => (\n                                        <option key={productId} value={productId}>\n                                            📦 {productId}\n                                        </option>\n                                    ))}\n                                </select>\n                                <p className=\"text-xs text-yellow-700 dark:text-yellow-300 mt-1\">\n                                    This user has trials for {availableProductsForUser.length} different products. \n                                    Select a specific product or view combined data.\n                                </p>\n                            </div>\n                        )}\n                    </div>\n                    \n                    {/* Current Selection Info */}\n                    <div>\n                        <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">\n                            Current View\n                        </label>\n                        <div className=\"p-3 bg-white dark:bg-gray-800 rounded-md border border-gray-200 dark:border-gray-700\">\n                            {selectedUser ? (\n                                <div>\n                                    <div className=\"flex items-center gap-2 mb-1\">\n                                        <User size={16} className=\"text-blue-600 dark:text-blue-400\" />\n                                        <span className=\"font-medium text-gray-900 dark:text-white\">Individual User</span>\n                                    </div>\n                                    <div className=\"text-sm text-gray-600 dark:text-gray-400 break-all\">\n                                        ID: {selectedUser}\n                                    </div>\n                                    <div className=\"text-sm text-gray-600 dark:text-gray-400\">\n                                        Status: {userTimelines[selectedUser]?.outcome_type || 'pending'}\n                                    </div>\n                                    {selectedUserHasMultipleProducts && (\n                                        <div className=\"text-sm text-orange-600 dark:text-orange-400\">\n                                            Products: {availableProductsForUser.length} ({selectedProductId || 'All'})\n                                        </div>\n                                    )}\n                                </div>\n                            ) : (\n                                <div>\n                                    <div className=\"flex items-center gap-2 mb-1\">\n                                        <Globe size={16} className=\"text-green-600 dark:text-green-400\" />\n                                        <span className=\"font-medium text-gray-900 dark:text-white\">Aggregate View</span>\n                                    </div>\n                                    <div className=\"text-sm text-gray-600 dark:text-gray-400\">\n                                        Showing data for all {Object.keys(userTimelines).length} users\n                                    </div>\n                                    <div className=\"text-sm text-blue-600 dark:text-blue-400\">\n                                        Multi-product users: {Object.keys(usersWithMultipleProducts).length}\n                                    </div>\n                                </div>\n                            )}\n                        </div>\n                    </div>\n                </div>\n            </div>\n\n            {/* Revenue Summary Cards */}\n            <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6\">\n                <div className=\"p-4 bg-purple-50 dark:bg-purple-900/20 rounded-lg border border-purple-200 dark:border-purple-800\">\n                    <div className=\"flex items-center gap-2 mb-2\">\n                        <Users size={20} className=\"text-purple-600 dark:text-purple-400\" />\n                        <h3 className=\"font-semibold text-purple-900 dark:text-purple-200\">Users with Timelines</h3>\n                    </div>\n                    <p className=\"text-2xl font-bold text-purple-600 dark:text-purple-300\">\n                        {selectedUser ? '1' : formatNumber(stage3Data.users_with_timelines || 0)}\n                    </p>\n                    <p className=\"text-sm text-purple-700 dark:text-purple-400\">\n                        {selectedUser ? 'Individual view' : 'Revenue projections generated'}\n                    </p>\n                </div>\n\n                <div className=\"p-4 bg-green-50 dark:bg-green-900/20 rounded-lg border border-green-200 dark:border-green-800\">\n                    <div className=\"flex items-center gap-2 mb-2\">\n                        <DollarSign size={20} className=\"text-green-600 dark:text-green-400\" />\n                        <h3 className=\"font-semibold text-green-900 dark:text-green-200\">Estimated Revenue</h3>\n                    </div>\n                    <p className=\"text-2xl font-bold text-green-600 dark:text-green-300\">\n                        {selectedUser ? \n                            formatCurrency(userTimelines[selectedUser]?.total_estimated_revenue || 0) :\n                            formatCurrency(aggregateStats.total_estimated_revenue || 0)\n                        }\n                    </p>\n                    <p className=\"text-sm text-green-700 dark:text-green-400\">\n                        Based on conversion probabilities\n                    </p>\n                </div>\n\n                <div className=\"p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-800\">\n                    <div className=\"flex items-center gap-2 mb-2\">\n                        <Activity size={20} className=\"text-blue-600 dark:text-blue-400\" />\n                        <h3 className=\"font-semibold text-blue-900 dark:text-blue-200\">Actual Revenue</h3>\n                    </div>\n                    <p className=\"text-2xl font-bold text-blue-600 dark:text-blue-300\">\n                        {selectedUser ? \n                            formatCurrency(userTimelines[selectedUser]?.total_actual_revenue || 0) :\n                            formatCurrency(aggregateStats.total_actual_revenue || 0)\n                        }\n                    </p>\n                    <p className=\"text-sm text-blue-700 dark:text-blue-400\">\n                        From confirmed outcomes\n                    </p>\n                </div>\n\n                <div className=\"p-4 bg-orange-50 dark:bg-orange-900/20 rounded-lg border border-orange-200 dark:border-orange-800\">\n                    <div className=\"flex items-center gap-2 mb-2\">\n                        <Clock size={20} className=\"text-orange-600 dark:text-orange-400\" />\n                        <h3 className=\"font-semibold text-orange-900 dark:text-orange-200\">Timeline End</h3>\n                    </div>\n                    <p className=\"text-lg font-bold text-orange-600 dark:text-orange-300\">\n                        {stage3Data.timeline_end_date || 'N/A'}\n                    </p>\n                    <p className=\"text-sm text-orange-700 dark:text-orange-400\">\n                        Projection end date\n                    </p>\n                </div>\n            </div>\n\n            {/* Revenue Formula Explanation */}\n            <div className=\"mb-6\">\n                <div className=\"p-4 bg-gradient-to-r from-green-50 to-blue-50 dark:from-green-900/20 dark:to-blue-900/20 rounded-lg border border-green-200 dark:border-green-800\">\n                    <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white mb-3 flex items-center gap-2\">\n                        <Calculator size={20} className=\"text-green-600 dark:text-green-400\" />\n                        Revenue Calculation Using Event State Tracker\n                    </h3>\n                    \n                    <div className=\"bg-white dark:bg-gray-800 rounded-lg p-4 font-mono text-sm mb-4\">\n                        <div className=\"space-y-3\">\n                            <div className=\"text-center\">\n                                <div className=\"text-lg font-bold text-gray-900 dark:text-white mb-2\">\n                                    🔵 Pre-Outcome (Trial Pending)\n                                </div>\n                                <div className=\"text-base text-blue-600 dark:text-blue-400\">\n                                    estimated_revenue = conversion_probability × (1 - refund_rate) × price\n                                </div>\n                            </div>\n                            \n                            <div className=\"text-center\">\n                                <div className=\"text-lg font-bold text-gray-900 dark:text-white mb-2\">\n                                    🟢 Post-Conversion (Subscription Active)\n                                </div>\n                                <div className=\"text-base text-green-600 dark:text-green-400\">\n                                    revenue = price × (1 - current_refund_rate)\n                                </div>\n                                <div className=\"text-xs text-gray-500 dark:text-gray-400\">\n                                    current_refund_rate degrades linearly to 0% over 30 days\n                                </div>\n                            </div>\n                            \n                            <div className=\"text-center\">\n                                <div className=\"text-lg font-bold text-gray-900 dark:text-white mb-2\">\n                                    🔴 Post-Cancellation (Subscription Cancelled)\n                                </div>\n                                <div className=\"text-base text-red-600 dark:text-red-400\">\n                                    revenue = $0.00\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n\n                    <div className=\"text-sm text-gray-600 dark:text-gray-400\">\n                        <strong>📈 State Tracking:</strong> \n                        • Backend uses event_state_tracker.py for proper event state management\n                        • Trial states: started → pending → ended (converted/cancelled)\n                        • Subscription states: active → cancelled  \n                        • Revenue tracking includes actual event revenue and refunds\n                    </div>\n                </div>\n            </div>\n\n            {/* User & Segment Details - Full Width */}\n            <div className=\"mb-6 p-4 bg-gradient-to-r from-purple-50 to-indigo-50 dark:from-purple-900/20 dark:to-indigo-900/20 rounded-lg border border-purple-200 dark:border-purple-800\">\n                <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2\">\n                    <Target size={20} className=\"text-purple-600 dark:text-purple-400\" />\n                    User & Segment Details\n                </h3>\n                \n                {selectedUser ? (\n                    (() => {\n                        // --- START: REPLACEMENT LOGIC ---\n                        \n                        // Get the complete, consolidated data for the selected user\n                        const userEventsData = backendUserTimelinesEvents[selectedUser];\n\n                        // If there's no data for the selected user, show an error state.\n                        if (!userEventsData) {\n                            return <div className=\"text-red-500 text-center\">Error: No timeline event data found for user {selectedUser}.</div>;\n                        }\n\n                        // Extract segment info and properties directly from the new, correct data structure.\n                        const segmentInfo = userEventsData.segment_info || {};\n                        const userProperties = segmentInfo.user_properties || {};\n                        \n                        // Extract metrics directly from the segment info\n                        const effectiveSegmentMetrics = segmentInfo.conversion_metrics || {};\n\n                        // The rest of your display logic can now use these variables directly.\n                        // For example, to get the matched segment ID:\n                        const matchedSegmentId = segmentInfo.matched_segment_id || segmentInfo.segment_id;\n                        // To get the final segment ID after rollup:\n                        const finalSegmentId = segmentInfo.final_viable_segment_id || segmentInfo.segment_id;\n\n                        // To check if a rollup occurred:\n                        const hasActualRollup = matchedSegmentId && finalSegmentId && matchedSegmentId !== finalSegmentId;\n\n                        // Extract segment properties from the correct sources\n                        let matchedSegmentProperties = userProperties;\n                        let finalSegmentProperties = userProperties;\n                        let matchedLevel = 0;\n                        let matchedUserCount = effectiveSegmentMetrics.sample_size || effectiveSegmentMetrics.cohort_size || 'Unknown';\n                        let finalLevel = 0;\n                        let finalUserCount = matchedUserCount;\n\n                        // --- END: REPLACEMENT LOGIC ---\n                        \n                        return (\n                            <div className=\"space-y-4\">\n                                <div className=\"grid grid-cols-1 lg:grid-cols-5 gap-4\">\n                                    {/* Column 1: User ID + User Properties */}\n                                    <div className=\"bg-gray-800 text-white p-4 rounded-lg text-sm\">\n                                        <div className=\"font-mono text-xs mb-3 text-blue-300 break-all\">\n                                            {selectedUser}\n                                        </div>\n                                        <div className=\"text-xs text-gray-400 mb-3\">\n                                            Short: {selectedUser.substring(0, 8)}...\n                                        </div>\n                                        <div className=\"space-y-1 text-xs\">\n                                            <div><span className=\"text-gray-400\">Product:</span> {userProperties.product_id || 'N/A'}</div>\n                                            <div><span className=\"text-gray-400\">Store:</span> {userProperties.app_store || 'N/A'}</div>\n                                            <div><span className=\"text-gray-400\">Price:</span> {userProperties.price_bucket || 'N/A'}</div>\n                                            <div><span className=\"text-gray-400\">Country:</span> {userProperties.country || 'N/A'}</div>\n                                            <div><span className=\"text-gray-400\">Economic Tier:</span> {userProperties.economic_tier || 'N/A'}</div>\n                                            <div><span className=\"text-gray-400\">Region:</span> {userProperties.region || 'N/A'}</div>\n                                        </div>\n                                    </div>\n\n                                    {/* Column 2: Matched Segment (Initial) - Uses enhanced data when available */}\n                                    <div className=\"bg-gray-800 text-white p-4 rounded-lg text-sm\">\n                                        <div className=\"font-medium text-blue-300 mb-2 text-xs\">\n                                            ID: {matchedSegmentId ? matchedSegmentId.substring(0, 8) + '...' : 'Unknown'}\n                                        </div>\n                                        <div className=\"space-y-1 text-xs\">\n                                            <div><span className=\"text-gray-400\">Product:</span> {matchedSegmentProperties.product_id || 'N/A'}</div>\n                                            <div><span className=\"text-gray-400\">Store:</span> {matchedSegmentProperties.app_store || 'N/A'}</div>\n                                            <div><span className=\"text-gray-400\">Price:</span> {matchedSegmentProperties.price_bucket || 'N/A'}</div>\n                                            <div><span className=\"text-gray-400\">Country:</span> {matchedSegmentProperties.country || 'N/A'}</div>\n                                            <div><span className=\"text-gray-400\">Economic Tier:</span> {matchedSegmentProperties.economic_tier || 'N/A'}</div>\n                                            <div><span className=\"text-gray-400\">Region:</span> {matchedSegmentProperties.region || 'N/A'}</div>\n                                            <div><span className=\"text-gray-400\">Level:</span> {matchedLevel}</div>\n                                            <div><span className=\"text-gray-400\">Users:</span> {matchedUserCount}</div>\n                                        </div>\n                                    </div>\n\n                                    {/* Column 3: Target Segment (Final Segment) - Always show if we have segment data */}\n                                    <div className=\"bg-gray-800 text-white p-4 rounded-lg text-sm\">\n                                        {hasActualRollup ? (\n                                            <div>\n                                                <div className=\"font-medium text-green-300 mb-2 text-xs\">\n                                                    ID: {finalSegmentId ? finalSegmentId.substring(0, 8) + '...' : 'Unknown'}\n                                                </div>\n                                                <div className=\"space-y-1 text-xs\">\n                                                    <div><span className=\"text-gray-400\">Product:</span> {finalSegmentProperties.product_id || 'N/A'}</div>\n                                                    <div><span className=\"text-gray-400\">Store:</span> {finalSegmentProperties.app_store || 'N/A'}</div>\n                                                    <div><span className=\"text-gray-400\">Price:</span> {finalSegmentProperties.price_bucket || 'N/A'}</div>\n                                                    <div><span className=\"text-gray-400\">Country:</span> {finalSegmentProperties.country || 'N/A'}</div>\n                                                    <div><span className=\"text-gray-400\">Economic Tier:</span> {finalSegmentProperties.economic_tier || 'N/A'}</div>\n                                                    <div><span className=\"text-gray-400\">Region:</span> {finalSegmentProperties.region || 'N/A'}</div>\n                                                    <div><span className=\"text-gray-400\">Level:</span> {finalLevel}</div>\n                                                    <div><span className=\"text-gray-400\">Users:</span> {finalUserCount}</div>\n                                                </div>\n                                            </div>\n                                        ) : (\n                                            <div>\n                                                <div className=\"font-medium text-blue-300 mb-2 text-xs\">\n                                                    ID: {finalSegmentId ? finalSegmentId.substring(0, 8) + '...' : 'Same as matched'}\n                                                </div>\n                                                <div className=\"space-y-1 text-xs\">\n                                                    <div><span className=\"text-gray-400\">Product:</span> {finalSegmentProperties.product_id || 'N/A'}</div>\n                                                    <div><span className=\"text-gray-400\">Store:</span> {finalSegmentProperties.app_store || 'N/A'}</div>\n                                                    <div><span className=\"text-gray-400\">Price:</span> {finalSegmentProperties.price_bucket || 'N/A'}</div>\n                                                    <div><span className=\"text-gray-400\">Country:</span> {finalSegmentProperties.country || 'N/A'}</div>\n                                                    <div><span className=\"text-gray-400\">Economic Tier:</span> {finalSegmentProperties.economic_tier || 'N/A'}</div>\n                                                    <div><span className=\"text-gray-400\">Region:</span> {finalSegmentProperties.region || 'N/A'}</div>\n                                                    <div><span className=\"text-gray-400\">Level:</span> {finalLevel}</div>\n                                                    <div><span className=\"text-gray-400\">Users:</span> {finalUserCount}</div>\n                                                </div>\n                                                <div className=\"text-xs text-gray-500 mt-2 italic\">\n                                                    Direct match - no rollup applied\n                                                </div>\n                                            </div>\n                                        )}\n                                    </div>\n\n                                    {/* Column 4: 4 Key Metrics */}\n                                    <div className=\"bg-gray-800 text-white p-4 rounded-lg text-sm\">\n                                        <div className=\"space-y-2 text-xs\">\n                                            <div>\n                                                <span className=\"text-gray-400\">Trial Conv.:</span> \n                                                <span className=\"ml-1 text-green-300\">\n                                                    {((effectiveSegmentMetrics.trial_conversion_rate || 0) * 100).toFixed(1)}%\n                                                </span>\n                                            </div>\n                                            <div>\n                                                <span className=\"text-gray-400\">Refund:</span> \n                                                <span className=\"ml-1 text-red-300\">\n                                                    {((effectiveSegmentMetrics.trial_converted_to_refund_rate || 0) * 100).toFixed(1)}%\n                                                </span>\n                                            </div>\n                                            <div>\n                                                <span className=\"text-gray-400\">Init. Refund:</span> \n                                                <span className=\"ml-1 text-red-300\">\n                                                    {((effectiveSegmentMetrics.initial_purchase_to_refund_rate || 0) * 100).toFixed(1)}%\n                                                </span>\n                                            </div>\n                                            <div>\n                                                <span className=\"text-gray-400\">Renewal Refund:</span> \n                                                <span className=\"ml-1 text-red-300\">\n                                                    {((effectiveSegmentMetrics.renewal_to_refund_rate || 0) * 100).toFixed(1)}%\n                                                </span>\n                                            </div>\n                                            <div>\n                                                <span className=\"text-gray-400\">Sample size:</span> \n                                                <span className=\"ml-1 text-blue-300\">\n                                                    {finalUserCount}\n                                                </span>\n                                            </div>\n                                        </div>\n                                    </div>\n\n                                    {/* Column 5: Prediction Accuracy */}\n                                    <div className=\"bg-gray-800 text-white p-4 rounded-lg text-sm\">\n                                        <div className=\"text-center\">\n                                            <div className={`\n                                                px-3 py-2 rounded-full text-xs font-medium\n                                                ${segmentInfo.accuracy_score === 'high' ? 'bg-green-600 text-white' : \n                                                  segmentInfo.accuracy_score === 'medium' ? 'bg-yellow-600 text-white' : \n                                                  'bg-red-600 text-white'}\n                                            `}>\n                                                {(segmentInfo.accuracy_score || 'Unknown').toUpperCase()}\n                                            </div>\n                                            <div className=\"text-xs text-gray-400 mt-2\">\n                                                Prediction Accuracy\n                                            </div>\n                                        </div>\n                                    </div>\n                                </div>\n                            </div>\n                        );\n                    })()\n                ) : (\n                    <div className=\"text-gray-600 dark:text-gray-400 italic text-center py-8\">\n                        Select an individual user to view segment details\n                    </div>\n                )}\n            </div>\n\n            {/* Event Timeline Table - Uses backend data directly */}\n            {stage3Data && (\n                <div className=\"mb-6\">\n                    <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white mb-4\">\n                        {selectedUser ? `Revenue Timeline for User ${selectedUser.substring(0, 16)}...` : 'Aggregate Revenue Timeline'}\n                        {selectedUser && selectedProductId && (\n                            <span className=\"text-sm text-gray-500 dark:text-gray-400 ml-2\">\n                                (Product: {selectedProductId})\n                            </span>\n                        )}\n                    </h3>\n                    <EventTimelineTableV3 \n                        data={getTimelineTableData()} \n                        selectedUserId={selectedUser}\n                        selectedProductId={selectedProductId || (selectedUser ? userTimelines[selectedUser]?.user_properties?.product_id : null)}\n                    />\n                </div>\n            )}\n\n            {/* Stage 3 Error Display */}\n            {stage3Data.error && (\n                <div className=\"text-center py-8 bg-red-50 dark:bg-red-900/20 rounded-lg border border-red-200 dark:border-red-800\">\n                    <AlertCircle size={48} className=\"mx-auto text-red-400 mb-4\" />\n                    <p className=\"text-red-600 dark:text-red-400 mb-2\">\n                        Stage 3 Error: {stage3Data.error}\n                    </p>\n                </div>\n            )}\n\n            {/* No Data Message */}\n            {Object.keys(userTimelines).length === 0 && !stage3Data.error && (\n                <div className=\"text-center py-8 bg-gray-50 dark:bg-gray-700 rounded-lg\">\n                    <TrendingUp size={48} className=\"mx-auto text-gray-400 mb-4\" />\n                    <p className=\"text-gray-600 dark:text-gray-400 mb-2\">\n                        No revenue timeline data available\n                    </p>\n                    <p className=\"text-sm text-gray-500 dark:text-gray-500\">\n                        Run Stage 3 analysis to see revenue timeline projections\n                    </p>\n                </div>\n            )}\n        </div>\n    );\n};\n\nexport default Stage3RevenueResultsV3; "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}