{"ast":null,"code":"import _objectSpread from\"/Users/joshuakaufman/untitled folder 3/orchestrator/dashboard/client/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useEffect}from'react';import ProductFilterConfig from'../cohort-pipeline/components/ProductFilterConfig';import PipelineStageIndicator from'../cohort-pipeline/components/PipelineStageIndicator';import DebugDataViewer from'../cohort-pipeline/components/DebugDataViewer';import CohortFilteringStats from'../cohort-pipeline/components/CohortFilteringStats';import Stage2UserMatchingResults from'../cohort-pipeline/components/Stage2UserMatchingResults';import Stage3RevenueResultsV3 from'../cohort-pipeline/components/Stage3RevenueResultsV3';import{useDebugMode}from'../cohort-pipeline/hooks/useDebugMode';import{api}from'../services/api';import{Zap,TrendingUp,Target,Users,BarChart3,Settings,RefreshCcw,Download,Upload}from'lucide-react';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const CohortAnalyzerV3RefactoredPage=()=>{var _pipelineData$data2,_pipelineData$data4,_stageResults$stage,_stageResults$stage2,_stageResults$stage3,_stageResults$stage2$,_stageResults$stage2$2,_pipelineData$stage_r,_pipelineData$stage_r2;// Local storage key for saving state - different from old page\nconst STORAGE_KEY='cohort_v3_refactored_analysis_params';// Default analysis parameters - matching the working old page format\nconst defaultAnalysisParams={date_from:'2025-01-01',date_to:'2025-01-31',optional_filters:[],primary_user_filter:{property_name:'',property_values:[]},secondary_filters:[],config:{product_filter:{include_patterns:['gluten'],exclude_patterns:[],specific_product_ids:['prod_R7oYuL3bSUecnr']},lifecycle:{trial_window_days:7,cancellation_window_days:30,smoothing_enabled:true},timeline:{include_estimates:true,include_confidence_intervals:false},detailed_events:{user_id:''}}};// Function to load saved parameters from localStorage\nconst loadSavedParams=()=>{try{const saved=localStorage.getItem(STORAGE_KEY);if(saved){var _parsedParams$config,_parsedParams$config2,_parsedParams$config3,_parsedParams$config4;const parsedParams=JSON.parse(saved);return _objectSpread(_objectSpread(_objectSpread({},defaultAnalysisParams),parsedParams),{},{optional_filters:parsedParams.optional_filters||[],secondary_filters:parsedParams.secondary_filters||[],config:_objectSpread(_objectSpread(_objectSpread({},defaultAnalysisParams.config),parsedParams.config),{},{product_filter:_objectSpread(_objectSpread({},defaultAnalysisParams.config.product_filter),(_parsedParams$config=parsedParams.config)===null||_parsedParams$config===void 0?void 0:_parsedParams$config.product_filter),lifecycle:_objectSpread(_objectSpread({},defaultAnalysisParams.config.lifecycle),(_parsedParams$config2=parsedParams.config)===null||_parsedParams$config2===void 0?void 0:_parsedParams$config2.lifecycle),timeline:_objectSpread(_objectSpread({},defaultAnalysisParams.config.timeline),(_parsedParams$config3=parsedParams.config)===null||_parsedParams$config3===void 0?void 0:_parsedParams$config3.timeline),detailed_events:_objectSpread(_objectSpread({},defaultAnalysisParams.config.detailed_events),(_parsedParams$config4=parsedParams.config)===null||_parsedParams$config4===void 0?void 0:_parsedParams$config4.detailed_events)})});}}catch(error){console.warn('Failed to load saved analysis parameters:',error);}return defaultAnalysisParams;};// Function to save parameters to localStorage\nconst saveParams=params=>{try{localStorage.setItem(STORAGE_KEY,JSON.stringify(params));}catch(error){console.warn('Failed to save analysis parameters:',error);}};// State for analysis parameters - initialize with saved values\nconst[analysisParams,setAnalysisParams]=useState(loadSavedParams);const[saveIndicator,setSaveIndicator]=useState(false);// Save parameters whenever they change\nuseEffect(()=>{saveParams(analysisParams);setSaveIndicator(true);const timer=setTimeout(()=>setSaveIndicator(false),1000);return()=>clearTimeout(timer);},[analysisParams]);// Use the SAME hooks as the working old page\nconst{debugMode,debugStage,setDebugMode,setDebugStage}=useDebugMode();// V3-specific state management (isolated from V2)\nconst[pipelineData,setPipelineData]=useState(null);const[loading,setLoading]=useState(false);const[error,setError]=useState(null);// V3-specific API calls\nconst runV3Analysis=async params=>{setLoading(true);setError(null);try{console.log('[V3-Refactored] Running full V3 refactored analysis with params:',params);// Add warning for potentially large responses\nconst dateRange=new Date(params.date_to)-new Date(params.date_from);const daySpan=dateRange/(1000*60*60*24);if(daySpan>35){console.warn(\"[V3-Refactored] Large date range detected (\".concat(daySpan,\" days). Response may be very large.\"));}const result=await api.analyzeCohortDataV3Refactored(params);// Check response size and warn if large\nconst responseSize=JSON.stringify(result).length;console.log(\"[V3-Refactored] Response size: \".concat((responseSize/(1024*1024)).toFixed(2),\" MB\"));if(responseSize>50*1024*1024){// 50MB threshold\nconsole.warn('[V3-Refactored] Large response detected. Consider using debug mode to analyze stages individually.');setError('Response is very large (>50MB). Consider using debug mode to analyze stages individually, or reduce the date range.');return;}console.log('[V3-Refactored] Full analysis result:',result);setPipelineData(result);}catch(err){console.error('[V3-Refactored] Full analysis failed:',err);// Enhanced error handling for large responses\nif(err.message&&(err.message.includes('out of memory')||err.message.includes('Maximum call stack'))){setError('Analysis failed due to large dataset size. Please use debug mode to analyze stages individually or reduce the date range.');}else if(err.code==='ERR_INSUFFICIENT_RESOURCES'){setError('Browser ran out of memory processing the large response. Please use debug mode or reduce the date range.');}else{setError(err.message||'V3 refactored analysis failed');}}finally{setLoading(false);}};const runV3StageAnalysis=async(params,stage)=>{setLoading(true);setError(null);try{console.log(\"[V3-Refactored] ENTERING runV3StageAnalysis for stage: \".concat(stage));console.log(\"[V3-Refactored] Params being passed:\",params);console.log(\"[V3-Refactored] About to call api.runV3RefactoredStageAnalysis...\");const result=await api.runV3RefactoredStageAnalysis(params,stage);// Check response size\nconst responseSize=JSON.stringify(result).length;console.log(\"[V3-Refactored] Stage \".concat(stage,\" response size: \").concat((responseSize/(1024*1024)).toFixed(2),\" MB\"));console.log(\"[V3-Refactored] RECEIVED result from api.runV3RefactoredStageAnalysis:\",result);setPipelineData(result);}catch(err){console.error(\"[V3-Refactored] Stage \".concat(stage,\" analysis failed:\"),err);// Enhanced error handling\nif(err.message&&(err.message.includes('out of memory')||err.message.includes('Maximum call stack'))){setError(\"Stage \".concat(stage,\" analysis failed due to large dataset size. Please reduce the date range.\"));}else{setError(err.message||\"V3 refactored stage \".concat(stage,\" analysis failed\"));}}finally{setLoading(false);}};const handleParameterChange=newParams=>{setAnalysisParams(newParams);};const handleRunAnalysis=()=>{if(debugMode&&debugStage){console.log('[V3-Refactored DEBUG] Running stage analysis:',debugStage);runV3StageAnalysis(analysisParams,debugStage);}else{console.log('[V3-Refactored DEBUG] Running full analysis');runV3Analysis(analysisParams);}};const handleResetToDefaults=()=>{setAnalysisParams(defaultAnalysisParams);};const handleClearAllSavedData=()=>{localStorage.removeItem(STORAGE_KEY);setAnalysisParams(defaultAnalysisParams);};const handleExportSettings=()=>{const dataStr=JSON.stringify(analysisParams,null,2);const dataUri='data:application/json;charset=utf-8,'+encodeURIComponent(dataStr);const exportFileDefaultName=\"cohort-v3-refactored-config-\".concat(new Date().toISOString().split('T')[0],\".json\");const linkElement=document.createElement('a');linkElement.setAttribute('href',dataUri);linkElement.setAttribute('download',exportFileDefaultName);linkElement.click();};const handleImportSettings=event=>{const file=event.target.files[0];if(file){const reader=new FileReader();reader.onload=e=>{try{const importedParams=JSON.parse(e.target.result);const mergedParams=_objectSpread(_objectSpread(_objectSpread({},defaultAnalysisParams),importedParams),{},{config:_objectSpread(_objectSpread({},defaultAnalysisParams.config),importedParams.config)});setAnalysisParams(mergedParams);}catch(error){console.error('Failed to import settings:',error);// Note: setError is now handled by usePipelineData hook, not available here\n}};reader.readAsText(file);}event.target.value='';};// Get stage-specific results for display (V3 Refactored format)\nconst getStageResults=stageId=>{var _pipelineData$data;// Handle both direct format (pipelineData.stage_results) and nested format (pipelineData.data.stage_results)\nconst stageResults=(pipelineData===null||pipelineData===void 0?void 0:pipelineData.stage_results)||(pipelineData===null||pipelineData===void 0?void 0:(_pipelineData$data=pipelineData.data)===null||_pipelineData$data===void 0?void 0:_pipelineData$data.stage_results);if(!stageResults)return null;return stageResults[stageId]||null;};// Check stage progress (V3 Refactored format)\n// Handle both direct format (pipelineData.stage_results) and nested format (pipelineData.data.stage_results)\nconst stageResults=(pipelineData===null||pipelineData===void 0?void 0:pipelineData.stage_results)||(pipelineData===null||pipelineData===void 0?void 0:(_pipelineData$data2=pipelineData.data)===null||_pipelineData$data2===void 0?void 0:_pipelineData$data2.stage_results);const stageProgress={stage1:!!(stageResults!==null&&stageResults!==void 0&&stageResults.stage1&&!stageResults.stage1.error),stage2:!!(stageResults!==null&&stageResults!==void 0&&stageResults.stage2&&!stageResults.stage2.error),stage3:!!(stageResults!==null&&stageResults!==void 0&&stageResults.stage3&&!stageResults.stage3.error)};// Debug: Log the actual data structure we're receiving\nuseEffect(()=>{if(pipelineData){var _pipelineData$data3;console.log('üîç [DEBUG] pipelineData structure:',pipelineData);console.log('üîç [DEBUG] pipelineData.stage_results (direct):',pipelineData.stage_results);console.log('üîç [DEBUG] pipelineData.data.stage_results (nested):',(_pipelineData$data3=pipelineData.data)===null||_pipelineData$data3===void 0?void 0:_pipelineData$data3.stage_results);console.log('üîç [DEBUG] computed stageResults:',stageResults);console.log('üîç [DEBUG] stageProgress:',stageProgress);console.log('üîç [DEBUG] Keys in pipelineData:',Object.keys(pipelineData));// Check specific stage results\nif(stageResults){console.log('üîç [DEBUG] Stage results keys:',Object.keys(stageResults));console.log('üîç [DEBUG] Stage 1 data:',stageResults.stage1);console.log('üîç [DEBUG] Stage 2 data:',stageResults.stage2);console.log('üîç [DEBUG] Stage 3 data:',stageResults.stage3);}// Check for alternative data locations\nif(pipelineData.data){console.log('üîç [DEBUG] Data keys:',Object.keys(pipelineData.data));}}else{console.log('üîç [DEBUG] No pipelineData available');}},[pipelineData,stageResults,stageProgress]);return/*#__PURE__*/_jsx(\"div\",{className:\"min-h-screen bg-gray-50 dark:bg-gray-900\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"container mx-auto px-4 py-8\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"mb-8\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h1\",{className:\"text-3xl font-bold text-gray-900 dark:text-white mb-2\",children:\"Cohort Pipeline V3 - Refactored Architecture\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-600 dark:text-gray-400\",children:\"3-stage conversion probability-based cohort analysis with segment matching and revenue timeline generation\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-2\",children:[saveIndicator&&/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-1 text-green-600 dark:text-green-400 text-sm\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"\\uD83D\\uDCBE\"}),/*#__PURE__*/_jsx(\"span\",{children:\"Saved\"})]}),/*#__PURE__*/_jsx(\"button\",{onClick:handleResetToDefaults,className:\"px-3 py-2 text-sm bg-gray-200 hover:bg-gray-300 dark:bg-gray-700 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 rounded-lg transition-colors\",title:\"Reset all settings to defaults\",children:\"Reset to Defaults\"}),/*#__PURE__*/_jsx(\"button\",{onClick:handleClearAllSavedData,className:\"px-3 py-2 text-sm bg-red-200 hover:bg-red-300 dark:bg-red-700 dark:hover:bg-red-600 text-red-700 dark:text-red-300 rounded-lg transition-colors\",title:\"Clear all saved data including debug state\",children:\"Clear All Data\"}),/*#__PURE__*/_jsx(\"button\",{onClick:handleExportSettings,className:\"px-3 py-2 text-sm bg-blue-200 hover:bg-blue-300 dark:bg-blue-700 dark:hover:bg-blue-600 text-blue-700 dark:text-blue-300 rounded-lg transition-colors\",title:\"Export current settings to JSON file\",children:\"Export Settings\"}),/*#__PURE__*/_jsxs(\"label\",{className:\"px-3 py-2 text-sm bg-green-200 hover:bg-green-300 dark:bg-green-700 dark:hover:bg-green-600 text-green-700 dark:text-green-300 rounded-lg transition-colors cursor-pointer\",children:[\"Import Settings\",/*#__PURE__*/_jsx(\"input\",{type:\"file\",accept:\".json\",onChange:handleImportSettings,className:\"hidden\"})]})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"mt-2 text-xs text-gray-500 dark:text-gray-400\",children:\"\\uD83D\\uDCBE Settings are automatically saved and will persist across page reloads\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"mb-8\",children:/*#__PURE__*/_jsx(\"div\",{className:\"bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-6\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between mb-6\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-lg font-semibold text-gray-900 dark:text-white\",children:\"V3 Refactored Pipeline Controls\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-4\",children:[/*#__PURE__*/_jsxs(\"label\",{className:\"flex items-center space-x-2\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"checkbox\",checked:debugMode,onChange:e=>setDebugMode(e.target.checked),className:\"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600\"}),/*#__PURE__*/_jsx(\"span\",{className:\"text-sm font-medium text-gray-900 dark:text-gray-300\",children:\"Debug Mode\"})]}),debugMode&&/*#__PURE__*/_jsxs(\"select\",{value:debugStage||'',onChange:e=>setDebugStage(e.target.value||null),className:\"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"Select stage...\"}),/*#__PURE__*/_jsx(\"option\",{value:\"stage1\",children:\"Stage 1: User Properties Input\"}),/*#__PURE__*/_jsx(\"option\",{value:\"stage2\",children:\"Stage 2: Segment Matching\"}),/*#__PURE__*/_jsx(\"option\",{value:\"stage3\",children:\"Stage 3: Revenue Timeline\"})]}),/*#__PURE__*/_jsx(\"button\",{onClick:handleRunAnalysis,disabled:loading,className:\"px-4 py-2 rounded-lg font-medium transition-colors \".concat(loading?'bg-gray-300 text-gray-500 cursor-not-allowed':'bg-blue-600 hover:bg-blue-700 text-white'),children:loading?'Running...':'Run Analysis'})]})]})})}),/*#__PURE__*/_jsxs(\"div\",{className:\"mb-8\",children:[/*#__PURE__*/_jsx(ProductFilterConfig,{config:analysisParams.config,analysisParams:analysisParams,onConfigChange:handleParameterChange}),(()=>{const dateRange=new Date(analysisParams.date_to)-new Date(analysisParams.date_from);const daySpan=dateRange/(1000*60*60*24);if(daySpan>35){return/*#__PURE__*/_jsx(\"div\",{className:\"mt-4 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-4\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-start gap-3\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-yellow-600 dark:text-yellow-400\",children:\"\\u26A0\\uFE0F\"}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-yellow-800 dark:text-yellow-200 font-semibold mb-2\",children:\"Large Date Range Detected\"}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-yellow-700 dark:text-yellow-300 text-sm mb-2\",children:[\"You've selected a \",Math.round(daySpan),\" day range. This may result in a very large response (\",'>',\"500MB) that could crash your browser.\"]}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-yellow-700 dark:text-yellow-300 text-sm\",children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Recommendations:\"}),/*#__PURE__*/_jsxs(\"ul\",{className:\"list-disc list-inside mt-1 space-y-1\",children:[/*#__PURE__*/_jsxs(\"li\",{children:[\"Use \",/*#__PURE__*/_jsx(\"strong\",{children:\"Debug Mode\"}),\" to analyze stages individually\"]}),/*#__PURE__*/_jsx(\"li\",{children:\"Reduce your date range to 30 days or less\"}),/*#__PURE__*/_jsx(\"li\",{children:\"Consider analyzing individual months separately\"})]})]})]})]})});}return null;})()]}),loading&&/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-center items-center py-12\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"ml-3\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-lg text-gray-600 dark:text-gray-400\",children:\"Running V3 refactored analysis...\"}),(()=>{const dateRange=new Date(analysisParams.date_to)-new Date(analysisParams.date_from);const daySpan=dateRange/(1000*60*60*24);if(daySpan>35){return/*#__PURE__*/_jsx(\"div\",{className:\"text-sm text-yellow-600 dark:text-yellow-400 mt-1\",children:\"\\u26A0\\uFE0F Large date range detected - this may take several minutes and could fail due to browser memory limits\"});}return null;})()]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-6\",children:[error&&/*#__PURE__*/_jsxs(\"div\",{className:\"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-red-800 dark:text-red-200 font-semibold mb-2\",children:\"Analysis Error\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-red-700 dark:text-red-300\",children:error})]}),pipelineData&&/*#__PURE__*/_jsxs(\"div\",{className:\"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-blue-800 dark:text-blue-200 font-semibold mb-2\",children:\"Debug: V3 Refactored API Data Structure\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-sm text-blue-700 dark:text-blue-300 space-y-1\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[\"Has pipelineData: \",pipelineData?'‚úÖ':'‚ùå']}),/*#__PURE__*/_jsxs(\"div\",{children:[\"Has stage_results (direct): \",pipelineData!==null&&pipelineData!==void 0&&pipelineData.stage_results?'‚úÖ':'‚ùå']}),/*#__PURE__*/_jsxs(\"div\",{children:[\"Has stage_results (nested): \",pipelineData!==null&&pipelineData!==void 0&&(_pipelineData$data4=pipelineData.data)!==null&&_pipelineData$data4!==void 0&&_pipelineData$data4.stage_results?'‚úÖ':'‚ùå']}),/*#__PURE__*/_jsxs(\"div\",{children:[\"Stage 1 Complete: \",stageProgress.stage1?'‚úÖ':'‚ùå']}),/*#__PURE__*/_jsxs(\"div\",{children:[\"Stage 2 Complete: \",stageProgress.stage2?'‚úÖ':'‚ùå']}),/*#__PURE__*/_jsxs(\"div\",{children:[\"Stage 3 Complete: \",stageProgress.stage3?'‚úÖ':'‚ùå']}),(stageResults===null||stageResults===void 0?void 0:(_stageResults$stage=stageResults.stage1)===null||_stageResults$stage===void 0?void 0:_stageResults$stage.error)&&/*#__PURE__*/_jsxs(\"div\",{className:\"text-red-600 dark:text-red-400\",children:[\"Stage 1 Error: \",stageResults.stage1.error]}),(stageResults===null||stageResults===void 0?void 0:(_stageResults$stage2=stageResults.stage2)===null||_stageResults$stage2===void 0?void 0:_stageResults$stage2.error)&&/*#__PURE__*/_jsxs(\"div\",{className:\"text-red-600 dark:text-red-400\",children:[\"Stage 2 Error: \",stageResults.stage2.error]}),(stageResults===null||stageResults===void 0?void 0:(_stageResults$stage3=stageResults.stage3)===null||_stageResults$stage3===void 0?void 0:_stageResults$stage3.error)&&/*#__PURE__*/_jsxs(\"div\",{className:\"text-red-600 dark:text-red-400\",children:[\"Stage 3 Error: \",stageResults.stage3.error]}),/*#__PURE__*/_jsxs(\"div\",{children:[\"Main data keys: \",pipelineData?Object.keys(pipelineData).join(', '):'None']}),stageResults&&/*#__PURE__*/_jsxs(\"div\",{children:[\"Stage results keys: \",Object.keys(stageResults).join(', ')]}),(stageResults===null||stageResults===void 0?void 0:stageResults.stage1)&&/*#__PURE__*/_jsxs(\"div\",{children:[\"Stage 1 users: \",stageResults.stage1.total_users||stageResults.stage1.cohort_size||'N/A']}),(stageResults===null||stageResults===void 0?void 0:stageResults.stage2)&&/*#__PURE__*/_jsxs(\"div\",{children:[\"Stage 2 matches: \",((_stageResults$stage2$=stageResults.stage2.matching_stats)===null||_stageResults$stage2$===void 0?void 0:_stageResults$stage2$.successful_matches)||0,\"/\",((_stageResults$stage2$2=stageResults.stage2.matching_stats)===null||_stageResults$stage2$2===void 0?void 0:_stageResults$stage2$2.total_users)||0]})]})]}),pipelineData&&/*#__PURE__*/_jsxs(_Fragment,{children:[stageProgress.stage1&&/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-2 mb-4\",children:[/*#__PURE__*/_jsx(Zap,{size:24,className:\"text-blue-600 dark:text-blue-400\"}),/*#__PURE__*/_jsx(\"h2\",{className:\"text-2xl font-bold text-gray-900 dark:text-white\",children:\"Stage 1: User Properties Input - Complete\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-3 gap-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-800\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"font-semibold text-blue-900 dark:text-blue-200\",children:\"Total Users Found\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-2xl font-bold text-blue-600 dark:text-blue-300\",children:((_pipelineData$stage_r=pipelineData.stage_results)===null||_pipelineData$stage_r===void 0?void 0:(_pipelineData$stage_r2=_pipelineData$stage_r.stage1)===null||_pipelineData$stage_r2===void 0?void 0:_pipelineData$stage_r2.total_users)||0})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"p-4 bg-green-50 dark:bg-green-900/20 rounded-lg border border-green-200 dark:border-green-800\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"font-semibold text-green-900 dark:text-green-200\",children:\"Date Range\"}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-sm font-medium text-green-600 dark:text-green-300\",children:[analysisParams.date_from,\" to \",analysisParams.date_to]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"p-4 bg-purple-50 dark:bg-purple-900/20 rounded-lg border border-purple-200 dark:border-purple-800\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"font-semibold text-purple-900 dark:text-purple-200\",children:\"Stage Status\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-sm font-medium text-purple-600 dark:text-purple-300\",children:\"\\u2705 User Cohort Extracted\"})]})]})]}),stageProgress.stage2&&/*#__PURE__*/_jsx(Stage2UserMatchingResults,{data:pipelineData}),stageProgress.stage3&&/*#__PURE__*/_jsx(Stage3RevenueResultsV3,{data:pipelineData})]}),debugMode&&pipelineData&&/*#__PURE__*/_jsx(DebugDataViewer,{data:pipelineData,stage:debugStage,title:\"V3 Refactored Pipeline Debug Data\"})]})]})});};export default CohortAnalyzerV3RefactoredPage;","map":{"version":3,"names":["React","useState","useEffect","ProductFilterConfig","PipelineStageIndicator","DebugDataViewer","CohortFilteringStats","Stage2UserMatchingResults","Stage3RevenueResultsV3","useDebugMode","api","Zap","TrendingUp","Target","Users","BarChart3","Settings","RefreshCcw","Download","Upload","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","CohortAnalyzerV3RefactoredPage","_pipelineData$data2","_pipelineData$data4","_stageResults$stage","_stageResults$stage2","_stageResults$stage3","_stageResults$stage2$","_stageResults$stage2$2","_pipelineData$stage_r","_pipelineData$stage_r2","STORAGE_KEY","defaultAnalysisParams","date_from","date_to","optional_filters","primary_user_filter","property_name","property_values","secondary_filters","config","product_filter","include_patterns","exclude_patterns","specific_product_ids","lifecycle","trial_window_days","cancellation_window_days","smoothing_enabled","timeline","include_estimates","include_confidence_intervals","detailed_events","user_id","loadSavedParams","saved","localStorage","getItem","_parsedParams$config","_parsedParams$config2","_parsedParams$config3","_parsedParams$config4","parsedParams","JSON","parse","_objectSpread","error","console","warn","saveParams","params","setItem","stringify","analysisParams","setAnalysisParams","saveIndicator","setSaveIndicator","timer","setTimeout","clearTimeout","debugMode","debugStage","setDebugMode","setDebugStage","pipelineData","setPipelineData","loading","setLoading","setError","runV3Analysis","log","dateRange","Date","daySpan","concat","result","analyzeCohortDataV3Refactored","responseSize","length","toFixed","err","message","includes","code","runV3StageAnalysis","stage","runV3RefactoredStageAnalysis","handleParameterChange","newParams","handleRunAnalysis","handleResetToDefaults","handleClearAllSavedData","removeItem","handleExportSettings","dataStr","dataUri","encodeURIComponent","exportFileDefaultName","toISOString","split","linkElement","document","createElement","setAttribute","click","handleImportSettings","event","file","target","files","reader","FileReader","onload","e","importedParams","mergedParams","readAsText","value","getStageResults","stageId","_pipelineData$data","stageResults","stage_results","data","stageProgress","stage1","stage2","stage3","_pipelineData$data3","Object","keys","className","children","onClick","title","type","accept","onChange","checked","disabled","onConfigChange","Math","round","join","total_users","cohort_size","matching_stats","successful_matches","size"],"sources":["/Users/joshuakaufman/untitled folder 3/orchestrator/dashboard/client/src/pages/CohortAnalyzerV3RefactoredPage.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport ProductFilterConfig from '../cohort-pipeline/components/ProductFilterConfig';\nimport PipelineStageIndicator from '../cohort-pipeline/components/PipelineStageIndicator';\nimport DebugDataViewer from '../cohort-pipeline/components/DebugDataViewer';\nimport CohortFilteringStats from '../cohort-pipeline/components/CohortFilteringStats';\nimport Stage2UserMatchingResults from '../cohort-pipeline/components/Stage2UserMatchingResults';\nimport Stage3RevenueResultsV3 from '../cohort-pipeline/components/Stage3RevenueResultsV3';\nimport { useDebugMode } from '../cohort-pipeline/hooks/useDebugMode';\nimport { api } from '../services/api';\nimport { Zap, TrendingUp, Target, Users, BarChart3, Settings, RefreshCcw, Download, Upload } from 'lucide-react';\n\nconst CohortAnalyzerV3RefactoredPage = () => {\n    // Local storage key for saving state - different from old page\n    const STORAGE_KEY = 'cohort_v3_refactored_analysis_params';\n    \n    // Default analysis parameters - matching the working old page format\n    const defaultAnalysisParams = {\n        date_from: '2025-01-01',\n        date_to: '2025-01-31',\n        optional_filters: [],\n        primary_user_filter: {\n            property_name: '',\n            property_values: []\n        },\n        secondary_filters: [],\n        config: {\n            product_filter: {\n                include_patterns: ['gluten'],\n                exclude_patterns: [],\n                specific_product_ids: ['prod_R7oYuL3bSUecnr']\n            },\n            lifecycle: {\n                trial_window_days: 7,\n                cancellation_window_days: 30,\n                smoothing_enabled: true\n            },\n            timeline: {\n                include_estimates: true,\n                include_confidence_intervals: false\n            },\n            detailed_events: {\n                user_id: ''\n            }\n        }\n    };\n\n    // Function to load saved parameters from localStorage\n    const loadSavedParams = () => {\n        try {\n            const saved = localStorage.getItem(STORAGE_KEY);\n            if (saved) {\n                const parsedParams = JSON.parse(saved);\n                return {\n                    ...defaultAnalysisParams,\n                    ...parsedParams,\n                    optional_filters: parsedParams.optional_filters || [],\n                    secondary_filters: parsedParams.secondary_filters || [],\n                    config: {\n                        ...defaultAnalysisParams.config,\n                        ...parsedParams.config,\n                        product_filter: {\n                            ...defaultAnalysisParams.config.product_filter,\n                            ...parsedParams.config?.product_filter\n                        },\n                        lifecycle: {\n                            ...defaultAnalysisParams.config.lifecycle,\n                            ...parsedParams.config?.lifecycle\n                        },\n                        timeline: {\n                            ...defaultAnalysisParams.config.timeline,\n                            ...parsedParams.config?.timeline\n                        },\n                        detailed_events: {\n                            ...defaultAnalysisParams.config.detailed_events,\n                            ...parsedParams.config?.detailed_events\n                        }\n                    }\n                };\n            }\n        } catch (error) {\n            console.warn('Failed to load saved analysis parameters:', error);\n        }\n        return defaultAnalysisParams;\n    };\n\n    // Function to save parameters to localStorage\n    const saveParams = (params) => {\n        try {\n            localStorage.setItem(STORAGE_KEY, JSON.stringify(params));\n        } catch (error) {\n            console.warn('Failed to save analysis parameters:', error);\n        }\n    };\n\n    // State for analysis parameters - initialize with saved values\n    const [analysisParams, setAnalysisParams] = useState(loadSavedParams);\n    const [saveIndicator, setSaveIndicator] = useState(false);\n\n    // Save parameters whenever they change\n    useEffect(() => {\n        saveParams(analysisParams);\n        setSaveIndicator(true);\n        const timer = setTimeout(() => setSaveIndicator(false), 1000);\n        return () => clearTimeout(timer);\n    }, [analysisParams]);\n\n    // Use the SAME hooks as the working old page\n    const { \n        debugMode, \n        debugStage, \n        setDebugMode, \n        setDebugStage \n    } = useDebugMode();\n\n    // V3-specific state management (isolated from V2)\n    const [pipelineData, setPipelineData] = useState(null);\n    const [loading, setLoading] = useState(false);\n    const [error, setError] = useState(null);\n    \n    // V3-specific API calls\n    const runV3Analysis = async (params) => {\n        setLoading(true);\n        setError(null);\n        try {\n            console.log('[V3-Refactored] Running full V3 refactored analysis with params:', params);\n            \n            // Add warning for potentially large responses\n            const dateRange = new Date(params.date_to) - new Date(params.date_from);\n            const daySpan = dateRange / (1000 * 60 * 60 * 24);\n            \n            if (daySpan > 35) {\n                console.warn(`[V3-Refactored] Large date range detected (${daySpan} days). Response may be very large.`);\n            }\n            \n            const result = await api.analyzeCohortDataV3Refactored(params);\n            \n            // Check response size and warn if large\n            const responseSize = JSON.stringify(result).length;\n            console.log(`[V3-Refactored] Response size: ${(responseSize / (1024 * 1024)).toFixed(2)} MB`);\n            \n            if (responseSize > 50 * 1024 * 1024) { // 50MB threshold\n                console.warn('[V3-Refactored] Large response detected. Consider using debug mode to analyze stages individually.');\n                setError('Response is very large (>50MB). Consider using debug mode to analyze stages individually, or reduce the date range.');\n                return;\n            }\n            \n            console.log('[V3-Refactored] Full analysis result:', result);\n            setPipelineData(result);\n        } catch (err) {\n            console.error('[V3-Refactored] Full analysis failed:', err);\n            \n            // Enhanced error handling for large responses\n            if (err.message && (err.message.includes('out of memory') || err.message.includes('Maximum call stack'))) {\n                setError('Analysis failed due to large dataset size. Please use debug mode to analyze stages individually or reduce the date range.');\n            } else if (err.code === 'ERR_INSUFFICIENT_RESOURCES') {\n                setError('Browser ran out of memory processing the large response. Please use debug mode or reduce the date range.');\n            } else {\n                setError(err.message || 'V3 refactored analysis failed');\n            }\n        } finally {\n            setLoading(false);\n        }\n    };\n    \n    const runV3StageAnalysis = async (params, stage) => {\n        setLoading(true);\n        setError(null);\n        try {\n            console.log(`[V3-Refactored] ENTERING runV3StageAnalysis for stage: ${stage}`);\n            console.log(`[V3-Refactored] Params being passed:`, params);\n            console.log(`[V3-Refactored] About to call api.runV3RefactoredStageAnalysis...`);\n            \n            const result = await api.runV3RefactoredStageAnalysis(params, stage);\n            \n            // Check response size\n            const responseSize = JSON.stringify(result).length;\n            console.log(`[V3-Refactored] Stage ${stage} response size: ${(responseSize / (1024 * 1024)).toFixed(2)} MB`);\n            \n            console.log(`[V3-Refactored] RECEIVED result from api.runV3RefactoredStageAnalysis:`, result);\n            setPipelineData(result);\n        } catch (err) {\n            console.error(`[V3-Refactored] Stage ${stage} analysis failed:`, err);\n            \n            // Enhanced error handling\n            if (err.message && (err.message.includes('out of memory') || err.message.includes('Maximum call stack'))) {\n                setError(`Stage ${stage} analysis failed due to large dataset size. Please reduce the date range.`);\n            } else {\n                setError(err.message || `V3 refactored stage ${stage} analysis failed`);\n            }\n        } finally {\n            setLoading(false);\n        }\n    };\n\n    const handleParameterChange = (newParams) => {\n        setAnalysisParams(newParams);\n    };\n\n    const handleRunAnalysis = () => {\n        if (debugMode && debugStage) {\n            console.log('[V3-Refactored DEBUG] Running stage analysis:', debugStage);\n            runV3StageAnalysis(analysisParams, debugStage);\n        } else {\n            console.log('[V3-Refactored DEBUG] Running full analysis');\n            runV3Analysis(analysisParams);\n        }\n    };\n\n    const handleResetToDefaults = () => {\n        setAnalysisParams(defaultAnalysisParams);\n    };\n\n    const handleClearAllSavedData = () => {\n        localStorage.removeItem(STORAGE_KEY);\n        setAnalysisParams(defaultAnalysisParams);\n    };\n\n    const handleExportSettings = () => {\n        const dataStr = JSON.stringify(analysisParams, null, 2);\n        const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);\n        const exportFileDefaultName = `cohort-v3-refactored-config-${new Date().toISOString().split('T')[0]}.json`;\n        \n        const linkElement = document.createElement('a');\n        linkElement.setAttribute('href', dataUri);\n        linkElement.setAttribute('download', exportFileDefaultName);\n        linkElement.click();\n    };\n\n    const handleImportSettings = (event) => {\n        const file = event.target.files[0];\n        if (file) {\n            const reader = new FileReader();\n            reader.onload = (e) => {\n                try {\n                    const importedParams = JSON.parse(e.target.result);\n                    const mergedParams = {\n                        ...defaultAnalysisParams,\n                        ...importedParams,\n                        config: {\n                            ...defaultAnalysisParams.config,\n                            ...importedParams.config\n                        }\n                    };\n                    setAnalysisParams(mergedParams);\n                } catch (error) {\n                    console.error('Failed to import settings:', error);\n                    // Note: setError is now handled by usePipelineData hook, not available here\n                }\n            };\n            reader.readAsText(file);\n        }\n        event.target.value = '';\n    };\n\n    // Get stage-specific results for display (V3 Refactored format)\n    const getStageResults = (stageId) => {\n        // Handle both direct format (pipelineData.stage_results) and nested format (pipelineData.data.stage_results)\n        const stageResults = pipelineData?.stage_results || pipelineData?.data?.stage_results;\n        if (!stageResults) return null;\n        \n        return stageResults[stageId] || null;\n    };\n\n    // Check stage progress (V3 Refactored format)\n    // Handle both direct format (pipelineData.stage_results) and nested format (pipelineData.data.stage_results)\n    const stageResults = pipelineData?.stage_results || pipelineData?.data?.stage_results;\n    \n    const stageProgress = {\n        stage1: !!(stageResults?.stage1 && !stageResults.stage1.error),\n        stage2: !!(stageResults?.stage2 && !stageResults.stage2.error),\n        stage3: !!(stageResults?.stage3 && !stageResults.stage3.error)\n    };\n\n    // Debug: Log the actual data structure we're receiving\n    useEffect(() => {\n        if (pipelineData) {\n            console.log('üîç [DEBUG] pipelineData structure:', pipelineData);\n            console.log('üîç [DEBUG] pipelineData.stage_results (direct):', pipelineData.stage_results);\n            console.log('üîç [DEBUG] pipelineData.data.stage_results (nested):', pipelineData.data?.stage_results);\n            console.log('üîç [DEBUG] computed stageResults:', stageResults);\n            console.log('üîç [DEBUG] stageProgress:', stageProgress);\n            console.log('üîç [DEBUG] Keys in pipelineData:', Object.keys(pipelineData));\n            \n            // Check specific stage results\n            if (stageResults) {\n                console.log('üîç [DEBUG] Stage results keys:', Object.keys(stageResults));\n                console.log('üîç [DEBUG] Stage 1 data:', stageResults.stage1);\n                console.log('üîç [DEBUG] Stage 2 data:', stageResults.stage2);\n                console.log('üîç [DEBUG] Stage 3 data:', stageResults.stage3);\n            }\n            \n            // Check for alternative data locations\n            if (pipelineData.data) {\n                console.log('üîç [DEBUG] Data keys:', Object.keys(pipelineData.data));\n            }\n        } else {\n            console.log('üîç [DEBUG] No pipelineData available');\n        }\n    }, [pipelineData, stageResults, stageProgress]);\n\n    return (\n        <div className=\"min-h-screen bg-gray-50 dark:bg-gray-900\">\n            <div className=\"container mx-auto px-4 py-8\">\n                {/* Header - matching CohortPipelineDebugPage.js style */}\n                <div className=\"mb-8\">\n                    <div className=\"flex items-center justify-between\">\n                        <div>\n                            <h1 className=\"text-3xl font-bold text-gray-900 dark:text-white mb-2\">\n                                Cohort Pipeline V3 - Refactored Architecture\n                            </h1>\n                            <p className=\"text-gray-600 dark:text-gray-400\">\n                                3-stage conversion probability-based cohort analysis with segment matching and revenue timeline generation\n                            </p>\n                        </div>\n                        \n                        {/* Settings Management - matching CohortPipelineDebugPage.js */}\n                        <div className=\"flex items-center space-x-2\">\n                            {saveIndicator && (\n                                <div className=\"flex items-center space-x-1 text-green-600 dark:text-green-400 text-sm\">\n                                    <span>üíæ</span>\n                                    <span>Saved</span>\n                                </div>\n                            )}\n                            \n                            <button\n                                onClick={handleResetToDefaults}\n                                className=\"px-3 py-2 text-sm bg-gray-200 hover:bg-gray-300 dark:bg-gray-700 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 rounded-lg transition-colors\"\n                                title=\"Reset all settings to defaults\"\n                            >\n                                Reset to Defaults\n                            </button>\n                            \n                            <button\n                                onClick={handleClearAllSavedData}\n                                className=\"px-3 py-2 text-sm bg-red-200 hover:bg-red-300 dark:bg-red-700 dark:hover:bg-red-600 text-red-700 dark:text-red-300 rounded-lg transition-colors\"\n                                title=\"Clear all saved data including debug state\"\n                            >\n                                Clear All Data\n                            </button>\n                            \n                            <button\n                                onClick={handleExportSettings}\n                                className=\"px-3 py-2 text-sm bg-blue-200 hover:bg-blue-300 dark:bg-blue-700 dark:hover:bg-blue-600 text-blue-700 dark:text-blue-300 rounded-lg transition-colors\"\n                                title=\"Export current settings to JSON file\"\n                            >\n                                Export Settings\n                            </button>\n                            \n                            <label className=\"px-3 py-2 text-sm bg-green-200 hover:bg-green-300 dark:bg-green-700 dark:hover:bg-green-600 text-green-700 dark:text-green-300 rounded-lg transition-colors cursor-pointer\">\n                                Import Settings\n                                <input\n                                    type=\"file\"\n                                    accept=\".json\"\n                                    onChange={handleImportSettings}\n                                    className=\"hidden\"\n                                />\n                            </label>\n                        </div>\n                    </div>\n                    \n                    {/* Auto-save indicator - matching CohortPipelineDebugPage.js */}\n                    <div className=\"mt-2 text-xs text-gray-500 dark:text-gray-400\">\n                        üíæ Settings are automatically saved and will persist across page reloads\n                    </div>\n                </div>\n\n                {/* Debug Controls Section - matching CohortPipelineDebugPage.js approach */}\n                <div className=\"mb-8\">\n                    <div className=\"bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-6\">\n                        <div className=\"flex items-center justify-between mb-6\">\n                            <h2 className=\"text-lg font-semibold text-gray-900 dark:text-white\">\n                                V3 Refactored Pipeline Controls\n                            </h2>\n                            \n                            {/* Debug Mode Toggle */}\n                            <div className=\"flex items-center space-x-4\">\n                                <label className=\"flex items-center space-x-2\">\n                                    <input\n                                        type=\"checkbox\"\n                                        checked={debugMode}\n                                        onChange={(e) => setDebugMode(e.target.checked)}\n                                        className=\"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600\"\n                                    />\n                                    <span className=\"text-sm font-medium text-gray-900 dark:text-gray-300\">\n                                        Debug Mode\n                                    </span>\n                                </label>\n                                \n                                {debugMode && (\n                                    <select\n                                        value={debugStage || ''}\n                                        onChange={(e) => setDebugStage(e.target.value || null)}\n                                        className=\"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white\"\n                                    >\n                                        <option value=\"\">Select stage...</option>\n                                        <option value=\"stage1\">Stage 1: User Properties Input</option>\n                                        <option value=\"stage2\">Stage 2: Segment Matching</option>\n                                        <option value=\"stage3\">Stage 3: Revenue Timeline</option>\n                                    </select>\n                                )}\n                                \n                                <button\n                                    onClick={handleRunAnalysis}\n                                    disabled={loading}\n                                    className={`px-4 py-2 rounded-lg font-medium transition-colors ${\n                                        loading\n                                            ? 'bg-gray-300 text-gray-500 cursor-not-allowed'\n                                            : 'bg-blue-600 hover:bg-blue-700 text-white'\n                                    }`}\n                                >\n                                    {loading ? 'Running...' : 'Run Analysis'}\n                                </button>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n\n                {/* Configuration Section */}\n                <div className=\"mb-8\">\n                    <ProductFilterConfig\n                        config={analysisParams.config}\n                        analysisParams={analysisParams}\n                        onConfigChange={handleParameterChange}\n                    />\n                    \n                    {/* Large Date Range Warning */}\n                    {(() => {\n                        const dateRange = new Date(analysisParams.date_to) - new Date(analysisParams.date_from);\n                        const daySpan = dateRange / (1000 * 60 * 60 * 24);\n                        \n                        if (daySpan > 35) {\n                            return (\n                                <div className=\"mt-4 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-4\">\n                                    <div className=\"flex items-start gap-3\">\n                                        <div className=\"text-yellow-600 dark:text-yellow-400\">‚ö†Ô∏è</div>\n                                        <div>\n                                            <h3 className=\"text-yellow-800 dark:text-yellow-200 font-semibold mb-2\">Large Date Range Detected</h3>\n                                            <p className=\"text-yellow-700 dark:text-yellow-300 text-sm mb-2\">\n                                                You've selected a {Math.round(daySpan)} day range. This may result in a very large response ({'>'}500MB) that could crash your browser.\n                                            </p>\n                                            <div className=\"text-yellow-700 dark:text-yellow-300 text-sm\">\n                                                <strong>Recommendations:</strong>\n                                                <ul className=\"list-disc list-inside mt-1 space-y-1\">\n                                                    <li>Use <strong>Debug Mode</strong> to analyze stages individually</li>\n                                                    <li>Reduce your date range to 30 days or less</li>\n                                                    <li>Consider analyzing individual months separately</li>\n                                                </ul>\n                                            </div>\n                                        </div>\n                                    </div>\n                                </div>\n                            );\n                        }\n                        return null;\n                    })()}\n                </div>\n\n                {/* Loading State */}\n                {loading && (\n                    <div className=\"flex justify-center items-center py-12\">\n                        <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500\"></div>\n                        <div className=\"ml-3\">\n                            <div className=\"text-lg text-gray-600 dark:text-gray-400\">\n                                Running V3 refactored analysis...\n                            </div>\n                            {(() => {\n                                const dateRange = new Date(analysisParams.date_to) - new Date(analysisParams.date_from);\n                                const daySpan = dateRange / (1000 * 60 * 60 * 24);\n                                \n                                if (daySpan > 35) {\n                                    return (\n                                        <div className=\"text-sm text-yellow-600 dark:text-yellow-400 mt-1\">\n                                            ‚ö†Ô∏è Large date range detected - this may take several minutes and could fail due to browser memory limits\n                                        </div>\n                                    );\n                                }\n                                return null;\n                            })()}\n                        </div>\n                    </div>\n                )}\n\n                {/* Results Display */}\n                <div className=\"space-y-6\">\n                    {/* Error Display */}\n                    {error && (\n                        <div className=\"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4\">\n                            <h3 className=\"text-red-800 dark:text-red-200 font-semibold mb-2\">Analysis Error</h3>\n                            <p className=\"text-red-700 dark:text-red-300\">{error}</p>\n                        </div>\n                    )}\n\n                    {/* Debug Information */}\n                    {pipelineData && (\n                        <div className=\"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4\">\n                            <h3 className=\"text-blue-800 dark:text-blue-200 font-semibold mb-2\">Debug: V3 Refactored API Data Structure</h3>\n                            <div className=\"text-sm text-blue-700 dark:text-blue-300 space-y-1\">\n                                <div>Has pipelineData: {pipelineData ? '‚úÖ' : '‚ùå'}</div>\n                                <div>Has stage_results (direct): {pipelineData?.stage_results ? '‚úÖ' : '‚ùå'}</div>\n                                <div>Has stage_results (nested): {pipelineData?.data?.stage_results ? '‚úÖ' : '‚ùå'}</div>\n                                <div>Stage 1 Complete: {stageProgress.stage1 ? '‚úÖ' : '‚ùå'}</div>\n                                <div>Stage 2 Complete: {stageProgress.stage2 ? '‚úÖ' : '‚ùå'}</div>\n                                <div>Stage 3 Complete: {stageProgress.stage3 ? '‚úÖ' : '‚ùå'}</div>\n                                {/* ENHANCED: Show stage errors if they exist */}\n                                {stageResults?.stage1?.error && (\n                                    <div className=\"text-red-600 dark:text-red-400\">Stage 1 Error: {stageResults.stage1.error}</div>\n                                )}\n                                {stageResults?.stage2?.error && (\n                                    <div className=\"text-red-600 dark:text-red-400\">Stage 2 Error: {stageResults.stage2.error}</div>\n                                )}\n                                {stageResults?.stage3?.error && (\n                                    <div className=\"text-red-600 dark:text-red-400\">Stage 3 Error: {stageResults.stage3.error}</div>\n                                )}\n                                <div>Main data keys: {pipelineData ? Object.keys(pipelineData).join(', ') : 'None'}</div>\n                                {stageResults && (\n                                    <div>Stage results keys: {Object.keys(stageResults).join(', ')}</div>\n                                )}\n                                {stageResults?.stage1 && (\n                                    <div>Stage 1 users: {stageResults.stage1.total_users || stageResults.stage1.cohort_size || 'N/A'}</div>\n                                )}\n                                {stageResults?.stage2 && (\n                                    <div>Stage 2 matches: {stageResults.stage2.matching_stats?.successful_matches || 0}/{stageResults.stage2.matching_stats?.total_users || 0}</div>\n                                )}\n                            </div>\n                        </div>\n                    )}\n\n                    {/* Progressive Results Display */}\n                    {pipelineData && (\n                        <>\n                            {/* Stage 1: User Properties Input Results */}\n                            {stageProgress.stage1 && (\n                                <div className=\"bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6\">\n                                    <div className=\"flex items-center gap-2 mb-4\">\n                                        <Zap size={24} className=\"text-blue-600 dark:text-blue-400\" />\n                                        <h2 className=\"text-2xl font-bold text-gray-900 dark:text-white\">\n                                            Stage 1: User Properties Input - Complete\n                                        </h2>\n                                    </div>\n                                    <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n                                        <div className=\"p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-800\">\n                                            <h3 className=\"font-semibold text-blue-900 dark:text-blue-200\">Total Users Found</h3>\n                                            <p className=\"text-2xl font-bold text-blue-600 dark:text-blue-300\">\n                                                {pipelineData.stage_results?.stage1?.total_users || 0}\n                                            </p>\n                                        </div>\n                                        <div className=\"p-4 bg-green-50 dark:bg-green-900/20 rounded-lg border border-green-200 dark:border-green-800\">\n                                            <h3 className=\"font-semibold text-green-900 dark:text-green-200\">Date Range</h3>\n                                            <p className=\"text-sm font-medium text-green-600 dark:text-green-300\">\n                                                {analysisParams.date_from} to {analysisParams.date_to}\n                                            </p>\n                                        </div>\n                                        <div className=\"p-4 bg-purple-50 dark:bg-purple-900/20 rounded-lg border border-purple-200 dark:border-purple-800\">\n                                            <h3 className=\"font-semibold text-purple-900 dark:text-purple-200\">Stage Status</h3>\n                                            <p className=\"text-sm font-medium text-purple-600 dark:text-purple-300\">\n                                                ‚úÖ User Cohort Extracted\n                                            </p>\n                                        </div>\n                                    </div>\n                                </div>\n                            )}\n\n                            {/* Stage 2: User-to-Segment Matching Results */}\n                            {stageProgress.stage2 && (\n                                <Stage2UserMatchingResults data={pipelineData} />\n                            )}\n\n                            {/* Stage 3: Revenue Timeline Generation Results */}\n                            {stageProgress.stage3 && (\n                                <Stage3RevenueResultsV3 data={pipelineData} />\n                            )}\n                        </>\n                    )}\n\n                    {/* Debug Data Viewer */}\n                    {debugMode && pipelineData && (\n                        <DebugDataViewer \n                            data={pipelineData} \n                            stage={debugStage}\n                            title=\"V3 Refactored Pipeline Debug Data\"\n                        />\n                    )}\n                </div>\n            </div>\n        </div>\n    );\n};\n\nexport default CohortAnalyzerV3RefactoredPage; "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}