{"ast":null,"code":"import _objectSpread from\"/Users/joshuakaufman/untitled folder 3/orchestrator/dashboard/client/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useMemo}from'react';/*\n * ========================================\n * ENHANCED ESTIMATED REVENUE & REFUND TRACKING\n * ========================================\n * \n * This component has been enhanced to support granular tracking of estimated refunds\n * (trial vs. subscription) and estimated revenue (trial vs. subscription contributions),\n * with detailed breakdown data for frontend tooltips.\n * \n * NEW FEATURES (TODOs 4 & 5 IMPLEMENTED):\n * \n * 1. Enhanced Estimated Revenue Tooltip (TODO 5):\n *    - Now shows 3-category breakdown:\n *      - \"From Pending Trials\": Revenue from users still in trial\n *      - \"From Trial Conversions\": Revenue from users who converted from trial\n *      - \"From Initial Purchases\": Revenue from users who purchased directly\n *    - Uses new backend data: estimated_trial_converted_revenue_component, estimated_initial_purchase_revenue_component\n * \n * 2. Separate Tooltip Components (TODO 4):\n *    - ActualRevenueTooltip: Handles actual revenue event details with sources\n *    - ActualRefundTooltip: Handles actual refund event details with sources  \n *    - EstimatedRevenueTooltip: Handles estimated revenue with 3-category breakdown\n *    - Updated state management to activeTooltip with type differentiation\n * \n * 3. Enhanced State Management (TODO 4):\n *    - Changed from tooltipData/tooltipPosition to activeTooltip object\n *    - activeTooltip contains: { type, data, position } for better type handling\n *    - Mouse event handlers updated to handle different tooltip types\n * \n * DATA STRUCTURE CHANGES:\n * \n * Per-user daily metrics (consolidated_user_daily_metrics[user_id][date_str]):\n *   - estimated_trial_converted_revenue_component: NEW - Revenue from trial conversions  \n *   - estimated_initial_purchase_revenue_component: NEW - Revenue from direct purchases\n *   - revenue_sources: NEW - Array of detailed revenue event sources\n *   - refund_sources: NEW - Array of detailed refund event sources\n * \n * Aggregated daily metrics (timeline_data[date_str]):\n *   - estimated_trial_converted_revenue_component: NEW - Aggregated trial conversion revenue\n *   - estimated_initial_purchase_revenue_component: NEW - Aggregated direct purchase revenue\n *   - users_from_trial_conversion: NEW - Count of users with trial conversion revenue\n *   - users_from_initial_purchase: NEW - Count of users with direct purchase revenue\n * \n * BUSINESS LOGIC NOTES:\n * \n * - Trial refunds: conversion_rate * base_refund_rate * price\n *   (Potential refunds IF trial converts AND user requests refund)\n * \n * - Subscription refunds: actual_conversion_revenue * current_refund_rate\n *   (Refunds based on subscription age, degrading linearly over 30 days)\n * \n * - All calculations come from backend state_models.py - NO business logic in frontend\n * \n * TOOLTIP PLACEMENT:\n * - \"Estimated Refunds (Potential)\" metric is placed in the \"Revenue Values\" category\n * - Positioned between \"Net Revenue\" and \"Estimated Revenue\" as requested\n */import{jsxs as _jsxs,jsx as _jsx,Fragment as _Fragment}from\"react/jsx-runtime\";const EstimatedRevenueTooltip=_ref=>{var _breakdown$total,_breakdown$total2,_breakdown$total3,_breakdown$total4,_breakdown$total5,_breakdown$total6,_breakdown$total7;let{data,position,onClose}=_ref;// Basic mouse hover logic to keep the tooltip open\nconst[isHovered,setIsHovered]=React.useState(false);const closeTimeoutRef=React.useRef(null);const handleMouseEnter=()=>{setIsHovered(true);clearTimeout(closeTimeoutRef.current);};const handleMouseLeave=()=>{setIsHovered(false);closeTimeoutRef.current=setTimeout(onClose,300);};if(!data||!data.breakdown)return null;const{breakdown}=data;const totalValue=((_breakdown$total=breakdown.total)===null||_breakdown$total===void 0?void 0:_breakdown$total.final_net_revenue)||0;// Helper to render a section only if it has meaningful data\nconst renderSection=(title,sectionData)=>{// First check if sectionData exists\nif(!sectionData)return null;// A section is meaningful if it has users or any revenue/refund data\nconst hasData=sectionData.users>0||sectionData.estimated_revenue||sectionData.actual_revenue;if(!hasData)return null;return/*#__PURE__*/_jsxs(\"div\",{className:\"border-b border-gray-700 pb-2 mb-2\",children:[/*#__PURE__*/_jsxs(\"h5\",{className:\"font-bold text-blue-300 mb-2\",children:[title,\" \",sectionData.users>0?\"(\".concat(sectionData.users,\" users)\"):'']}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-2 gap-x-4 text-xs\",children:[sectionData.hasOwnProperty('estimated_revenue')&&/*#__PURE__*/_jsx(\"div\",{children:\"Est. Revenue:\"}),sectionData.hasOwnProperty('estimated_revenue')&&/*#__PURE__*/_jsxs(\"div\",{className:\"text-right font-mono\",children:[\"$\",sectionData.estimated_revenue.toFixed(2)]}),sectionData.hasOwnProperty('actual_revenue')&&/*#__PURE__*/_jsx(\"div\",{children:\"Actual Revenue:\"}),sectionData.hasOwnProperty('actual_revenue')&&/*#__PURE__*/_jsxs(\"div\",{className:\"text-right font-mono\",children:[\"$\",sectionData.actual_revenue.toFixed(2)]}),sectionData.hasOwnProperty('actual_refunds')&&/*#__PURE__*/_jsx(\"div\",{children:\"Actual Refunds:\"}),sectionData.hasOwnProperty('actual_refunds')&&/*#__PURE__*/_jsxs(\"div\",{className:\"text-right font-mono text-red-400\",children:[\"-$\",sectionData.actual_refunds.toFixed(2)]}),sectionData.hasOwnProperty('estimated_refunds')&&/*#__PURE__*/_jsx(\"div\",{children:\"Est. Refunds:\"}),sectionData.hasOwnProperty('estimated_refunds')&&/*#__PURE__*/_jsxs(\"div\",{className:\"text-right font-mono text-yellow-400\",children:[\"-$\",sectionData.estimated_refunds.toFixed(2)]}),/*#__PURE__*/_jsx(\"div\",{className:\"border-t border-gray-600 mt-1 pt-1\",children:\"Net Revenue:\"}),/*#__PURE__*/_jsx(\"div\",{className:\"text-right font-mono border-t border-gray-600 mt-1 pt-1\",children:sectionData.hasOwnProperty('net_estimated_revenue')?\"$\".concat(sectionData.net_estimated_revenue.toFixed(2)):sectionData.hasOwnProperty('net_revenue_after_estimated_refunds')?\"$\".concat(sectionData.net_revenue_after_estimated_refunds.toFixed(2)):\"$\".concat((sectionData.actual_revenue-sectionData.actual_refunds).toFixed(2))})]})]});};return/*#__PURE__*/_jsxs(\"div\",{className:\"fixed z-50 bg-gray-800 border border-gray-600 text-white rounded-lg shadow-lg p-4 w-96 pointer-events-auto\",style:{left:position.x,top:position.y},onMouseEnter:handleMouseEnter,onMouseLeave:handleMouseLeave,children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between items-start mb-3\",children:[/*#__PURE__*/_jsxs(\"h4\",{className:\"font-semibold\",children:[\"Est. Net Revenue: $\",totalValue.toFixed(2)]}),/*#__PURE__*/_jsx(\"button\",{onClick:onClose,className:\"text-gray-400 hover:text-gray-200\",children:\"\\xD7\"})]}),(()=>{const trialConverted=breakdown.trial_converted||{};const initialPurchase=breakdown.initial_purchase||{};const showTrialRatio=trialConverted.actual_revenue>0;const showInitialRatio=initialPurchase.actual_revenue>0;if(!showTrialRatio&&!showInitialRatio)return null;return/*#__PURE__*/_jsxs(\"div\",{className:\"bg-blue-900 p-3 rounded-lg border border-blue-600 mb-3\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-sm font-medium text-blue-200 mb-2\",children:\"\\uD83C\\uDFAF Refund Rate Analysis\"}),showTrialRatio&&/*#__PURE__*/_jsxs(\"div\",{className:\"mb-2\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-xs font-medium text-blue-300\",children:\"Trial Conversion Refund Rate:\"}),/*#__PURE__*/_jsx(\"div\",{className:\"text-sm font-bold text-blue-100\",children:(()=>{const revenue=trialConverted.actual_revenue||0;const estimatedRefunds=trialConverted.estimated_refunds||0;const refundRate=revenue>0?estimatedRefunds/revenue*100:0;return\"\".concat(estimatedRefunds.toFixed(2),\" / \").concat(revenue.toFixed(2),\" = \").concat(refundRate.toFixed(1),\"%\");})()}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-xs text-blue-400\",children:[\"$\",(trialConverted.estimated_refunds||0).toFixed(2),\" estimated refunds on $\",(trialConverted.actual_revenue||0).toFixed(2),\" revenue\"]})]}),showInitialRatio&&/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-xs font-medium text-blue-300\",children:\"Initial Purchase Refund Rate:\"}),/*#__PURE__*/_jsx(\"div\",{className:\"text-sm font-bold text-blue-100\",children:(()=>{const revenue=initialPurchase.actual_revenue||0;const estimatedRefunds=initialPurchase.estimated_refunds||0;const refundRate=revenue>0?estimatedRefunds/revenue*100:0;return\"\".concat(estimatedRefunds.toFixed(2),\" / \").concat(revenue.toFixed(2),\" = \").concat(refundRate.toFixed(1),\"%\");})()}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-xs text-blue-400\",children:[\"$\",(initialPurchase.estimated_refunds||0).toFixed(2),\" estimated refunds on $\",(initialPurchase.actual_revenue||0).toFixed(2),\" revenue\"]})]})]});})(),renderSection('-- Pending Trial --',breakdown.pending_trial),renderSection('-- Trial Converted --',breakdown.trial_converted),renderSection('-- Initial Purchase --',breakdown.initial_purchase),/*#__PURE__*/_jsxs(\"div\",{className:\"pt-2\",children:[/*#__PURE__*/_jsx(\"h5\",{className:\"font-bold text-green-300 mb-2\",children:\"-- Total --\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-2 gap-x-4 text-xs\",children:[/*#__PURE__*/_jsx(\"div\",{children:\"Total Actual Revenue:\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-right font-mono\",children:[\"$\",(((_breakdown$total2=breakdown.total)===null||_breakdown$total2===void 0?void 0:_breakdown$total2.total_actual_revenue)||0).toFixed(2)]}),/*#__PURE__*/_jsx(\"div\",{children:\"Total Actual Refunds:\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-right font-mono text-red-400\",children:[\"-$\",(((_breakdown$total3=breakdown.total)===null||_breakdown$total3===void 0?void 0:_breakdown$total3.total_actual_refunds)||0).toFixed(2)]}),/*#__PURE__*/_jsx(\"div\",{children:\"Total Net Revenue:\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-right font-mono\",children:[\"$\",(((_breakdown$total4=breakdown.total)===null||_breakdown$total4===void 0?void 0:_breakdown$total4.total_net_revenue)||0).toFixed(2)]}),/*#__PURE__*/_jsx(\"div\",{children:\"Est. Revenue (from trials):\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-right font-mono\",children:[\"$\",(((_breakdown$total5=breakdown.total)===null||_breakdown$total5===void 0?void 0:_breakdown$total5.est_revenue_from_trials)||0).toFixed(2)]}),/*#__PURE__*/_jsx(\"div\",{children:\"Est. Refunds (from pending trials, trial converted, and initial purchase):\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-right font-mono text-yellow-400\",children:[\"-$\",(((_breakdown$total6=breakdown.total)===null||_breakdown$total6===void 0?void 0:_breakdown$total6.est_refunds_from_all_sources)||0).toFixed(2)]}),/*#__PURE__*/_jsx(\"div\",{className:\"font-bold border-t border-gray-600 mt-1 pt-1\",children:\"Final Net Revenue:\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"font-bold text-right font-mono border-t border-gray-600 mt-1 pt-1\",children:[\"$\",(((_breakdown$total7=breakdown.total)===null||_breakdown$total7===void 0?void 0:_breakdown$total7.final_net_revenue)||0).toFixed(2)]})]})]})]});};// CORRECTED - Final version of the component\nconst ActualRevenueTooltip=_ref2=>{let{data,position,onClose}=_ref2;const[isHovered,setIsHovered]=React.useState(false);const closeTimeoutRef=React.useRef(null);if(!data)return null;const{value=0,sources={},buckets={}}=data;const handleMouseEnter=()=>{setIsHovered(true);if(closeTimeoutRef.current){clearTimeout(closeTimeoutRef.current);closeTimeoutRef.current=null;}};const handleMouseLeave=()=>{setIsHovered(false);closeTimeoutRef.current=setTimeout(()=>{onClose();},300);};return/*#__PURE__*/_jsxs(\"div\",{className:\"fixed z-50 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-600 rounded-lg shadow-lg p-4 max-w-md pointer-events-auto\",style:{left:position.x,top:position.y,pointerEvents:'auto'},onMouseEnter:handleMouseEnter,onMouseLeave:handleMouseLeave,children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between items-start mb-3\",children:[/*#__PURE__*/_jsxs(\"h4\",{className:\"font-semibold text-lg text-gray-900 dark:text-white\",children:[\"Actual Revenue: $\",value.toFixed(2)]}),/*#__PURE__*/_jsx(\"button\",{onClick:onClose,className:\"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 ml-2\",children:\"\\xD7\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-3 text-xs\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h5\",{className:\"font-bold text-sm text-gray-700 dark:text-gray-300 mb-1\",children:\"By Source\"}),Object.keys(sources).length>0?Object.entries(sources).map(_ref3=>{let[source,stats]=_ref3;return/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between\",children:[/*#__PURE__*/_jsxs(\"span\",{className:\"text-gray-600 dark:text-gray-400\",children:[source,\":\"]}),/*#__PURE__*/_jsxs(\"span\",{className:\"font-medium text-gray-800 dark:text-gray-200\",children:[stats.count,\" txn, $\",stats.total.toFixed(2)]})]},source);}):/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-500 italic\",children:\"No source data.\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"border-t dark:border-gray-600 pt-2\",children:[/*#__PURE__*/_jsx(\"h5\",{className:\"font-bold text-sm text-gray-700 dark:text-gray-300 mb-1\",children:\"By Amount ($5 Buckets)\"}),Object.keys(buckets).length>0?Object.entries(buckets).sort().map(_ref4=>{let[bucket,count]=_ref4;return/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between\",children:[/*#__PURE__*/_jsxs(\"span\",{className:\"text-gray-600 dark:text-gray-400\",children:[bucket,\":\"]}),/*#__PURE__*/_jsxs(\"span\",{className:\"font-medium text-gray-800 dark:text-gray-200\",children:[count,\" transactions\"]})]},bucket);}):/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-500 italic\",children:\"No bucket data.\"})]})]})]});};// CORRECTED - Final version of the component\nconst ActualRefundTooltip=_ref5=>{let{data,position,onClose}=_ref5;const[isHovered,setIsHovered]=React.useState(false);const closeTimeoutRef=React.useRef(null);if(!data)return null;const{value=0,sources={},buckets={}}=data;const handleMouseEnter=()=>{setIsHovered(true);if(closeTimeoutRef.current){clearTimeout(closeTimeoutRef.current);closeTimeoutRef.current=null;}};const handleMouseLeave=()=>{setIsHovered(false);closeTimeoutRef.current=setTimeout(()=>{onClose();},300);};return/*#__PURE__*/_jsxs(\"div\",{className:\"fixed z-50 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-600 rounded-lg shadow-lg p-4 max-w-md pointer-events-auto\",style:{left:position.x,top:position.y,pointerEvents:'auto'},onMouseEnter:handleMouseEnter,onMouseLeave:handleMouseLeave,children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between items-start mb-3\",children:[/*#__PURE__*/_jsxs(\"h4\",{className:\"font-semibold text-lg text-gray-900 dark:text-white\",children:[\"Actual Refunds: $\",value.toFixed(2)]}),/*#__PURE__*/_jsx(\"button\",{onClick:onClose,className:\"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 ml-2\",children:\"\\xD7\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-3 text-xs\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h5\",{className:\"font-bold text-sm text-gray-700 dark:text-gray-300 mb-1\",children:\"By Source\"}),Object.keys(sources).length>0?Object.entries(sources).map(_ref6=>{let[source,stats]=_ref6;return/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between\",children:[/*#__PURE__*/_jsxs(\"span\",{className:\"text-gray-600 dark:text-gray-400\",children:[source,\":\"]}),/*#__PURE__*/_jsxs(\"span\",{className:\"font-medium text-gray-800 dark:text-gray-200\",children:[stats.count,\" txn, $\",stats.total.toFixed(2)]})]},source);}):/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-500 italic\",children:\"No source data.\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"border-t dark:border-gray-600 pt-2\",children:[/*#__PURE__*/_jsx(\"h5\",{className:\"font-bold text-sm text-gray-700 dark:text-gray-300 mb-1\",children:\"By Amount ($5 Buckets)\"}),Object.keys(buckets).length>0?Object.entries(buckets).sort().map(_ref7=>{let[bucket,count]=_ref7;return/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between\",children:[/*#__PURE__*/_jsxs(\"span\",{className:\"text-gray-600 dark:text-gray-400\",children:[bucket,\":\"]}),/*#__PURE__*/_jsxs(\"span\",{className:\"font-medium text-gray-800 dark:text-gray-200\",children:[count,\" transactions\"]})]},bucket);}):/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-500 italic\",children:\"No bucket data.\"})]})]})]});};const EventTimelineTableV3=_ref8=>{var _data$data;let{data,selectedUserId='',selectedProductId=''}=_ref8;const[showCumulative,setShowCumulative]=useState(false);// TODO 4: Enhanced state management with activeTooltip type differentiation\nconst[activeTooltip,setActiveTooltip]=useState(null);// { type, data, position }\nconst tooltipTimeoutRef=React.useRef(null);// V3 ONLY: Only handle the V3 backend format directly\nlet timelineData;let dates=[];let dailyMetrics={};let cumulativeMetrics={};let userTimelines={};let userDailyMetrics={};if(data!==null&&data!==void 0&&data.data){// V3 format: data comes from Stage3RevenueResults.getTimelineTableData()\ndates=data.data.dates||[];dailyMetrics=data.data.daily_metrics||{};cumulativeMetrics=data.data.cumulative_metrics||{};userTimelines=data.data.user_timelines||{};userDailyMetrics=data.data.user_daily_metrics||{};// 🔍 FRONTEND DATA VERIFICATION: Log what EventTimelineTableV3 receives\nconsole.log('🔍 [EventTimelineTableV3] Received data structure:');console.log('🔍   - dates count:',dates.length);console.log('🔍   - dailyMetrics dates:',Object.keys(dailyMetrics).length);console.log('🔍   - userDailyMetrics users:',Object.keys(userDailyMetrics).length);console.log('🔍   - selectedUserId:',selectedUserId);// 🔍 ENHANCED DEBUG: Show detailed userDailyMetrics structure\nif(Object.keys(userDailyMetrics).length>0){console.log('🔍   - userDailyMetrics keys:',Object.keys(userDailyMetrics));// Show first user's data as sample\nconst firstUserId=Object.keys(userDailyMetrics)[0];const firstUserData=userDailyMetrics[firstUserId];console.log('🔍   - First user ID:',firstUserId);console.log('🔍   - First user dates:',Object.keys(firstUserData||{}));if(firstUserData&&Object.keys(firstUserData).length>0){const firstDate=Object.keys(firstUserData)[0];const firstDateData=firstUserData[firstDate];console.log('🔍   - First date data sample:',firstDate,firstDateData);console.log('🔍   - Has tooltip_data:',!!(firstDateData!==null&&firstDateData!==void 0&&firstDateData.tooltip_data));if(firstDateData!==null&&firstDateData!==void 0&&firstDateData.tooltip_data){console.log('🔍   - tooltip_data structure:',Object.keys(firstDateData.tooltip_data));}}// Check if selectedUserId exists in userDailyMetrics\nif(selectedUserId&&selectedUserId in userDailyMetrics){console.log('🔍   - selectedUserId found in userDailyMetrics!');const selectedUserData=userDailyMetrics[selectedUserId];console.log('🔍   - selectedUser dates:',Object.keys(selectedUserData||{}));if(selectedUserData&&Object.keys(selectedUserData).length>0){const sampleDate=Object.keys(selectedUserData)[0];const sampleDateData=selectedUserData[sampleDate];console.log('🔍   - selectedUser sample date data:',sampleDate,sampleDateData);console.log('🔍   - selectedUser has tooltip_data:',!!(sampleDateData!==null&&sampleDateData!==void 0&&sampleDateData.tooltip_data));}}else if(selectedUserId){console.log('🔍   - selectedUserId NOT found in userDailyMetrics:',selectedUserId);console.log('🔍   - Available user IDs:',Object.keys(userDailyMetrics));}}// 🔥 STAGE 3 TIMELINE DEBUG: Target the problematic user and date\nconst targetUser='$device:056F1F33-A295-47F1-9284-F3719DAA976E';const targetDate='2025-05-14';if(selectedUserId&&selectedUserId.includes('056F1F33-A295-47F1-9284')){console.log('🔥 STAGE3 SUCCESS: V3 Data Correctly Fixed');console.log('🔥   - Selected User ID:',selectedUserId);console.log('🔥   - Target Date:',targetDate);if(userDailyMetrics[selectedUserId]&&userDailyMetrics[selectedUserId][targetDate]){const dayData=userDailyMetrics[selectedUserId][targetDate];console.log('🔥   - trial_converted:',dayData.trial_converted);console.log('🔥   - initial_purchase:',dayData.initial_purchase);if(dayData.trial_converted===1&&dayData.initial_purchase===0){console.log('🔥   ✅ BUSINESS RULE COMPLIANCE: trial_converted=1, initial_purchase=0 (FIXED!)');}else{console.log('🔥   ❌ BUSINESS RULE VIOLATION: Both values still showing as 1');}}else{console.log('🔥   ❌ TARGET USER DATA NOT FOUND in userDailyMetrics');}}}// Cleanup tooltip timeout on unmount\nReact.useEffect(()=>{return()=>{if(tooltipTimeoutRef.current){clearTimeout(tooltipTimeoutRef.current);}};},[]);// V3 Debug logging\nconsole.log('[DEBUG V3] EventTimelineTable received data:',data);console.log('[DEBUG V3] Data structure check:',{hasData:!!data,hasDataData:!!(data!==null&&data!==void 0&&data.data),dataKeys:data?Object.keys(data):[],dataDataKeys:data!==null&&data!==void 0&&data.data?Object.keys(data.data):[]});// V3 Additional debugging for data structure\nconsole.log('[DEBUG V3] Raw data.data structure:',data===null||data===void 0?void 0:data.data);console.log('[DEBUG V3] Available keys in data.data:',data!==null&&data!==void 0&&data.data?Object.keys(data.data):[]);if(data!==null&&data!==void 0&&(_data$data=data.data)!==null&&_data$data!==void 0&&_data$data.daily_metrics){console.log('[DEBUG V3] daily_metrics type:',typeof data.data.daily_metrics);console.log('[DEBUG V3] daily_metrics sample keys:',Object.keys(data.data.daily_metrics).slice(0,3));}// Extract available users and products for filtering\nconst{availableUsers,availableProducts}=useMemo(()=>{const users=new Set();const products=new Set();// Extract from user daily metrics (most accurate)\nObject.keys(userDailyMetrics).forEach(userId=>{users.add(userId);});// Extract from user timelines if available\nObject.keys(userTimelines).forEach(userId=>{var _userTimeline$summary;users.add(userId);const userTimeline=userTimelines[userId];if(userTimeline.events){userTimeline.events.forEach(event=>{if(event.product_id){products.add(event.product_id);}});}if((_userTimeline$summary=userTimeline.summary)!==null&&_userTimeline$summary!==void 0&&_userTimeline$summary.product_summaries){Object.keys(userTimeline.summary.product_summaries).forEach(productId=>{products.add(productId);});}});// Extract from daily metrics breakdown if available\nObject.values(dailyMetrics).forEach(dayData=>{var _dayData$estimated_re;if((_dayData$estimated_re=dayData.estimated_revenue_breakdown)!==null&&_dayData$estimated_re!==void 0&&_dayData$estimated_re.user_breakdowns){Object.keys(dayData.estimated_revenue_breakdown.user_breakdowns).forEach(userId=>{users.add(userId);const userBreakdown=dayData.estimated_revenue_breakdown.user_breakdowns[userId];if(userBreakdown.product_breakdowns){Object.keys(userBreakdown.product_breakdowns).forEach(productId=>{products.add(productId);});}});}});return{availableUsers:Array.from(users).sort(),availableProducts:Array.from(products).sort()};},[userDailyMetrics,userTimelines,dailyMetrics]);// Filter data based on selected user/product\nconst filteredData=useMemo(()=>{if(!selectedUserId&&!selectedProductId){return{dailyMetrics,cumulativeMetrics};}// CRITICAL: Use backend's pre-calculated user daily metrics directly\n// No business logic recalculation in frontend - pure display layer\nconst filteredDaily={};const filteredCumulative={};if(selectedUserId&&!selectedProductId){// 🔥 STAGE 3 FILTERED DATA DEBUG: Target the problematic user\nconst targetDate='2025-05-14';const isTargetUser=selectedUserId.includes('056F1F33-A295-47F1-9284');if(isTargetUser){console.log('🔥 STAGE3 FILTERED DATA DEBUG - Processing Target User:');console.log('🔥   - Selected User ID:',selectedUserId);console.log('🔥   - Raw User Metrics:',userDailyMetrics[selectedUserId]);}// Filter by user only - use backend's user daily metrics directly\nconst userMetrics=userDailyMetrics[selectedUserId];if(userMetrics){// Calculate cumulative values for single user view\nlet cumulativeValues={trial_started:0,trial_ended:0,trial_converted:0,trial_cancelled:0,initial_purchase:0,subscription_cancelled:0,revenue:0,refund:0,refund_count:0};dates.forEach(date=>{const userDayMetrics=userMetrics[date];if(userDayMetrics){// Use backend's pre-calculated daily metrics directly\nfilteredDaily[date]=_objectSpread(_objectSpread({},userDayMetrics),{},{revenue_net:(userDayMetrics.revenue||0)-(userDayMetrics.refund||0)});// 🔥 STAGE 3 DEBUG: Check target date data processing\nif(isTargetUser&&date===targetDate){console.log('🔥 STAGE3 FILTERED DATA DEBUG - Target Date Processing:');console.log('🔥   - Date:',date);console.log('🔥   - Raw Backend Data:',userDayMetrics);console.log('🔥   - trial_converted (backend):',userDayMetrics.trial_converted);console.log('🔥   - initial_purchase (backend):',userDayMetrics.initial_purchase);console.log('🔥   - Filtered Daily Result:',filteredDaily[date]);}// Calculate cumulative values by summing daily values\ncumulativeValues.trial_started+=userDayMetrics.trial_started||0;cumulativeValues.trial_ended+=userDayMetrics.trial_ended||0;cumulativeValues.trial_converted+=userDayMetrics.trial_converted||0;cumulativeValues.trial_cancelled+=userDayMetrics.trial_cancelled||0;cumulativeValues.initial_purchase+=userDayMetrics.initial_purchase||0;cumulativeValues.subscription_cancelled+=userDayMetrics.subscription_cancelled||0;cumulativeValues.revenue+=userDayMetrics.revenue||0;cumulativeValues.refund+=userDayMetrics.refund||0;cumulativeValues.refund_count+=userDayMetrics.refund_count||0;// Create cumulative metrics with proper field names\nfilteredCumulative[date]={// Copy daily values for state-based metrics (these don't accumulate)\ntrial_pending:userDayMetrics.trial_pending||0,subscription_active:userDayMetrics.subscription_active||0,estimated_revenue:userDayMetrics.estimated_revenue||0,// Add cumulative values with proper field names expected by getCumulativeValue functions\ncumulative_trial_started:cumulativeValues.trial_started,cumulative_trial_ended:cumulativeValues.trial_ended,cumulative_trial_converted:cumulativeValues.trial_converted,cumulative_trial_cancelled:cumulativeValues.trial_cancelled,cumulative_initial_purchase:cumulativeValues.initial_purchase,cumulative_subscription_cancelled:cumulativeValues.subscription_cancelled,cumulative_revenue:cumulativeValues.revenue,cumulative_refund:cumulativeValues.refund,cumulative_refund_count:cumulativeValues.refund_count,cumulative_revenue_net:cumulativeValues.revenue-cumulativeValues.refund};}else{// No data for this user on this date\nfilteredDaily[date]={trial_started:0,trial_pending:0,trial_ended:0,trial_converted:0,trial_cancelled:0,initial_purchase:0,subscription_active:0,subscription_cancelled:0,revenue:0,refund:0,refund_count:0,estimated_revenue:0,revenue_net:0};// For cumulative, maintain previous cumulative values (no change on days with no activity)\nfilteredCumulative[date]={// State-based metrics remain 0\ntrial_pending:0,subscription_active:0,estimated_revenue:0,// Cumulative values remain at previous levels\ncumulative_trial_started:cumulativeValues.trial_started,cumulative_trial_ended:cumulativeValues.trial_ended,cumulative_trial_converted:cumulativeValues.trial_converted,cumulative_trial_cancelled:cumulativeValues.trial_cancelled,cumulative_initial_purchase:cumulativeValues.initial_purchase,cumulative_subscription_cancelled:cumulativeValues.subscription_cancelled,cumulative_revenue:cumulativeValues.revenue,cumulative_refund:cumulativeValues.refund,cumulative_refund_count:cumulativeValues.refund_count,cumulative_revenue_net:cumulativeValues.revenue-cumulativeValues.refund};}});}else{// User not found in user daily metrics\ndates.forEach(date=>{filteredDaily[date]={trial_started:0,trial_pending:0,trial_ended:0,trial_converted:0,trial_cancelled:0,initial_purchase:0,subscription_active:0,subscription_cancelled:0,revenue:0,refund:0,refund_count:0,estimated_revenue:0,revenue_net:0};filteredCumulative[date]={trial_pending:0,subscription_active:0,estimated_revenue:0,cumulative_trial_started:0,cumulative_trial_ended:0,cumulative_trial_converted:0,cumulative_trial_cancelled:0,cumulative_initial_purchase:0,cumulative_subscription_cancelled:0,cumulative_revenue:0,cumulative_refund:0,cumulative_refund_count:0,cumulative_revenue_net:0};});}}else if(selectedProductId&&!selectedUserId){// Filter by product only - currently showing aggregate data\n// TODO: Backend should provide product-specific aggregations directly\n// For now, ensure cumulative metrics are properly calculated if they're empty\ndates.forEach(date=>{filteredDaily[date]=_objectSpread({},dailyMetrics[date]);// Check if cumulative metrics exist for this date, if not calculate them\nif(cumulativeMetrics[date]&&Object.keys(cumulativeMetrics[date]).length>0){filteredCumulative[date]=_objectSpread({},cumulativeMetrics[date]);}else{// Calculate cumulative metrics for this date if missing\n// Note: This is a fallback - should ideally be handled by backend or Stage3RevenueResultsV3\nconsole.warn(\"Missing cumulative metrics for date \".concat(date,\", this should be handled by Stage3RevenueResultsV3\"));filteredCumulative[date]=_objectSpread({},cumulativeMetrics[date])||{};}});}else if(selectedUserId&&selectedProductId){// Filter by both user and product\n// TODO: Backend should provide user-product specific metrics\n// For now, use user metrics (which aggregate across all products for that user)\nconst userMetrics=userDailyMetrics[selectedUserId];if(userMetrics){// CRITICAL FIX: Calculate cumulative values for single user view (same logic as user-only)\nlet cumulativeValues={trial_started:0,trial_ended:0,trial_converted:0,trial_cancelled:0,initial_purchase:0,subscription_cancelled:0,revenue:0,refund:0,refund_count:0};dates.forEach(date=>{const userDayMetrics=userMetrics[date];if(userDayMetrics){// Use backend's pre-calculated metrics directly\n// Note: This shows all products for the user, not just the selected product\nfilteredDaily[date]=_objectSpread(_objectSpread({},userDayMetrics),{},{// CRITICAL FIX: Calculate revenue_net since backend doesn't provide it for individual users\nrevenue_net:(userDayMetrics.revenue||0)-(userDayMetrics.refund||0)});// Calculate cumulative values by summing daily values\ncumulativeValues.trial_started+=userDayMetrics.trial_started||0;cumulativeValues.trial_ended+=userDayMetrics.trial_ended||0;cumulativeValues.trial_converted+=userDayMetrics.trial_converted||0;cumulativeValues.trial_cancelled+=userDayMetrics.trial_cancelled||0;cumulativeValues.initial_purchase+=userDayMetrics.initial_purchase||0;cumulativeValues.subscription_cancelled+=userDayMetrics.subscription_cancelled||0;cumulativeValues.revenue+=userDayMetrics.revenue||0;cumulativeValues.refund+=userDayMetrics.refund||0;cumulativeValues.refund_count+=userDayMetrics.refund_count||0;// Create cumulative metrics with proper field names\nfilteredCumulative[date]={// Copy daily values for state-based metrics (these don't accumulate)\ntrial_pending:userDayMetrics.trial_pending||0,subscription_active:userDayMetrics.subscription_active||0,estimated_revenue:userDayMetrics.estimated_revenue||0,// Add cumulative values with proper field names expected by getCumulativeValue functions\ncumulative_trial_started:cumulativeValues.trial_started,cumulative_trial_ended:cumulativeValues.trial_ended,cumulative_trial_converted:cumulativeValues.trial_converted,cumulative_trial_cancelled:cumulativeValues.trial_cancelled,cumulative_initial_purchase:cumulativeValues.initial_purchase,cumulative_subscription_cancelled:cumulativeValues.subscription_cancelled,cumulative_revenue:cumulativeValues.revenue,cumulative_refund:cumulativeValues.refund,cumulative_refund_count:cumulativeValues.refund_count,cumulative_revenue_net:cumulativeValues.revenue-cumulativeValues.refund};}else{filteredDaily[date]={trial_started:0,trial_pending:0,trial_ended:0,trial_converted:0,trial_cancelled:0,initial_purchase:0,subscription_active:0,subscription_cancelled:0,revenue:0,refund:0,refund_count:0,estimated_revenue:0,revenue_net:0};// For cumulative, maintain previous cumulative values (no change on days with no activity)\nfilteredCumulative[date]={// State-based metrics remain 0\ntrial_pending:0,subscription_active:0,estimated_revenue:0,// Cumulative values remain at previous levels\ncumulative_trial_started:cumulativeValues.trial_started,cumulative_trial_ended:cumulativeValues.trial_ended,cumulative_trial_converted:cumulativeValues.trial_converted,cumulative_trial_cancelled:cumulativeValues.trial_cancelled,cumulative_initial_purchase:cumulativeValues.initial_purchase,cumulative_subscription_cancelled:cumulativeValues.subscription_cancelled,cumulative_revenue:cumulativeValues.revenue,cumulative_refund:cumulativeValues.refund,cumulative_refund_count:cumulativeValues.refund_count,cumulative_revenue_net:cumulativeValues.revenue-cumulativeValues.refund};}});}else{dates.forEach(date=>{filteredDaily[date]={trial_started:0,trial_pending:0,trial_ended:0,trial_converted:0,trial_cancelled:0,initial_purchase:0,subscription_active:0,subscription_cancelled:0,revenue:0,refund:0,refund_count:0,estimated_revenue:0,revenue_net:0};filteredCumulative[date]={trial_pending:0,subscription_active:0,estimated_revenue:0,cumulative_trial_started:0,cumulative_trial_ended:0,cumulative_trial_converted:0,cumulative_trial_cancelled:0,cumulative_initial_purchase:0,cumulative_subscription_cancelled:0,cumulative_revenue:0,cumulative_refund:0,cumulative_refund_count:0,cumulative_revenue_net:0};});}}return{dailyMetrics:filteredDaily,cumulativeMetrics:filteredCumulative};},[selectedUserId,selectedProductId,dailyMetrics,cumulativeMetrics,userDailyMetrics,dates]);// NOW we can do early returns after all hooks are called\nif(!data){return/*#__PURE__*/_jsx(\"div\",{className:\"text-center py-8\",children:/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-500 dark:text-gray-400\",children:\"No timeline data available. Run an analysis to see results.\"})});}const formatCurrency=value=>{if(value===null||value===undefined)return'$0';const rounded=Math.round(Number(value));return\"$\".concat(rounded.toLocaleString());};const formatNumber=value=>{if(value===null||value===undefined)return'0';return Number(value).toLocaleString();};// Replace the entire getEstimatedRevenueTooltipData function with this new version:\nconst getEstimatedRevenueTooltipData=(date,value)=>{const safeValue=typeof value==='number'?value:0;if(safeValue===0&&!selectedUserId)return null;// Allow empty tooltips for individual users to show state\nif(selectedUserId){// INDIVIDUAL USER VIEW\nconst userMetrics=userDailyMetrics[selectedUserId];if(!userMetrics||!userMetrics[date]||!userMetrics[date].tooltip_data){console.warn(\"[WARN] No individual tooltip data for user \".concat(selectedUserId,\" on date \").concat(date));// Return a minimal object to show an 'inactive' state tooltip\nreturn{value:0,breakdown:{formula:'⚫ Inactive: Est_Revenue = 0 (No active trial or subscription)',calculation:'No data for this user on this date.',components:{'User ID':selectedUserId.substring(0,16)+'...','Date':date,'Current State':'Inactive'},components_order:['User ID','Date','Current State']}};}// The 'tooltip_data' object from the backend has the exact structure { value, breakdown }\n// that the EstimatedRevenueTooltip component expects.\nreturn userMetrics[date].tooltip_data;}else{// AGGREGATE VIEW\nconst aggregateData=dailyMetrics[date];if(!aggregateData||!aggregateData.estimated_revenue_breakdown){console.warn(\"[WARN] No aggregate breakdown data for date \".concat(date));return null;}const breakdownData=aggregateData.estimated_revenue_breakdown;// This part relies on the backend fix from TODO 1.\n// It constructs the data object for the tooltip component.\nreturn{value:safeValue,estimated_trial_revenue_component:breakdownData.total_trial_revenue,estimated_trial_converted_revenue_component:breakdownData.total_trial_converted_revenue,estimated_initial_purchase_revenue_component:breakdownData.total_initial_purchase_revenue,estimated_trial_refund_component:breakdownData.total_trial_refunds,estimated_trial_converted_refund_component:breakdownData.total_trial_converted_refunds,estimated_initial_purchase_refund_component:breakdownData.total_initial_purchase_refunds,breakdown:breakdownData};}};// CORRECTED - Final version of the function\nconst getRevenueTooltipData=(date,value)=>{var _dailyMetrics$date;const safeValue=typeof value==='number'?value:0;if(safeValue===0)return null;const tooltipData=(_dailyMetrics$date=dailyMetrics[date])===null||_dailyMetrics$date===void 0?void 0:_dailyMetrics$date.revenue_tooltip_data;if(!tooltipData)return null;return _objectSpread({value:safeValue},tooltipData);};// CORRECTED - Final version of the function\nconst getRefundTooltipData=(date,value)=>{var _dailyMetrics$date2;const safeValue=typeof value==='number'?value:0;if(safeValue===0)return null;const tooltipData=(_dailyMetrics$date2=dailyMetrics[date])===null||_dailyMetrics$date2===void 0?void 0:_dailyMetrics$date2.refund_tooltip_data;if(!tooltipData)return null;return _objectSpread({value:safeValue},tooltipData);};// Function to generate tooltip data for estimated refunds\nconst getEstimatedRefundsTooltipData=(date,trialRefunds,subscriptionRefunds,totalRefunds)=>{if(totalRefunds===0){return null;// Don't show tooltip for $0 values\n}console.log(\"[DEBUG] getEstimatedRefundsTooltipData called with:\",{date,trialRefunds,subscriptionRefunds,totalRefunds,selectedUserId,selectedProductId,isAggregateView:!selectedUserId});// ENHANCED: Support both individual user view AND aggregate view\nif(!selectedUserId){// AGGREGATE VIEW: Show breakdown across all users\nconsole.log(\"[DEBUG] Creating aggregate refunds tooltip for date \".concat(date));// Get aggregate data from dailyMetrics\nconst aggregateData=dailyMetrics[date];if(!aggregateData){console.warn(\"[WARN] No aggregate data found for date \".concat(date));return null;}// Count users contributing to each type of refund\nlet usersWithTrialRefunds=0;let usersWithSubscriptionRefunds=0;let totalUsers=0;// Analyze user daily metrics to get user counts\nObject.keys(userDailyMetrics).forEach(userId=>{const userMetrics=userDailyMetrics[userId][date];if(userMetrics){totalUsers++;if((userMetrics.estimated_trial_refund_component||0)>0){usersWithTrialRefunds++;}if((userMetrics.estimated_subscription_refund_component||0)>0){usersWithSubscriptionRefunds++;}}});return{value:totalRefunds,// THIS IS THE FIX: Add the component values so the tooltip can read them\nestimated_trial_refund_component:trialRefunds,estimated_subscription_refund_component:subscriptionRefunds,// We can reuse the estimated revenue component names since the tooltip is generic\nestimated_trial_revenue_component:trialRefunds,estimated_trial_converted_revenue_component:aggregateData.estimated_trial_converted_refund_component||0,estimated_initial_purchase_revenue_component:aggregateData.estimated_initial_purchase_refund_component||0,breakdown:{formula:'🔄 Aggregate Estimated Potential Refunds: Σ(Trial_Refunds) + Σ(Subscription_Refunds) across all users',calculation:\"Trial: $\".concat(trialRefunds.toFixed(2),\" (\").concat(usersWithTrialRefunds,\" users) + Subscription: $\").concat(subscriptionRefunds.toFixed(2),\" (\").concat(usersWithSubscriptionRefunds,\" users) = $\").concat(totalRefunds.toFixed(2)),components:{'View Type':'Aggregate (All Users)','Date':date,'Total Users':totalUsers,'Total Estimated Refunds (Potential)':\"$\".concat(totalRefunds.toFixed(2)),'Estimated Refunds from Trials (Potential)':\"$\".concat(trialRefunds.toFixed(2)),'Users with Trial Refunds':usersWithTrialRefunds,'Estimated Refunds from Subscriptions (Potential)':\"$\".concat(subscriptionRefunds.toFixed(2)),'Users with Subscription Refunds':usersWithSubscriptionRefunds,'Trial Refunds Explanation':'Refunds expected if pending trials convert then users request refunds','Subscription Refunds Explanation':'Refunds expected from active subscriptions based on age and historical patterns'},components_order:['View Type','Date','Total Users','Total Estimated Refunds (Potential)','Estimated Refunds from Trials (Potential)','Users with Trial Refunds','Estimated Refunds from Subscriptions (Potential)','Users with Subscription Refunds','Trial Refunds Explanation','Subscription Refunds Explanation']}};}// INDIVIDUAL USER VIEW: Show breakdown for specific user\n// Get the user's daily metrics for this date to access detailed breakdown\nconst userMetrics=userDailyMetrics[selectedUserId];if(!userMetrics||!userMetrics[date]){console.warn(\"[WARN] No user metrics found for user \".concat(selectedUserId,\" on date \").concat(date));return null;}const dayMetrics=userMetrics[date];const tooltipData=dayMetrics.tooltip_data;if(!tooltipData||!tooltipData.breakdown){console.warn(\"[WARN] No tooltip breakdown data found for estimated refunds\");return null;}// Extract components from the enhanced breakdown\nconst breakdown=tooltipData.breakdown;const components=breakdown.components||{};return{value:totalRefunds,breakdown:{formula:'🔄 Estimated Potential Refunds: Trial_Refunds + Subscription_Refunds',calculation:\"Trial: $\".concat(trialRefunds.toFixed(2),\" + Subscription: $\").concat(subscriptionRefunds.toFixed(2),\" = $\").concat(totalRefunds.toFixed(2)),components:{'View Type':'Individual User','Product ID':components['Product ID']||'Unknown','Current State':components['Current State']||'Unknown','Total Estimated Refunds (Potential)':\"$\".concat(totalRefunds.toFixed(2)),'Estimated Refunds from Trial (Potential)':\"$\".concat(trialRefunds.toFixed(2)),'Estimated Refunds from Subscription (Potential)':\"$\".concat(subscriptionRefunds.toFixed(2)),'Segment Base Refund Rate':components['Segment Base Refund Rate']||'Unknown','Current Refund Probability':components['Current Refund Probability']||components['Refund Likelihood']||'Unknown','Notes':trialRefunds>0?'Refunds expected if trial converts then user requests refund':'Refunds expected based on subscription age and historical patterns'},components_order:['View Type','Product ID','Current State','Total Estimated Refunds (Potential)','Estimated Refunds from Trial (Potential)','Estimated Refunds from Subscription (Potential)','Segment Base Refund Rate','Current Refund Probability','Notes']}};};// Define all metrics with their categories and data extraction logic\nconst metrics=[// Daily Absolute Values\n{key:'daily_trial_started',label:'Trial Started',category:'daily_absolute',categoryLabel:'Daily Absolute Values',getValue:date=>{var _filteredData$dailyMe;return((_filteredData$dailyMe=filteredData.dailyMetrics[date])===null||_filteredData$dailyMe===void 0?void 0:_filteredData$dailyMe.trial_started)||0;},getCumulativeValue:date=>{var _filteredData$cumulat;return((_filteredData$cumulat=filteredData.cumulativeMetrics[date])===null||_filteredData$cumulat===void 0?void 0:_filteredData$cumulat.cumulative_trial_started)||0;},format:formatNumber},{key:'daily_trial_pending',label:'Trial Pending',category:'daily_absolute',getValue:date=>{var _filteredData$dailyMe2;return((_filteredData$dailyMe2=filteredData.dailyMetrics[date])===null||_filteredData$dailyMe2===void 0?void 0:_filteredData$dailyMe2.trial_pending)||0;},// CRITICAL FIX: Trial pending is a state-based metric, cumulative should show same as daily\ngetCumulativeValue:date=>{var _filteredData$dailyMe3;return((_filteredData$dailyMe3=filteredData.dailyMetrics[date])===null||_filteredData$dailyMe3===void 0?void 0:_filteredData$dailyMe3.trial_pending)||0;},format:formatNumber},{key:'daily_trial_ended',label:'Trial Ended',category:'daily_absolute',getValue:date=>{var _filteredData$dailyMe4;return((_filteredData$dailyMe4=filteredData.dailyMetrics[date])===null||_filteredData$dailyMe4===void 0?void 0:_filteredData$dailyMe4.trial_ended)||0;},getCumulativeValue:date=>{var _filteredData$cumulat2;return((_filteredData$cumulat2=filteredData.cumulativeMetrics[date])===null||_filteredData$cumulat2===void 0?void 0:_filteredData$cumulat2.cumulative_trial_ended)||0;},format:formatNumber},{key:'daily_trial_cancelled',label:'Trial Cancelled',category:'daily_absolute',getValue:date=>{var _filteredData$dailyMe5;return((_filteredData$dailyMe5=filteredData.dailyMetrics[date])===null||_filteredData$dailyMe5===void 0?void 0:_filteredData$dailyMe5.trial_cancelled)||0;},getCumulativeValue:date=>{var _filteredData$cumulat3;return((_filteredData$cumulat3=filteredData.cumulativeMetrics[date])===null||_filteredData$cumulat3===void 0?void 0:_filteredData$cumulat3.cumulative_trial_cancelled)||0;},format:formatNumber},{key:'daily_trial_converted',label:'Trial Converted',category:'daily_absolute',getValue:date=>{var _filteredData$dailyMe6;return((_filteredData$dailyMe6=filteredData.dailyMetrics[date])===null||_filteredData$dailyMe6===void 0?void 0:_filteredData$dailyMe6.trial_converted)||0;},getCumulativeValue:date=>{var _filteredData$cumulat4;return((_filteredData$cumulat4=filteredData.cumulativeMetrics[date])===null||_filteredData$cumulat4===void 0?void 0:_filteredData$cumulat4.cumulative_trial_converted)||0;},format:formatNumber},{key:'daily_initial_purchase',label:'Initial Purchase',category:'daily_absolute',getValue:date=>{var _filteredData$dailyMe7;return((_filteredData$dailyMe7=filteredData.dailyMetrics[date])===null||_filteredData$dailyMe7===void 0?void 0:_filteredData$dailyMe7.initial_purchase)||0;},getCumulativeValue:date=>{var _filteredData$cumulat5;return((_filteredData$cumulat5=filteredData.cumulativeMetrics[date])===null||_filteredData$cumulat5===void 0?void 0:_filteredData$cumulat5.cumulative_initial_purchase)||0;},format:formatNumber},{key:'daily_subscription_active',label:'Subscription Active',category:'daily_absolute',getValue:date=>{var _filteredData$dailyMe8;return((_filteredData$dailyMe8=filteredData.dailyMetrics[date])===null||_filteredData$dailyMe8===void 0?void 0:_filteredData$dailyMe8.subscription_active)||0;},// CRITICAL FIX: Subscription active is a state-based metric, cumulative should show same as daily\ngetCumulativeValue:date=>{var _filteredData$dailyMe9;return((_filteredData$dailyMe9=filteredData.dailyMetrics[date])===null||_filteredData$dailyMe9===void 0?void 0:_filteredData$dailyMe9.subscription_active)||0;},format:formatNumber},{key:'daily_subscription_cancelled',label:'Subscription Cancelled',category:'daily_absolute',getValue:date=>{var _filteredData$dailyMe0;return((_filteredData$dailyMe0=filteredData.dailyMetrics[date])===null||_filteredData$dailyMe0===void 0?void 0:_filteredData$dailyMe0.subscription_cancelled)||0;},getCumulativeValue:date=>{var _filteredData$cumulat6;return((_filteredData$cumulat6=filteredData.cumulativeMetrics[date])===null||_filteredData$cumulat6===void 0?void 0:_filteredData$cumulat6.cumulative_subscription_cancelled)||0;},format:formatNumber},{key:'daily_users',label:'Daily Users',category:'daily_absolute',getValue:date=>{var _filteredData$dailyMe1;return((_filteredData$dailyMe1=filteredData.dailyMetrics[date])===null||_filteredData$dailyMe1===void 0?void 0:_filteredData$dailyMe1.daily_users)||0;},getCumulativeValue:date=>{var _filteredData$dailyMe10;return((_filteredData$dailyMe10=filteredData.dailyMetrics[date])===null||_filteredData$dailyMe10===void 0?void 0:_filteredData$dailyMe10.cumulative_users)||0;},format:formatNumber},{key:'daily_refund_count',label:'Refunds',category:'daily_absolute',getValue:date=>{var _filteredData$dailyMe11;return((_filteredData$dailyMe11=filteredData.dailyMetrics[date])===null||_filteredData$dailyMe11===void 0?void 0:_filteredData$dailyMe11.refund_count)||0;},getCumulativeValue:date=>{var _filteredData$cumulat7;return((_filteredData$cumulat7=filteredData.cumulativeMetrics[date])===null||_filteredData$cumulat7===void 0?void 0:_filteredData$cumulat7.cumulative_refund_count)||0;},format:formatNumber},// Revenue Values\n{key:'daily_revenue',label:'Revenue',category:'revenue',categoryLabel:'Revenue Values',getValue:date=>{var _filteredData$dailyMe12;return((_filteredData$dailyMe12=filteredData.dailyMetrics[date])===null||_filteredData$dailyMe12===void 0?void 0:_filteredData$dailyMe12.revenue)||0;},getCumulativeValue:date=>{var _filteredData$cumulat8;return((_filteredData$cumulat8=filteredData.cumulativeMetrics[date])===null||_filteredData$cumulat8===void 0?void 0:_filteredData$cumulat8.cumulative_revenue)||0;},format:formatCurrency,isRevenue:true,// NEW: Mark this as revenue for tooltip handling\ngetTooltipData:date=>{var _filteredData$cumulat9,_filteredData$dailyMe13;const value=showCumulative?((_filteredData$cumulat9=filteredData.cumulativeMetrics[date])===null||_filteredData$cumulat9===void 0?void 0:_filteredData$cumulat9.cumulative_revenue)||0:((_filteredData$dailyMe13=filteredData.dailyMetrics[date])===null||_filteredData$dailyMe13===void 0?void 0:_filteredData$dailyMe13.revenue)||0;return getRevenueTooltipData(date,value);}},{key:'daily_refund',label:'Refunds',category:'revenue',getValue:date=>{var _filteredData$dailyMe14;return((_filteredData$dailyMe14=filteredData.dailyMetrics[date])===null||_filteredData$dailyMe14===void 0?void 0:_filteredData$dailyMe14.refund)||0;},getCumulativeValue:date=>{var _filteredData$cumulat0;return((_filteredData$cumulat0=filteredData.cumulativeMetrics[date])===null||_filteredData$cumulat0===void 0?void 0:_filteredData$cumulat0.cumulative_refund)||0;},format:formatCurrency,isRefund:true,// NEW: Mark this as refund for tooltip handling\ngetTooltipData:date=>{var _filteredData$cumulat1,_filteredData$dailyMe15;const value=showCumulative?((_filteredData$cumulat1=filteredData.cumulativeMetrics[date])===null||_filteredData$cumulat1===void 0?void 0:_filteredData$cumulat1.cumulative_refund)||0:((_filteredData$dailyMe15=filteredData.dailyMetrics[date])===null||_filteredData$dailyMe15===void 0?void 0:_filteredData$dailyMe15.refund)||0;return getRefundTooltipData(date,value);}},{key:'daily_revenue_net',label:'Net Revenue',category:'revenue',getValue:date=>{var _filteredData$dailyMe16;return((_filteredData$dailyMe16=filteredData.dailyMetrics[date])===null||_filteredData$dailyMe16===void 0?void 0:_filteredData$dailyMe16.revenue_net)||0;},getCumulativeValue:date=>{var _filteredData$cumulat10;return((_filteredData$cumulat10=filteredData.cumulativeMetrics[date])===null||_filteredData$cumulat10===void 0?void 0:_filteredData$cumulat10.cumulative_revenue_net)||0;},format:formatCurrency},{key:'daily_estimated_revenue',label:'Estimated Revenue',category:'revenue',isEstimatedRevenue:true,getValue:date=>{var _filteredData$dailyMe17;return((_filteredData$dailyMe17=filteredData.dailyMetrics[date])===null||_filteredData$dailyMe17===void 0?void 0:_filteredData$dailyMe17.estimated_revenue)||0;},// CRITICAL FIX: Estimated revenue is a state-based metric, cumulative should show same as daily\ngetCumulativeValue:date=>{var _filteredData$dailyMe18;return((_filteredData$dailyMe18=filteredData.dailyMetrics[date])===null||_filteredData$dailyMe18===void 0?void 0:_filteredData$dailyMe18.estimated_revenue)||0;},format:formatCurrency,getTooltipData:date=>{var _filteredData$dailyMe19,_filteredData$dailyMe20;const value=showCumulative?((_filteredData$dailyMe19=filteredData.dailyMetrics[date])===null||_filteredData$dailyMe19===void 0?void 0:_filteredData$dailyMe19.estimated_revenue)||0// Same as daily for state-based\n:((_filteredData$dailyMe20=filteredData.dailyMetrics[date])===null||_filteredData$dailyMe20===void 0?void 0:_filteredData$dailyMe20.estimated_revenue)||0;return getEstimatedRevenueTooltipData(date,value);}},{key:'daily_estimated_refunds',label:'Estimated Refunds (Potential)',category:'revenue',isEstimatedRefunds:true,getValue:date=>{const dailyData=filteredData.dailyMetrics[date];const trialRefunds=(dailyData===null||dailyData===void 0?void 0:dailyData.estimated_trial_refund_component)||0;const subscriptionRefunds=(dailyData===null||dailyData===void 0?void 0:dailyData.estimated_subscription_refund_component)||0;return trialRefunds+subscriptionRefunds;},// CRITICAL FIX: Estimated refunds is a state-based metric, cumulative should show same as daily\ngetCumulativeValue:date=>{const dailyData=filteredData.dailyMetrics[date];const trialRefunds=(dailyData===null||dailyData===void 0?void 0:dailyData.estimated_trial_refund_component)||0;const subscriptionRefunds=(dailyData===null||dailyData===void 0?void 0:dailyData.estimated_subscription_refund_component)||0;return trialRefunds+subscriptionRefunds;},format:formatCurrency,getTooltipData:date=>{const dailyData=filteredData.dailyMetrics[date];const trialRefunds=(dailyData===null||dailyData===void 0?void 0:dailyData.estimated_trial_refund_component)||0;const subscriptionRefunds=(dailyData===null||dailyData===void 0?void 0:dailyData.estimated_subscription_refund_component)||0;const totalRefunds=trialRefunds+subscriptionRefunds;if(totalRefunds===0){return null;// Don't show tooltip for $0 values\n}return getEstimatedRefundsTooltipData(date,trialRefunds,subscriptionRefunds,totalRefunds);}}];// Group metrics by category\nconst groupedMetrics=metrics.reduce((acc,metric)=>{if(!acc[metric.category]){acc[metric.category]={label:metric.categoryLabel||metric.category,metrics:[]};}acc[metric.category].metrics.push(metric);return acc;},{});return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"mb-8 bg-white dark:bg-gray-700 p-6 rounded-lg shadow-md\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between items-center mb-4\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-2xl font-bold text-gray-800 dark:text-white\",children:\"Daily Event & Revenue Timeline\"}),/*#__PURE__*/_jsx(\"div\",{className:\"flex gap-2\",children:/*#__PURE__*/_jsx(\"button\",{onClick:()=>setShowCumulative(!showCumulative),className:\"px-3 py-1 text-sm rounded-full \".concat(showCumulative?'bg-blue-500 text-white':'bg-gray-200 dark:bg-gray-600 text-gray-700 dark:text-white'),children:showCumulative?'Show Daily':'Show Cumulative'})})]}),/*#__PURE__*/_jsx(\"div\",{className:\"overflow-x-auto\",children:/*#__PURE__*/_jsxs(\"table\",{className:\"min-w-full text-sm border dark:border-gray-600\",children:[/*#__PURE__*/_jsx(\"thead\",{className:\"bg-gray-50 dark:bg-gray-700\",children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{className:\"p-2 border-b dark:border-gray-600 text-left text-gray-700 dark:text-white sticky left-0 bg-gray-50 dark:bg-gray-700 z-10 min-w-[200px]\",children:\"Metric\"}),dates.map(date=>/*#__PURE__*/_jsx(\"th\",{className:\"p-2 border-b dark:border-gray-600 text-center text-gray-700 dark:text-white whitespace-nowrap min-w-[80px]\",children:date},date))]})}),/*#__PURE__*/_jsx(\"tbody\",{className:\"bg-white dark:bg-gray-800\",children:Object.entries(groupedMetrics).map(_ref9=>{let[categoryKey,category]=_ref9;return/*#__PURE__*/_jsxs(React.Fragment,{children:[/*#__PURE__*/_jsx(\"tr\",{className:\"bg-gray-100 dark:bg-gray-600\",children:/*#__PURE__*/_jsx(\"td\",{colSpan:dates.length+1,className:\"p-2 font-semibold text-gray-800 dark:text-white border-b dark:border-gray-600\",children:category.label})}),category.metrics.map(metric=>/*#__PURE__*/_jsxs(\"tr\",{className:\"hover:bg-gray-50 dark:hover:bg-gray-700\",children:[/*#__PURE__*/_jsx(\"td\",{className:\"p-2 border-b dark:border-gray-600 font-medium text-gray-700 dark:text-white sticky left-0 bg-white dark:bg-gray-800 z-10\",children:metric.label}),dates.map(date=>{const value=showCumulative?metric.getCumulativeValue(date):metric.getValue(date);return/*#__PURE__*/_jsx(\"td\",{className:\"p-2 border-b dark:border-gray-600 text-center text-gray-700 dark:text-white \".concat(metric.isEstimatedRevenue||metric.isRevenue||metric.isRefund||metric.isEstimatedRefunds?'cursor-help hover:bg-yellow-50 dark:hover:bg-yellow-900/20 relative':''),onMouseEnter:metric.isRevenue||metric.isRefund||metric.isEstimatedRevenue||metric.isEstimatedRefunds?e=>{// This logic block now correctly only runs for the aggregate view.\nif(tooltipTimeoutRef.current)clearTimeout(tooltipTimeoutRef.current);tooltipTimeoutRef.current=setTimeout(()=>{const rect=e.target.getBoundingClientRect();const tooltipData=metric.getTooltipData(date,value);if(tooltipData){// Smart positioning: check available space\nconst tooltipWidth=400;// Estimated tooltip width (updated for w-96 class)\nconst tooltipHeight=480;// Estimated tooltip height\nconst spaceOnRight=window.innerWidth-rect.right;const spaceOnLeft=rect.left;let xPosition,yPosition;// Choose horizontal position based on available space\nif(spaceOnRight>=tooltipWidth+20){// Enough space on the right\nxPosition=rect.right+10;}else if(spaceOnLeft>=tooltipWidth+20){// Not enough space on right, but enough on left\nxPosition=rect.left-tooltipWidth-10;}else{// Not enough space on either side, center it\nxPosition=Math.max(10,(window.innerWidth-tooltipWidth)/2);}// Vertical position: position so BOTTOM of tooltip aligns with cell center\nconst cellCenterY=rect.top+rect.height/2;yPosition=Math.max(10,cellCenterY-tooltipHeight-200);// Move up by 200 pixels\n// Ensure tooltip doesn't go below screen\nyPosition=Math.min(yPosition,window.innerHeight-tooltipHeight-10);let tooltipType='estimated_revenue';if(metric.isRevenue)tooltipType='revenue';else if(metric.isRefund)tooltipType='refund';else if(metric.isEstimatedRefunds)tooltipType='estimated_refunds';setActiveTooltip({type:tooltipType,data:tooltipData,position:{x:xPosition,y:yPosition}});}},150);}:undefined,onMouseLeave:metric.isEstimatedRevenue||metric.isRevenue||metric.isRefund||metric.isEstimatedRefunds?()=>{// Handle mouse leave for tooltips\n// Clear the show timeout if mouse leaves before tooltip appears\nif(tooltipTimeoutRef.current){clearTimeout(tooltipTimeoutRef.current);tooltipTimeoutRef.current=null;}// Set a timeout to hide the tooltip, allowing time to move to tooltip\nconst hideTimeout=setTimeout(()=>{setActiveTooltip(null);},100);// Shorter delay for quicker hiding\ntooltipTimeoutRef.current=hideTimeout;}:undefined,children:metric.format(value)},date);})]},metric.key))]},categoryKey);})})]})}),dates.length===0&&/*#__PURE__*/_jsx(\"div\",{className:\"text-center py-8\",children:/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-500 dark:text-gray-400\",children:\"No timeline data available. Run an analysis to see results.\"})})]}),(activeTooltip===null||activeTooltip===void 0?void 0:activeTooltip.type)==='estimated_revenue'&&/*#__PURE__*/_jsx(EstimatedRevenueTooltip,{data:activeTooltip.data,position:activeTooltip.position,onClose:()=>setActiveTooltip(null),selectedUserId:selectedUserId,selectedProductId:selectedProductId}),(activeTooltip===null||activeTooltip===void 0?void 0:activeTooltip.type)==='revenue'&&/*#__PURE__*/_jsx(ActualRevenueTooltip,{data:activeTooltip.data,position:activeTooltip.position,onClose:()=>setActiveTooltip(null),selectedUserId:selectedUserId,selectedProductId:selectedProductId}),(activeTooltip===null||activeTooltip===void 0?void 0:activeTooltip.type)==='refund'&&/*#__PURE__*/_jsx(ActualRefundTooltip,{data:activeTooltip.data,position:activeTooltip.position,onClose:()=>setActiveTooltip(null),selectedUserId:selectedUserId,selectedProductId:selectedProductId}),(activeTooltip===null||activeTooltip===void 0?void 0:activeTooltip.type)==='estimated_refunds'&&/*#__PURE__*/_jsx(EstimatedRevenueTooltip,{data:activeTooltip.data,position:activeTooltip.position,onClose:()=>setActiveTooltip(null),selectedUserId:selectedUserId,selectedProductId:selectedProductId})]});};export default EventTimelineTableV3;","map":{"version":3,"names":["React","useState","useMemo","jsxs","_jsxs","jsx","_jsx","Fragment","_Fragment","EstimatedRevenueTooltip","_ref","_breakdown$total","_breakdown$total2","_breakdown$total3","_breakdown$total4","_breakdown$total5","_breakdown$total6","_breakdown$total7","data","position","onClose","isHovered","setIsHovered","closeTimeoutRef","useRef","handleMouseEnter","clearTimeout","current","handleMouseLeave","setTimeout","breakdown","totalValue","total","final_net_revenue","renderSection","title","sectionData","hasData","users","estimated_revenue","actual_revenue","className","children","concat","hasOwnProperty","toFixed","actual_refunds","estimated_refunds","net_estimated_revenue","net_revenue_after_estimated_refunds","style","left","x","top","y","onMouseEnter","onMouseLeave","onClick","trialConverted","trial_converted","initialPurchase","initial_purchase","showTrialRatio","showInitialRatio","revenue","estimatedRefunds","refundRate","pending_trial","total_actual_revenue","total_actual_refunds","total_net_revenue","est_revenue_from_trials","est_refunds_from_all_sources","ActualRevenueTooltip","_ref2","value","sources","buckets","pointerEvents","Object","keys","length","entries","map","_ref3","source","stats","count","sort","_ref4","bucket","ActualRefundTooltip","_ref5","_ref6","_ref7","EventTimelineTableV3","_ref8","_data$data","selectedUserId","selectedProductId","showCumulative","setShowCumulative","activeTooltip","setActiveTooltip","tooltipTimeoutRef","timelineData","dates","dailyMetrics","cumulativeMetrics","userTimelines","userDailyMetrics","daily_metrics","cumulative_metrics","user_timelines","user_daily_metrics","console","log","firstUserId","firstUserData","firstDate","firstDateData","tooltip_data","selectedUserData","sampleDate","sampleDateData","targetUser","targetDate","includes","dayData","useEffect","hasDataData","dataKeys","dataDataKeys","slice","availableUsers","availableProducts","Set","products","forEach","userId","add","_userTimeline$summary","userTimeline","events","event","product_id","summary","product_summaries","productId","values","_dayData$estimated_re","estimated_revenue_breakdown","user_breakdowns","userBreakdown","product_breakdowns","Array","from","filteredData","filteredDaily","filteredCumulative","isTargetUser","userMetrics","cumulativeValues","trial_started","trial_ended","trial_cancelled","subscription_cancelled","refund","refund_count","date","userDayMetrics","_objectSpread","revenue_net","trial_pending","subscription_active","cumulative_trial_started","cumulative_trial_ended","cumulative_trial_converted","cumulative_trial_cancelled","cumulative_initial_purchase","cumulative_subscription_cancelled","cumulative_revenue","cumulative_refund","cumulative_refund_count","cumulative_revenue_net","warn","formatCurrency","undefined","rounded","Math","round","Number","toLocaleString","formatNumber","getEstimatedRevenueTooltipData","safeValue","formula","calculation","components","substring","components_order","aggregateData","breakdownData","estimated_trial_revenue_component","total_trial_revenue","estimated_trial_converted_revenue_component","total_trial_converted_revenue","estimated_initial_purchase_revenue_component","total_initial_purchase_revenue","estimated_trial_refund_component","total_trial_refunds","estimated_trial_converted_refund_component","total_trial_converted_refunds","estimated_initial_purchase_refund_component","total_initial_purchase_refunds","getRevenueTooltipData","_dailyMetrics$date","tooltipData","revenue_tooltip_data","getRefundTooltipData","_dailyMetrics$date2","refund_tooltip_data","getEstimatedRefundsTooltipData","trialRefunds","subscriptionRefunds","totalRefunds","isAggregateView","usersWithTrialRefunds","usersWithSubscriptionRefunds","totalUsers","estimated_subscription_refund_component","dayMetrics","metrics","key","label","category","categoryLabel","getValue","_filteredData$dailyMe","getCumulativeValue","_filteredData$cumulat","format","_filteredData$dailyMe2","_filteredData$dailyMe3","_filteredData$dailyMe4","_filteredData$cumulat2","_filteredData$dailyMe5","_filteredData$cumulat3","_filteredData$dailyMe6","_filteredData$cumulat4","_filteredData$dailyMe7","_filteredData$cumulat5","_filteredData$dailyMe8","_filteredData$dailyMe9","_filteredData$dailyMe0","_filteredData$cumulat6","_filteredData$dailyMe1","daily_users","_filteredData$dailyMe10","cumulative_users","_filteredData$dailyMe11","_filteredData$cumulat7","_filteredData$dailyMe12","_filteredData$cumulat8","isRevenue","getTooltipData","_filteredData$cumulat9","_filteredData$dailyMe13","_filteredData$dailyMe14","_filteredData$cumulat0","isRefund","_filteredData$cumulat1","_filteredData$dailyMe15","_filteredData$dailyMe16","_filteredData$cumulat10","isEstimatedRevenue","_filteredData$dailyMe17","_filteredData$dailyMe18","_filteredData$dailyMe19","_filteredData$dailyMe20","isEstimatedRefunds","dailyData","groupedMetrics","reduce","acc","metric","push","_ref9","categoryKey","colSpan","e","rect","target","getBoundingClientRect","tooltipWidth","tooltipHeight","spaceOnRight","window","innerWidth","right","spaceOnLeft","xPosition","yPosition","max","cellCenterY","height","min","innerHeight","tooltipType","type","hideTimeout"],"sources":["/Users/joshuakaufman/untitled folder 3/orchestrator/dashboard/client/src/cohort-pipeline/components/EventTimelineTableV3.js"],"sourcesContent":["import React, { useState, useMemo } from 'react';\n\n/*\n * ========================================\n * ENHANCED ESTIMATED REVENUE & REFUND TRACKING\n * ========================================\n * \n * This component has been enhanced to support granular tracking of estimated refunds\n * (trial vs. subscription) and estimated revenue (trial vs. subscription contributions),\n * with detailed breakdown data for frontend tooltips.\n * \n * NEW FEATURES (TODOs 4 & 5 IMPLEMENTED):\n * \n * 1. Enhanced Estimated Revenue Tooltip (TODO 5):\n *    - Now shows 3-category breakdown:\n *      - \"From Pending Trials\": Revenue from users still in trial\n *      - \"From Trial Conversions\": Revenue from users who converted from trial\n *      - \"From Initial Purchases\": Revenue from users who purchased directly\n *    - Uses new backend data: estimated_trial_converted_revenue_component, estimated_initial_purchase_revenue_component\n * \n * 2. Separate Tooltip Components (TODO 4):\n *    - ActualRevenueTooltip: Handles actual revenue event details with sources\n *    - ActualRefundTooltip: Handles actual refund event details with sources  \n *    - EstimatedRevenueTooltip: Handles estimated revenue with 3-category breakdown\n *    - Updated state management to activeTooltip with type differentiation\n * \n * 3. Enhanced State Management (TODO 4):\n *    - Changed from tooltipData/tooltipPosition to activeTooltip object\n *    - activeTooltip contains: { type, data, position } for better type handling\n *    - Mouse event handlers updated to handle different tooltip types\n * \n * DATA STRUCTURE CHANGES:\n * \n * Per-user daily metrics (consolidated_user_daily_metrics[user_id][date_str]):\n *   - estimated_trial_converted_revenue_component: NEW - Revenue from trial conversions  \n *   - estimated_initial_purchase_revenue_component: NEW - Revenue from direct purchases\n *   - revenue_sources: NEW - Array of detailed revenue event sources\n *   - refund_sources: NEW - Array of detailed refund event sources\n * \n * Aggregated daily metrics (timeline_data[date_str]):\n *   - estimated_trial_converted_revenue_component: NEW - Aggregated trial conversion revenue\n *   - estimated_initial_purchase_revenue_component: NEW - Aggregated direct purchase revenue\n *   - users_from_trial_conversion: NEW - Count of users with trial conversion revenue\n *   - users_from_initial_purchase: NEW - Count of users with direct purchase revenue\n * \n * BUSINESS LOGIC NOTES:\n * \n * - Trial refunds: conversion_rate * base_refund_rate * price\n *   (Potential refunds IF trial converts AND user requests refund)\n * \n * - Subscription refunds: actual_conversion_revenue * current_refund_rate\n *   (Refunds based on subscription age, degrading linearly over 30 days)\n * \n * - All calculations come from backend state_models.py - NO business logic in frontend\n * \n * TOOLTIP PLACEMENT:\n * - \"Estimated Refunds (Potential)\" metric is placed in the \"Revenue Values\" category\n * - Positioned between \"Net Revenue\" and \"Estimated Revenue\" as requested\n */\n\nconst EstimatedRevenueTooltip = ({ data, position, onClose }) => {\n    // Basic mouse hover logic to keep the tooltip open\n    const [isHovered, setIsHovered] = React.useState(false);\n    const closeTimeoutRef = React.useRef(null);\n    const handleMouseEnter = () => { setIsHovered(true); clearTimeout(closeTimeoutRef.current); };\n    const handleMouseLeave = () => { setIsHovered(false); closeTimeoutRef.current = setTimeout(onClose, 300); };\n    \n    if (!data || !data.breakdown) return null;\n\n    const { breakdown } = data;\n    const totalValue = breakdown.total?.final_net_revenue || 0;\n\n    // Helper to render a section only if it has meaningful data\n    const renderSection = (title, sectionData) => {\n        // First check if sectionData exists\n        if (!sectionData) return null;\n        \n        // A section is meaningful if it has users or any revenue/refund data\n        const hasData = sectionData.users > 0 || sectionData.estimated_revenue || sectionData.actual_revenue;\n        if (!hasData) return null;\n\n        return (\n            <div className=\"border-b border-gray-700 pb-2 mb-2\">\n                <h5 className=\"font-bold text-blue-300 mb-2\">{title} {sectionData.users > 0 ? `(${sectionData.users} users)` : ''}</h5>\n                <div className=\"grid grid-cols-2 gap-x-4 text-xs\">\n                    {/* Render fields based on what the section contains */}\n                    {sectionData.hasOwnProperty('estimated_revenue') && <div>Est. Revenue:</div>}\n                    {sectionData.hasOwnProperty('estimated_revenue') && <div className=\"text-right font-mono\">${sectionData.estimated_revenue.toFixed(2)}</div>}\n                    \n                    {sectionData.hasOwnProperty('actual_revenue') && <div>Actual Revenue:</div>}\n                    {sectionData.hasOwnProperty('actual_revenue') && <div className=\"text-right font-mono\">${sectionData.actual_revenue.toFixed(2)}</div>}\n                    \n                    {sectionData.hasOwnProperty('actual_refunds') && <div>Actual Refunds:</div>}\n                    {sectionData.hasOwnProperty('actual_refunds') && <div className=\"text-right font-mono text-red-400\">-${sectionData.actual_refunds.toFixed(2)}</div>}\n\n                    {sectionData.hasOwnProperty('estimated_refunds') && <div>Est. Refunds:</div>}\n                    {sectionData.hasOwnProperty('estimated_refunds') && <div className=\"text-right font-mono text-yellow-400\">-${sectionData.estimated_refunds.toFixed(2)}</div>}\n                    \n                    {/* Render Net values */}\n                    <div className=\"border-t border-gray-600 mt-1 pt-1\">Net Revenue:</div>\n                    <div className=\"text-right font-mono border-t border-gray-600 mt-1 pt-1\">\n                        {sectionData.hasOwnProperty('net_estimated_revenue') ? `$${sectionData.net_estimated_revenue.toFixed(2)}` :\n                         sectionData.hasOwnProperty('net_revenue_after_estimated_refunds') ? `$${sectionData.net_revenue_after_estimated_refunds.toFixed(2)}` :\n                         `$${(sectionData.actual_revenue - sectionData.actual_refunds).toFixed(2)}`}\n                    </div>\n                </div>\n            </div>\n        );\n    };\n\n    return (\n        <div\n            className=\"fixed z-50 bg-gray-800 border border-gray-600 text-white rounded-lg shadow-lg p-4 w-96 pointer-events-auto\"\n            style={{ left: position.x, top: position.y }}\n            onMouseEnter={handleMouseEnter}\n            onMouseLeave={handleMouseLeave}\n        >\n            <div className=\"flex justify-between items-start mb-3\">\n                <h4 className=\"font-semibold\">Est. Net Revenue: ${totalValue.toFixed(2)}</h4>\n                <button onClick={onClose} className=\"text-gray-400 hover:text-gray-200\">&times;</button>\n            </div>\n            \n            {/* NEW: Refund Rate Ratios - Show prominently at the top */}\n            {(() => {\n                const trialConverted = breakdown.trial_converted || {};\n                const initialPurchase = breakdown.initial_purchase || {};\n                \n                const showTrialRatio = trialConverted.actual_revenue > 0;\n                const showInitialRatio = initialPurchase.actual_revenue > 0;\n                \n                if (!showTrialRatio && !showInitialRatio) return null;\n                \n                return (\n                    <div className=\"bg-blue-900 p-3 rounded-lg border border-blue-600 mb-3\">\n                        <div className=\"text-sm font-medium text-blue-200 mb-2\">\n                            🎯 Refund Rate Analysis\n                        </div>\n                        \n                        {showTrialRatio && (\n                            <div className=\"mb-2\">\n                                <div className=\"text-xs font-medium text-blue-300\">\n                                    Trial Conversion Refund Rate:\n                                </div>\n                                <div className=\"text-sm font-bold text-blue-100\">\n                                    {(() => {\n                                        const revenue = trialConverted.actual_revenue || 0;\n                                        const estimatedRefunds = trialConverted.estimated_refunds || 0;\n                                        const refundRate = revenue > 0 ? (estimatedRefunds / revenue) * 100 : 0;\n                                        return `${estimatedRefunds.toFixed(2)} / ${revenue.toFixed(2)} = ${refundRate.toFixed(1)}%`;\n                                    })()}\n                                </div>\n                                <div className=\"text-xs text-blue-400\">\n                                    ${(trialConverted.estimated_refunds || 0).toFixed(2)} estimated refunds on ${(trialConverted.actual_revenue || 0).toFixed(2)} revenue\n                                </div>\n                            </div>\n                        )}\n                        \n                        {showInitialRatio && (\n                            <div>\n                                <div className=\"text-xs font-medium text-blue-300\">\n                                    Initial Purchase Refund Rate:\n                                </div>\n                                <div className=\"text-sm font-bold text-blue-100\">\n                                    {(() => {\n                                        const revenue = initialPurchase.actual_revenue || 0;\n                                        const estimatedRefunds = initialPurchase.estimated_refunds || 0;\n                                        const refundRate = revenue > 0 ? (estimatedRefunds / revenue) * 100 : 0;\n                                        return `${estimatedRefunds.toFixed(2)} / ${revenue.toFixed(2)} = ${refundRate.toFixed(1)}%`;\n                                    })()}\n                                </div>\n                                <div className=\"text-xs text-blue-400\">\n                                    ${(initialPurchase.estimated_refunds || 0).toFixed(2)} estimated refunds on ${(initialPurchase.actual_revenue || 0).toFixed(2)} revenue\n                                </div>\n                            </div>\n                        )}\n                    </div>\n                );\n            })()}\n            \n            {renderSection('-- Pending Trial --', breakdown.pending_trial)}\n            {renderSection('-- Trial Converted --', breakdown.trial_converted)}\n            {renderSection('-- Initial Purchase --', breakdown.initial_purchase)}\n\n            {/* Total Section */}\n            <div className=\"pt-2\">\n                <h5 className=\"font-bold text-green-300 mb-2\">-- Total --</h5>\n                <div className=\"grid grid-cols-2 gap-x-4 text-xs\">\n                    <div>Total Actual Revenue:</div>\n                    <div className=\"text-right font-mono\">${(breakdown.total?.total_actual_revenue || 0).toFixed(2)}</div>\n                    \n                    <div>Total Actual Refunds:</div>\n                    <div className=\"text-right font-mono text-red-400\">-${(breakdown.total?.total_actual_refunds || 0).toFixed(2)}</div>\n                    \n                    <div>Total Net Revenue:</div>\n                    <div className=\"text-right font-mono\">${(breakdown.total?.total_net_revenue || 0).toFixed(2)}</div>\n                    \n                    <div>Est. Revenue (from trials):</div>\n                    <div className=\"text-right font-mono\">${(breakdown.total?.est_revenue_from_trials || 0).toFixed(2)}</div>\n                    \n                    <div>Est. Refunds (from pending trials, trial converted, and initial purchase):</div>\n                    <div className=\"text-right font-mono text-yellow-400\">-${(breakdown.total?.est_refunds_from_all_sources || 0).toFixed(2)}</div>\n                    \n                    <div className=\"font-bold border-t border-gray-600 mt-1 pt-1\">Final Net Revenue:</div>\n                    <div className=\"font-bold text-right font-mono border-t border-gray-600 mt-1 pt-1\">${(breakdown.total?.final_net_revenue || 0).toFixed(2)}</div>\n                </div>\n            </div>\n        </div>\n    );\n};\n\n// CORRECTED - Final version of the component\nconst ActualRevenueTooltip = ({ data, position, onClose }) => {\n    const [isHovered, setIsHovered] = React.useState(false);\n    const closeTimeoutRef = React.useRef(null);\n    \n    if (!data) return null;\n    \n    const { value = 0, sources = {}, buckets = {} } = data;\n    \n    const handleMouseEnter = () => {\n        setIsHovered(true);\n        if (closeTimeoutRef.current) {\n            clearTimeout(closeTimeoutRef.current);\n            closeTimeoutRef.current = null;\n        }\n    };\n    \n    const handleMouseLeave = () => {\n        setIsHovered(false);\n        closeTimeoutRef.current = setTimeout(() => {\n            onClose();\n        }, 300);\n    };\n    \n    return (\n        <div \n            className=\"fixed z-50 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-600 rounded-lg shadow-lg p-4 max-w-md pointer-events-auto\"\n            style={{\n                left: position.x,\n                top: position.y,\n                pointerEvents: 'auto'\n            }}\n            onMouseEnter={handleMouseEnter}\n            onMouseLeave={handleMouseLeave}\n        >\n            <div className=\"flex justify-between items-start mb-3\">\n                <h4 className=\"font-semibold text-lg text-gray-900 dark:text-white\">Actual Revenue: ${value.toFixed(2)}</h4>\n                <button onClick={onClose} className=\"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 ml-2\">&times;</button>\n            </div>\n            <div className=\"space-y-3 text-xs\">\n                <div>\n                    <h5 className=\"font-bold text-sm text-gray-700 dark:text-gray-300 mb-1\">By Source</h5>\n                    {Object.keys(sources).length > 0 ? Object.entries(sources).map(([source, stats]) => (\n                        <div key={source} className=\"flex justify-between\"><span className=\"text-gray-600 dark:text-gray-400\">{source}:</span><span className=\"font-medium text-gray-800 dark:text-gray-200\">{stats.count} txn, ${stats.total.toFixed(2)}</span></div>\n                    )) : <p className=\"text-gray-500 italic\">No source data.</p>}\n                </div>\n                <div className=\"border-t dark:border-gray-600 pt-2\">\n                    <h5 className=\"font-bold text-sm text-gray-700 dark:text-gray-300 mb-1\">By Amount ($5 Buckets)</h5>\n                    {Object.keys(buckets).length > 0 ? Object.entries(buckets).sort().map(([bucket, count]) => (\n                        <div key={bucket} className=\"flex justify-between\"><span className=\"text-gray-600 dark:text-gray-400\">{bucket}:</span><span className=\"font-medium text-gray-800 dark:text-gray-200\">{count} transactions</span></div>\n                    )) : <p className=\"text-gray-500 italic\">No bucket data.</p>}\n                </div>\n            </div>\n        </div>\n    );\n};\n\n// CORRECTED - Final version of the component\nconst ActualRefundTooltip = ({ data, position, onClose }) => {\n    const [isHovered, setIsHovered] = React.useState(false);\n    const closeTimeoutRef = React.useRef(null);\n    \n    if (!data) return null;\n    \n    const { value = 0, sources = {}, buckets = {} } = data;\n    \n    const handleMouseEnter = () => {\n        setIsHovered(true);\n        if (closeTimeoutRef.current) {\n            clearTimeout(closeTimeoutRef.current);\n            closeTimeoutRef.current = null;\n        }\n    };\n    \n    const handleMouseLeave = () => {\n        setIsHovered(false);\n        closeTimeoutRef.current = setTimeout(() => {\n            onClose();\n        }, 300);\n    };\n    \n    return (\n        <div \n            className=\"fixed z-50 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-600 rounded-lg shadow-lg p-4 max-w-md pointer-events-auto\"\n            style={{\n                left: position.x,\n                top: position.y,\n                pointerEvents: 'auto'\n            }}\n            onMouseEnter={handleMouseEnter}\n            onMouseLeave={handleMouseLeave}\n        >\n            <div className=\"flex justify-between items-start mb-3\">\n                <h4 className=\"font-semibold text-lg text-gray-900 dark:text-white\">Actual Refunds: ${value.toFixed(2)}</h4>\n                <button onClick={onClose} className=\"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 ml-2\">&times;</button>\n            </div>\n            <div className=\"space-y-3 text-xs\">\n                <div>\n                    <h5 className=\"font-bold text-sm text-gray-700 dark:text-gray-300 mb-1\">By Source</h5>\n                    {Object.keys(sources).length > 0 ? Object.entries(sources).map(([source, stats]) => (\n                        <div key={source} className=\"flex justify-between\"><span className=\"text-gray-600 dark:text-gray-400\">{source}:</span><span className=\"font-medium text-gray-800 dark:text-gray-200\">{stats.count} txn, ${stats.total.toFixed(2)}</span></div>\n                    )) : <p className=\"text-gray-500 italic\">No source data.</p>}\n                </div>\n                <div className=\"border-t dark:border-gray-600 pt-2\">\n                    <h5 className=\"font-bold text-sm text-gray-700 dark:text-gray-300 mb-1\">By Amount ($5 Buckets)</h5>\n                    {Object.keys(buckets).length > 0 ? Object.entries(buckets).sort().map(([bucket, count]) => (\n                        <div key={bucket} className=\"flex justify-between\"><span className=\"text-gray-600 dark:text-gray-400\">{bucket}:</span><span className=\"font-medium text-gray-800 dark:text-gray-200\">{count} transactions</span></div>\n                    )) : <p className=\"text-gray-500 italic\">No bucket data.</p>}\n                </div>\n            </div>\n        </div>\n    );\n};\n\nconst EventTimelineTableV3 = ({ data, selectedUserId = '', selectedProductId = '' }) => {\n    const [showCumulative, setShowCumulative] = useState(false);\n    \n    // TODO 4: Enhanced state management with activeTooltip type differentiation\n    const [activeTooltip, setActiveTooltip] = useState(null); // { type, data, position }\n    const tooltipTimeoutRef = React.useRef(null);\n    \n    // V3 ONLY: Only handle the V3 backend format directly\n    let timelineData;\n    let dates = [];\n    let dailyMetrics = {};\n    let cumulativeMetrics = {};\n    let userTimelines = {};\n    let userDailyMetrics = {};\n    \n    if (data?.data) {\n        // V3 format: data comes from Stage3RevenueResults.getTimelineTableData()\n        dates = data.data.dates || [];\n        dailyMetrics = data.data.daily_metrics || {};\n        cumulativeMetrics = data.data.cumulative_metrics || {};\n        userTimelines = data.data.user_timelines || {};\n        userDailyMetrics = data.data.user_daily_metrics || {};\n        \n        // 🔍 FRONTEND DATA VERIFICATION: Log what EventTimelineTableV3 receives\n        console.log('🔍 [EventTimelineTableV3] Received data structure:');\n        console.log('🔍   - dates count:', dates.length);\n        console.log('🔍   - dailyMetrics dates:', Object.keys(dailyMetrics).length);\n        console.log('🔍   - userDailyMetrics users:', Object.keys(userDailyMetrics).length);\n        console.log('🔍   - selectedUserId:', selectedUserId);\n        \n        // 🔍 ENHANCED DEBUG: Show detailed userDailyMetrics structure\n        if (Object.keys(userDailyMetrics).length > 0) {\n            console.log('🔍   - userDailyMetrics keys:', Object.keys(userDailyMetrics));\n            \n            // Show first user's data as sample\n            const firstUserId = Object.keys(userDailyMetrics)[0];\n            const firstUserData = userDailyMetrics[firstUserId];\n            console.log('🔍   - First user ID:', firstUserId);\n            console.log('🔍   - First user dates:', Object.keys(firstUserData || {}));\n            \n            if (firstUserData && Object.keys(firstUserData).length > 0) {\n                const firstDate = Object.keys(firstUserData)[0];\n                const firstDateData = firstUserData[firstDate];\n                console.log('🔍   - First date data sample:', firstDate, firstDateData);\n                console.log('🔍   - Has tooltip_data:', !!firstDateData?.tooltip_data);\n                if (firstDateData?.tooltip_data) {\n                    console.log('🔍   - tooltip_data structure:', Object.keys(firstDateData.tooltip_data));\n                }\n            }\n            \n            // Check if selectedUserId exists in userDailyMetrics\n            if (selectedUserId && selectedUserId in userDailyMetrics) {\n                console.log('🔍   - selectedUserId found in userDailyMetrics!');\n                const selectedUserData = userDailyMetrics[selectedUserId];\n                console.log('🔍   - selectedUser dates:', Object.keys(selectedUserData || {}));\n                \n                if (selectedUserData && Object.keys(selectedUserData).length > 0) {\n                    const sampleDate = Object.keys(selectedUserData)[0];\n                    const sampleDateData = selectedUserData[sampleDate];\n                    console.log('🔍   - selectedUser sample date data:', sampleDate, sampleDateData);\n                    console.log('🔍   - selectedUser has tooltip_data:', !!sampleDateData?.tooltip_data);\n                }\n            } else if (selectedUserId) {\n                console.log('🔍   - selectedUserId NOT found in userDailyMetrics:', selectedUserId);\n                console.log('🔍   - Available user IDs:', Object.keys(userDailyMetrics));\n            }\n        }\n        \n        // 🔥 STAGE 3 TIMELINE DEBUG: Target the problematic user and date\n        const targetUser = '$device:056F1F33-A295-47F1-9284-F3719DAA976E';\n        const targetDate = '2025-05-14';\n        \n        if (selectedUserId && selectedUserId.includes('056F1F33-A295-47F1-9284')) {\n            console.log('🔥 STAGE3 SUCCESS: V3 Data Correctly Fixed');\n            console.log('🔥   - Selected User ID:', selectedUserId);\n            console.log('🔥   - Target Date:', targetDate);\n            \n            if (userDailyMetrics[selectedUserId] && userDailyMetrics[selectedUserId][targetDate]) {\n                const dayData = userDailyMetrics[selectedUserId][targetDate];\n                console.log('🔥   - trial_converted:', dayData.trial_converted);\n                console.log('🔥   - initial_purchase:', dayData.initial_purchase);\n                \n                if (dayData.trial_converted === 1 && dayData.initial_purchase === 0) {\n                    console.log('🔥   ✅ BUSINESS RULE COMPLIANCE: trial_converted=1, initial_purchase=0 (FIXED!)');\n                } else {\n                    console.log('🔥   ❌ BUSINESS RULE VIOLATION: Both values still showing as 1');\n                }\n            } else {\n                console.log('🔥   ❌ TARGET USER DATA NOT FOUND in userDailyMetrics');\n            }\n        }\n    }\n\n    // Cleanup tooltip timeout on unmount\n    React.useEffect(() => {\n        return () => {\n            if (tooltipTimeoutRef.current) {\n                clearTimeout(tooltipTimeoutRef.current);\n            }\n        };\n    }, []);\n\n    // V3 Debug logging\n    console.log('[DEBUG V3] EventTimelineTable received data:', data);\n    console.log('[DEBUG V3] Data structure check:', {\n        hasData: !!data,\n        hasDataData: !!data?.data,\n        dataKeys: data ? Object.keys(data) : [],\n        dataDataKeys: data?.data ? Object.keys(data.data) : []\n    });\n    \n    // V3 Additional debugging for data structure\n    console.log('[DEBUG V3] Raw data.data structure:', data?.data);\n    console.log('[DEBUG V3] Available keys in data.data:', data?.data ? Object.keys(data.data) : []);\n    if (data?.data?.daily_metrics) {\n        console.log('[DEBUG V3] daily_metrics type:', typeof data.data.daily_metrics);\n        console.log('[DEBUG V3] daily_metrics sample keys:', Object.keys(data.data.daily_metrics).slice(0, 3));\n    }\n\n    // Extract available users and products for filtering\n    const { availableUsers, availableProducts } = useMemo(() => {\n        const users = new Set();\n        const products = new Set();\n        \n        // Extract from user daily metrics (most accurate)\n        Object.keys(userDailyMetrics).forEach(userId => {\n            users.add(userId);\n        });\n        \n        // Extract from user timelines if available\n        Object.keys(userTimelines).forEach(userId => {\n            users.add(userId);\n            const userTimeline = userTimelines[userId];\n            if (userTimeline.events) {\n                userTimeline.events.forEach(event => {\n                    if (event.product_id) {\n                        products.add(event.product_id);\n                    }\n                });\n            }\n            if (userTimeline.summary?.product_summaries) {\n                Object.keys(userTimeline.summary.product_summaries).forEach(productId => {\n                    products.add(productId);\n                });\n            }\n        });\n        \n        // Extract from daily metrics breakdown if available\n        Object.values(dailyMetrics).forEach(dayData => {\n            if (dayData.estimated_revenue_breakdown?.user_breakdowns) {\n                Object.keys(dayData.estimated_revenue_breakdown.user_breakdowns).forEach(userId => {\n                    users.add(userId);\n                    const userBreakdown = dayData.estimated_revenue_breakdown.user_breakdowns[userId];\n                    if (userBreakdown.product_breakdowns) {\n                        Object.keys(userBreakdown.product_breakdowns).forEach(productId => {\n                            products.add(productId);\n                        });\n                    }\n                });\n            }\n        });\n        \n        return {\n            availableUsers: Array.from(users).sort(),\n            availableProducts: Array.from(products).sort()\n        };\n    }, [userDailyMetrics, userTimelines, dailyMetrics]);\n\n    // Filter data based on selected user/product\n    const filteredData = useMemo(() => {\n        if (!selectedUserId && !selectedProductId) {\n            return { dailyMetrics, cumulativeMetrics };\n        }\n\n        // CRITICAL: Use backend's pre-calculated user daily metrics directly\n        // No business logic recalculation in frontend - pure display layer\n        \n        const filteredDaily = {};\n        const filteredCumulative = {};\n\n        if (selectedUserId && !selectedProductId) {\n            // 🔥 STAGE 3 FILTERED DATA DEBUG: Target the problematic user\n            const targetDate = '2025-05-14';\n            const isTargetUser = selectedUserId.includes('056F1F33-A295-47F1-9284');\n            \n            if (isTargetUser) {\n                console.log('🔥 STAGE3 FILTERED DATA DEBUG - Processing Target User:');\n                console.log('🔥   - Selected User ID:', selectedUserId);\n                console.log('🔥   - Raw User Metrics:', userDailyMetrics[selectedUserId]);\n            }\n            \n            // Filter by user only - use backend's user daily metrics directly\n            const userMetrics = userDailyMetrics[selectedUserId];\n            \n            if (userMetrics) {\n                // Calculate cumulative values for single user view\n                let cumulativeValues = {\n                    trial_started: 0,\n                    trial_ended: 0,\n                    trial_converted: 0,\n                    trial_cancelled: 0,\n                    initial_purchase: 0,\n                    subscription_cancelled: 0,\n                    revenue: 0,\n                    refund: 0,\n                    refund_count: 0\n                };\n                \n                dates.forEach(date => {\n                    const userDayMetrics = userMetrics[date];\n                    if (userDayMetrics) {\n                        // Use backend's pre-calculated daily metrics directly\n                        filteredDaily[date] = { \n                            ...userDayMetrics,\n                            revenue_net: (userDayMetrics.revenue || 0) - (userDayMetrics.refund || 0)\n                        };\n                        \n                        // 🔥 STAGE 3 DEBUG: Check target date data processing\n                        if (isTargetUser && date === targetDate) {\n                            console.log('🔥 STAGE3 FILTERED DATA DEBUG - Target Date Processing:');\n                            console.log('🔥   - Date:', date);\n                            console.log('🔥   - Raw Backend Data:', userDayMetrics);\n                            console.log('🔥   - trial_converted (backend):', userDayMetrics.trial_converted);\n                            console.log('🔥   - initial_purchase (backend):', userDayMetrics.initial_purchase);\n                            console.log('🔥   - Filtered Daily Result:', filteredDaily[date]);\n                        }\n                        \n                        // Calculate cumulative values by summing daily values\n                        cumulativeValues.trial_started += userDayMetrics.trial_started || 0;\n                        cumulativeValues.trial_ended += userDayMetrics.trial_ended || 0;\n                        cumulativeValues.trial_converted += userDayMetrics.trial_converted || 0;\n                        cumulativeValues.trial_cancelled += userDayMetrics.trial_cancelled || 0;\n                        cumulativeValues.initial_purchase += userDayMetrics.initial_purchase || 0;\n                        cumulativeValues.subscription_cancelled += userDayMetrics.subscription_cancelled || 0;\n                        cumulativeValues.revenue += userDayMetrics.revenue || 0;\n                        cumulativeValues.refund += userDayMetrics.refund || 0;\n                        cumulativeValues.refund_count += userDayMetrics.refund_count || 0;\n                        \n                        // Create cumulative metrics with proper field names\n                        filteredCumulative[date] = {\n                            // Copy daily values for state-based metrics (these don't accumulate)\n                            trial_pending: userDayMetrics.trial_pending || 0,\n                            subscription_active: userDayMetrics.subscription_active || 0,\n                            estimated_revenue: userDayMetrics.estimated_revenue || 0,\n                            \n                            // Add cumulative values with proper field names expected by getCumulativeValue functions\n                            cumulative_trial_started: cumulativeValues.trial_started,\n                            cumulative_trial_ended: cumulativeValues.trial_ended,\n                            cumulative_trial_converted: cumulativeValues.trial_converted,\n                            cumulative_trial_cancelled: cumulativeValues.trial_cancelled,\n                            cumulative_initial_purchase: cumulativeValues.initial_purchase,\n                            cumulative_subscription_cancelled: cumulativeValues.subscription_cancelled,\n                            cumulative_revenue: cumulativeValues.revenue,\n                            cumulative_refund: cumulativeValues.refund,\n                            cumulative_refund_count: cumulativeValues.refund_count,\n                            cumulative_revenue_net: cumulativeValues.revenue - cumulativeValues.refund\n                        };\n                    } else {\n                        // No data for this user on this date\n                        filteredDaily[date] = {\n                            trial_started: 0,\n                            trial_pending: 0,\n                            trial_ended: 0,\n                            trial_converted: 0,\n                            trial_cancelled: 0,\n                            initial_purchase: 0,\n                            subscription_active: 0,\n                            subscription_cancelled: 0,\n                            revenue: 0,\n                            refund: 0,\n                            refund_count: 0,\n                            estimated_revenue: 0,\n                            revenue_net: 0\n                        };\n                        \n                        // For cumulative, maintain previous cumulative values (no change on days with no activity)\n                        filteredCumulative[date] = {\n                            // State-based metrics remain 0\n                            trial_pending: 0,\n                            subscription_active: 0,\n                            estimated_revenue: 0,\n                            \n                            // Cumulative values remain at previous levels\n                            cumulative_trial_started: cumulativeValues.trial_started,\n                            cumulative_trial_ended: cumulativeValues.trial_ended,\n                            cumulative_trial_converted: cumulativeValues.trial_converted,\n                            cumulative_trial_cancelled: cumulativeValues.trial_cancelled,\n                            cumulative_initial_purchase: cumulativeValues.initial_purchase,\n                            cumulative_subscription_cancelled: cumulativeValues.subscription_cancelled,\n                            cumulative_revenue: cumulativeValues.revenue,\n                            cumulative_refund: cumulativeValues.refund,\n                            cumulative_refund_count: cumulativeValues.refund_count,\n                            cumulative_revenue_net: cumulativeValues.revenue - cumulativeValues.refund\n                        };\n                    }\n                });\n            } else {\n                // User not found in user daily metrics\n                dates.forEach(date => {\n                    filteredDaily[date] = {\n                        trial_started: 0,\n                        trial_pending: 0,\n                        trial_ended: 0,\n                        trial_converted: 0,\n                        trial_cancelled: 0,\n                        initial_purchase: 0,\n                        subscription_active: 0,\n                        subscription_cancelled: 0,\n                        revenue: 0,\n                        refund: 0,\n                        refund_count: 0,\n                        estimated_revenue: 0,\n                        revenue_net: 0\n                    };\n                    \n                    filteredCumulative[date] = {\n                        trial_pending: 0,\n                        subscription_active: 0,\n                        estimated_revenue: 0,\n                        cumulative_trial_started: 0,\n                        cumulative_trial_ended: 0,\n                        cumulative_trial_converted: 0,\n                        cumulative_trial_cancelled: 0,\n                        cumulative_initial_purchase: 0,\n                        cumulative_subscription_cancelled: 0,\n                        cumulative_revenue: 0,\n                        cumulative_refund: 0,\n                        cumulative_refund_count: 0,\n                        cumulative_revenue_net: 0\n                    };\n                });\n            }\n        } else if (selectedProductId && !selectedUserId) {\n            // Filter by product only - currently showing aggregate data\n            // TODO: Backend should provide product-specific aggregations directly\n            // For now, ensure cumulative metrics are properly calculated if they're empty\n            dates.forEach(date => {\n                filteredDaily[date] = { ...dailyMetrics[date] };\n                \n                // Check if cumulative metrics exist for this date, if not calculate them\n                if (cumulativeMetrics[date] && Object.keys(cumulativeMetrics[date]).length > 0) {\n                    filteredCumulative[date] = { ...cumulativeMetrics[date] };\n                } else {\n                    // Calculate cumulative metrics for this date if missing\n                    // Note: This is a fallback - should ideally be handled by backend or Stage3RevenueResultsV3\n                    console.warn(`Missing cumulative metrics for date ${date}, this should be handled by Stage3RevenueResultsV3`);\n                    filteredCumulative[date] = { ...cumulativeMetrics[date] } || {};\n                }\n            });\n        } else if (selectedUserId && selectedProductId) {\n            // Filter by both user and product\n            // TODO: Backend should provide user-product specific metrics\n            // For now, use user metrics (which aggregate across all products for that user)\n            const userMetrics = userDailyMetrics[selectedUserId];\n            \n            if (userMetrics) {\n                // CRITICAL FIX: Calculate cumulative values for single user view (same logic as user-only)\n                let cumulativeValues = {\n                    trial_started: 0,\n                    trial_ended: 0,\n                    trial_converted: 0,\n                    trial_cancelled: 0,\n                    initial_purchase: 0,\n                    subscription_cancelled: 0,\n                    revenue: 0,\n                    refund: 0,\n                    refund_count: 0\n                };\n                \n                dates.forEach(date => {\n                    const userDayMetrics = userMetrics[date];\n                    if (userDayMetrics) {\n                        // Use backend's pre-calculated metrics directly\n                        // Note: This shows all products for the user, not just the selected product\n                        filteredDaily[date] = { \n                            ...userDayMetrics,\n                            // CRITICAL FIX: Calculate revenue_net since backend doesn't provide it for individual users\n                            revenue_net: (userDayMetrics.revenue || 0) - (userDayMetrics.refund || 0)\n                        };\n                        \n                        // Calculate cumulative values by summing daily values\n                        cumulativeValues.trial_started += userDayMetrics.trial_started || 0;\n                        cumulativeValues.trial_ended += userDayMetrics.trial_ended || 0;\n                        cumulativeValues.trial_converted += userDayMetrics.trial_converted || 0;\n                        cumulativeValues.trial_cancelled += userDayMetrics.trial_cancelled || 0;\n                        cumulativeValues.initial_purchase += userDayMetrics.initial_purchase || 0;\n                        cumulativeValues.subscription_cancelled += userDayMetrics.subscription_cancelled || 0;\n                        cumulativeValues.revenue += userDayMetrics.revenue || 0;\n                        cumulativeValues.refund += userDayMetrics.refund || 0;\n                        cumulativeValues.refund_count += userDayMetrics.refund_count || 0;\n                        \n                        // Create cumulative metrics with proper field names\n                        filteredCumulative[date] = {\n                            // Copy daily values for state-based metrics (these don't accumulate)\n                            trial_pending: userDayMetrics.trial_pending || 0,\n                            subscription_active: userDayMetrics.subscription_active || 0,\n                            estimated_revenue: userDayMetrics.estimated_revenue || 0,\n                            \n                            // Add cumulative values with proper field names expected by getCumulativeValue functions\n                            cumulative_trial_started: cumulativeValues.trial_started,\n                            cumulative_trial_ended: cumulativeValues.trial_ended,\n                            cumulative_trial_converted: cumulativeValues.trial_converted,\n                            cumulative_trial_cancelled: cumulativeValues.trial_cancelled,\n                            cumulative_initial_purchase: cumulativeValues.initial_purchase,\n                            cumulative_subscription_cancelled: cumulativeValues.subscription_cancelled,\n                            cumulative_revenue: cumulativeValues.revenue,\n                            cumulative_refund: cumulativeValues.refund,\n                            cumulative_refund_count: cumulativeValues.refund_count,\n                            cumulative_revenue_net: cumulativeValues.revenue - cumulativeValues.refund\n                        };\n                    } else {\n                        filteredDaily[date] = {\n                            trial_started: 0,\n                            trial_pending: 0,\n                            trial_ended: 0,\n                            trial_converted: 0,\n                            trial_cancelled: 0,\n                            initial_purchase: 0,\n                            subscription_active: 0,\n                            subscription_cancelled: 0,\n                            revenue: 0,\n                            refund: 0,\n                            refund_count: 0,\n                            estimated_revenue: 0,\n                            revenue_net: 0\n                        };\n                        \n                        // For cumulative, maintain previous cumulative values (no change on days with no activity)\n                        filteredCumulative[date] = {\n                            // State-based metrics remain 0\n                            trial_pending: 0,\n                            subscription_active: 0,\n                            estimated_revenue: 0,\n                            \n                            // Cumulative values remain at previous levels\n                            cumulative_trial_started: cumulativeValues.trial_started,\n                            cumulative_trial_ended: cumulativeValues.trial_ended,\n                            cumulative_trial_converted: cumulativeValues.trial_converted,\n                            cumulative_trial_cancelled: cumulativeValues.trial_cancelled,\n                            cumulative_initial_purchase: cumulativeValues.initial_purchase,\n                            cumulative_subscription_cancelled: cumulativeValues.subscription_cancelled,\n                            cumulative_revenue: cumulativeValues.revenue,\n                            cumulative_refund: cumulativeValues.refund,\n                            cumulative_refund_count: cumulativeValues.refund_count,\n                            cumulative_revenue_net: cumulativeValues.revenue - cumulativeValues.refund\n                        };\n                    }\n                });\n            } else {\n                dates.forEach(date => {\n                    filteredDaily[date] = {\n                        trial_started: 0,\n                        trial_pending: 0,\n                        trial_ended: 0,\n                        trial_converted: 0,\n                        trial_cancelled: 0,\n                        initial_purchase: 0,\n                        subscription_active: 0,\n                        subscription_cancelled: 0,\n                        revenue: 0,\n                        refund: 0,\n                        refund_count: 0,\n                        estimated_revenue: 0,\n                        revenue_net: 0\n                    };\n                    \n                    filteredCumulative[date] = {\n                        trial_pending: 0,\n                        subscription_active: 0,\n                        estimated_revenue: 0,\n                        cumulative_trial_started: 0,\n                        cumulative_trial_ended: 0,\n                        cumulative_trial_converted: 0,\n                        cumulative_trial_cancelled: 0,\n                        cumulative_initial_purchase: 0,\n                        cumulative_subscription_cancelled: 0,\n                        cumulative_revenue: 0,\n                        cumulative_refund: 0,\n                        cumulative_refund_count: 0,\n                        cumulative_revenue_net: 0\n                    };\n                });\n            }\n        }\n\n        return { dailyMetrics: filteredDaily, cumulativeMetrics: filteredCumulative };\n    }, [selectedUserId, selectedProductId, dailyMetrics, cumulativeMetrics, userDailyMetrics, dates]);\n\n    // NOW we can do early returns after all hooks are called\n    if (!data) {\n        return (\n            <div className=\"text-center py-8\">\n                <p className=\"text-gray-500 dark:text-gray-400\">\n                    No timeline data available. Run an analysis to see results.\n                </p>\n            </div>\n        );\n    }\n\n    const formatCurrency = (value) => {\n        if (value === null || value === undefined) return '$0';\n        const rounded = Math.round(Number(value));\n        return `$${rounded.toLocaleString()}`;\n    };\n\n    const formatNumber = (value) => {\n        if (value === null || value === undefined) return '0';\n        return Number(value).toLocaleString();\n    };\n\n    // Replace the entire getEstimatedRevenueTooltipData function with this new version:\n    const getEstimatedRevenueTooltipData = (date, value) => {\n        const safeValue = typeof value === 'number' ? value : 0;\n        if (safeValue === 0 && !selectedUserId) return null; // Allow empty tooltips for individual users to show state\n\n        if (selectedUserId) {\n            // INDIVIDUAL USER VIEW\n            const userMetrics = userDailyMetrics[selectedUserId];\n            if (!userMetrics || !userMetrics[date] || !userMetrics[date].tooltip_data) {\n                console.warn(`[WARN] No individual tooltip data for user ${selectedUserId} on date ${date}`);\n                // Return a minimal object to show an 'inactive' state tooltip\n                return {\n                    value: 0,\n                    breakdown: {\n                        formula: '⚫ Inactive: Est_Revenue = 0 (No active trial or subscription)',\n                        calculation: 'No data for this user on this date.',\n                        components: {\n                            'User ID': selectedUserId.substring(0, 16) + '...',\n                            'Date': date,\n                            'Current State': 'Inactive',\n                        },\n                        components_order: ['User ID', 'Date', 'Current State']\n                    }\n                };\n            }\n            // The 'tooltip_data' object from the backend has the exact structure { value, breakdown }\n            // that the EstimatedRevenueTooltip component expects.\n            return userMetrics[date].tooltip_data;\n\n        } else {\n            // AGGREGATE VIEW\n            const aggregateData = dailyMetrics[date];\n            if (!aggregateData || !aggregateData.estimated_revenue_breakdown) {\n                console.warn(`[WARN] No aggregate breakdown data for date ${date}`);\n                return null;\n            }\n\n            const breakdownData = aggregateData.estimated_revenue_breakdown;\n\n            // This part relies on the backend fix from TODO 1.\n            // It constructs the data object for the tooltip component.\n            return {\n                value: safeValue,\n                estimated_trial_revenue_component: breakdownData.total_trial_revenue,\n                estimated_trial_converted_revenue_component: breakdownData.total_trial_converted_revenue,\n                estimated_initial_purchase_revenue_component: breakdownData.total_initial_purchase_revenue,\n                estimated_trial_refund_component: breakdownData.total_trial_refunds,\n                estimated_trial_converted_refund_component: breakdownData.total_trial_converted_refunds,\n                estimated_initial_purchase_refund_component: breakdownData.total_initial_purchase_refunds,\n                breakdown: breakdownData,\n            };\n        }\n    };\n\n    // CORRECTED - Final version of the function\n    const getRevenueTooltipData = (date, value) => {\n        const safeValue = typeof value === 'number' ? value : 0;\n        if (safeValue === 0) return null;\n        \n        const tooltipData = dailyMetrics[date]?.revenue_tooltip_data;\n        if (!tooltipData) return null;\n        \n        return { value: safeValue, ...tooltipData };\n    };\n\n    // CORRECTED - Final version of the function\n    const getRefundTooltipData = (date, value) => {\n        const safeValue = typeof value === 'number' ? value : 0;\n        if (safeValue === 0) return null;\n\n        const tooltipData = dailyMetrics[date]?.refund_tooltip_data;\n        if (!tooltipData) return null;\n\n        return { value: safeValue, ...tooltipData };\n    };\n\n    // Function to generate tooltip data for estimated refunds\n    const getEstimatedRefundsTooltipData = (date, trialRefunds, subscriptionRefunds, totalRefunds) => {\n        if (totalRefunds === 0) {\n            return null; // Don't show tooltip for $0 values\n        }\n        \n        console.log(`[DEBUG] getEstimatedRefundsTooltipData called with:`, {\n            date,\n            trialRefunds,\n            subscriptionRefunds,\n            totalRefunds,\n            selectedUserId,\n            selectedProductId,\n            isAggregateView: !selectedUserId\n        });\n        \n        // ENHANCED: Support both individual user view AND aggregate view\n        if (!selectedUserId) {\n            // AGGREGATE VIEW: Show breakdown across all users\n            console.log(`[DEBUG] Creating aggregate refunds tooltip for date ${date}`);\n            \n            // Get aggregate data from dailyMetrics\n            const aggregateData = dailyMetrics[date];\n            if (!aggregateData) {\n                console.warn(`[WARN] No aggregate data found for date ${date}`);\n                return null;\n            }\n            \n            // Count users contributing to each type of refund\n            let usersWithTrialRefunds = 0;\n            let usersWithSubscriptionRefunds = 0;\n            let totalUsers = 0;\n            \n            // Analyze user daily metrics to get user counts\n            Object.keys(userDailyMetrics).forEach(userId => {\n                const userMetrics = userDailyMetrics[userId][date];\n                if (userMetrics) {\n                    totalUsers++;\n                    if ((userMetrics.estimated_trial_refund_component || 0) > 0) {\n                        usersWithTrialRefunds++;\n                    }\n                    if ((userMetrics.estimated_subscription_refund_component || 0) > 0) {\n                        usersWithSubscriptionRefunds++;\n                    }\n                }\n            });\n            \n            return {\n                value: totalRefunds,\n                // THIS IS THE FIX: Add the component values so the tooltip can read them\n                estimated_trial_refund_component: trialRefunds,\n                estimated_subscription_refund_component: subscriptionRefunds, \n                // We can reuse the estimated revenue component names since the tooltip is generic\n                estimated_trial_revenue_component: trialRefunds,\n                estimated_trial_converted_revenue_component: aggregateData.estimated_trial_converted_refund_component || 0,\n                estimated_initial_purchase_revenue_component: aggregateData.estimated_initial_purchase_refund_component || 0,\n                breakdown: {\n                    formula: '🔄 Aggregate Estimated Potential Refunds: Σ(Trial_Refunds) + Σ(Subscription_Refunds) across all users',\n                    calculation: `Trial: $${trialRefunds.toFixed(2)} (${usersWithTrialRefunds} users) + Subscription: $${subscriptionRefunds.toFixed(2)} (${usersWithSubscriptionRefunds} users) = $${totalRefunds.toFixed(2)}`,\n                    components: {\n                        'View Type': 'Aggregate (All Users)',\n                        'Date': date,\n                        'Total Users': totalUsers,\n                        'Total Estimated Refunds (Potential)': `$${totalRefunds.toFixed(2)}`,\n                        'Estimated Refunds from Trials (Potential)': `$${trialRefunds.toFixed(2)}`,\n                        'Users with Trial Refunds': usersWithTrialRefunds,\n                        'Estimated Refunds from Subscriptions (Potential)': `$${subscriptionRefunds.toFixed(2)}`,\n                        'Users with Subscription Refunds': usersWithSubscriptionRefunds,\n                        'Trial Refunds Explanation': 'Refunds expected if pending trials convert then users request refunds',\n                        'Subscription Refunds Explanation': 'Refunds expected from active subscriptions based on age and historical patterns'\n                    },\n                    components_order: [\n                        'View Type',\n                        'Date', \n                        'Total Users',\n                        'Total Estimated Refunds (Potential)',\n                        'Estimated Refunds from Trials (Potential)',\n                        'Users with Trial Refunds',\n                        'Estimated Refunds from Subscriptions (Potential)',\n                        'Users with Subscription Refunds',\n                        'Trial Refunds Explanation',\n                        'Subscription Refunds Explanation'\n                    ]\n                }\n            };\n        }\n        \n        // INDIVIDUAL USER VIEW: Show breakdown for specific user\n        // Get the user's daily metrics for this date to access detailed breakdown\n        const userMetrics = userDailyMetrics[selectedUserId];\n        if (!userMetrics || !userMetrics[date]) {\n            console.warn(`[WARN] No user metrics found for user ${selectedUserId} on date ${date}`);\n            return null;\n        }\n        \n        const dayMetrics = userMetrics[date];\n        const tooltipData = dayMetrics.tooltip_data;\n        \n        if (!tooltipData || !tooltipData.breakdown) {\n            console.warn(`[WARN] No tooltip breakdown data found for estimated refunds`);\n            return null;\n        }\n        \n        // Extract components from the enhanced breakdown\n        const breakdown = tooltipData.breakdown;\n        const components = breakdown.components || {};\n        \n        return {\n            value: totalRefunds,\n            breakdown: {\n                formula: '🔄 Estimated Potential Refunds: Trial_Refunds + Subscription_Refunds',\n                calculation: `Trial: $${trialRefunds.toFixed(2)} + Subscription: $${subscriptionRefunds.toFixed(2)} = $${totalRefunds.toFixed(2)}`,\n                components: {\n                    'View Type': 'Individual User',\n                    'Product ID': components['Product ID'] || 'Unknown',\n                    'Current State': components['Current State'] || 'Unknown',\n                    'Total Estimated Refunds (Potential)': `$${totalRefunds.toFixed(2)}`,\n                    'Estimated Refunds from Trial (Potential)': `$${trialRefunds.toFixed(2)}`,\n                    'Estimated Refunds from Subscription (Potential)': `$${subscriptionRefunds.toFixed(2)}`,\n                    'Segment Base Refund Rate': components['Segment Base Refund Rate'] || 'Unknown',\n                    'Current Refund Probability': components['Current Refund Probability'] || components['Refund Likelihood'] || 'Unknown',\n                    'Notes': trialRefunds > 0 ? 'Refunds expected if trial converts then user requests refund' : 'Refunds expected based on subscription age and historical patterns'\n                },\n                components_order: [\n                    'View Type',\n                    'Product ID',\n                    'Current State',\n                    'Total Estimated Refunds (Potential)',\n                    'Estimated Refunds from Trial (Potential)',\n                    'Estimated Refunds from Subscription (Potential)',\n                    'Segment Base Refund Rate',\n                    'Current Refund Probability',\n                    'Notes'\n                ]\n            }\n        };\n    };\n\n    // Define all metrics with their categories and data extraction logic\n    const metrics = [\n        // Daily Absolute Values\n        {\n            key: 'daily_trial_started',\n            label: 'Trial Started',\n            category: 'daily_absolute',\n            categoryLabel: 'Daily Absolute Values',\n            getValue: (date) => filteredData.dailyMetrics[date]?.trial_started || 0,\n            getCumulativeValue: (date) => filteredData.cumulativeMetrics[date]?.cumulative_trial_started || 0,\n            format: formatNumber\n        },\n        {\n            key: 'daily_trial_pending',\n            label: 'Trial Pending',\n            category: 'daily_absolute',\n            getValue: (date) => filteredData.dailyMetrics[date]?.trial_pending || 0,\n            // CRITICAL FIX: Trial pending is a state-based metric, cumulative should show same as daily\n            getCumulativeValue: (date) => filteredData.dailyMetrics[date]?.trial_pending || 0,\n            format: formatNumber\n        },\n        {\n            key: 'daily_trial_ended',\n            label: 'Trial Ended',\n            category: 'daily_absolute',\n            getValue: (date) => filteredData.dailyMetrics[date]?.trial_ended || 0,\n            getCumulativeValue: (date) => filteredData.cumulativeMetrics[date]?.cumulative_trial_ended || 0,\n            format: formatNumber\n        },\n        {\n            key: 'daily_trial_cancelled',\n            label: 'Trial Cancelled',\n            category: 'daily_absolute',\n            getValue: (date) => filteredData.dailyMetrics[date]?.trial_cancelled || 0,\n            getCumulativeValue: (date) => filteredData.cumulativeMetrics[date]?.cumulative_trial_cancelled || 0,\n            format: formatNumber\n        },\n        {\n            key: 'daily_trial_converted',\n            label: 'Trial Converted',\n            category: 'daily_absolute',\n            getValue: (date) => filteredData.dailyMetrics[date]?.trial_converted || 0,\n            getCumulativeValue: (date) => filteredData.cumulativeMetrics[date]?.cumulative_trial_converted || 0,\n            format: formatNumber\n        },\n        {\n            key: 'daily_initial_purchase',\n            label: 'Initial Purchase',\n            category: 'daily_absolute',\n            getValue: (date) => filteredData.dailyMetrics[date]?.initial_purchase || 0,\n            getCumulativeValue: (date) => filteredData.cumulativeMetrics[date]?.cumulative_initial_purchase || 0,\n            format: formatNumber\n        },\n        {\n            key: 'daily_subscription_active',\n            label: 'Subscription Active',\n            category: 'daily_absolute',\n            getValue: (date) => filteredData.dailyMetrics[date]?.subscription_active || 0,\n            // CRITICAL FIX: Subscription active is a state-based metric, cumulative should show same as daily\n            getCumulativeValue: (date) => filteredData.dailyMetrics[date]?.subscription_active || 0,\n            format: formatNumber\n        },\n        {\n            key: 'daily_subscription_cancelled',\n            label: 'Subscription Cancelled',\n            category: 'daily_absolute',\n            getValue: (date) => filteredData.dailyMetrics[date]?.subscription_cancelled || 0,\n            getCumulativeValue: (date) => filteredData.cumulativeMetrics[date]?.cumulative_subscription_cancelled || 0,\n            format: formatNumber\n        },\n        {\n            key: 'daily_users',\n            label: 'Daily Users',\n            category: 'daily_absolute',\n            getValue: (date) => filteredData.dailyMetrics[date]?.daily_users || 0,\n            getCumulativeValue: (date) => filteredData.dailyMetrics[date]?.cumulative_users || 0,\n            format: formatNumber\n        },\n        {\n            key: 'daily_refund_count',\n            label: 'Refunds',\n            category: 'daily_absolute',\n            getValue: (date) => filteredData.dailyMetrics[date]?.refund_count || 0,\n            getCumulativeValue: (date) => filteredData.cumulativeMetrics[date]?.cumulative_refund_count || 0,\n            format: formatNumber\n        },\n        // Revenue Values\n        {\n            key: 'daily_revenue',\n            label: 'Revenue',\n            category: 'revenue',\n            categoryLabel: 'Revenue Values',\n            getValue: (date) => filteredData.dailyMetrics[date]?.revenue || 0,\n            getCumulativeValue: (date) => filteredData.cumulativeMetrics[date]?.cumulative_revenue || 0,\n            format: formatCurrency,\n            isRevenue: true,  // NEW: Mark this as revenue for tooltip handling\n            getTooltipData: (date) => {\n                const value = showCumulative \n                    ? (filteredData.cumulativeMetrics[date]?.cumulative_revenue || 0)\n                    : (filteredData.dailyMetrics[date]?.revenue || 0);\n                return getRevenueTooltipData(date, value);\n            }\n        },\n        {\n            key: 'daily_refund',\n            label: 'Refunds',\n            category: 'revenue',\n            getValue: (date) => filteredData.dailyMetrics[date]?.refund || 0,\n            getCumulativeValue: (date) => filteredData.cumulativeMetrics[date]?.cumulative_refund || 0,\n            format: formatCurrency,\n            isRefund: true,  // NEW: Mark this as refund for tooltip handling\n            getTooltipData: (date) => {\n                const value = showCumulative \n                    ? (filteredData.cumulativeMetrics[date]?.cumulative_refund || 0)\n                    : (filteredData.dailyMetrics[date]?.refund || 0);\n                return getRefundTooltipData(date, value);\n            }\n        },\n        {\n            key: 'daily_revenue_net',\n            label: 'Net Revenue',\n            category: 'revenue',\n            getValue: (date) => filteredData.dailyMetrics[date]?.revenue_net || 0,\n            getCumulativeValue: (date) => filteredData.cumulativeMetrics[date]?.cumulative_revenue_net || 0,\n            format: formatCurrency\n        },\n        {\n            key: 'daily_estimated_revenue',\n            label: 'Estimated Revenue',\n            category: 'revenue',\n            isEstimatedRevenue: true,\n            getValue: (date) => filteredData.dailyMetrics[date]?.estimated_revenue || 0,\n            // CRITICAL FIX: Estimated revenue is a state-based metric, cumulative should show same as daily\n            getCumulativeValue: (date) => filteredData.dailyMetrics[date]?.estimated_revenue || 0,\n            format: formatCurrency,\n            getTooltipData: (date) => {\n                const value = showCumulative \n                    ? (filteredData.dailyMetrics[date]?.estimated_revenue || 0)  // Same as daily for state-based\n                    : (filteredData.dailyMetrics[date]?.estimated_revenue || 0);\n                return getEstimatedRevenueTooltipData(date, value);\n            }\n        },\n        {\n            key: 'daily_estimated_refunds',\n            label: 'Estimated Refunds (Potential)',\n            category: 'revenue',\n            isEstimatedRefunds: true,\n            getValue: (date) => {\n                const dailyData = filteredData.dailyMetrics[date];\n                const trialRefunds = dailyData?.estimated_trial_refund_component || 0;\n                const subscriptionRefunds = dailyData?.estimated_subscription_refund_component || 0;\n                return trialRefunds + subscriptionRefunds;\n            },\n            // CRITICAL FIX: Estimated refunds is a state-based metric, cumulative should show same as daily\n            getCumulativeValue: (date) => {\n                const dailyData = filteredData.dailyMetrics[date];\n                const trialRefunds = dailyData?.estimated_trial_refund_component || 0;\n                const subscriptionRefunds = dailyData?.estimated_subscription_refund_component || 0;\n                return trialRefunds + subscriptionRefunds;\n            },\n            format: formatCurrency,\n            getTooltipData: (date) => {\n                const dailyData = filteredData.dailyMetrics[date];\n                const trialRefunds = dailyData?.estimated_trial_refund_component || 0;\n                const subscriptionRefunds = dailyData?.estimated_subscription_refund_component || 0;\n                const totalRefunds = trialRefunds + subscriptionRefunds;\n                \n                if (totalRefunds === 0) {\n                    return null; // Don't show tooltip for $0 values\n                }\n                \n                return getEstimatedRefundsTooltipData(date, trialRefunds, subscriptionRefunds, totalRefunds);\n            }\n        }\n    ];\n\n    // Group metrics by category\n    const groupedMetrics = metrics.reduce((acc, metric) => {\n        if (!acc[metric.category]) {\n            acc[metric.category] = {\n                label: metric.categoryLabel || metric.category,\n                metrics: []\n            };\n        }\n        acc[metric.category].metrics.push(metric);\n        return acc;\n    }, {});\n\n    return (\n        <>\n            <div className=\"mb-8 bg-white dark:bg-gray-700 p-6 rounded-lg shadow-md\">\n                <div className=\"flex justify-between items-center mb-4\">\n                    <h2 className=\"text-2xl font-bold text-gray-800 dark:text-white\">Daily Event & Revenue Timeline</h2>\n                    <div className=\"flex gap-2\">\n                        <button\n                            onClick={() => setShowCumulative(!showCumulative)}\n                            className={`px-3 py-1 text-sm rounded-full ${\n                                showCumulative \n                                    ? 'bg-blue-500 text-white' \n                                    : 'bg-gray-200 dark:bg-gray-600 text-gray-700 dark:text-white'\n                            }`}\n                        >\n                            {showCumulative ? 'Show Daily' : 'Show Cumulative'}\n                        </button>\n                    </div>\n                </div>\n                \n                {/* Table Container */}\n                <div className=\"overflow-x-auto\">\n                    <table className=\"min-w-full text-sm border dark:border-gray-600\">\n                        <thead className=\"bg-gray-50 dark:bg-gray-700\">\n                            <tr>\n                                <th className=\"p-2 border-b dark:border-gray-600 text-left text-gray-700 dark:text-white sticky left-0 bg-gray-50 dark:bg-gray-700 z-10 min-w-[200px]\">\n                                    Metric\n                                </th>\n                                {dates.map(date => (\n                                    <th key={date} className=\"p-2 border-b dark:border-gray-600 text-center text-gray-700 dark:text-white whitespace-nowrap min-w-[80px]\">\n                                        {date}\n                                    </th>\n                                ))}\n                            </tr>\n                        </thead>\n                        <tbody className=\"bg-white dark:bg-gray-800\">\n                            {Object.entries(groupedMetrics).map(([categoryKey, category]) => (\n                                <React.Fragment key={categoryKey}>\n                                    {/* Category Header */}\n                                    <tr className=\"bg-gray-100 dark:bg-gray-600\">\n                                        <td colSpan={dates.length + 1} className=\"p-2 font-semibold text-gray-800 dark:text-white border-b dark:border-gray-600\">\n                                            {category.label}\n                                        </td>\n                                    </tr>\n                                    {/* Metrics in this category */}\n                                    {category.metrics.map((metric) => (\n                                        <tr key={metric.key} className=\"hover:bg-gray-50 dark:hover:bg-gray-700\">\n                                            <td className=\"p-2 border-b dark:border-gray-600 font-medium text-gray-700 dark:text-white sticky left-0 bg-white dark:bg-gray-800 z-10\">\n                                                {metric.label}\n                                            </td>\n                                            {dates.map(date => {\n                                                const value = showCumulative \n                                                    ? metric.getCumulativeValue(date)\n                                                    : metric.getValue(date);\n                                                return (\n                                                    <td \n                                                        key={date} \n                                                        className={`p-2 border-b dark:border-gray-600 text-center text-gray-700 dark:text-white ${\n                                                            metric.isEstimatedRevenue || metric.isRevenue || metric.isRefund || metric.isEstimatedRefunds ? 'cursor-help hover:bg-yellow-50 dark:hover:bg-yellow-900/20 relative' : ''\n                                                        }`}\n                                                        onMouseEnter={\n                                            (metric.isRevenue || metric.isRefund || metric.isEstimatedRevenue || metric.isEstimatedRefunds)\n                                            ? (e) => {\n                                                // This logic block now correctly only runs for the aggregate view.\n                                                if (tooltipTimeoutRef.current) clearTimeout(tooltipTimeoutRef.current);\n                                                tooltipTimeoutRef.current = setTimeout(() => {\n                                                    const rect = e.target.getBoundingClientRect();\n                                                    const tooltipData = metric.getTooltipData(date, value);\n                                                    if (tooltipData) {\n                                                                                                // Smart positioning: check available space\n                                        const tooltipWidth = 400; // Estimated tooltip width (updated for w-96 class)\n                                        const tooltipHeight = 480; // Estimated tooltip height\n                                                        const spaceOnRight = window.innerWidth - rect.right;\n                                                        const spaceOnLeft = rect.left;\n                                                        \n                                                        let xPosition, yPosition;\n                                                        \n                                                        // Choose horizontal position based on available space\n                                                        if (spaceOnRight >= tooltipWidth + 20) {\n                                                            // Enough space on the right\n                                                            xPosition = rect.right + 10;\n                                                        } else if (spaceOnLeft >= tooltipWidth + 20) {\n                                                            // Not enough space on right, but enough on left\n                                                            xPosition = rect.left - tooltipWidth - 10;\n                                                        } else {\n                                                            // Not enough space on either side, center it\n                                                            xPosition = Math.max(10, (window.innerWidth - tooltipWidth) / 2);\n                                                        }\n                                                        \n                                                        // Vertical position: position so BOTTOM of tooltip aligns with cell center\n                                                        const cellCenterY = rect.top + (rect.height / 2);\n                                                        yPosition = Math.max(10, cellCenterY - tooltipHeight - 200); // Move up by 200 pixels\n                                                        \n                                                        // Ensure tooltip doesn't go below screen\n                                                        yPosition = Math.min(yPosition, window.innerHeight - tooltipHeight - 10);\n                                                        \n                                                        let tooltipType = 'estimated_revenue';\n                                                        if (metric.isRevenue) tooltipType = 'revenue';\n                                                        else if (metric.isRefund) tooltipType = 'refund';\n                                                        else if (metric.isEstimatedRefunds) tooltipType = 'estimated_refunds';\n                                                        \n                                                        setActiveTooltip({ \n                                                            type: tooltipType,\n                                                            data: tooltipData,\n                                                            position: { x: xPosition, y: yPosition }\n                                                        });\n                                                    }\n                                                }, 150);\n                                            }\n                                            : undefined\n                                        }\n                                                        onMouseLeave={metric.isEstimatedRevenue || metric.isRevenue || metric.isRefund || metric.isEstimatedRefunds ? () => {\n                                                            // Handle mouse leave for tooltips\n                                                            \n                                                            // Clear the show timeout if mouse leaves before tooltip appears\n                                                            if (tooltipTimeoutRef.current) {\n                                                                clearTimeout(tooltipTimeoutRef.current);\n                                                                tooltipTimeoutRef.current = null;\n                                                            }\n                                                            \n                                                            // Set a timeout to hide the tooltip, allowing time to move to tooltip\n                                                            const hideTimeout = setTimeout(() => {\n                                                                setActiveTooltip(null);\n                                                            }, 100); // Shorter delay for quicker hiding\n                                                            \n                                                            tooltipTimeoutRef.current = hideTimeout;\n                                                        } : undefined}\n                                                    >\n                                                        {metric.format(value)}\n                                                    </td>\n                                                );\n                                            })}\n                                        </tr>\n                                    ))}\n                                </React.Fragment>\n                            ))}\n                        </tbody>\n                    </table>\n                </div>\n\n                {dates.length === 0 && (\n                    <div className=\"text-center py-8\">\n                        <p className=\"text-gray-500 dark:text-gray-400\">\n                            No timeline data available. Run an analysis to see results.\n                        </p>\n                    </div>\n                )}\n            </div>\n            \n            {/* TODO 4: Conditional tooltip rendering based on type */}\n            {activeTooltip?.type === 'estimated_revenue' && (\n                <EstimatedRevenueTooltip\n                    data={activeTooltip.data}\n                    position={activeTooltip.position}\n                    onClose={() => setActiveTooltip(null)}\n                    selectedUserId={selectedUserId}\n                    selectedProductId={selectedProductId}\n                />\n            )}\n            \n            {activeTooltip?.type === 'revenue' && (\n                <ActualRevenueTooltip\n                    data={activeTooltip.data}\n                    position={activeTooltip.position}\n                    onClose={() => setActiveTooltip(null)}\n                    selectedUserId={selectedUserId}\n                    selectedProductId={selectedProductId}\n                />\n            )}\n            \n            {activeTooltip?.type === 'refund' && (\n                <ActualRefundTooltip\n                    data={activeTooltip.data}\n                    position={activeTooltip.position}\n                    onClose={() => setActiveTooltip(null)}\n                    selectedUserId={selectedUserId}\n                    selectedProductId={selectedProductId}\n                />\n            )}\n            \n            {activeTooltip?.type === 'estimated_refunds' && (\n                <EstimatedRevenueTooltip\n                    data={activeTooltip.data}\n                    position={activeTooltip.position}\n                    onClose={() => setActiveTooltip(null)}\n                    selectedUserId={selectedUserId}\n                    selectedProductId={selectedProductId}\n                />\n            )}\n        </>\n    );\n};\n\nexport default EventTimelineTableV3; "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}