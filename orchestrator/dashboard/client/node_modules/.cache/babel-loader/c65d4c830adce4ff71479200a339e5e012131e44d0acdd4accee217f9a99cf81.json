{"ast":null,"code":"import _objectSpread from\"/Users/joshuakaufman/untitled folder 3/orchestrator/dashboard/client/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";// client/src/pages/CohortAnalyzerPage.js\n// COHORT DEFINITION:\n// A user is part of the cohort ONLY if they:\n// 1. Exist in the database\n// 2. Have a \"trial started\" event within the specified date range\n// This is enforced using the enforce_trial_started flag in API calls\n// IMPORTANT: Users who do not meet both criteria are EXCLUDED from all analysis.\n// All events analyzed are ONLY from users in this cohort.\nimport React,{useState,useEffect,useCallback}from'react';import{api}from'../services/api';// Assuming your API service is here\nimport{LineChart,Line,XAxis,YAxis,CartesianGrid,Tooltip,Legend,ResponsiveContainer}from'recharts';import{ChevronDown,ChevronRight,PlusCircle,XCircle,AlertTriangle,Loader,Filter}from'lucide-react';import Select from'react-select';import{Chart as ChartJS,CategoryScale,LinearScale,PointElement,LineElement,Title,Tooltip as ChartTooltip,Legend as ChartLegend}from'chart.js';import{Line as ChartLine}from'react-chartjs-2';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";ChartJS.register(CategoryScale,LinearScale,PointElement,LineElement,Title,ChartTooltip,ChartLegend);// Custom styles for react-select\nconst customSelectStyles={control:(base,state)=>_objectSpread(_objectSpread({},base),{},{background:'#FFFFFF',borderColor:state.isFocused?'#4F46E5':'#CBD5E0',boxShadow:state.isFocused?'0 0 0 1px #4F46E5':'none','&:hover':{borderColor:'#4F46E5'},padding:'2px',fontSize:'0.9rem'}),option:(base,state)=>_objectSpread(_objectSpread({},base),{},{backgroundColor:state.isSelected?'#4F46E5':state.isFocused?'#EEF2FF':'transparent',color:state.isSelected?'white':'#1A202C','&:hover':{backgroundColor:state.isSelected?'#4F46E5':'#EEF2FF'},cursor:'pointer',fontSize:'0.9rem'}),multiValue:base=>_objectSpread(_objectSpread({},base),{},{backgroundColor:'#EEF2FF',border:'1px solid #E2E8F0'}),multiValueLabel:base=>_objectSpread(_objectSpread({},base),{},{color:'#4F46E5',fontWeight:500}),multiValueRemove:base=>_objectSpread(_objectSpread({},base),{},{color:'#4F46E5','&:hover':{backgroundColor:'#4F46E5',color:'white'}}),menu:base=>_objectSpread(_objectSpread({},base),{},{zIndex:100,boxShadow:'0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)',backgroundColor:'#FFFFFF'}),placeholder:base=>_objectSpread(_objectSpread({},base),{},{color:'#718096'}),input:base=>_objectSpread(_objectSpread({},base),{},{color:'#1A202C'}),singleValue:base=>_objectSpread(_objectSpread({},base),{},{color:'#1A202C'})};// For dark mode\nconst darkModeSelectStyles=_objectSpread(_objectSpread({},customSelectStyles),{},{control:(base,state)=>_objectSpread(_objectSpread({},customSelectStyles.control(base,state)),{},{background:'#1F2937',borderColor:state.isFocused?'#4F46E5':'#4B5563','&:hover':{borderColor:'#4F46E5'}}),option:(base,state)=>_objectSpread(_objectSpread({},customSelectStyles.option(base,state)),{},{backgroundColor:state.isSelected?'#4F46E5':state.isFocused?'#374151':'#1F2937',color:state.isSelected?'white':'#F3F4F6'}),multiValue:base=>_objectSpread(_objectSpread({},customSelectStyles.multiValue(base)),{},{backgroundColor:'#374151',border:'1px solid #4B5563'}),multiValueLabel:base=>_objectSpread(_objectSpread({},customSelectStyles.multiValueLabel(base)),{},{color:'#F3F4F6'}),multiValueRemove:base=>_objectSpread(_objectSpread({},customSelectStyles.multiValueRemove(base)),{},{color:'#F3F4F6','&:hover':{backgroundColor:'#4F46E5',color:'white'}}),menu:base=>_objectSpread(_objectSpread({},customSelectStyles.menu(base)),{},{backgroundColor:'#1F2937',border:'1px solid #4B5563'}),placeholder:base=>_objectSpread(_objectSpread({},customSelectStyles.placeholder(base)),{},{color:'#9CA3AF'}),input:base=>_objectSpread(_objectSpread({},base),{},{color:'#F3F4F6'}),singleValue:base=>_objectSpread(_objectSpread({},base),{},{color:'#F3F4F6'})});// Define the color coding for the user timeline table\nconst timelineColors={default:{bg:'bg-gray-100 dark:bg-gray-700',text:'text-gray-500 dark:text-gray-400'},trial_started:{bg:'bg-yellow-100 dark:bg-yellow-900/50',text:'text-yellow-800 dark:text-yellow-200'},trial_converted:{bg:'bg-green-100 dark:bg-green-900/50',text:'text-green-800 dark:text-green-200'},trial_cancelled:{bg:'bg-red-100 dark:bg-red-900/50',text:'text-red-800 dark:text-red-200'},conversion_cancelled:{bg:'bg-green-50 dark:bg-green-900/30',text:'text-green-600 dark:text-green-300'},refunded:{bg:'bg-red-50 dark:bg-red-900/30',text:'text-red-600 dark:text-red-300'}};// New component for displaying filter stats\nconst FilterStatsDisplay=_ref=>{var _filtering_steps;let{filterStats}=_ref;if(!filterStats)return null;const{filtering_steps,base_cohort_count,final_cohort_count}=filterStats;// Calculate percentages\nconst calculatePercentage=(count,total)=>{if(!total)return 0;return(count/total*100).toFixed(1);};return/*#__PURE__*/_jsxs(\"div\",{className:\"mb-6 p-4 border rounded-lg bg-white dark:bg-gray-700 shadow-sm\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-2 mb-3\",children:[/*#__PURE__*/_jsx(Filter,{size:18,className:\"text-indigo-600 dark:text-indigo-400\"}),/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg font-semibold text-gray-700 dark:text-white\",children:\"Cohort Filtering Statistics\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-col md:flex-row items-center justify-between mb-4 p-3 bg-indigo-50 dark:bg-indigo-900/30 rounded-md\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"text-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-sm text-gray-600 dark:text-gray-300\",children:\"Base Cohort\"}),/*#__PURE__*/_jsx(\"div\",{className:\"text-xl font-bold text-indigo-600 dark:text-indigo-300\",children:base_cohort_count}),/*#__PURE__*/_jsx(\"div\",{className:\"text-xs text-gray-500 dark:text-gray-400\",children:\"100%\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"hidden md:block text-gray-400\",children:\"\\u2192\"}),filtering_steps.slice(1).map((step,index)=>/*#__PURE__*/_jsxs(\"div\",{className:\"text-center\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"text-sm text-gray-600 dark:text-gray-300\",children:[\"After \",step.step]}),/*#__PURE__*/_jsx(\"div\",{className:\"text-xl font-bold text-indigo-600 dark:text-indigo-300\",children:step.users_count}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-xs text-gray-500 dark:text-gray-400\",children:[calculatePercentage(step.users_count,base_cohort_count),\"% of base\"]})]},index)),final_cohort_count!==((_filtering_steps=filtering_steps[filtering_steps.length-1])===null||_filtering_steps===void 0?void 0:_filtering_steps.users_count)&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"div\",{className:\"hidden md:block text-gray-400\",children:\"\\u2192\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-sm text-gray-600 dark:text-gray-300\",children:\"Final Cohort\"}),/*#__PURE__*/_jsx(\"div\",{className:\"text-xl font-bold text-indigo-600 dark:text-indigo-300\",children:final_cohort_count}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-xs text-gray-500 dark:text-gray-400\",children:[calculatePercentage(final_cohort_count,base_cohort_count),\"% of base\"]})]})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"overflow-x-auto\",children:/*#__PURE__*/_jsxs(\"table\",{className:\"min-w-full text-sm border dark:border-gray-600\",children:[/*#__PURE__*/_jsx(\"thead\",{className:\"bg-gray-50 dark:bg-gray-700\",children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{className:\"p-2 border-b dark:border-gray-600 text-left text-gray-700 dark:text-white\",children:\"Filter Step\"}),/*#__PURE__*/_jsx(\"th\",{className:\"p-2 border-b dark:border-gray-600 text-left text-gray-700 dark:text-white\",children:\"Description\"}),/*#__PURE__*/_jsx(\"th\",{className:\"p-2 border-b dark:border-gray-600 text-center text-gray-700 dark:text-white\",children:\"Users Count\"}),/*#__PURE__*/_jsx(\"th\",{className:\"p-2 border-b dark:border-gray-600 text-center text-gray-700 dark:text-white\",children:\"Users Filtered\"}),/*#__PURE__*/_jsx(\"th\",{className:\"p-2 border-b dark:border-gray-600 text-center text-gray-700 dark:text-white\",children:\"% of Base\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{className:\"bg-white dark:bg-gray-800\",children:filtering_steps.map((step,index)=>/*#__PURE__*/_jsxs(\"tr\",{className:index%2===0?'':'bg-gray-50 dark:bg-gray-700',children:[/*#__PURE__*/_jsx(\"td\",{className:\"p-2 border-b dark:border-gray-600 font-medium text-gray-700 dark:text-gray-300\",children:step.step}),/*#__PURE__*/_jsx(\"td\",{className:\"p-2 border-b dark:border-gray-600 text-gray-700 dark:text-gray-300\",children:step.description}),/*#__PURE__*/_jsx(\"td\",{className:\"p-2 border-b dark:border-gray-600 text-center text-gray-700 dark:text-gray-300\",children:step.users_count}),/*#__PURE__*/_jsx(\"td\",{className:\"p-2 border-b dark:border-gray-600 text-center text-gray-700 dark:text-gray-300\",children:step.users_filtered||0}),/*#__PURE__*/_jsxs(\"td\",{className:\"p-2 border-b dark:border-gray-600 text-center text-gray-700 dark:text-gray-300\",children:[calculatePercentage(step.users_count,base_cohort_count),\"%\"]})]},index))})]})})]});};// Add this Tooltip component before the main CohortAnalyzerPage component\nconst EstimatedRevenueTooltip=_ref2=>{let{data,position,onClose}=_ref2;if(!data)return null;return/*#__PURE__*/_jsxs(\"div\",{className:\"fixed z-50 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-600 rounded-lg shadow-lg p-4 max-w-md\",style:{left:Math.min(position.x,window.innerWidth-400),top:Math.max(position.y-100,10)},children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between items-start mb-2\",children:[/*#__PURE__*/_jsx(\"h4\",{className:\"font-semibold text-gray-800 dark:text-white\",children:\"Estimated Revenue Calculation\"}),/*#__PURE__*/_jsx(\"button\",{onClick:onClose,className:\"text-gray-500 hover:text-gray-700\",children:\"\\xD7\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-3 text-sm\",children:[(()=>{const breakdown=data.breakdown||{};const trialConverted=breakdown.trial_converted||{};const initialPurchase=breakdown.initial_purchase||{};const showTrialRatio=trialConverted.actual_revenue>0;const showInitialRatio=initialPurchase.actual_revenue>0;if(!showTrialRatio&&!showInitialRatio)return null;return/*#__PURE__*/_jsxs(\"div\",{className:\"bg-blue-50 dark:bg-blue-900 p-3 rounded-lg border border-blue-200 dark:border-blue-700 mb-3\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-sm font-medium text-blue-800 dark:text-blue-200 mb-2\",children:\"\\uD83C\\uDFAF Refund Rate Analysis\"}),showTrialRatio&&/*#__PURE__*/_jsxs(\"div\",{className:\"mb-2\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-xs font-medium text-blue-700 dark:text-blue-300\",children:\"Trial Conversion Refund Rate:\"}),/*#__PURE__*/_jsx(\"div\",{className:\"text-sm font-bold text-blue-900 dark:text-blue-100\",children:(()=>{const revenue=trialConverted.actual_revenue||0;const estimatedRefunds=trialConverted.estimated_refunds||0;const refundRate=revenue>0?estimatedRefunds/revenue*100:0;return\"\".concat(estimatedRefunds.toFixed(2),\" / \").concat(revenue.toFixed(2),\" = \").concat(refundRate.toFixed(1),\"%\");})()}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-xs text-blue-600 dark:text-blue-400\",children:[\"$\",(trialConverted.estimated_refunds||0).toFixed(2),\" estimated refunds on $\",(trialConverted.actual_revenue||0).toFixed(2),\" revenue\"]})]}),showInitialRatio&&/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-xs font-medium text-blue-700 dark:text-blue-300\",children:\"Initial Purchase Refund Rate:\"}),/*#__PURE__*/_jsx(\"div\",{className:\"text-sm font-bold text-blue-900 dark:text-blue-100\",children:(()=>{const revenue=initialPurchase.actual_revenue||0;const estimatedRefunds=initialPurchase.estimated_refunds||0;const refundRate=revenue>0?estimatedRefunds/revenue*100:0;return\"\".concat(estimatedRefunds.toFixed(2),\" / \").concat(revenue.toFixed(2),\" = \").concat(refundRate.toFixed(1),\"%\");})()}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-xs text-blue-600 dark:text-blue-400\",children:[\"$\",(initialPurchase.estimated_refunds||0).toFixed(2),\" estimated refunds on $\",(initialPurchase.actual_revenue||0).toFixed(2),\" revenue\"]})]})]});})(),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{className:\"font-medium text-gray-700 dark:text-gray-300\",children:\"Formula:\"}),/*#__PURE__*/_jsx(\"div\",{className:\"font-mono text-xs bg-gray-100 dark:bg-gray-700 p-2 rounded\",children:data.formula})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{className:\"font-medium text-gray-700 dark:text-gray-300\",children:\"Calculation:\"}),/*#__PURE__*/_jsx(\"div\",{className:\"font-mono text-xs bg-gray-100 dark:bg-gray-700 p-2 rounded\",children:data.calculation})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{className:\"font-medium text-gray-700 dark:text-gray-300\",children:\"Components:\"}),/*#__PURE__*/_jsx(\"div\",{className:\"text-xs space-y-1\",children:Object.entries(data.components||{}).map(_ref3=>{let[key,value]=_ref3;return/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between\",children:[/*#__PURE__*/_jsxs(\"span\",{className:\"text-gray-600 dark:text-gray-400\",children:[key,\":\"]}),/*#__PURE__*/_jsx(\"span\",{className:\"font-mono\",children:value})]},key);})})]}),/*#__PURE__*/_jsx(\"div\",{className:\"border-t pt-2\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between font-medium\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"Result:\"}),/*#__PURE__*/_jsx(\"span\",{className:\"text-green-600 dark:text-green-400\",children:data.result})]})})]})]});};const CohortAnalyzerPage=()=>{var _analysisResult$summa,_analysisResult$summa2,_analysisResult$summa3,_analysisResult$summa4,_analysisResult$summa5,_analysisResult$cohor,_analysisResult$cohor2,_analysisResult$cohor3,_analysisResult$cohor4,_analysisResult$cohor5,_analysisResult$cohor6,_analysisResult$cohor7,_analysisResult$cohor8,_analysisResult$cohor9,_analysisResult$cohor0,_analysisResult$cohor1,_analysisResult$cohor10,_analysisResult$cohor11,_analysisResult$cohor12,_analysisResult$cohor13,_analysisResult$cohor14,_analysisResult$cohor15,_analysisResult$cohor16,_analysisResult$cohor17,_analysisResult$cohor18,_analysisResult$cohor19,_analysisResult$cohor20,_analysisResult$cohor21,_analysisResult$cohor22,_analysisResult$cohor23,_analysisResult$cohor24,_userTimelineData$use,_userTimelineData$val;const initialFilters={date_from_str:'',date_to_str:'',optional_filters:[]// [{id: uuid, property_name: '', property_values: [], property_source: 'event/user'}]\n};const[filters,setFilters]=useState(initialFilters);const[availableEventProperties,setAvailableEventProperties]=useState([]);const[availableUserProperties,setAvailableUserProperties]=useState([]);const[propertyValueOptions,setPropertyValueOptions]=useState({});// { 'prop_key': ['val1', 'val2'] }\nconst[isLoading,setIsLoading]=useState(false);const[analysisResult,setAnalysisResult]=useState(null);const[error,setError]=useState(null);const[showLifecycleTables,setShowLifecycleTables]=useState(false);const[activePropertyDiscovery,setActivePropertyDiscovery]=useState(false);const[propertyDiscoveryMessage,setPropertyDiscoveryMessage]=useState('');const[isInitializing,setIsInitializing]=useState(true);// User timeline state\nconst[userTimelineData,setUserTimelineData]=useState(null);const[isLoadingTimeline,setIsLoadingTimeline]=useState(false);const[timelineError,setTimelineError]=useState(null);// Event Revenue Timeline state - NEW FEATURE\nconst[eventRevenueTimelineData,setEventRevenueTimelineData]=useState(null);const[isLoadingEventRevenueTimeline,setIsLoadingEventRevenueTimeline]=useState(false);const[eventRevenueTimelineError,setEventRevenueTimelineError]=useState(null);const[selectedUserId,setSelectedUserId]=useState('');const[selectedProductId,setSelectedProductId]=useState('');const[availableUsers,setAvailableUsers]=useState([]);const[availableProducts,setAvailableProducts]=useState([]);// Add state for cohort definition warning\nconst[cohortDefinitionWarning,setCohortDefinitionWarning]=useState(null);// Add state for tooltip\nconst[tooltipData,setTooltipData]=useState(null);const[tooltipPosition,setTooltipPosition]=useState({x:0,y:0});// Add state for product selection at component level\nconst[selectedProducts,setSelectedProducts]=React.useState({});// State for lifecycle table global product selection (single selector for all tables)\nconst[globalSelectedProduct,setGlobalSelectedProduct]=React.useState(\"\");// State for chart modal\nconst[showChartModal,setShowChartModal]=React.useState(false);// Load saved filters from localStorage on component mount\nuseEffect(()=>{const savedFilters=localStorage.getItem('cohortAnalyzerFilters');if(savedFilters){try{const parsedFilters=JSON.parse(savedFilters);setFilters(prev=>_objectSpread(_objectSpread(_objectSpread({},prev),parsedFilters),{},{optional_filters:parsedFilters.optional_filters||[]// Ensure optional_filters exists\n}));}catch(error){console.error('Error loading saved filters:',error);}}},[]);// Save filters to localStorage whenever they change\nuseEffect(()=>{const filtersToSave={date_from_str:filters.date_from_str,date_to_str:filters.date_to_str,optional_filters:filters.optional_filters};localStorage.setItem('cohortAnalyzerFilters',JSON.stringify(filtersToSave));},[filters.date_from_str,filters.date_to_str,filters.optional_filters]);// Define fetchDiscoverableProperties BEFORE it's used in the useEffect\nconst fetchDiscoverableProperties=useCallback(async()=>{try{const data=await api.getDiscoverableCohortProperties();setAvailableEventProperties(data.event_properties||[]);setAvailableUserProperties(data.user_properties||[]);// Check if we got an empty response and need to enable properties\nif((!data.event_properties||data.event_properties.length===0)&&(!data.user_properties||data.user_properties.length===0)){if(data.status===\"discovery_initiated\"){setPropertyDiscoveryMessage(data.message||\"Property discovery auto-triggered. Please wait...\");setActivePropertyDiscovery(true);// Poll for completion\nconst checkDiscoveryInterval=setInterval(async()=>{try{const status=await api.getPropertyDiscoveryStatus();if(status.status==='completed'){clearInterval(checkDiscoveryInterval);setActivePropertyDiscovery(false);setPropertyDiscoveryMessage(\"Discovery completed! Refreshing properties...\");// Refresh properties after a delay\nsetTimeout(fetchDiscoverableProperties,1000);}}catch(err){console.error(\"Error checking discovery status:\",err);}},3000);}}}catch(err){console.error(\"Error fetching discoverable properties:\",err);if(err.code===\"tables_missing\"){// Specific error for missing tables - try to enable properties automatically\ntry{await api.enableCohortProperties();setPropertyDiscoveryMessage(\"Property system initialized. Please wait while we discover properties...\");// Give time for the initialization and then try again\nsetTimeout(fetchDiscoverableProperties,2000);}catch(enableErr){setError(\"Could not initialize property system. Please try again or check server logs.\");}}else{setError(\"Could not load filter property lists. Try triggering discovery or check console.\");}}},[]);const getPropertyDiscoveryStatus=useCallback(async()=>{try{const status=await api.getPropertyDiscoveryStatus();if(status.active){setActivePropertyDiscovery(true);setPropertyDiscoveryMessage(status.message||\"Property discovery in progress...\");}else if(status.status==='completed'){setActivePropertyDiscovery(false);}}catch(err){console.error(\"Error checking discovery status:\",err);}},[]);// Initialize properties and fetch discoverable properties on mount\nuseEffect(()=>{const initializeProperties=async()=>{setIsInitializing(true);try{// First try to enable properties to ensure tables exist\nawait api.enableCohortProperties();// Check discovery status\nawait getPropertyDiscoveryStatus();// Then fetch the properties\nawait fetchDiscoverableProperties();}catch(err){console.error(\"Error initializing properties:\",err);setError(\"Could not initialize property system. Please check server logs.\");}finally{setIsInitializing(false);}};initializeProperties();},[fetchDiscoverableProperties,getPropertyDiscoveryStatus]);const handleFilterChange=function(type,value){let index=arguments.length>2&&arguments[2]!==undefined?arguments[2]:-1;setFilters(prev=>{const newFilters=_objectSpread({},prev);if(type==='date_from_str'||type==='date_to_str'){newFilters[type]=value;}else if(type==='optional_filter_property'){newFilters.optional_filters[index].property_name=value;newFilters.optional_filters[index].property_values=[];// Reset values\nif(value)fetchPropertyValues(value,'user','optional_filter_'+index);}else if(type==='optional_filter_values'){// Assuming value is an array from a multi-select component\nnewFilters.optional_filters[index].property_values=value;}else if(type.startsWith('optional_filter_')){const field=type.substring('optional_filter_'.length);// 'property', 'values', 'source'\nif(field==='property'){newFilters.optional_filters[index].property_name=value;newFilters.optional_filters[index].property_values=[];// Reset values\nif(value&&newFilters.optional_filters[index].property_source){fetchPropertyValues(value,newFilters.optional_filters[index].property_source,\"optional_filter_\".concat(index));}}else if(field==='values'){newFilters.optional_filters[index].property_values=value;// Assuming array\n}else if(field==='source'){newFilters.optional_filters[index].property_source=value;// If property name already exists, re-fetch values for new source\nif(newFilters.optional_filters[index].property_name){fetchPropertyValues(newFilters.optional_filters[index].property_name,value,\"optional_filter_\".concat(index));}}}return newFilters;});};const fetchPropertyValues=async(propertyName,propertySource,filterIdentifier)=>{if(!propertyName||!propertySource)return;try{const data=await api.getDiscoverableCohortPropertyValues(propertyName,propertySource);setPropertyValueOptions(prev=>_objectSpread(_objectSpread({},prev),{},{[filterIdentifier+'_'+propertyName]:data.values||[]}));}catch(err){console.error(\"Error fetching values for \".concat(propertyName,\":\"),err);setPropertyValueOptions(prev=>_objectSpread(_objectSpread({},prev),{},{[filterIdentifier+'_'+propertyName]:[]}));}};const addOptionalFilter=()=>{setFilters(prev=>_objectSpread(_objectSpread({},prev),{},{optional_filters:[...prev.optional_filters,{id:Date.now().toString(),property_name:'',property_values:[],property_source:'event'}]}));};const removeOptionalFilter=idToRemove=>{setFilters(prev=>_objectSpread(_objectSpread({},prev),{},{optional_filters:prev.optional_filters.filter(f=>f.id!==idToRemove)}));};const handleSubmit=async e=>{e.preventDefault();setIsLoading(true);setError(null);setAnalysisResult(null);setUserTimelineData(null);setTimelineError(null);// Reset event revenue timeline state\nsetEventRevenueTimelineData(null);setEventRevenueTimelineError(null);setSelectedUserId('');setSelectedProductId('');// Reset warning state\nsetCohortDefinitionWarning(null);try{// Basic validation\nif(!filters.date_from_str||!filters.date_to_str){throw new Error(\"Start Date and End Date are required.\");}// Remove the check that requires primary filter when secondary filters exist\n// We'll allow analysis without a primary filter\n// Check primary filter has values if property is selected\nif(filters.optional_filters.length>0&&filters.optional_filters[0].property_name&&filters.optional_filters[0].property_values.length===0){throw new Error(\"Please select values for the optional filters or clear the property selection.\");}// Validate secondary filters\nfor(const filter of filters.optional_filters){if(!filter.property_name||filter.property_values.length===0){throw new Error(\"Optional filter is incomplete. Please select both property and values for all filters or remove unused ones.\");}}// Define precise cohort filtering requirements for the backend\n// Define precise cohort filtering requirements for the backend\n// This ensures ONLY users with a trial started event in the specified date range are included\nconst cohortFilters=_objectSpread(_objectSpread({},filters),{},{enforce_trial_started:true,// Add flag to inform backend to enforce trial started requirement\ncohort_definition:{required_event:\"RC Trial started\",date_range:{from:filters.date_from_str,to:filters.date_to_str},strict_filtering:true// Only include events from users in this cohort\n}});const result=await api.analyzeCohortData(cohortFilters);if(result.error){setError(result.error);}else{// Verify that the backend properly applied our cohort definition\n// by checking if trial_started user count matches the total cohort users\nif(result.cohort_event_occurrence&&result.cohort_event_occurrence.trial_started&&result.summary_stats&&result.summary_stats.total_users_in_final_cohort){const trialStartedUsers=result.cohort_event_occurrence.trial_started.user_count;const totalCohortUsers=result.summary_stats.total_users_in_final_cohort;// The counts should match if cohort definition was applied correctly\nif(trialStartedUsers!==totalCohortUsers){const warningMessage=\"Warning: Cohort definition may not be correctly applied. \"+\"Cohort users (\".concat(totalCohortUsers,\") should equal \")+\"trial started users (\".concat(trialStartedUsers,\").\");console.warn(warningMessage);setCohortDefinitionWarning(warningMessage);}}setAnalysisResult(result);// Fetch timeline data after successful analysis\nfetchUserTimeline();// Fetch event revenue timeline data (aggregate mode)\nfetchEventRevenueTimeline();}}catch(err){console.error(\"Analysis error:\",err);setError(err.message||\"Analysis failed. Please check that you have selected valid filter criteria.\");}setIsLoading(false);};const fetchUserTimeline=async()=>{setIsLoadingTimeline(true);try{console.log('[DEBUG] fetchUserTimeline called with filters:',filters);// Use only the basic filters that the unified pipeline expects\nconst timelineData=await api.getCohortUserTimeline(filters);console.log('[DEBUG] fetchUserTimeline response:',timelineData);if(timelineData.error){console.log('[DEBUG] fetchUserTimeline error:',timelineData.error);setTimelineError(timelineData.error);}else{console.log('[DEBUG] Setting userTimelineData:',timelineData);setUserTimelineData(timelineData);}}catch(err){console.error(\"Timeline fetch error:\",err);setTimelineError(err.message||\"Could not load user timeline data.\");}setIsLoadingTimeline(false);};const fetchEventRevenueTimeline=async function(){let distinctId=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;let productId=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;setIsLoadingEventRevenueTimeline(true);setEventRevenueTimelineError(null);try{console.log('[DEBUG] fetchEventRevenueTimeline called with filters:',filters,'distinctId:',distinctId,'productId:',productId);// Use only the basic filters that the unified pipeline expects\nconst timelineData=await api.getUserEventRevenueTimeline(filters,distinctId,productId);console.log('[DEBUG] fetchEventRevenueTimeline response:',timelineData);if(timelineData.error){console.log('[DEBUG] fetchEventRevenueTimeline error:',timelineData.error);setEventRevenueTimelineError(timelineData.error);}else{console.log('[DEBUG] Setting eventRevenueTimelineData:',timelineData);setEventRevenueTimelineData(timelineData);// Update available users and products from the response\nif(timelineData.available_users){setAvailableUsers(timelineData.available_users);}if(timelineData.available_products){setAvailableProducts(timelineData.available_products);}}}catch(err){console.error(\"Event revenue timeline fetch error:\",err);setEventRevenueTimelineError(err.message||\"Could not load event revenue timeline data.\");}setIsLoadingEventRevenueTimeline(false);};// Function to determine cell state based on user's event history\n// Returns the event state for a day (used for cell background color)\nconst getCellState=(userProductKey,date,eventMap)=>{// If this user has no events on this date, return default state\nif(!eventMap[userProductKey]||!eventMap[userProductKey][date]){// Look for the most recent event before this date to maintain state\nlet mostRecentEventDate=null;let mostRecentState='default';if(eventMap[userProductKey]){// Find the most recent event before this date\nfor(const eventDate in eventMap[userProductKey]){if(eventDate<=date&&(!mostRecentEventDate||eventDate>mostRecentEventDate)){mostRecentEventDate=eventDate;// Get the last event of that day which would determine state going forward\nconst events=eventMap[userProductKey][eventDate];const lastEvent=events[events.length-1];// Determine the state based on the last event\nif(lastEvent.type==='RC Trial started'){mostRecentState='trial_started';}else if(lastEvent.type==='RC Trial converted'){mostRecentState='trial_converted';}else if(lastEvent.type==='RC Trial cancelled'){mostRecentState='trial_cancelled';}else if(lastEvent.type==='RC Initial purchase'){mostRecentState='trial_converted';// Use same color as trial converted\n}else if(lastEvent.type==='RC Renewal'){mostRecentState='trial_converted';// Use same color for renewals\n}else if(lastEvent.type==='RC Cancellation'){mostRecentState=lastEvent.has_refund?'refunded':'conversion_cancelled';}}}}return mostRecentState;}// Get the first event for this user on this date (which determines cell color)\nconst firstEvent=eventMap[userProductKey][date][0];// Return cell state based on the first event type\nif(firstEvent.type==='RC Trial started'){return'trial_started';}else if(firstEvent.type==='RC Trial converted'){return'trial_converted';}else if(firstEvent.type==='RC Trial cancelled'){return'trial_cancelled';}else if(firstEvent.type==='RC Initial purchase'){return'trial_converted';// Use same color as trial converted for initial purchase\n}else if(firstEvent.type==='RC Renewal'){return'trial_converted';// Use same color for renewals\n}else if(firstEvent.type==='RC Cancellation'){// If cancellation has refund flag, use refunded color\nreturn firstEvent.has_refund?'refunded':'conversion_cancelled';}return'default';};// Function to get events for a specific date (returns an array of events)\nconst getEventsForDate=(userProductKey,date,eventMap)=>{if(!eventMap[userProductKey]||!eventMap[userProductKey][date]){return[];}return eventMap[userProductKey][date];};const triggerPropertyDiscovery=async()=>{setActivePropertyDiscovery(true);setPropertyDiscoveryMessage('Property discovery initiated...');try{const result=await api.triggerCohortPropertyDiscovery();// Updated API method name\nsetPropertyDiscoveryMessage(result.message+\" Refresh page after a few moments to see updated filter options.\");// Optionally, could poll for completion or auto-refresh discoverable props\nsetTimeout(()=>fetchDiscoverableProperties(),5000);// Re-fetch after a delay\n}catch(err){setPropertyDiscoveryMessage('Error triggering discovery: '+(err.message||'Unknown error'));}// setActivePropertyDiscovery(false); // Keep message displayed\n};const renderLifecycleTable=function(title,ratesData){let denominatorKey=arguments.length>2&&arguments[2]!==undefined?arguments[2]:\"rate_denominator_count\";// Add debugging\nconsole.log(\"[DEBUG] renderLifecycleTable called for \\\"\".concat(title,\"\\\"\"));console.log(\"[DEBUG] ratesData:\",ratesData);if(!ratesData){console.log(\"[DEBUG] No ratesData for \\\"\".concat(title,\"\\\"\"));return/*#__PURE__*/_jsxs(\"p\",{className:\"text-sm text-gray-500 dark:text-gray-300\",children:[\"Lifecycle rate data not available for \",title,\".\"]});}// Handle new product-based format\nconst isNewFormat=ratesData.rates_by_product||ratesData.aggregate_rates;console.log(\"[DEBUG] isNewFormat: \".concat(isNewFormat,\" for \\\"\").concat(title,\"\\\"\"));if(isNewFormat){const aggregateRates=ratesData.aggregate_rates;const productRates=ratesData.rates_by_product||{};console.log(\"[DEBUG] aggregateRates:\",aggregateRates);console.log(\"[DEBUG] productRates:\",productRates);if(!aggregateRates||!aggregateRates.rates_by_day||Object.keys(aggregateRates.rates_by_day).length===0){console.log(\"[DEBUG] No valid aggregateRates for \\\"\".concat(title,\"\\\"\"));// Show raw data for debugging\nreturn/*#__PURE__*/_jsxs(\"div\",{className:\"mb-6 p-4 bg-yellow-50 dark:bg-yellow-900/30 rounded-lg\",children:[/*#__PURE__*/_jsxs(\"h4\",{className:\"text-lg font-semibold text-gray-900 dark:text-white mb-2\",children:[title,\" - Debug Info\"]}),/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-gray-600 dark:text-gray-400 mb-2\",children:\"Raw data structure (for debugging):\"}),/*#__PURE__*/_jsx(\"pre\",{className:\"text-xs bg-gray-100 dark:bg-gray-800 p-2 rounded overflow-x-auto\",children:JSON.stringify(ratesData,null,2)})]});}// Determine which rates to display based on global product selector\nconst displayRates=globalSelectedProduct&&productRates[globalSelectedProduct]?productRates[globalSelectedProduct]:aggregateRates;const ratesByDay=displayRates.rates_by_day;const sortedDays=Object.keys(ratesByDay).map(Number).sort((a,b)=>a-b);// Prepare row data for the transposed table\nconst rowData=[{metric:\"Raw Daily Cancellation %\",dataKey:\"raw_daily_cancellation_rate\"},{metric:\"Smoothed Daily Cancellation %\",dataKey:\"smoothed_daily_cancellation_rate\"},{metric:\"Raw Cumulative Cancellation %\",dataKey:\"raw_cumulative_cancellation_rate\"},{metric:\"Smoothed Cumulative Cancellation %\",dataKey:\"smoothed_cumulative_cancellation_rate\"},{metric:\"Raw Daily Refund %\",dataKey:\"raw_daily_refund_rate\"},{metric:\"Smoothed Daily Refund %\",dataKey:\"smoothed_daily_refund_rate\"},{metric:\"Raw Cumulative Refund %\",dataKey:\"raw_cumulative_refund_rate\"},{metric:\"Smoothed Cumulative Refund %\",dataKey:\"smoothed_cumulative_refund_rate\"}];return/*#__PURE__*/_jsxs(\"div\",{className:\"mb-6\",children:[/*#__PURE__*/_jsx(\"h4\",{className:\"text-lg font-semibold text-gray-900 dark:text-white mb-4\",children:title}),/*#__PURE__*/_jsxs(\"div\",{className:\"mb-4 p-3 bg-blue-50 dark:bg-blue-900/30 rounded-lg\",children:[/*#__PURE__*/_jsx(\"h5\",{className:\"font-semibold text-blue-800 dark:text-blue-200 mb-2\",children:\"Smoothing Method Information\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm text-blue-700 dark:text-blue-300\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Method:\"}),\" \",displayRates.smoothing_method||'none']}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Quality:\"}),\" \",displayRates.smoothing_quality||'N/A']}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Sample Size:\"}),\" \",displayRates.total_sample_size||0]})]}),displayRates.smoothing_details&&/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{children:/*#__PURE__*/_jsx(\"strong\",{children:\"Data Characteristics:\"})}),/*#__PURE__*/_jsx(\"ul\",{className:\"ml-4 mt-1\",children:displayRates.smoothing_details.cancellation&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"li\",{children:[\"Early Concentration: \",displayRates.smoothing_details.cancellation.early_concentration]}),/*#__PURE__*/_jsxs(\"li\",{children:[\"Sparsity: \",displayRates.smoothing_details.cancellation.sparsity]}),/*#__PURE__*/_jsxs(\"li\",{children:[\"Max Rate: \",displayRates.smoothing_details.cancellation.max_rate]})]})})]})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"bg-gray-50 dark:bg-gray-800 border-r border-gray-200 dark:border-gray-700\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"px-4 py-3 font-medium text-gray-900 dark:text-white border-b border-gray-200 dark:border-gray-700\",children:\"Metric\"}),rowData.map((row,index)=>/*#__PURE__*/_jsx(\"div\",{className:\"px-4 py-3 text-sm border-b border-gray-200 dark:border-gray-700 \".concat(index%2===0?'bg-white dark:bg-gray-900':'bg-gray-50 dark:bg-gray-800',\" text-gray-900 dark:text-white font-medium\"),children:row.metric},index))]}),/*#__PURE__*/_jsx(\"div\",{className:\"flex-1 overflow-x-auto\",children:/*#__PURE__*/_jsx(\"div\",{className:\"flex\",children:sortedDays.map(day=>{const dayStr=day.toString();const dayData=ratesByDay[dayStr];return/*#__PURE__*/_jsxs(\"div\",{className:\"min-w-[100px] border-r border-gray-200 dark:border-gray-700 last:border-r-0\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"px-4 py-3 bg-gray-50 dark:bg-gray-800 font-medium text-gray-900 dark:text-white text-center border-b border-gray-200 dark:border-gray-700\",children:[\"Day \",day]}),rowData.map((row,index)=>/*#__PURE__*/_jsxs(\"div\",{className:\"px-4 py-3 text-sm text-center border-b border-gray-200 dark:border-gray-700 \".concat(index%2===0?'bg-white dark:bg-gray-900':'bg-gray-50 dark:bg-gray-800',\" text-gray-500 dark:text-gray-300\"),children:[dayData?(dayData[row.dataKey]||0).toFixed(2):'0.00',\"%\"]},index))]},dayStr);})})})]})})]});}// Fall back to legacy format handling if needed\nif(!ratesData.rates_by_day||Object.keys(ratesData.rates_by_day).length===0){return/*#__PURE__*/_jsxs(\"p\",{className:\"text-sm text-gray-500 dark:text-gray-300\",children:[\"No lifecycle rate data available for \",title,\".\"]});}const sortedDays=Object.keys(ratesData.rates_by_day).map(Number).sort((a,b)=>a-b);const ratesDenominator=ratesData[denominatorKey]||0;// Legacy format with transposed layout\nconst legacyRowData=[{metric:\"Daily Cancel %\",dataKey:\"cancelled_daily_pct\"},{metric:\"Cumulative Cancel %\",dataKey:\"cancelled_cumulative_pct\"},{metric:\"Daily Convert %\",dataKey:\"converted_daily_pct\"},{metric:\"Cumulative Convert %\",dataKey:\"converted_cumulative_pct\"}];return/*#__PURE__*/_jsxs(\"div\",{className:\"mb-6\",children:[/*#__PURE__*/_jsx(\"h4\",{className:\"text-lg font-semibold mb-2 text-gray-900 dark:text-white\",children:title}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-sm text-gray-600 dark:text-gray-400 mb-3\",children:[\"Based on \",ratesDenominator,\" users. \",ratesData.message]}),/*#__PURE__*/_jsx(\"div\",{className:\"border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"bg-gray-50 dark:bg-gray-800 border-r border-gray-200 dark:border-gray-700\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"px-4 py-3 font-medium text-gray-900 dark:text-white border-b border-gray-200 dark:border-gray-700\",children:\"Metric\"}),legacyRowData.map((row,index)=>/*#__PURE__*/_jsx(\"div\",{className:\"px-4 py-3 text-sm border-b border-gray-200 dark:border-gray-700 \".concat(index%2===0?'bg-white dark:bg-gray-900':'bg-gray-50 dark:bg-gray-800',\" text-gray-900 dark:text-white font-medium\"),children:row.metric},index))]}),/*#__PURE__*/_jsx(\"div\",{className:\"flex-1 overflow-x-auto\",children:/*#__PURE__*/_jsx(\"div\",{className:\"flex\",children:sortedDays.map(day=>{const dayStr=day.toString();const dayData=ratesData.rates_by_day[dayStr];return/*#__PURE__*/_jsxs(\"div\",{className:\"min-w-[100px] border-r border-gray-200 dark:border-gray-700 last:border-r-0\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"px-4 py-3 bg-gray-50 dark:bg-gray-800 font-medium text-gray-900 dark:text-white text-center border-b border-gray-200 dark:border-gray-700\",children:[\"Day \",day]}),legacyRowData.map((row,index)=>/*#__PURE__*/_jsxs(\"div\",{className:\"px-4 py-3 text-sm text-center border-b border-gray-200 dark:border-gray-700 \".concat(index%2===0?'bg-white dark:bg-gray-900':'bg-gray-50 dark:bg-gray-800',\" text-gray-500 dark:text-gray-300\"),children:[dayData?(dayData[row.dataKey]||0).toFixed(2):'0.00',\"%\"]},index))]},dayStr);})})})]})})]});};const formatCurrency=value=>{if(value===null||value===undefined)return\"N/A\";return value.toLocaleString('en-US',{style:'currency',currency:'USD'});};// Prepare data for the chart\nconst chartData=(analysisResult===null||analysisResult===void 0?void 0:analysisResult.daily_data.map(d=>{const actualNetRevenue=d.cumulative_revenue_actual_net||0;// Dotted line: actual net cumulative revenue + (estimated additional from pending trials) + (net effect of estimated future refunds on actual revenue)\n// The estimated_future_refunds_on_actual_revenue_amount is an *amount* to be subtracted.\nconst projectedNetRevenue=actualNetRevenue+(d.estimated_additional_revenue_from_pending_trials_net_refund||0)-(d.estimated_future_refunds_on_actual_revenue_amount||0);const trialsStarted=d.daily_trials_started||0;const trialsConverted=d.daily_trials_converted_actual||0;const trialsCancelled=d.daily_trials_cancelled_actual||0;const trialsEnded=trialsConverted+trialsCancelled;const trialsPending=d.daily_trials_started-trialsEnded;return{date:d.date,// Absolute values - Daily\ndaily_trials_started:trialsStarted,daily_trials_ended:trialsEnded,daily_trials_pending:trialsPending,daily_conversions:trialsConverted,daily_conversions_net_refunds:trialsConverted-(d.daily_refund_count_actual||0),daily_estimated_conversions_net_refunds:trialsConverted-(d.daily_estimated_refunds||0),daily_refunds:d.daily_refund_count_actual||0,// Money values - Daily\ndaily_revenue:d.daily_revenue_actual||0,daily_revenue_net:d.daily_revenue_actual_net||0,daily_estimated_revenue:d.daily_estimated_revenue||0,// Absolute values - Cumulative\ncumulative_trials_started:d.cumulative_trials_started||0,cumulative_trials_ended:(d.cumulative_trials_converted_actual||0)+(d.cumulative_trials_cancelled_actual||0),cumulative_trials_pending:d.cumulative_trials_started-((d.cumulative_trials_converted_actual||0)+(d.cumulative_trials_cancelled_actual||0)),cumulative_conversions:d.cumulative_trials_converted_actual||0,cumulative_conversions_net_refunds:(d.cumulative_trials_converted_actual||0)-(d.cumulative_refund_count_actual||0),cumulative_estimated_conversions_net_refunds:(d.cumulative_trials_converted_actual||0)-(d.cumulative_estimated_refunds||0),cumulative_refunds:d.cumulative_refund_count_actual||0,// Money values - Cumulative\ncumulative_revenue:d.cumulative_revenue_actual||0,cumulative_revenue_net:actualNetRevenue,cumulative_estimated_revenue:projectedNetRevenue};}))||[];const[visibleAbsoluteMetrics,setVisibleAbsoluteMetrics]=useState({daily_trials_started:true,daily_trials_ended:false,daily_trials_pending:false,daily_conversions:true,daily_conversions_net_refunds:false,daily_estimated_conversions_net_refunds:false,daily_refunds:false,cumulative_trials_started:true,cumulative_trials_ended:false,cumulative_trials_pending:false,cumulative_conversions:true,cumulative_conversions_net_refunds:false,cumulative_estimated_conversions_net_refunds:false,cumulative_refunds:false});const[visibleMoneyMetrics,setVisibleMoneyMetrics]=useState({daily_revenue:true,daily_revenue_net:false,daily_estimated_revenue:false,cumulative_revenue:false,cumulative_revenue_net:true,cumulative_estimated_revenue:true});const toggleAbsoluteMetric=metricKey=>{setVisibleAbsoluteMetrics(prev=>_objectSpread(_objectSpread({},prev),{},{[metricKey]:!prev[metricKey]}));};const toggleMoneyMetric=metricKey=>{setVisibleMoneyMetrics(prev=>_objectSpread(_objectSpread({},prev),{},{[metricKey]:!prev[metricKey]}));};// Add this function to determine which styles to use based on dark mode detection\nconst getSelectTheme=()=>{const isDarkMode=document.documentElement.classList.contains('dark')||window.matchMedia('(prefers-color-scheme: dark)').matches;return isDarkMode?darkModeSelectStyles:customSelectStyles;};// Chart Modal Component\nconst ChartModal=()=>{if(!showChartModal||!(analysisResult!==null&&analysisResult!==void 0&&analysisResult.lifecycle_rates))return null;const lifecycleRates=analysisResult.lifecycle_rates;// Get chart data for different scenarios\nconst getChartData=function(ratesData,title){let type=arguments.length>2&&arguments[2]!==undefined?arguments[2]:'cancellation_refund';if(!(ratesData!==null&&ratesData!==void 0&&ratesData.rates_by_day))return null;const days=Object.keys(ratesData.rates_by_day).map(Number).sort((a,b)=>a-b);let datasets=[];if(type==='cancellation_refund'){// Cancellation/Refund scenario\ndatasets=[{label:'Raw Cumulative Cancellation %',data:days.map(day=>{var _ratesData$rates_by_d;return((_ratesData$rates_by_d=ratesData.rates_by_day[day.toString()])===null||_ratesData$rates_by_d===void 0?void 0:_ratesData$rates_by_d.raw_cumulative_cancellation_rate)||0;}),borderColor:'rgb(255, 99, 132)',backgroundColor:'rgba(255, 99, 132, 0.1)',borderDash:[],tension:0.1},{label:'Smoothed Cumulative Cancellation %',data:days.map(day=>{var _ratesData$rates_by_d2;return((_ratesData$rates_by_d2=ratesData.rates_by_day[day.toString()])===null||_ratesData$rates_by_d2===void 0?void 0:_ratesData$rates_by_d2.smoothed_cumulative_cancellation_rate)||0;}),borderColor:'rgb(255, 99, 132)',backgroundColor:'rgba(255, 99, 132, 0.3)',borderDash:[5,5],tension:0.1},{label:'Raw Cumulative Refund %',data:days.map(day=>{var _ratesData$rates_by_d3;return((_ratesData$rates_by_d3=ratesData.rates_by_day[day.toString()])===null||_ratesData$rates_by_d3===void 0?void 0:_ratesData$rates_by_d3.raw_cumulative_refund_rate)||0;}),borderColor:'rgb(54, 162, 235)',backgroundColor:'rgba(54, 162, 235, 0.1)',borderDash:[],tension:0.1},{label:'Smoothed Cumulative Refund %',data:days.map(day=>{var _ratesData$rates_by_d4;return((_ratesData$rates_by_d4=ratesData.rates_by_day[day.toString()])===null||_ratesData$rates_by_d4===void 0?void 0:_ratesData$rates_by_d4.smoothed_cumulative_refund_rate)||0;}),borderColor:'rgb(54, 162, 235)',backgroundColor:'rgba(54, 162, 235, 0.3)',borderDash:[5,5],tension:0.1}];}else if(type==='conversion_cancellation'){// Trial Conversion/Cancellation scenario\ndatasets=[{label:'Raw Cumulative Conversion %',data:days.map(day=>{var _ratesData$rates_by_d5;return((_ratesData$rates_by_d5=ratesData.rates_by_day[day.toString()])===null||_ratesData$rates_by_d5===void 0?void 0:_ratesData$rates_by_d5.raw_cumulative_conversion_rate)||0;}),borderColor:'rgb(75, 192, 192)',backgroundColor:'rgba(75, 192, 192, 0.1)',borderDash:[],tension:0.1},{label:'Smoothed Cumulative Conversion %',data:days.map(day=>{var _ratesData$rates_by_d6;return((_ratesData$rates_by_d6=ratesData.rates_by_day[day.toString()])===null||_ratesData$rates_by_d6===void 0?void 0:_ratesData$rates_by_d6.smoothed_cumulative_conversion_rate)||0;}),borderColor:'rgb(75, 192, 192)',backgroundColor:'rgba(75, 192, 192, 0.3)',borderDash:[5,5],tension:0.1},{label:'Raw Cumulative Cancellation %',data:days.map(day=>{var _ratesData$rates_by_d7;return((_ratesData$rates_by_d7=ratesData.rates_by_day[day.toString()])===null||_ratesData$rates_by_d7===void 0?void 0:_ratesData$rates_by_d7.raw_cumulative_cancellation_rate)||0;}),borderColor:'rgb(255, 99, 132)',backgroundColor:'rgba(255, 99, 132, 0.1)',borderDash:[],tension:0.1},{label:'Smoothed Cumulative Cancellation %',data:days.map(day=>{var _ratesData$rates_by_d8;return((_ratesData$rates_by_d8=ratesData.rates_by_day[day.toString()])===null||_ratesData$rates_by_d8===void 0?void 0:_ratesData$rates_by_d8.smoothed_cumulative_cancellation_rate)||0;}),borderColor:'rgb(255, 99, 132)',backgroundColor:'rgba(255, 99, 132, 0.3)',borderDash:[5,5],tension:0.1}];}return{labels:days.map(day=>\"Day \".concat(day)),datasets:datasets};};const chartOptions={responsive:true,plugins:{legend:{position:'top'},title:{display:true,text:'Raw vs Smoothed Cumulative Rates'}},scales:{y:{beginAtZero:true,title:{display:true,text:'Percentage (%)'}},x:{title:{display:true,text:'Days'}}}};// Determine which rates to use based on global product selector\nconst getDisplayRates=ratesData=>{if(!ratesData)return null;if(globalSelectedProduct&&ratesData.rates_by_product&&ratesData.rates_by_product[globalSelectedProduct]){return ratesData.rates_by_product[globalSelectedProduct];}return ratesData.aggregate_rates||ratesData;};const trialToOutcomeRates=getDisplayRates(lifecycleRates.trial_to_outcome_rates);const cancellationRefundRates=getDisplayRates(lifecycleRates.trial_to_cancellation_rates||lifecycleRates.trial_to_refund_rates);return/*#__PURE__*/_jsx(\"div\",{className:\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\",children:/*#__PURE__*/_jsx(\"div\",{className:\"bg-white dark:bg-gray-800 rounded-lg max-w-6xl w-full max-h-[90vh] overflow-y-auto\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"p-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between items-center mb-6\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-2xl font-bold text-gray-900 dark:text-white\",children:\"Lifecycle Rate Charts\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setShowChartModal(false),className:\"p-2 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200\",children:/*#__PURE__*/_jsx(XCircle,{size:24})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 lg:grid-cols-2 gap-6\",children:[trialToOutcomeRates&&/*#__PURE__*/_jsxs(\"div\",{className:\"bg-gray-50 dark:bg-gray-700 p-4 rounded-lg\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg font-semibold mb-4 text-gray-900 dark:text-white\",children:\"Trial to Outcome (Conversion vs Cancellation)\"}),/*#__PURE__*/_jsx(ChartLine,{data:getChartData(trialToOutcomeRates,'Trial to Outcome','conversion_cancellation'),options:chartOptions})]}),cancellationRefundRates&&/*#__PURE__*/_jsxs(\"div\",{className:\"bg-gray-50 dark:bg-gray-700 p-4 rounded-lg\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg font-semibold mb-4 text-gray-900 dark:text-white\",children:\"Cancellation vs Refund Rates\"}),/*#__PURE__*/_jsx(ChartLine,{data:getChartData(cancellationRefundRates,'Cancellation vs Refund','cancellation_refund'),options:chartOptions})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mt-6 text-sm text-gray-600 dark:text-gray-400\",children:[/*#__PURE__*/_jsx(\"p\",{children:/*#__PURE__*/_jsx(\"strong\",{children:\"Legend:\"})}),/*#__PURE__*/_jsxs(\"ul\",{className:\"list-disc list-inside mt-2\",children:[/*#__PURE__*/_jsx(\"li\",{children:\"Solid lines represent raw data\"}),/*#__PURE__*/_jsx(\"li\",{children:\"Dashed lines represent smoothed curves\"}),/*#__PURE__*/_jsx(\"li\",{children:\"The smoothing algorithm first smooths cumulative rates, then derives daily rates\"})]})]})]})})});};return/*#__PURE__*/_jsxs(\"div\",{className:\"p-6 max-w-full mx-auto bg-white dark:bg-gray-800 min-h-screen\",children:[/*#__PURE__*/_jsx(\"h1\",{className:\"text-3xl font-bold mb-6 text-gray-800 dark:text-white border-b pb-2 border-gray-200 dark:border-gray-600\",children:\"Cohort Analyzer\"}),isInitializing?/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-center p-8 bg-white dark:bg-gray-700 rounded-lg shadow-md\",children:[/*#__PURE__*/_jsx(Loader,{className:\"animate-spin mr-2 text-indigo-600 dark:text-indigo-400\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-700 dark:text-white\",children:\"Initializing cohort analyzer...\"})]}):/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit,className:\"bg-white dark:bg-gray-700 p-6 rounded-lg shadow-md mb-8\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6 border-b border-gray-200 dark:border-gray-600 pb-6\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"date_from_str\",className:\"block text-sm font-medium text-gray-700 dark:text-white mb-2\",children:\"Start Date *\"}),/*#__PURE__*/_jsx(\"input\",{type:\"date\",id:\"date_from_str\",value:filters.date_from_str,onChange:e=>handleFilterChange('date_from_str',e.target.value),className:\"mt-1 block w-full p-2.5 border border-gray-300 dark:border-gray-500 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm bg-white dark:bg-gray-600 text-gray-900 dark:text-white\",required:true})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"date_to_str\",className:\"block text-sm font-medium text-gray-700 dark:text-white mb-2\",children:\"End Date *\"}),/*#__PURE__*/_jsx(\"input\",{type:\"date\",id:\"date_to_str\",value:filters.date_to_str,onChange:e=>handleFilterChange('date_to_str',e.target.value),className:\"mt-1 block w-full p-2.5 border border-gray-300 dark:border-gray-500 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm bg-white dark:bg-gray-600 text-gray-900 dark:text-white\",required:true})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mb-6 p-5 border rounded-md border-teal-200 dark:border-teal-500 bg-teal-50 dark:bg-teal-900/40\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between items-center mb-3\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg font-semibold text-gray-800 dark:text-white\",children:\"Additional Event/User Property Filters\"}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:addOptionalFilter,className:\"p-1.5 bg-teal-100 dark:bg-teal-600 text-teal-700 dark:text-white rounded-full hover:bg-teal-200 dark:hover:bg-teal-500 transition-colors\",children:/*#__PURE__*/_jsx(PlusCircle,{size:18})})]}),filters.optional_filters.length===0&&/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-gray-600 dark:text-gray-300 italic mb-2\",children:\"No additional filters. Click the + button to add a filter.\"}),filters.optional_filters.map((filter,index)=>/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-4 gap-3 items-end mb-4 p-4 border-t dark:border-gray-600 bg-white dark:bg-gray-600 rounded-md shadow-sm\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-xs font-medium text-gray-600 dark:text-white mb-1\",children:\"Source Type\"}),/*#__PURE__*/_jsxs(\"select\",{value:filter.property_source,onChange:e=>handleFilterChange(\"optional_filter_source\",e.target.value,index),className:\"block w-full p-2 border border-gray-300 dark:border-gray-500 rounded-md shadow-sm focus:ring-teal-500 focus:border-teal-500 sm:text-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-white\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"event\",children:\"Event Property\"}),/*#__PURE__*/_jsx(\"option\",{value:\"user\",children:\"User Property\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-xs font-medium text-gray-600 dark:text-white mb-1\",children:\"Property Name\"}),/*#__PURE__*/_jsxs(\"select\",{value:filter.property_name,onChange:e=>handleFilterChange(\"optional_filter_property\",e.target.value,index),className:\"block w-full p-2 border border-gray-300 dark:border-gray-500 rounded-md shadow-sm focus:ring-teal-500 focus:border-teal-500 sm:text-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-white\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"-- Select Property --\"}),(filter.property_source==='event'?availableEventProperties:availableUserProperties).map(p=>/*#__PURE__*/_jsx(\"option\",{value:p.key,children:p.display_name||p.key},p.key))]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-xs font-medium text-gray-600 dark:text-white mb-1\",children:\"Property Value(s)\"}),/*#__PURE__*/_jsx(Select,{isMulti:true,isDisabled:!filter.property_name||!filter.property_source,options:(propertyValueOptions[\"optional_filter_\".concat(index,\"_\")+filter.property_name]||[]).map(val=>({value:val,label:val})),value:filter.property_values.map(val=>({value:val,label:val})),onChange:selected=>handleFilterChange(\"optional_filter_values\",selected?selected.map(option=>option.value):[],index),styles:getSelectTheme(),placeholder:\"Select values...\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"flex justify-end\",children:/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:()=>removeOptionalFilter(filter.id),className:\"p-1.5 bg-red-100 dark:bg-red-700 text-red-600 dark:text-white rounded-full hover:bg-red-200 dark:hover:bg-red-600 transition-colors\",children:/*#__PURE__*/_jsx(XCircle,{size:18})})})]},filter.id))]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between mt-8\",children:[/*#__PURE__*/_jsx(\"button\",{type:\"submit\",disabled:isLoading,className:\"px-6 py-2.5 bg-indigo-600 text-white font-semibold rounded-md shadow hover:bg-indigo-700 disabled:opacity-50 flex items-center transition-colors\",children:isLoading?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Loader,{className:\"animate-spin mr-2\",size:16}),\"Analyzing...\"]}):'Analyze Cohort'}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:triggerPropertyDiscovery,disabled:activePropertyDiscovery,className:\"px-5 py-2.5 bg-teal-600 text-white text-sm font-medium rounded-md hover:bg-teal-700 disabled:opacity-50 flex items-center transition-colors\",children:activePropertyDiscovery?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Loader,{className:\"animate-spin mr-2\",size:16}),\"Discovery Running...\"]}):\"Discover Filter Properties\"})]}),propertyDiscoveryMessage&&/*#__PURE__*/_jsx(\"div\",{className:\"mt-3 p-3 bg-teal-50 dark:bg-teal-900/40 border border-teal-200 dark:border-teal-600 rounded-md\",children:/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-teal-700 dark:text-teal-300\",children:propertyDiscoveryMessage})})]}),error&&/*#__PURE__*/_jsx(\"div\",{className:\"my-4 p-4 bg-red-100 dark:bg-red-800 text-red-700 dark:text-white rounded-md shadow-md border border-red-300 dark:border-red-600\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center\",children:[/*#__PURE__*/_jsx(AlertTriangle,{className:\"mr-2 flex-shrink-0\"}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"span\",{className:\"font-medium block\",children:\"Analysis Error:\"}),/*#__PURE__*/_jsx(\"span\",{className:\"block mt-1\",children:error})]})]})}),cohortDefinitionWarning&&/*#__PURE__*/_jsx(\"div\",{className:\"my-4 p-4 bg-yellow-100 dark:bg-yellow-800 text-yellow-700 dark:text-white rounded-md shadow-md border border-yellow-300 dark:border-yellow-600\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center\",children:[/*#__PURE__*/_jsx(AlertTriangle,{className:\"mr-2 flex-shrink-0\"}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"span\",{className:\"font-medium block\",children:\"Cohort Definition Warning:\"}),/*#__PURE__*/_jsx(\"span\",{className:\"block mt-1\",children:cohortDefinitionWarning}),/*#__PURE__*/_jsx(\"span\",{className:\"block mt-1 text-sm italic\",children:\"The backend may not be correctly filtering users based on trial started events.\"})]})]})}),analysisResult&&/*#__PURE__*/_jsxs(\"div\",{className:\"mt-8 bg-white dark:bg-gray-700 p-6 rounded-lg shadow-md\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-2xl font-bold mb-4 text-gray-800 dark:text-white\",children:\"Analysis Results\"}),analysisResult.filter_stats&&/*#__PURE__*/_jsx(FilterStatsDisplay,{filterStats:analysisResult.filter_stats}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"p-4 bg-gray-50 dark:bg-gray-600 rounded-md\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"font-semibold text-gray-700 dark:text-white\",children:\"Cohort Users (Trial Started)\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-2xl font-bold text-indigo-600 dark:text-indigo-300\",children:((_analysisResult$summa=analysisResult.summary_stats)===null||_analysisResult$summa===void 0?void 0:_analysisResult$summa.total_users_in_final_cohort)||0}),/*#__PURE__*/_jsx(\"p\",{className:\"text-xs text-gray-500 dark:text-gray-300\",children:\"Unique users who had an 'RC Trial started' event in the selected date range (and match primary filter if applied).\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"p-4 bg-gray-50 dark:bg-gray-600 rounded-md\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"font-semibold text-gray-700 dark:text-white\",children:\"Events Analyzed (Cohort Only)\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-2xl font-bold text-indigo-600 dark:text-indigo-300\",children:((_analysisResult$summa2=analysisResult.summary_stats)===null||_analysisResult$summa2===void 0?void 0:_analysisResult$summa2.total_events_analyzed)||0}),/*#__PURE__*/_jsx(\"p\",{className:\"text-xs text-gray-500 dark:text-gray-300\",children:\"Events from users in the trial started cohort\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"p-4 bg-gray-50 dark:bg-gray-600 rounded-md\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"font-semibold text-gray-700 dark:text-white\",children:\"Cohort ARPC (Overall)\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-2xl font-bold text-indigo-600 dark:text-indigo-300\",children:formatCurrency((_analysisResult$summa3=analysisResult.summary_stats)===null||_analysisResult$summa3===void 0?void 0:_analysisResult$summa3.arpc_cohort)}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-xs text-gray-500 dark:text-gray-300\",children:[\"Basis: \",(_analysisResult$summa4=analysisResult.summary_stats)===null||_analysisResult$summa4===void 0?void 0:_analysisResult$summa4.arpc_datapoints,\" users. \",(_analysisResult$summa5=analysisResult.summary_stats)===null||_analysisResult$summa5===void 0?void 0:_analysisResult$summa5.arpc_calculation_basis]}),/*#__PURE__*/_jsx(\"p\",{className:\"text-xs text-gray-500 dark:text-gray-300 italic\",children:\"See per-product breakdown below\"})]})]}),eventRevenueTimelineData&&eventRevenueTimelineData.arpc_per_product&&Object.keys(eventRevenueTimelineData.arpc_per_product).length>0&&/*#__PURE__*/_jsxs(\"div\",{className:\"mb-6\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"font-semibold text-gray-700 dark:text-white mb-3\",children:\"ARPC Per Product\"}),/*#__PURE__*/_jsx(\"div\",{className:\"bg-gray-50 dark:bg-gray-600 rounded-lg p-3\",children:/*#__PURE__*/_jsx(\"div\",{className:\"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-3\",children:Object.entries(eventRevenueTimelineData.arpc_per_product).map(_ref4=>{let[productId,arpcData]=_ref4;return/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white dark:bg-gray-700 rounded-md p-3 border border-gray-200 dark:border-gray-600\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-xs font-medium text-gray-600 dark:text-gray-300 truncate\",title:productId,children:productId}),/*#__PURE__*/_jsx(\"div\",{className:\"text-lg font-bold text-green-600 dark:text-green-400 leading-tight\",children:typeof arpcData==='object'?formatCurrency(arpcData.arpc):formatCurrency(arpcData)}),typeof arpcData==='object'&&/*#__PURE__*/_jsxs(\"div\",{className:\"text-xs text-gray-500 dark:text-gray-400 mt-1 space-y-0.5\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[arpcData.event_count,\" events\"]}),/*#__PURE__*/_jsxs(\"div\",{children:[arpcData.unique_users,\" users\"]}),/*#__PURE__*/_jsx(\"div\",{className:\"font-medium\",children:formatCurrency(arpcData.total_revenue)})]})]},productId);})})})]}),analysisResult.event_user_counts&&/*#__PURE__*/_jsxs(\"div\",{className:\"mb-6\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"font-semibold text-gray-700 dark:text-white mb-3\",children:\"Unique Users Per Event Type\"}),/*#__PURE__*/_jsx(\"div\",{className:\"overflow-x-auto\",children:/*#__PURE__*/_jsxs(\"table\",{className:\"min-w-full text-sm border dark:border-gray-600\",children:[/*#__PURE__*/_jsx(\"thead\",{className:\"bg-gray-50 dark:bg-gray-700\",children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{className:\"p-2 border-b dark:border-gray-600 text-left text-gray-700 dark:text-white\",children:\"Event Type\"}),/*#__PURE__*/_jsx(\"th\",{className:\"p-2 border-b dark:border-gray-600 text-left text-gray-700 dark:text-white\",children:\"Unique Users\"}),/*#__PURE__*/_jsx(\"th\",{className:\"p-2 border-b dark:border-gray-600 text-left text-gray-700 dark:text-white\",children:\"Total Events\"}),/*#__PURE__*/_jsx(\"th\",{className:\"p-2 border-b dark:border-gray-600 text-left text-gray-700 dark:text-white\",children:\"Events Per User\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{className:\"bg-white dark:bg-gray-800\",children:Object.entries(analysisResult.event_user_counts).map((_ref5,index)=>{let[eventType,counts]=_ref5;return/*#__PURE__*/_jsxs(\"tr\",{className:index%2===0?'':'bg-gray-50 dark:bg-gray-700',children:[/*#__PURE__*/_jsx(\"td\",{className:\"p-2 border-b dark:border-gray-600 font-medium text-gray-700 dark:text-gray-300\",children:eventType}),/*#__PURE__*/_jsx(\"td\",{className:\"p-2 border-b dark:border-gray-600 text-gray-700 dark:text-gray-300\",children:counts.unique_users||0}),/*#__PURE__*/_jsx(\"td\",{className:\"p-2 border-b dark:border-gray-600 text-gray-700 dark:text-gray-300\",children:counts.total_events||0}),/*#__PURE__*/_jsx(\"td\",{className:\"p-2 border-b dark:border-gray-600 text-gray-700 dark:text-gray-300\",children:counts.unique_users>0?(counts.total_events/counts.unique_users).toFixed(2):'0.00'})]},eventType);})})]})})]}),analysisResult.cohort_event_occurrence&&/*#__PURE__*/_jsxs(\"div\",{className:\"mb-6\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"font-semibold text-gray-700 dark:text-white mb-3\",children:\"Cohort Event Occurrence\"}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-sm text-gray-600 dark:text-gray-300 mb-2\",children:[\"Number of users in the cohort who have had each event at least once.\",/*#__PURE__*/_jsx(\"span\",{className:\"italic\",children:\" Note: Cohort is defined as users in the database who have a \\\"Trial started\\\" event within the selected date range. All other users are excluded.\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"overflow-x-auto\",children:/*#__PURE__*/_jsxs(\"table\",{className:\"min-w-full text-sm border dark:border-gray-600\",children:[/*#__PURE__*/_jsx(\"thead\",{className:\"bg-gray-50 dark:bg-gray-700\",children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{className:\"p-2 border-b dark:border-gray-600 text-left text-gray-700 dark:text-white\",children:\"Event\"}),/*#__PURE__*/_jsx(\"th\",{className:\"p-2 border-b dark:border-gray-600 text-left text-gray-700 dark:text-white\",children:\"User Count\"}),/*#__PURE__*/_jsx(\"th\",{className:\"p-2 border-b dark:border-gray-600 text-left text-gray-700 dark:text-white\",children:\"% of Cohort\"})]})}),/*#__PURE__*/_jsxs(\"tbody\",{className:\"bg-white dark:bg-gray-800\",children:[/*#__PURE__*/_jsxs(\"tr\",{className:\"bg-indigo-50 dark:bg-indigo-900/30\",children:[/*#__PURE__*/_jsx(\"td\",{className:\"p-2 border-b dark:border-gray-600 font-medium text-gray-700 dark:text-white\",children:\"Trial Started\"}),/*#__PURE__*/_jsx(\"td\",{className:\"p-2 border-b dark:border-gray-600 text-gray-700 dark:text-gray-300\",children:((_analysisResult$cohor=analysisResult.cohort_event_occurrence.trial_started)===null||_analysisResult$cohor===void 0?void 0:(_analysisResult$cohor2=_analysisResult$cohor.user_count)===null||_analysisResult$cohor2===void 0?void 0:_analysisResult$cohor2.toLocaleString())||'0'}),/*#__PURE__*/_jsx(\"td\",{className:\"p-2 border-b dark:border-gray-600 text-gray-700 dark:text-gray-300\",children:\"100%\"})]}),/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{className:\"p-2 border-b dark:border-gray-600 font-medium text-gray-700 dark:text-gray-300\",children:\"Trial Ended (Total)\"}),/*#__PURE__*/_jsx(\"td\",{className:\"p-2 border-b dark:border-gray-600 text-gray-700 dark:text-gray-300\",children:((_analysisResult$cohor3=analysisResult.cohort_event_occurrence.trial_ended)===null||_analysisResult$cohor3===void 0?void 0:(_analysisResult$cohor4=_analysisResult$cohor3.user_count)===null||_analysisResult$cohor4===void 0?void 0:_analysisResult$cohor4.toLocaleString())||'0'}),/*#__PURE__*/_jsx(\"td\",{className:\"p-2 border-b dark:border-gray-600 text-gray-700 dark:text-gray-300\",children:(_analysisResult$cohor5=analysisResult.cohort_event_occurrence.trial_ended)!==null&&_analysisResult$cohor5!==void 0&&_analysisResult$cohor5.percentage?analysisResult.cohort_event_occurrence.trial_ended.percentage.toFixed(1)+'%':'0%'})]}),/*#__PURE__*/_jsxs(\"tr\",{className:\"bg-gray-50 dark:bg-gray-700 pl-4\",children:[/*#__PURE__*/_jsx(\"td\",{className:\"p-2 border-b dark:border-gray-600 pl-8 text-gray-700 dark:text-gray-300\",children:\"\\u2192 Trial Converted\"}),/*#__PURE__*/_jsx(\"td\",{className:\"p-2 border-b dark:border-gray-600 text-gray-700 dark:text-gray-300\",children:((_analysisResult$cohor6=analysisResult.cohort_event_occurrence.trial_converted)===null||_analysisResult$cohor6===void 0?void 0:(_analysisResult$cohor7=_analysisResult$cohor6.user_count)===null||_analysisResult$cohor7===void 0?void 0:_analysisResult$cohor7.toLocaleString())||'0'}),/*#__PURE__*/_jsx(\"td\",{className:\"p-2 border-b dark:border-gray-600 text-gray-700 dark:text-gray-300\",children:(_analysisResult$cohor8=analysisResult.cohort_event_occurrence.trial_converted)!==null&&_analysisResult$cohor8!==void 0&&_analysisResult$cohor8.percentage?analysisResult.cohort_event_occurrence.trial_converted.percentage.toFixed(1)+'%':'0%'})]}),/*#__PURE__*/_jsxs(\"tr\",{className:\"bg-gray-50 dark:bg-gray-700\",children:[/*#__PURE__*/_jsx(\"td\",{className:\"p-2 border-b dark:border-gray-600 pl-8 text-gray-700 dark:text-gray-300\",children:\"\\u2192 Trial Cancelled\"}),/*#__PURE__*/_jsx(\"td\",{className:\"p-2 border-b dark:border-gray-600 text-gray-700 dark:text-gray-300\",children:((_analysisResult$cohor9=analysisResult.cohort_event_occurrence.trial_cancelled)===null||_analysisResult$cohor9===void 0?void 0:(_analysisResult$cohor0=_analysisResult$cohor9.user_count)===null||_analysisResult$cohor0===void 0?void 0:_analysisResult$cohor0.toLocaleString())||'0'}),/*#__PURE__*/_jsx(\"td\",{className:\"p-2 border-b dark:border-gray-600 text-gray-700 dark:text-gray-300\",children:(_analysisResult$cohor1=analysisResult.cohort_event_occurrence.trial_cancelled)!==null&&_analysisResult$cohor1!==void 0&&_analysisResult$cohor1.percentage?analysisResult.cohort_event_occurrence.trial_cancelled.percentage.toFixed(1)+'%':'0%'})]}),/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{className:\"p-2 border-b dark:border-gray-600 font-medium text-gray-700 dark:text-gray-300\",children:\"Initial Purchase\"}),/*#__PURE__*/_jsx(\"td\",{className:\"p-2 border-b dark:border-gray-600 text-gray-700 dark:text-gray-300\",children:((_analysisResult$cohor10=analysisResult.cohort_event_occurrence.initial_purchase)===null||_analysisResult$cohor10===void 0?void 0:(_analysisResult$cohor11=_analysisResult$cohor10.user_count)===null||_analysisResult$cohor11===void 0?void 0:_analysisResult$cohor11.toLocaleString())||'0'}),/*#__PURE__*/_jsx(\"td\",{className:\"p-2 border-b dark:border-gray-600 text-gray-700 dark:text-gray-300\",children:(_analysisResult$cohor12=analysisResult.cohort_event_occurrence.initial_purchase)!==null&&_analysisResult$cohor12!==void 0&&_analysisResult$cohor12.percentage?analysisResult.cohort_event_occurrence.initial_purchase.percentage.toFixed(1)+'%':'0%'})]}),/*#__PURE__*/_jsxs(\"tr\",{className:\"bg-gray-50 dark:bg-gray-700\",children:[/*#__PURE__*/_jsx(\"td\",{className:\"p-2 border-b dark:border-gray-600 font-medium text-gray-700 dark:text-gray-300\",children:\"Renewal\"}),/*#__PURE__*/_jsx(\"td\",{className:\"p-2 border-b dark:border-gray-600 text-gray-700 dark:text-gray-300\",children:((_analysisResult$cohor13=analysisResult.cohort_event_occurrence.renewal)===null||_analysisResult$cohor13===void 0?void 0:(_analysisResult$cohor14=_analysisResult$cohor13.user_count)===null||_analysisResult$cohor14===void 0?void 0:_analysisResult$cohor14.toLocaleString())||'0'}),/*#__PURE__*/_jsx(\"td\",{className:\"p-2 border-b dark:border-gray-600 text-gray-700 dark:text-gray-300\",children:(_analysisResult$cohor15=analysisResult.cohort_event_occurrence.renewal)!==null&&_analysisResult$cohor15!==void 0&&_analysisResult$cohor15.percentage?analysisResult.cohort_event_occurrence.renewal.percentage.toFixed(1)+'%':'0%'})]}),/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{className:\"p-2 border-b dark:border-gray-600 font-medium text-gray-700 dark:text-gray-300\",children:\"RC Cancellation (Total)\"}),/*#__PURE__*/_jsx(\"td\",{className:\"p-2 border-b dark:border-gray-600 text-gray-700 dark:text-gray-300\",children:((_analysisResult$cohor16=analysisResult.cohort_event_occurrence.rc_cancellation)===null||_analysisResult$cohor16===void 0?void 0:(_analysisResult$cohor17=_analysisResult$cohor16.user_count)===null||_analysisResult$cohor17===void 0?void 0:_analysisResult$cohor17.toLocaleString())||'0'}),/*#__PURE__*/_jsx(\"td\",{className:\"p-2 border-b dark:border-gray-600 text-gray-700 dark:text-gray-300\",children:(_analysisResult$cohor18=analysisResult.cohort_event_occurrence.rc_cancellation)!==null&&_analysisResult$cohor18!==void 0&&_analysisResult$cohor18.percentage?analysisResult.cohort_event_occurrence.rc_cancellation.percentage.toFixed(1)+'%':'0%'})]}),/*#__PURE__*/_jsxs(\"tr\",{className:\"bg-gray-50 dark:bg-gray-700\",children:[/*#__PURE__*/_jsx(\"td\",{className:\"p-2 border-b dark:border-gray-600 pl-8 text-gray-700 dark:text-gray-300\",children:\"\\u2192 Refund (revenue < 0)\"}),/*#__PURE__*/_jsx(\"td\",{className:\"p-2 border-b dark:border-gray-600 text-gray-700 dark:text-gray-300\",children:((_analysisResult$cohor19=analysisResult.cohort_event_occurrence.rc_refund)===null||_analysisResult$cohor19===void 0?void 0:(_analysisResult$cohor20=_analysisResult$cohor19.user_count)===null||_analysisResult$cohor20===void 0?void 0:_analysisResult$cohor20.toLocaleString())||'0'}),/*#__PURE__*/_jsx(\"td\",{className:\"p-2 border-b dark:border-gray-600 text-gray-700 dark:text-gray-300\",children:(_analysisResult$cohor21=analysisResult.cohort_event_occurrence.rc_refund)!==null&&_analysisResult$cohor21!==void 0&&_analysisResult$cohor21.percentage?analysisResult.cohort_event_occurrence.rc_refund.percentage.toFixed(1)+'%':'0%'})]}),/*#__PURE__*/_jsxs(\"tr\",{className:\"bg-gray-50 dark:bg-gray-700\",children:[/*#__PURE__*/_jsx(\"td\",{className:\"p-2 border-b dark:border-gray-600 pl-8 text-gray-700 dark:text-gray-300\",children:\"\\u2192 Cancelled (revenue = 0)\"}),/*#__PURE__*/_jsx(\"td\",{className:\"p-2 border-b dark:border-gray-600 text-gray-700 dark:text-gray-300\",children:((_analysisResult$cohor22=analysisResult.cohort_event_occurrence.rc_cancel_no_refund)===null||_analysisResult$cohor22===void 0?void 0:(_analysisResult$cohor23=_analysisResult$cohor22.user_count)===null||_analysisResult$cohor23===void 0?void 0:_analysisResult$cohor23.toLocaleString())||'0'}),/*#__PURE__*/_jsx(\"td\",{className:\"p-2 border-b dark:border-gray-600 text-gray-700 dark:text-gray-300\",children:(_analysisResult$cohor24=analysisResult.cohort_event_occurrence.rc_cancel_no_refund)!==null&&_analysisResult$cohor24!==void 0&&_analysisResult$cohor24.percentage?analysisResult.cohort_event_occurrence.rc_cancel_no_refund.percentage.toFixed(1)+'%':'0%'})]})]})]})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mb-4\",children:[/*#__PURE__*/_jsxs(\"button\",{onClick:()=>setShowLifecycleTables(!showLifecycleTables),className:\"text-indigo-600 dark:text-indigo-300 hover:underline text-sm mb-2\",children:[showLifecycleTables?/*#__PURE__*/_jsx(ChevronDown,{className:\"inline mr-1\",size:16}):/*#__PURE__*/_jsx(ChevronRight,{className:\"inline mr-1\",size:16}),\"Show/Hide Lifecycle Rate Tables\"]}),(()=>{console.log('[DEBUG] showLifecycleTables:',showLifecycleTables,'lifecycle_rates exists:',!!(analysisResult!==null&&analysisResult!==void 0&&analysisResult.lifecycle_rates));if(showLifecycleTables&&analysisResult!==null&&analysisResult!==void 0&&analysisResult.lifecycle_rates){console.log('[DEBUG] Lifecycle tables section should render!',analysisResult.lifecycle_rates);console.log('[DEBUG] Available lifecycle rate keys:',Object.keys(analysisResult.lifecycle_rates));}return null;})()]}),showLifecycleTables&&(analysisResult===null||analysisResult===void 0?void 0:analysisResult.lifecycle_rates)&&/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-6 mb-8 p-4 border-t dark:border-gray-600\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"mb-6 p-4 bg-blue-50 dark:bg-blue-900/30 rounded-lg border border-blue-200 dark:border-blue-700\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg font-semibold text-blue-800 dark:text-blue-200 mb-3\",children:\"Enhanced Product-Based Lifecycle Analysis System\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm text-blue-700 dark:text-blue-300\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h4\",{className:\"font-semibold mb-2\",children:\"Key Improvements:\"}),/*#__PURE__*/_jsxs(\"ul\",{className:\"list-disc ml-5 space-y-1\",children:[/*#__PURE__*/_jsxs(\"li\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Fixed Cumulative Calculation:\"}),\" Now shows actual percentage of cohort that performs action, not forced 100%\"]}),/*#__PURE__*/_jsxs(\"li\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Product-Level Granularity:\"}),\" Analyze lifecycle patterns per product ID\"]}),/*#__PURE__*/_jsxs(\"li\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Intelligent Smoothing:\"}),\" Adaptive smoothing that handles high-early, low-later patterns effectively\"]}),/*#__PURE__*/_jsxs(\"li\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Extended Lookback:\"}),\" Automatically extends lookback 30-60 days when sample size < 100\"]})]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h4\",{className:\"font-semibold mb-2\",children:\"Metrics Displayed:\"}),/*#__PURE__*/_jsxs(\"ul\",{className:\"list-disc ml-5 space-y-1\",children:[/*#__PURE__*/_jsxs(\"li\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Raw Daily Rates:\"}),\" Actual percentage of cohort performing action on specific day\"]}),/*#__PURE__*/_jsxs(\"li\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Smoothed Daily Rates:\"}),\" Algorithm-enhanced rates accounting for data sparsity\"]}),/*#__PURE__*/_jsxs(\"li\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Cumulative Rates:\"}),\" Total percentage who have performed action by day X (using smoothed data)\"]}),/*#__PURE__*/_jsxs(\"li\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Separate Tracking:\"}),\" 14 days for refunds, 400 days for cancellations\"]})]})]})]})]}),(()=>{// Get all available product IDs from lifecycle rates\nconst allAvailableProducts=new Set();const lifecycleRates=analysisResult.lifecycle_rates||{};Object.values(lifecycleRates).forEach(rateData=>{if(rateData&&rateData.rates_by_product){Object.keys(rateData.rates_by_product).forEach(productId=>{allAvailableProducts.add(productId);});}});const productList=Array.from(allAvailableProducts).sort();if(productList.length>0){return/*#__PURE__*/_jsx(\"div\",{className:\"mb-6 p-4 bg-green-50 dark:bg-green-900/30 rounded-lg border border-green-200 dark:border-green-700\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h4\",{className:\"font-semibold text-green-800 dark:text-green-200 mb-1\",children:\"Product Analysis Filter\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-green-700 dark:text-green-300\",children:\"Select a specific product to analyze, or view aggregate data across all products.\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-3\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"text-sm font-medium text-green-700 dark:text-green-300\",children:\"Product:\"}),/*#__PURE__*/_jsxs(\"select\",{value:globalSelectedProduct,onChange:e=>setGlobalSelectedProduct(e.target.value),className:\"px-4 py-2 border border-green-300 dark:border-green-600 rounded-md text-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-green-500 focus:border-green-500\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"All Products (Aggregate)\"}),productList.map(productId=>/*#__PURE__*/_jsxs(\"option\",{value:productId,children:[\"Product \",productId]},productId))]}),/*#__PURE__*/_jsxs(\"button\",{onClick:()=>setShowChartModal(true),className:\"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white text-sm rounded-md transition-colors duration-200 flex items-center space-x-2\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"\\uD83D\\uDCCA\"}),/*#__PURE__*/_jsx(\"span\",{children:\"View Charts\"})]})]})]})});}return null;})(),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-8\",children:[analysisResult.lifecycle_rates.trial_to_cancellation_rates&&renderLifecycleTable(\"Trial Converted -> Cancellation Rates\",analysisResult.lifecycle_rates.trial_to_cancellation_rates),analysisResult.lifecycle_rates.trial_to_refund_rates&&renderLifecycleTable(\"Trial Converted -> Refund Rates\",analysisResult.lifecycle_rates.trial_to_refund_rates),analysisResult.lifecycle_rates.initial_purchase_to_cancellation_rates&&renderLifecycleTable(\"Initial Purchase -> Cancellation Rates\",analysisResult.lifecycle_rates.initial_purchase_to_cancellation_rates),analysisResult.lifecycle_rates.initial_purchase_to_refund_rates&&renderLifecycleTable(\"Initial Purchase -> Refund Rates\",analysisResult.lifecycle_rates.initial_purchase_to_refund_rates),analysisResult.lifecycle_rates.renewal_to_cancellation_rates&&renderLifecycleTable(\"Renewal -> Cancellation Rates\",analysisResult.lifecycle_rates.renewal_to_cancellation_rates),analysisResult.lifecycle_rates.renewal_to_refund_rates&&renderLifecycleTable(\"Renewal -> Refund Rates\",analysisResult.lifecycle_rates.renewal_to_refund_rates),analysisResult.lifecycle_rates.trial_to_outcome_rates&&renderLifecycleTable(\"Trial to Outcome Rates\",analysisResult.lifecycle_rates.trial_to_outcome_rates)]})]}),/*#__PURE__*/_jsx(\"h3\",{className:\"text-xl font-semibold mb-3 text-gray-700 dark:text-white\",children:\"Daily Performance Charts\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"mb-6\",children:[/*#__PURE__*/_jsx(\"h4\",{className:\"font-semibold text-gray-700 dark:text-white mb-2\",children:\"Absolute Values\"}),/*#__PURE__*/_jsx(\"div\",{className:\"mb-4 flex flex-wrap gap-2\",children:Object.keys(visibleAbsoluteMetrics).map(key=>/*#__PURE__*/_jsx(\"button\",{onClick:()=>toggleAbsoluteMetric(key),className:\"px-3 py-1 text-xs rounded-full \".concat(visibleAbsoluteMetrics[key]?'bg-blue-500 text-white':'bg-gray-200 dark:bg-gray-600 text-gray-700 dark:text-white'),children:key.split('_').join(' ')},key))}),/*#__PURE__*/_jsx(\"div\",{className:\"h-80 w-full mb-8 bg-gray-50 dark:bg-gray-700 p-4 rounded-lg\",children:/*#__PURE__*/_jsx(ResponsiveContainer,{width:\"100%\",height:\"100%\",children:/*#__PURE__*/_jsxs(LineChart,{data:chartData,margin:{top:5,right:30,left:20,bottom:5},children:[/*#__PURE__*/_jsx(CartesianGrid,{strokeDasharray:\"3 3\"}),/*#__PURE__*/_jsx(XAxis,{dataKey:\"date\"}),/*#__PURE__*/_jsx(YAxis,{}),/*#__PURE__*/_jsx(Tooltip,{formatter:value=>typeof value==='number'?value.toLocaleString():value}),/*#__PURE__*/_jsx(ChartLegend,{}),visibleAbsoluteMetrics.daily_trials_started&&/*#__PURE__*/_jsx(Line,{type:\"monotone\",dataKey:\"daily_trials_started\",stroke:\"#8884d8\",name:\"Daily Trials Started\"}),visibleAbsoluteMetrics.daily_trials_ended&&/*#__PURE__*/_jsx(Line,{type:\"monotone\",dataKey:\"daily_trials_ended\",stroke:\"#82ca9d\",name:\"Daily Trials Ended\"}),visibleAbsoluteMetrics.daily_trials_pending&&/*#__PURE__*/_jsx(Line,{type:\"monotone\",dataKey:\"daily_trials_pending\",stroke:\"#ffc658\",name:\"Daily Trials Pending\"}),visibleAbsoluteMetrics.daily_conversions&&/*#__PURE__*/_jsx(Line,{type:\"monotone\",dataKey:\"daily_conversions\",stroke:\"#ff7300\",name:\"Daily Conversions\"}),visibleAbsoluteMetrics.daily_conversions_net_refunds&&/*#__PURE__*/_jsx(Line,{type:\"monotone\",dataKey:\"daily_conversions_net_refunds\",stroke:\"#ff0000\",name:\"Daily Conv. Net Refunds\"}),visibleAbsoluteMetrics.daily_estimated_conversions_net_refunds&&/*#__PURE__*/_jsx(Line,{type:\"monotone\",dataKey:\"daily_estimated_conversions_net_refunds\",stroke:\"#b967ff\",name:\"Daily Est. Conv. Net Refunds\"}),visibleAbsoluteMetrics.daily_refunds&&/*#__PURE__*/_jsx(Line,{type:\"monotone\",dataKey:\"daily_refunds\",stroke:\"#ff67b3\",name:\"Daily Refunds\"}),visibleAbsoluteMetrics.cumulative_trials_started&&/*#__PURE__*/_jsx(Line,{type:\"monotone\",dataKey:\"cumulative_trials_started\",stroke:\"#8884d8\",strokeDasharray:\"5 5\",name:\"Cum. Trials Started\"}),visibleAbsoluteMetrics.cumulative_trials_ended&&/*#__PURE__*/_jsx(Line,{type:\"monotone\",dataKey:\"cumulative_trials_ended\",stroke:\"#82ca9d\",strokeDasharray:\"5 5\",name:\"Cum. Trials Ended\"}),visibleAbsoluteMetrics.cumulative_trials_pending&&/*#__PURE__*/_jsx(Line,{type:\"monotone\",dataKey:\"cumulative_trials_pending\",stroke:\"#ffc658\",strokeDasharray:\"5 5\",name:\"Cum. Trials Pending\"}),visibleAbsoluteMetrics.cumulative_conversions&&/*#__PURE__*/_jsx(Line,{type:\"monotone\",dataKey:\"cumulative_conversions\",stroke:\"#ff7300\",strokeDasharray:\"5 5\",name:\"Cum. Conversions\"}),visibleAbsoluteMetrics.cumulative_conversions_net_refunds&&/*#__PURE__*/_jsx(Line,{type:\"monotone\",dataKey:\"cumulative_conversions_net_refunds\",stroke:\"#ff0000\",strokeDasharray:\"5 5\",name:\"Cum. Conv. Net Refunds\"}),visibleAbsoluteMetrics.cumulative_estimated_conversions_net_refunds&&/*#__PURE__*/_jsx(Line,{type:\"monotone\",dataKey:\"cumulative_estimated_conversions_net_refunds\",stroke:\"#b967ff\",strokeDasharray:\"5 5\",name:\"Cum. Est. Conv. Net Refunds\"}),visibleAbsoluteMetrics.cumulative_refunds&&/*#__PURE__*/_jsx(Line,{type:\"monotone\",dataKey:\"cumulative_refunds\",stroke:\"#ff67b3\",strokeDasharray:\"5 5\",name:\"Cum. Refunds\"})]})})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mb-6\",children:[/*#__PURE__*/_jsx(\"h4\",{className:\"font-semibold text-gray-700 dark:text-white mb-2\",children:\"Revenue Values\"}),/*#__PURE__*/_jsx(\"div\",{className:\"mb-4 flex flex-wrap gap-2\",children:Object.keys(visibleMoneyMetrics).map(key=>/*#__PURE__*/_jsx(\"button\",{onClick:()=>toggleMoneyMetric(key),className:\"px-3 py-1 text-xs rounded-full \".concat(visibleMoneyMetrics[key]?'bg-green-500 text-white':'bg-gray-200 dark:bg-gray-600 text-gray-700 dark:text-white'),children:key.split('_').join(' ')},key))}),/*#__PURE__*/_jsx(\"div\",{className:\"h-80 w-full mb-8 bg-gray-50 dark:bg-gray-700 p-4 rounded-lg\",children:/*#__PURE__*/_jsx(ResponsiveContainer,{width:\"100%\",height:\"100%\",children:/*#__PURE__*/_jsxs(LineChart,{data:chartData,margin:{top:5,right:30,left:20,bottom:5},children:[/*#__PURE__*/_jsx(CartesianGrid,{strokeDasharray:\"3 3\"}),/*#__PURE__*/_jsx(XAxis,{dataKey:\"date\"}),/*#__PURE__*/_jsx(YAxis,{}),/*#__PURE__*/_jsx(Tooltip,{formatter:value=>formatCurrency(value)}),/*#__PURE__*/_jsx(ChartLegend,{}),visibleMoneyMetrics.daily_revenue&&/*#__PURE__*/_jsx(Line,{type:\"monotone\",dataKey:\"daily_revenue\",stroke:\"#00b300\",name:\"Daily Revenue\"}),visibleMoneyMetrics.daily_revenue_net&&/*#__PURE__*/_jsx(Line,{type:\"monotone\",dataKey:\"daily_revenue_net\",stroke:\"#00e600\",name:\"Daily Net Revenue\"}),visibleMoneyMetrics.daily_estimated_revenue&&/*#__PURE__*/_jsx(Line,{type:\"monotone\",dataKey:\"daily_estimated_revenue\",stroke:\"#4dff4d\",name:\"Daily Est. Revenue\"}),visibleMoneyMetrics.cumulative_revenue&&/*#__PURE__*/_jsx(Line,{type:\"monotone\",dataKey:\"cumulative_revenue\",stroke:\"#009900\",strokeDasharray:\"5 5\",name:\"Cum. Revenue\"}),visibleMoneyMetrics.cumulative_revenue_net&&/*#__PURE__*/_jsx(Line,{type:\"monotone\",dataKey:\"cumulative_revenue_net\",stroke:\"#00cc00\",strokeDasharray:\"5 5\",name:\"Cum. Net Revenue\"}),visibleMoneyMetrics.cumulative_estimated_revenue&&/*#__PURE__*/_jsx(Line,{type:\"monotone\",dataKey:\"cumulative_estimated_revenue\",stroke:\"#00e600\",strokeDasharray:\"5 5\",name:\"Cum. Est. Revenue\"})]})})})]})]}),eventRevenueTimelineData?/*#__PURE__*/_jsxs(\"div\",{className:\"mb-8 bg-white dark:bg-gray-700 p-6 rounded-lg shadow-md\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between items-center mb-4\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-2xl font-bold text-gray-800 dark:text-white\",children:\"Daily Event & Revenue Timeline\"}),/*#__PURE__*/_jsx(\"div\",{className:\"flex gap-2\",children:/*#__PURE__*/_jsx(\"span\",{className:\"text-sm font-medium px-3 py-1 bg-blue-100 text-blue-800 dark:bg-blue-800 dark:text-blue-100 rounded-full\",children:selectedUserId&&selectedProductId?'Detailed View':'Aggregate View'})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6 p-4 border rounded-lg bg-gray-50 dark:bg-gray-600\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"user-select\",className:\"block text-sm font-medium text-gray-700 dark:text-white mb-2\",children:\"Select User (Optional)\"}),/*#__PURE__*/_jsx(Select,{id:\"user-select\",isClearable:true,isSearchable:true,options:availableUsers.map(user=>({value:user,label:user})),value:selectedUserId?{value:selectedUserId,label:selectedUserId}:null,onChange:selected=>{const newUserId=selected?selected.value:'';setSelectedUserId(newUserId);fetchEventRevenueTimeline(newUserId,selectedProductId);},styles:getSelectTheme(),placeholder:\"Type to search users...\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"product-select\",className:\"block text-sm font-medium text-gray-700 dark:text-white mb-2\",children:\"Select Product (Optional)\"}),/*#__PURE__*/_jsx(Select,{id:\"product-select\",isClearable:true,isSearchable:true,options:availableProducts.map(product=>({value:product,label:product})),value:selectedProductId?{value:selectedProductId,label:selectedProductId}:null,onChange:selected=>{const newProductId=selected?selected.value:'';setSelectedProductId(newProductId);fetchEventRevenueTimeline(selectedUserId,newProductId);},styles:getSelectTheme(),placeholder:\"Type to search products...\"})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"overflow-x-auto\",children:/*#__PURE__*/_jsxs(\"table\",{className:\"min-w-full text-sm border dark:border-gray-600\",children:[/*#__PURE__*/_jsx(\"thead\",{className:\"bg-gray-50 dark:bg-gray-700\",children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{className:\"p-2 border-b dark:border-gray-600 text-left text-gray-700 dark:text-white sticky left-0 bg-gray-50 dark:bg-gray-700 z-10 min-w-[200px]\",children:\"Metric\"}),eventRevenueTimelineData.dates.map(date=>/*#__PURE__*/_jsx(\"th\",{className:\"p-2 border-b dark:border-gray-600 text-center text-gray-700 dark:text-white whitespace-nowrap min-w-[80px]\",children:date},date))]})}),/*#__PURE__*/_jsx(\"tbody\",{className:\"bg-white dark:bg-gray-800\",children:(()=>{// Define all metrics with their categories and data extraction logic\nconst metrics=[// Daily Absolute Values\n{key:'daily_trial_started',label:'Trial Started',category:'daily_absolute',categoryLabel:'Daily Absolute Values',getValue:(date,index)=>{var _eventRows$trial_star,_eventRows$trial_star2;const chartDay=chartData?chartData.find(d=>d.date===date):null;const eventRows=eventRevenueTimelineData.event_rows||{};return selectedUserId||selectedProductId?((_eventRows$trial_star=eventRows.trial_started)===null||_eventRows$trial_star===void 0?void 0:_eventRows$trial_star[date])||0:((_eventRows$trial_star2=eventRows.trial_started)===null||_eventRows$trial_star2===void 0?void 0:_eventRows$trial_star2[date])||(chartDay===null||chartDay===void 0?void 0:chartDay.daily_trials_started)||0;}},{key:'daily_trial_pending',label:'Trial Pending',category:'daily_absolute',getValue:(date,index)=>{var _eventRows$trial_pend;// FIXED: Use the backend-calculated trial_pending value directly\nconst eventRows=eventRevenueTimelineData.event_rows||{};return((_eventRows$trial_pend=eventRows.trial_pending)===null||_eventRows$trial_pend===void 0?void 0:_eventRows$trial_pend[date])||0;}},{key:'daily_trial_ended',label:'Trial Ended',category:'daily_absolute',getValue:(date,index)=>{var _eventRows$trial_ende;const eventRows=eventRevenueTimelineData.event_rows||{};return((_eventRows$trial_ende=eventRows.trial_ended)===null||_eventRows$trial_ende===void 0?void 0:_eventRows$trial_ende[date])||0;}},{key:'daily_trial_cancelled',label:'Trial Cancelled',category:'daily_absolute',getValue:(date,index)=>{var _eventRows$trial_canc;const eventRows=eventRevenueTimelineData.event_rows||{};return((_eventRows$trial_canc=eventRows.trial_canceled)===null||_eventRows$trial_canc===void 0?void 0:_eventRows$trial_canc[date])||0;}},{key:'daily_trial_converted',label:'Trial Converted',category:'daily_absolute',getValue:(date,index)=>{var _eventRows$trial_conv,_eventRows$trial_conv2;const chartDay=chartData?chartData.find(d=>d.date===date):null;const eventRows=eventRevenueTimelineData.event_rows||{};return selectedUserId||selectedProductId?((_eventRows$trial_conv=eventRows.trial_converted)===null||_eventRows$trial_conv===void 0?void 0:_eventRows$trial_conv[date])||0:((_eventRows$trial_conv2=eventRows.trial_converted)===null||_eventRows$trial_conv2===void 0?void 0:_eventRows$trial_conv2[date])||(chartDay===null||chartDay===void 0?void 0:chartDay.daily_conversions)||0;}},{key:'daily_initial_purchase',label:'Initial Purchase',category:'daily_absolute',getValue:(date,index)=>{var _eventRows$initial_pu;const eventRows=eventRevenueTimelineData.event_rows||{};return((_eventRows$initial_pu=eventRows.initial_purchase)===null||_eventRows$initial_pu===void 0?void 0:_eventRows$initial_pu[date])||0;}},{key:'daily_subscription_active',label:'Subscription Active',category:'daily_absolute',getValue:(date,index)=>{var _eventRows$subscripti;// FIXED: Use the backend-calculated subscription_active value directly\nconst eventRows=eventRevenueTimelineData.event_rows||{};return((_eventRows$subscripti=eventRows.subscription_active)===null||_eventRows$subscripti===void 0?void 0:_eventRows$subscripti[date])||0;}},{key:'daily_subscription_cancelled',label:'Subscription Cancelled',category:'daily_absolute',getValue:(date,index)=>{var _eventRows$subscripti2;const eventRows=eventRevenueTimelineData.event_rows||{};return((_eventRows$subscripti2=eventRows.subscription_cancelled)===null||_eventRows$subscripti2===void 0?void 0:_eventRows$subscripti2[date])||0;}},{key:'daily_refund',label:'Refund',category:'daily_absolute',getValue:(date,index)=>{var _eventRows$refund,_eventRows$refund2;const chartDay=chartData?chartData.find(d=>d.date===date):null;const eventRows=eventRevenueTimelineData.event_rows||{};return selectedUserId||selectedProductId?((_eventRows$refund=eventRows.refund)===null||_eventRows$refund===void 0?void 0:_eventRows$refund[date])||0:((_eventRows$refund2=eventRows.refund)===null||_eventRows$refund2===void 0?void 0:_eventRows$refund2[date])||(chartDay===null||chartDay===void 0?void 0:chartDay.daily_refunds)||0;}},// Daily Revenue\n{key:'daily_revenue',label:'Revenue (Actual)',category:'daily_revenue',categoryLabel:'Daily Revenue',getValue:(date,index)=>{var _estimateRows$current,_estimateRows$current2;const chartDay=chartData?chartData.find(d=>d.date===date):null;const estimateRows=eventRevenueTimelineData.estimate_rows||{};const value=selectedUserId||selectedProductId?((_estimateRows$current=estimateRows.current_revenue)===null||_estimateRows$current===void 0?void 0:_estimateRows$current[date])||0:((_estimateRows$current2=estimateRows.current_revenue)===null||_estimateRows$current2===void 0?void 0:_estimateRows$current2[date])||(chartDay===null||chartDay===void 0?void 0:chartDay.daily_revenue)||0;return formatCurrency(value);}},{key:'daily_est_revenue',label:'Est. Revenue',category:'daily_revenue',isEstimatedRevenue:true,getValue:(date,index)=>{var _estimateRows$estimat,_estimateRows$estimat2;const chartDay=chartData?chartData.find(d=>d.date===date):null;const estimateRows=eventRevenueTimelineData.estimate_rows||{};const value=selectedUserId||selectedProductId?((_estimateRows$estimat=estimateRows.estimated_net_revenue)===null||_estimateRows$estimat===void 0?void 0:_estimateRows$estimat[date])||0:((_estimateRows$estimat2=estimateRows.estimated_revenue)===null||_estimateRows$estimat2===void 0?void 0:_estimateRows$estimat2[date])||(chartDay===null||chartDay===void 0?void 0:chartDay.daily_estimated_revenue)||0;return formatCurrency(value);},getTooltipData:(date,index)=>{var _estimateRows$estimat3,_estimateRows$estimat4;// Mock calculation data - this would come from the backend in reality\nconst chartDay=chartData?chartData.find(d=>d.date===date):null;const estimateRows=eventRevenueTimelineData.estimate_rows||{};const actualValue=selectedUserId||selectedProductId?((_estimateRows$estimat3=estimateRows.estimated_net_revenue)===null||_estimateRows$estimat3===void 0?void 0:_estimateRows$estimat3[date])||0:((_estimateRows$estimat4=estimateRows.estimated_revenue)===null||_estimateRows$estimat4===void 0?void 0:_estimateRows$estimat4[date])||(chartDay===null||chartDay===void 0?void 0:chartDay.daily_estimated_revenue)||0;// Mock data structure - backend should provide this\nreturn{formula:\"Est_Revenue = (Active_Trials × Trial_Conv_Rate × Avg_Revenue) + (Active_Subs × (1 - Churn_Rate) × Avg_Revenue) - (Expected_Refunds × Avg_Refund)\",calculation:\"(\".concat((chartDay===null||chartDay===void 0?void 0:chartDay.daily_trials_pending)||0,\" \\xD7 0.15 \\xD7 $9.99) + (\").concat((chartDay===null||chartDay===void 0?void 0:chartDay.daily_trials_pending)||0,\" \\xD7 0.95 \\xD7 $9.99) - (\").concat((chartDay===null||chartDay===void 0?void 0:chartDay.daily_refunds)||0,\" \\xD7 $9.99)\"),components:{\"Active Trials\":(chartDay===null||chartDay===void 0?void 0:chartDay.daily_trials_pending)||0,\"Trial Conversion Rate\":\"15%\",\"Active Subscriptions\":\"N/A\",\"Churn Rate\":\"5%\",\"Avg Revenue\":\"$9.99\",\"Expected Refunds\":(chartDay===null||chartDay===void 0?void 0:chartDay.daily_refunds)||0,\"Avg Refund\":\"$9.99\"},result:formatCurrency(actualValue)};}},// Cumulative Absolute Values\n{key:'cumulative_trial_started',label:'Trial Started',category:'cumulative_absolute',categoryLabel:'Cumulative Absolute Values',getValue:(date,index)=>{const chartDay=chartData?chartData.find(d=>d.date===date):null;const eventRows=eventRevenueTimelineData.event_rows||{};return selectedUserId||selectedProductId?eventRevenueTimelineData.dates.slice(0,index+1).reduce((sum,d)=>{var _eventRows$trial_star3;return sum+(((_eventRows$trial_star3=eventRows.trial_started)===null||_eventRows$trial_star3===void 0?void 0:_eventRows$trial_star3[d])||0);},0):(chartDay===null||chartDay===void 0?void 0:chartDay.cumulative_trials_started)||0;}},{key:'cumulative_trial_pending',label:'Trial Pending',category:'cumulative_absolute',getValue:(date,index)=>{var _eventRows$trial_pend2;// This is a point-in-time value, same as daily pending\nconst eventRows=eventRevenueTimelineData.event_rows||{};return((_eventRows$trial_pend2=eventRows.trial_pending)===null||_eventRows$trial_pend2===void 0?void 0:_eventRows$trial_pend2[date])||0;}},{key:'cumulative_trial_ended',label:'Trial Ended',category:'cumulative_absolute',getValue:(date,index)=>{const eventRows=eventRevenueTimelineData.event_rows||{};return eventRevenueTimelineData.dates.slice(0,index+1).reduce((sum,d)=>{var _eventRows$trial_ende2;return sum+(((_eventRows$trial_ende2=eventRows.trial_ended)===null||_eventRows$trial_ende2===void 0?void 0:_eventRows$trial_ende2[d])||0);},0);}},{key:'cumulative_trial_cancelled',label:'Trial Cancelled',category:'cumulative_absolute',getValue:(date,index)=>{const eventRows=eventRevenueTimelineData.event_rows||{};return selectedUserId||selectedProductId?eventRevenueTimelineData.dates.slice(0,index+1).reduce((sum,d)=>{var _eventRows$trial_canc2;return sum+(((_eventRows$trial_canc2=eventRows.trial_canceled)===null||_eventRows$trial_canc2===void 0?void 0:_eventRows$trial_canc2[d])||0);},0):chartData?chartData.slice(0,index+1).reduce((sum,d)=>{var _eventRows$trial_canc3;return sum+(((_eventRows$trial_canc3=eventRows.trial_canceled)===null||_eventRows$trial_canc3===void 0?void 0:_eventRows$trial_canc3[d.date])||0);},0):0;}},{key:'cumulative_trial_converted',label:'Trial Converted',category:'cumulative_absolute',getValue:(date,index)=>{const chartDay=chartData?chartData.find(d=>d.date===date):null;const eventRows=eventRevenueTimelineData.event_rows||{};return selectedUserId||selectedProductId?eventRevenueTimelineData.dates.slice(0,index+1).reduce((sum,d)=>{var _eventRows$trial_conv3;return sum+(((_eventRows$trial_conv3=eventRows.trial_converted)===null||_eventRows$trial_conv3===void 0?void 0:_eventRows$trial_conv3[d])||0);},0):(chartDay===null||chartDay===void 0?void 0:chartDay.cumulative_conversions)||0;}},{key:'cumulative_initial_purchase',label:'Initial Purchase',category:'cumulative_absolute',getValue:(date,index)=>{var _eventRows$cumulative;const eventRows=eventRevenueTimelineData.event_rows||{};return selectedUserId||selectedProductId?eventRevenueTimelineData.dates.slice(0,index+1).reduce((sum,d)=>{var _eventRows$initial_pu2;return sum+(((_eventRows$initial_pu2=eventRows.initial_purchase)===null||_eventRows$initial_pu2===void 0?void 0:_eventRows$initial_pu2[d])||0);},0):((_eventRows$cumulative=eventRows.cumulative_initial_purchase)===null||_eventRows$cumulative===void 0?void 0:_eventRows$cumulative[date])||0;}},{key:'cumulative_subscription_active',label:'Subscription Active',category:'cumulative_absolute',getValue:(date,index)=>{var _eventRows$subscripti3;// This is a point-in-time value, same as daily subscription_active\nconst eventRows=eventRevenueTimelineData.event_rows||{};return((_eventRows$subscripti3=eventRows.subscription_active)===null||_eventRows$subscripti3===void 0?void 0:_eventRows$subscripti3[date])||0;}},{key:'cumulative_subscription_cancelled',label:'Subscription Cancelled',category:'cumulative_absolute',getValue:(date,index)=>{const eventRows=eventRevenueTimelineData.event_rows||{};return eventRevenueTimelineData.dates.slice(0,index+1).reduce((sum,d)=>{var _eventRows$subscripti4;return sum+(((_eventRows$subscripti4=eventRows.subscription_cancelled)===null||_eventRows$subscripti4===void 0?void 0:_eventRows$subscripti4[d])||0);},0);}},{key:'cumulative_refund',label:'Refund',category:'cumulative_absolute',getValue:(date,index)=>{const chartDay=chartData?chartData.find(d=>d.date===date):null;const eventRows=eventRevenueTimelineData.event_rows||{};return selectedUserId||selectedProductId?eventRevenueTimelineData.dates.slice(0,index+1).reduce((sum,d)=>{var _eventRows$refund3;return sum+(((_eventRows$refund3=eventRows.refund)===null||_eventRows$refund3===void 0?void 0:_eventRows$refund3[d])||0);},0):(chartDay===null||chartDay===void 0?void 0:chartDay.cumulative_refunds)||0;}},// Cumulative Revenue\n{key:'cumulative_revenue',label:'Revenue (Actual)',category:'cumulative_revenue',categoryLabel:'Cumulative Revenue',getValue:(date,index)=>{const chartDay=chartData?chartData.find(d=>d.date===date):null;const estimateRows=eventRevenueTimelineData.estimate_rows||{};const value=selectedUserId||selectedProductId?eventRevenueTimelineData.dates.slice(0,index+1).reduce((sum,d)=>{var _estimateRows$current3;return sum+(((_estimateRows$current3=estimateRows.current_revenue)===null||_estimateRows$current3===void 0?void 0:_estimateRows$current3[d])||0);},0):(chartDay===null||chartDay===void 0?void 0:chartDay.cumulative_revenue)||0;return formatCurrency(value);}},{key:'cumulative_est_revenue',label:'Est. Revenue',category:'cumulative_revenue',isEstimatedRevenue:true,getValue:(date,index)=>{const chartDay=chartData?chartData.find(d=>d.date===date):null;const estimateRows=eventRevenueTimelineData.estimate_rows||{};const value=selectedUserId||selectedProductId?eventRevenueTimelineData.dates.slice(0,index+1).reduce((sum,d)=>{var _estimateRows$estimat5;return sum+(((_estimateRows$estimat5=estimateRows.estimated_net_revenue)===null||_estimateRows$estimat5===void 0?void 0:_estimateRows$estimat5[d])||0);},0):(chartDay===null||chartDay===void 0?void 0:chartDay.cumulative_estimated_revenue)||0;return formatCurrency(value);},getTooltipData:(date,index)=>{const chartDay=chartData?chartData.find(d=>d.date===date):null;const estimateRows=eventRevenueTimelineData.estimate_rows||{};const actualValue=selectedUserId||selectedProductId?eventRevenueTimelineData.dates.slice(0,index+1).reduce((sum,d)=>{var _estimateRows$estimat6;return sum+(((_estimateRows$estimat6=estimateRows.estimated_net_revenue)===null||_estimateRows$estimat6===void 0?void 0:_estimateRows$estimat6[d])||0);},0):(chartDay===null||chartDay===void 0?void 0:chartDay.cumulative_estimated_revenue)||0;return{formula:\"Cumulative_Est_Revenue = Σ(Daily_Est_Revenue) from start to date\",calculation:\"Sum of daily estimated revenue from start date to \".concat(date),components:{\"Period\":\"Start to \".concat(date),\"Days\":index+1,\"Avg Daily Est\":formatCurrency(actualValue/(index+1))},result:formatCurrency(actualValue)};}}];// Group metrics by category for styling\nconst categoryColors={daily_absolute:'bg-blue-50 dark:bg-blue-900/30',daily_revenue:'bg-green-50 dark:bg-green-900/30',cumulative_absolute:'bg-indigo-50 dark:bg-indigo-900/30',cumulative_revenue:'bg-emerald-50 dark:bg-emerald-900/30'};return metrics.map((metric,metricIndex)=>{const isFirstInCategory=metricIndex===0||metrics[metricIndex-1].category!==metric.category;return/*#__PURE__*/_jsxs(React.Fragment,{children:[isFirstInCategory&&metric.categoryLabel&&/*#__PURE__*/_jsx(\"tr\",{className:\"\".concat(categoryColors[metric.category],\" border-t-2 border-gray-300 dark:border-gray-500\"),children:/*#__PURE__*/_jsx(\"td\",{colSpan:eventRevenueTimelineData.dates.length+1,className:\"p-2 border-b dark:border-gray-600 text-center font-semibold text-gray-700 dark:text-white\",children:metric.categoryLabel})}),/*#__PURE__*/_jsxs(\"tr\",{className:metricIndex%2===0?'':'bg-gray-50 dark:bg-gray-700',children:[/*#__PURE__*/_jsx(\"td\",{className:\"p-2 border-b dark:border-gray-600 font-medium text-gray-700 dark:text-gray-300 sticky left-0 z-10 bg-inherit\",children:metric.label}),eventRevenueTimelineData.dates.map((date,dateIndex)=>/*#__PURE__*/_jsx(\"td\",{className:\"p-2 border-b dark:border-gray-600 text-center text-gray-700 dark:text-gray-300 whitespace-nowrap \".concat(metric.isEstimatedRevenue?'cursor-help hover:bg-yellow-50 dark:hover:bg-yellow-900/20':''),onMouseEnter:metric.isEstimatedRevenue?e=>{const tooltipData=metric.getTooltipData(date,dateIndex);setTooltipData(tooltipData);setTooltipPosition({x:e.clientX,y:e.clientY});}:undefined,onMouseLeave:metric.isEstimatedRevenue?()=>{setTooltipData(null);}:undefined,children:metric.getValue(date,dateIndex)},date))]})]},metric.key);});})()})]})})]}):isLoadingEventRevenueTimeline?/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-center p-8 bg-white dark:bg-gray-700 rounded-lg shadow-md my-4\",children:[/*#__PURE__*/_jsx(Loader,{className:\"animate-spin mr-2 text-indigo-600 dark:text-indigo-400\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-700 dark:text-white\",children:\"Loading event revenue timeline...\"})]}):eventRevenueTimelineError?/*#__PURE__*/_jsx(\"div\",{className:\"my-4 p-4 bg-yellow-100 dark:bg-yellow-800 text-yellow-700 dark:text-white rounded-md shadow-md border border-yellow-300 dark:border-yellow-600\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center\",children:[/*#__PURE__*/_jsx(AlertTriangle,{className:\"mr-2 flex-shrink-0\"}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"span\",{className:\"font-medium block\",children:\"Event Revenue Timeline Error:\"}),/*#__PURE__*/_jsx(\"span\",{className:\"block mt-1\",children:eventRevenueTimelineError})]})]})}):null,userTimelineData?/*#__PURE__*/_jsxs(\"div\",{className:\"mb-8\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between items-center mb-3\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-xl font-semibold text-gray-700 dark:text-white\",children:\"User Timeline\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex gap-2\",children:[/*#__PURE__*/_jsxs(\"span\",{className:\"text-sm font-medium px-3 py-1 bg-blue-100 text-blue-800 dark:bg-blue-800 dark:text-blue-100 rounded-full\",children:[userTimelineData.unique_users_count||userTimelineData.total_users,\" Unique Users\"]}),/*#__PURE__*/_jsxs(\"span\",{className:\"text-sm font-medium px-3 py-1 bg-green-100 text-green-800 dark:bg-green-800 dark:text-green-100 rounded-full\",children:[userTimelineData.total_user_product_combinations||((_userTimelineData$use=userTimelineData.users)===null||_userTimelineData$use===void 0?void 0:_userTimelineData$use.length),\" User-Product Combinations\"]}),/*#__PURE__*/_jsxs(\"span\",{className:\"text-sm font-medium px-3 py-1 bg-purple-100 text-purple-800 dark:bg-purple-800 dark:text-purple-100 rounded-full\",children:[((_userTimelineData$val=userTimelineData.valid_product_ids)===null||_userTimelineData$val===void 0?void 0:_userTimelineData$val.length)||0,\" Unique Products\"]})]})]}),userTimelineData.filter_stats&&/*#__PURE__*/_jsx(FilterStatsDisplay,{filterStats:userTimelineData.filter_stats}),/*#__PURE__*/_jsxs(\"div\",{className:\"mb-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-wrap gap-3 mb-2\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"px-3 py-2 rounded \".concat(timelineColors.default.bg,\" \").concat(timelineColors.default.text),children:\"No Event\"}),/*#__PURE__*/_jsx(\"div\",{className:\"px-3 py-2 rounded \".concat(timelineColors.trial_started.bg,\" \").concat(timelineColors.trial_started.text),children:\"Trial Started\"}),/*#__PURE__*/_jsx(\"div\",{className:\"px-3 py-2 rounded \".concat(timelineColors.trial_converted.bg,\" \").concat(timelineColors.trial_converted.text),children:\"Trial Converted\"}),/*#__PURE__*/_jsx(\"div\",{className:\"px-3 py-2 rounded \".concat(timelineColors.trial_cancelled.bg,\" \").concat(timelineColors.trial_cancelled.text),children:\"Trial Cancelled\"}),/*#__PURE__*/_jsx(\"div\",{className:\"px-3 py-2 rounded \".concat(timelineColors.conversion_cancelled.bg,\" \").concat(timelineColors.conversion_cancelled.text),children:\"Conversion Cancelled\"}),/*#__PURE__*/_jsx(\"div\",{className:\"px-3 py-2 rounded \".concat(timelineColors.refunded.bg,\" \").concat(timelineColors.refunded.text),children:\"Refunded\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"relative flex items-center bg-gray-100 dark:bg-gray-700 p-2 rounded text-sm\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"mr-2\",children:\"Multiple events on the same day:\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"relative mr-8 px-4 py-2 rounded bg-green-100 dark:bg-green-900/50\",style:{minWidth:\"180px\"},children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-green-800 dark:text-green-200\",children:\"Trial Converted\"}),/*#__PURE__*/_jsx(\"div\",{className:\"absolute top-0 right-0 -mt-1 -mr-1 bg-blue-500 text-white text-[8px] rounded-full w-4 h-4 flex items-center justify-center\",children:\"3\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"mt-1 flex flex-col gap-1 w-full\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"px-1 py-0.5 text-[9px] w-full text-center rounded bg-yellow-100 dark:bg-yellow-900/50 text-yellow-800 dark:text-yellow-200\",children:\"Trial started\"}),/*#__PURE__*/_jsx(\"div\",{className:\"px-1 py-0.5 text-[9px] w-full text-center rounded bg-red-50 dark:bg-red-900/30 text-red-600 dark:text-red-300\",children:\"Refunded\"})]})]}),/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-600 dark:text-gray-300\",children:\"The cell is colored by the first event, with a counter and full-text badges for each additional event\"})]})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"overflow-x-auto\",children:/*#__PURE__*/_jsxs(\"table\",{className:\"min-w-full text-sm border dark:border-gray-600\",children:[/*#__PURE__*/_jsx(\"thead\",{className:\"bg-gray-50 dark:bg-gray-700\",children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{className:\"p-2 border-b dark:border-gray-600 text-left text-gray-700 dark:text-white sticky left-0 bg-gray-50 dark:bg-gray-700 z-10\",children:\"User ID\"}),/*#__PURE__*/_jsx(\"th\",{className:\"p-2 border-b dark:border-gray-600 text-left text-gray-700 dark:text-white sticky left-[150px] bg-gray-50 dark:bg-gray-700 z-10\",children:\"Product ID\"}),userTimelineData.dates.map(date=>/*#__PURE__*/_jsx(\"th\",{className:\"p-2 border-b dark:border-gray-600 text-center text-gray-700 dark:text-white whitespace-nowrap\",children:date},date))]})}),/*#__PURE__*/_jsx(\"tbody\",{className:\"bg-white dark:bg-gray-800\",children:userTimelineData.users.map((user,index)=>{// Get background colors for alternating users (not user-product rows)\nconst isNewUser=index===0||userTimelineData.users[index-1].id!==user.id;const userBgClass=isNewUser?index%4<2?'bg-white dark:bg-gray-800':'bg-gray-50 dark:bg-gray-700':'';return/*#__PURE__*/_jsxs(\"tr\",{className:userBgClass,children:[/*#__PURE__*/_jsx(\"td\",{className:\"p-2 border-b dark:border-gray-600 font-medium text-gray-700 dark:text-gray-300 sticky left-0 z-10\",style:{backgroundColor:'inherit'},children:isNewUser?user.id:''}),/*#__PURE__*/_jsx(\"td\",{className:\"p-2 border-b dark:border-gray-600 font-medium text-green-700 dark:text-green-300 sticky left-[150px] z-10\",style:{backgroundColor:'inherit'},children:user.product_id}),userTimelineData.dates.map(date=>{const cellState=getCellState(user.user_product_key,date,userTimelineData.events);const events=getEventsForDate(user.user_product_key,date,userTimelineData.events);const hasEvents=events.length>0;return/*#__PURE__*/_jsx(\"td\",{className:\"p-2 border dark:border-gray-600 text-xs relative \".concat(timelineColors[cellState].bg),children:hasEvents?/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-col items-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-center w-full \".concat(timelineColors[cellState].text,\" font-medium\"),children:events[0].type.replace('RC ','')}),events.length>1&&/*#__PURE__*/_jsx(\"div\",{className:\"mt-1 flex flex-col items-center w-full gap-1\",children:events.slice(1).map((additionalEvent,idx)=>{const eventType=additionalEvent.type.replace('RC ','');let badgeState='default';// Determine appropriate color for this event\nif(additionalEvent.type==='RC Trial started')badgeState='trial_started';else if(additionalEvent.type==='RC Trial converted')badgeState='trial_converted';else if(additionalEvent.type==='RC Trial cancelled')badgeState='trial_cancelled';else if(additionalEvent.type==='RC Cancellation'){badgeState=additionalEvent.has_refund?'refunded':'conversion_cancelled';}else if(additionalEvent.type==='RC Initial purchase'){badgeState='trial_converted';}else if(additionalEvent.type==='RC Renewal'){badgeState='trial_converted';}return/*#__PURE__*/_jsx(\"div\",{className:\"px-1 py-0.5 text-[9px] w-full text-center rounded \".concat(timelineColors[badgeState].bg,\" \").concat(timelineColors[badgeState].text),title:\"\".concat(eventType,\" at \").concat(additionalEvent.time,\" for \").concat(additionalEvent.product_id),children:eventType},idx);})}),events.length>1&&/*#__PURE__*/_jsx(\"div\",{className:\"absolute top-0 right-0 -mt-1 -mr-1 bg-blue-500 text-white text-[8px] rounded-full w-4 h-4 flex items-center justify-center\",children:events.length})]}):''},date);})]},user.user_product_key);})})]})})]}):isLoadingTimeline?/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-center p-8 bg-white dark:bg-gray-700 rounded-lg shadow-md my-4\",children:[/*#__PURE__*/_jsx(Loader,{className:\"animate-spin mr-2 text-indigo-600 dark:text-indigo-400\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-700 dark:text-white\",children:\"Loading user timeline data...\"})]}):timelineError?/*#__PURE__*/_jsx(\"div\",{className:\"my-4 p-4 bg-yellow-100 dark:bg-yellow-800 text-yellow-700 dark:text-white rounded-md shadow-md border border-yellow-300 dark:border-yellow-600\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center\",children:[/*#__PURE__*/_jsx(AlertTriangle,{className:\"mr-2 flex-shrink-0\"}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"span\",{className:\"font-medium block\",children:\"Timeline Error:\"}),/*#__PURE__*/_jsx(\"span\",{className:\"block mt-1\",children:timelineError})]})]})}):null,/*#__PURE__*/_jsx(EstimatedRevenueTooltip,{data:tooltipData,position:tooltipPosition,onClose:()=>setTooltipData(null)}),/*#__PURE__*/_jsx(ChartModal,{})]});};export default CohortAnalyzerPage;","map":{"version":3,"names":["React","useState","useEffect","useCallback","api","LineChart","Line","XAxis","YAxis","CartesianGrid","Tooltip","Legend","ResponsiveContainer","ChevronDown","ChevronRight","PlusCircle","XCircle","AlertTriangle","Loader","Filter","Select","Chart","ChartJS","CategoryScale","LinearScale","PointElement","LineElement","Title","ChartTooltip","ChartLegend","ChartLine","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","register","customSelectStyles","control","base","state","_objectSpread","background","borderColor","isFocused","boxShadow","padding","fontSize","option","backgroundColor","isSelected","color","cursor","multiValue","border","multiValueLabel","fontWeight","multiValueRemove","menu","zIndex","placeholder","input","singleValue","darkModeSelectStyles","timelineColors","default","bg","text","trial_started","trial_converted","trial_cancelled","conversion_cancelled","refunded","FilterStatsDisplay","_ref","_filtering_steps","filterStats","filtering_steps","base_cohort_count","final_cohort_count","calculatePercentage","count","total","toFixed","className","children","size","slice","map","step","index","users_count","length","description","users_filtered","EstimatedRevenueTooltip","_ref2","data","position","onClose","style","left","Math","min","x","window","innerWidth","top","max","y","onClick","breakdown","trialConverted","initialPurchase","initial_purchase","showTrialRatio","actual_revenue","showInitialRatio","revenue","estimatedRefunds","estimated_refunds","refundRate","concat","formula","calculation","Object","entries","components","_ref3","key","value","result","CohortAnalyzerPage","_analysisResult$summa","_analysisResult$summa2","_analysisResult$summa3","_analysisResult$summa4","_analysisResult$summa5","_analysisResult$cohor","_analysisResult$cohor2","_analysisResult$cohor3","_analysisResult$cohor4","_analysisResult$cohor5","_analysisResult$cohor6","_analysisResult$cohor7","_analysisResult$cohor8","_analysisResult$cohor9","_analysisResult$cohor0","_analysisResult$cohor1","_analysisResult$cohor10","_analysisResult$cohor11","_analysisResult$cohor12","_analysisResult$cohor13","_analysisResult$cohor14","_analysisResult$cohor15","_analysisResult$cohor16","_analysisResult$cohor17","_analysisResult$cohor18","_analysisResult$cohor19","_analysisResult$cohor20","_analysisResult$cohor21","_analysisResult$cohor22","_analysisResult$cohor23","_analysisResult$cohor24","_userTimelineData$use","_userTimelineData$val","initialFilters","date_from_str","date_to_str","optional_filters","filters","setFilters","availableEventProperties","setAvailableEventProperties","availableUserProperties","setAvailableUserProperties","propertyValueOptions","setPropertyValueOptions","isLoading","setIsLoading","analysisResult","setAnalysisResult","error","setError","showLifecycleTables","setShowLifecycleTables","activePropertyDiscovery","setActivePropertyDiscovery","propertyDiscoveryMessage","setPropertyDiscoveryMessage","isInitializing","setIsInitializing","userTimelineData","setUserTimelineData","isLoadingTimeline","setIsLoadingTimeline","timelineError","setTimelineError","eventRevenueTimelineData","setEventRevenueTimelineData","isLoadingEventRevenueTimeline","setIsLoadingEventRevenueTimeline","eventRevenueTimelineError","setEventRevenueTimelineError","selectedUserId","setSelectedUserId","selectedProductId","setSelectedProductId","availableUsers","setAvailableUsers","availableProducts","setAvailableProducts","cohortDefinitionWarning","setCohortDefinitionWarning","tooltipData","setTooltipData","tooltipPosition","setTooltipPosition","selectedProducts","setSelectedProducts","globalSelectedProduct","setGlobalSelectedProduct","showChartModal","setShowChartModal","savedFilters","localStorage","getItem","parsedFilters","JSON","parse","prev","console","filtersToSave","setItem","stringify","fetchDiscoverableProperties","getDiscoverableCohortProperties","event_properties","user_properties","status","message","checkDiscoveryInterval","setInterval","getPropertyDiscoveryStatus","clearInterval","setTimeout","err","code","enableCohortProperties","enableErr","active","initializeProperties","handleFilterChange","type","arguments","undefined","newFilters","property_name","property_values","fetchPropertyValues","startsWith","field","substring","property_source","propertyName","propertySource","filterIdentifier","getDiscoverableCohortPropertyValues","values","addOptionalFilter","id","Date","now","toString","removeOptionalFilter","idToRemove","filter","f","handleSubmit","e","preventDefault","Error","cohortFilters","enforce_trial_started","cohort_definition","required_event","date_range","from","to","strict_filtering","analyzeCohortData","cohort_event_occurrence","summary_stats","total_users_in_final_cohort","trialStartedUsers","user_count","totalCohortUsers","warningMessage","warn","fetchUserTimeline","fetchEventRevenueTimeline","log","timelineData","getCohortUserTimeline","distinctId","productId","getUserEventRevenueTimeline","available_users","available_products","getCellState","userProductKey","date","eventMap","mostRecentEventDate","mostRecentState","eventDate","events","lastEvent","has_refund","firstEvent","getEventsForDate","triggerPropertyDiscovery","triggerCohortPropertyDiscovery","renderLifecycleTable","title","ratesData","denominatorKey","isNewFormat","rates_by_product","aggregate_rates","aggregateRates","productRates","rates_by_day","keys","displayRates","ratesByDay","sortedDays","Number","sort","a","b","rowData","metric","dataKey","smoothing_method","smoothing_quality","total_sample_size","smoothing_details","cancellation","early_concentration","sparsity","max_rate","row","day","dayStr","dayData","ratesDenominator","legacyRowData","formatCurrency","toLocaleString","currency","chartData","daily_data","d","actualNetRevenue","cumulative_revenue_actual_net","projectedNetRevenue","estimated_additional_revenue_from_pending_trials_net_refund","estimated_future_refunds_on_actual_revenue_amount","trialsStarted","daily_trials_started","trialsConverted","daily_trials_converted_actual","trialsCancelled","daily_trials_cancelled_actual","trialsEnded","trialsPending","daily_trials_ended","daily_trials_pending","daily_conversions","daily_conversions_net_refunds","daily_refund_count_actual","daily_estimated_conversions_net_refunds","daily_estimated_refunds","daily_refunds","daily_revenue","daily_revenue_actual","daily_revenue_net","daily_revenue_actual_net","daily_estimated_revenue","cumulative_trials_started","cumulative_trials_ended","cumulative_trials_converted_actual","cumulative_trials_cancelled_actual","cumulative_trials_pending","cumulative_conversions","cumulative_conversions_net_refunds","cumulative_refund_count_actual","cumulative_estimated_conversions_net_refunds","cumulative_estimated_refunds","cumulative_refunds","cumulative_revenue","cumulative_revenue_actual","cumulative_revenue_net","cumulative_estimated_revenue","visibleAbsoluteMetrics","setVisibleAbsoluteMetrics","visibleMoneyMetrics","setVisibleMoneyMetrics","toggleAbsoluteMetric","metricKey","toggleMoneyMetric","getSelectTheme","isDarkMode","document","documentElement","classList","contains","matchMedia","matches","ChartModal","lifecycle_rates","lifecycleRates","getChartData","days","datasets","label","_ratesData$rates_by_d","raw_cumulative_cancellation_rate","borderDash","tension","_ratesData$rates_by_d2","smoothed_cumulative_cancellation_rate","_ratesData$rates_by_d3","raw_cumulative_refund_rate","_ratesData$rates_by_d4","smoothed_cumulative_refund_rate","_ratesData$rates_by_d5","raw_cumulative_conversion_rate","_ratesData$rates_by_d6","smoothed_cumulative_conversion_rate","_ratesData$rates_by_d7","_ratesData$rates_by_d8","labels","chartOptions","responsive","plugins","legend","display","scales","beginAtZero","getDisplayRates","trialToOutcomeRates","trial_to_outcome_rates","cancellationRefundRates","trial_to_cancellation_rates","trial_to_refund_rates","options","onSubmit","htmlFor","onChange","target","required","p","display_name","isMulti","isDisabled","val","selected","styles","disabled","filter_stats","total_events_analyzed","arpc_cohort","arpc_datapoints","arpc_calculation_basis","arpc_per_product","_ref4","arpcData","arpc","event_count","unique_users","total_revenue","event_user_counts","_ref5","eventType","counts","total_events","trial_ended","percentage","renewal","rc_cancellation","rc_refund","rc_cancel_no_refund","allAvailableProducts","Set","forEach","rateData","add","productList","Array","initial_purchase_to_cancellation_rates","initial_purchase_to_refund_rates","renewal_to_cancellation_rates","renewal_to_refund_rates","split","join","width","height","margin","right","bottom","strokeDasharray","formatter","stroke","name","isClearable","isSearchable","user","newUserId","product","newProductId","dates","metrics","category","categoryLabel","getValue","_eventRows$trial_star","_eventRows$trial_star2","chartDay","find","eventRows","event_rows","_eventRows$trial_pend","trial_pending","_eventRows$trial_ende","_eventRows$trial_canc","trial_canceled","_eventRows$trial_conv","_eventRows$trial_conv2","_eventRows$initial_pu","_eventRows$subscripti","subscription_active","_eventRows$subscripti2","subscription_cancelled","_eventRows$refund","_eventRows$refund2","refund","_estimateRows$current","_estimateRows$current2","estimateRows","estimate_rows","current_revenue","isEstimatedRevenue","_estimateRows$estimat","_estimateRows$estimat2","estimated_net_revenue","estimated_revenue","getTooltipData","_estimateRows$estimat3","_estimateRows$estimat4","actualValue","reduce","sum","_eventRows$trial_star3","_eventRows$trial_pend2","_eventRows$trial_ende2","_eventRows$trial_canc2","_eventRows$trial_canc3","_eventRows$trial_conv3","_eventRows$cumulative","_eventRows$initial_pu2","cumulative_initial_purchase","_eventRows$subscripti3","_eventRows$subscripti4","_eventRows$refund3","_estimateRows$current3","_estimateRows$estimat5","_estimateRows$estimat6","categoryColors","daily_absolute","cumulative_absolute","metricIndex","isFirstInCategory","colSpan","dateIndex","onMouseEnter","clientX","clientY","onMouseLeave","unique_users_count","total_users","total_user_product_combinations","users","valid_product_ids","minWidth","isNewUser","userBgClass","product_id","cellState","user_product_key","hasEvents","replace","additionalEvent","idx","badgeState","time"],"sources":["/Users/joshuakaufman/untitled folder 3/orchestrator/dashboard/client/src/pages/CohortAnalyzerPage.js"],"sourcesContent":["// client/src/pages/CohortAnalyzerPage.js\n// COHORT DEFINITION:\n// A user is part of the cohort ONLY if they:\n// 1. Exist in the database\n// 2. Have a \"trial started\" event within the specified date range\n// This is enforced using the enforce_trial_started flag in API calls\n// IMPORTANT: Users who do not meet both criteria are EXCLUDED from all analysis.\n// All events analyzed are ONLY from users in this cohort.\n\nimport React, { useState, useEffect, useCallback } from 'react';\nimport { api } from '../services/api'; // Assuming your API service is here\nimport { LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer } from 'recharts';\nimport { ChevronDown, ChevronRight, PlusCircle, XCircle, AlertTriangle, Loader, Filter } from 'lucide-react';\nimport Select from 'react-select';\nimport {\n    Chart as ChartJS,\n    CategoryScale,\n    LinearScale,\n    PointElement,\n    LineElement,\n    Title,\n    Tooltip as ChartTooltip,\n    Legend as ChartLegend,\n} from 'chart.js';\nimport { Line as ChartLine } from 'react-chartjs-2';\n\nChartJS.register(\n    CategoryScale,\n    LinearScale,\n    PointElement,\n    LineElement,\n    Title,\n    ChartTooltip,\n    ChartLegend\n);\n\n// Custom styles for react-select\nconst customSelectStyles = {\n  control: (base, state) => ({\n    ...base,\n    background: '#FFFFFF',\n    borderColor: state.isFocused ? '#4F46E5' : '#CBD5E0',\n    boxShadow: state.isFocused ? '0 0 0 1px #4F46E5' : 'none',\n    '&:hover': {\n      borderColor: '#4F46E5',\n    },\n    padding: '2px',\n    fontSize: '0.9rem',\n  }),\n  option: (base, state) => ({\n    ...base,\n    backgroundColor: state.isSelected \n      ? '#4F46E5' \n      : state.isFocused \n        ? '#EEF2FF' \n        : 'transparent',\n    color: state.isSelected ? 'white' : '#1A202C',\n    '&:hover': {\n      backgroundColor: state.isSelected ? '#4F46E5' : '#EEF2FF',\n    },\n    cursor: 'pointer',\n    fontSize: '0.9rem',\n  }),\n  multiValue: (base) => ({\n    ...base,\n    backgroundColor: '#EEF2FF',\n    border: '1px solid #E2E8F0',\n  }),\n  multiValueLabel: (base) => ({\n    ...base,\n    color: '#4F46E5',\n    fontWeight: 500,\n  }),\n  multiValueRemove: (base) => ({\n    ...base,\n    color: '#4F46E5',\n    '&:hover': {\n      backgroundColor: '#4F46E5',\n      color: 'white',\n    },\n  }),\n  menu: (base) => ({\n    ...base,\n    zIndex: 100,\n    boxShadow: '0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)',\n    backgroundColor: '#FFFFFF',\n  }),\n  placeholder: (base) => ({\n    ...base,\n    color: '#718096',\n  }),\n  input: (base) => ({\n    ...base,\n    color: '#1A202C',\n  }),\n  singleValue: (base) => ({\n    ...base,\n    color: '#1A202C',\n  }),\n};\n\n// For dark mode\nconst darkModeSelectStyles = {\n  ...customSelectStyles,\n  control: (base, state) => ({\n    ...customSelectStyles.control(base, state),\n    background: '#1F2937',\n    borderColor: state.isFocused ? '#4F46E5' : '#4B5563',\n    '&:hover': {\n      borderColor: '#4F46E5',\n    },\n  }),\n  option: (base, state) => ({\n    ...customSelectStyles.option(base, state),\n    backgroundColor: state.isSelected \n      ? '#4F46E5' \n      : state.isFocused \n        ? '#374151' \n        : '#1F2937',\n    color: state.isSelected ? 'white' : '#F3F4F6',\n  }),\n  multiValue: (base) => ({\n    ...customSelectStyles.multiValue(base),\n    backgroundColor: '#374151',\n    border: '1px solid #4B5563',\n  }),\n  multiValueLabel: (base) => ({\n    ...customSelectStyles.multiValueLabel(base),\n    color: '#F3F4F6',\n  }),\n  multiValueRemove: (base) => ({\n    ...customSelectStyles.multiValueRemove(base),\n    color: '#F3F4F6',\n    '&:hover': {\n      backgroundColor: '#4F46E5',\n      color: 'white',\n    },\n  }),\n  menu: (base) => ({\n    ...customSelectStyles.menu(base),\n    backgroundColor: '#1F2937',\n    border: '1px solid #4B5563',\n  }),\n  placeholder: (base) => ({\n    ...customSelectStyles.placeholder(base),\n    color: '#9CA3AF',\n  }),\n  input: (base) => ({\n    ...base,\n    color: '#F3F4F6',\n  }),\n  singleValue: (base) => ({\n    ...base,\n    color: '#F3F4F6',\n  }),\n};\n\n// Define the color coding for the user timeline table\nconst timelineColors = {\n  default: {\n    bg: 'bg-gray-100 dark:bg-gray-700',\n    text: 'text-gray-500 dark:text-gray-400'\n  },\n  trial_started: {\n    bg: 'bg-yellow-100 dark:bg-yellow-900/50',\n    text: 'text-yellow-800 dark:text-yellow-200'\n  },\n  trial_converted: {\n    bg: 'bg-green-100 dark:bg-green-900/50',\n    text: 'text-green-800 dark:text-green-200'\n  },\n  trial_cancelled: {\n    bg: 'bg-red-100 dark:bg-red-900/50',\n    text: 'text-red-800 dark:text-red-200'\n  },\n  conversion_cancelled: {\n    bg: 'bg-green-50 dark:bg-green-900/30',\n    text: 'text-green-600 dark:text-green-300'\n  },\n  refunded: {\n    bg: 'bg-red-50 dark:bg-red-900/30',\n    text: 'text-red-600 dark:text-red-300'\n  }\n};\n\n// New component for displaying filter stats\nconst FilterStatsDisplay = ({ filterStats }) => {\n    if (!filterStats) return null;\n    \n    const { filtering_steps, base_cohort_count, final_cohort_count } = filterStats;\n    \n    // Calculate percentages\n    const calculatePercentage = (count, total) => {\n        if (!total) return 0;\n        return ((count / total) * 100).toFixed(1);\n    };\n    \n    return (\n        <div className=\"mb-6 p-4 border rounded-lg bg-white dark:bg-gray-700 shadow-sm\">\n            <div className=\"flex items-center gap-2 mb-3\">\n                <Filter size={18} className=\"text-indigo-600 dark:text-indigo-400\" />\n                <h3 className=\"text-lg font-semibold text-gray-700 dark:text-white\">Cohort Filtering Statistics</h3>\n            </div>\n            \n            <div className=\"flex flex-col md:flex-row items-center justify-between mb-4 p-3 bg-indigo-50 dark:bg-indigo-900/30 rounded-md\">\n                <div className=\"text-center\">\n                    <div className=\"text-sm text-gray-600 dark:text-gray-300\">Base Cohort</div>\n                    <div className=\"text-xl font-bold text-indigo-600 dark:text-indigo-300\">{base_cohort_count}</div>\n                    <div className=\"text-xs text-gray-500 dark:text-gray-400\">100%</div>\n                </div>\n                \n                <div className=\"hidden md:block text-gray-400\">→</div>\n                \n                {filtering_steps.slice(1).map((step, index) => (\n                    <div key={index} className=\"text-center\">\n                        <div className=\"text-sm text-gray-600 dark:text-gray-300\">After {step.step}</div>\n                        <div className=\"text-xl font-bold text-indigo-600 dark:text-indigo-300\">{step.users_count}</div>\n                        <div className=\"text-xs text-gray-500 dark:text-gray-400\">\n                            {calculatePercentage(step.users_count, base_cohort_count)}% of base\n                        </div>\n                    </div>\n                ))}\n                \n                {/* If there's a significant difference between final count and last step */}\n                {final_cohort_count !== (filtering_steps[filtering_steps.length - 1]?.users_count) && (\n                    <>\n                        <div className=\"hidden md:block text-gray-400\">→</div>\n                        <div className=\"text-center\">\n                            <div className=\"text-sm text-gray-600 dark:text-gray-300\">Final Cohort</div>\n                            <div className=\"text-xl font-bold text-indigo-600 dark:text-indigo-300\">{final_cohort_count}</div>\n                            <div className=\"text-xs text-gray-500 dark:text-gray-400\">\n                                {calculatePercentage(final_cohort_count, base_cohort_count)}% of base\n                            </div>\n                        </div>\n                    </>\n                )}\n            </div>\n            \n            <div className=\"overflow-x-auto\">\n                <table className=\"min-w-full text-sm border dark:border-gray-600\">\n                    <thead className=\"bg-gray-50 dark:bg-gray-700\">\n                        <tr>\n                            <th className=\"p-2 border-b dark:border-gray-600 text-left text-gray-700 dark:text-white\">Filter Step</th>\n                            <th className=\"p-2 border-b dark:border-gray-600 text-left text-gray-700 dark:text-white\">Description</th>\n                            <th className=\"p-2 border-b dark:border-gray-600 text-center text-gray-700 dark:text-white\">Users Count</th>\n                            <th className=\"p-2 border-b dark:border-gray-600 text-center text-gray-700 dark:text-white\">Users Filtered</th>\n                            <th className=\"p-2 border-b dark:border-gray-600 text-center text-gray-700 dark:text-white\">% of Base</th>\n                        </tr>\n                    </thead>\n                    <tbody className=\"bg-white dark:bg-gray-800\">\n                        {filtering_steps.map((step, index) => (\n                            <tr key={index} className={index % 2 === 0 ? '' : 'bg-gray-50 dark:bg-gray-700'}>\n                                <td className=\"p-2 border-b dark:border-gray-600 font-medium text-gray-700 dark:text-gray-300\">{step.step}</td>\n                                <td className=\"p-2 border-b dark:border-gray-600 text-gray-700 dark:text-gray-300\">{step.description}</td>\n                                <td className=\"p-2 border-b dark:border-gray-600 text-center text-gray-700 dark:text-gray-300\">{step.users_count}</td>\n                                <td className=\"p-2 border-b dark:border-gray-600 text-center text-gray-700 dark:text-gray-300\">\n                                    {step.users_filtered || 0}\n                                </td>\n                                <td className=\"p-2 border-b dark:border-gray-600 text-center text-gray-700 dark:text-gray-300\">\n                                    {calculatePercentage(step.users_count, base_cohort_count)}%\n                                </td>\n                            </tr>\n                        ))}\n                    </tbody>\n                </table>\n            </div>\n        </div>\n    );\n};\n\n// Add this Tooltip component before the main CohortAnalyzerPage component\nconst EstimatedRevenueTooltip = ({ data, position, onClose }) => {\n    if (!data) return null;\n    \n    return (\n        <div \n            className=\"fixed z-50 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-600 rounded-lg shadow-lg p-4 max-w-md\"\n            style={{\n                left: Math.min(position.x, window.innerWidth - 400),\n                top: Math.max(position.y - 100, 10),\n            }}\n        >\n            <div className=\"flex justify-between items-start mb-2\">\n                <h4 className=\"font-semibold text-gray-800 dark:text-white\">Estimated Revenue Calculation</h4>\n                <button onClick={onClose} className=\"text-gray-500 hover:text-gray-700\">×</button>\n            </div>\n            \n            <div className=\"space-y-3 text-sm\">\n                {/* NEW: Refund Rate Ratios - Show prominently at the top */}\n                {(() => {\n                    const breakdown = data.breakdown || {};\n                    const trialConverted = breakdown.trial_converted || {};\n                    const initialPurchase = breakdown.initial_purchase || {};\n                    \n                    const showTrialRatio = trialConverted.actual_revenue > 0;\n                    const showInitialRatio = initialPurchase.actual_revenue > 0;\n                    \n                    if (!showTrialRatio && !showInitialRatio) return null;\n                    \n                    return (\n                        <div className=\"bg-blue-50 dark:bg-blue-900 p-3 rounded-lg border border-blue-200 dark:border-blue-700 mb-3\">\n                            <div className=\"text-sm font-medium text-blue-800 dark:text-blue-200 mb-2\">\n                                🎯 Refund Rate Analysis\n                            </div>\n                            \n                            {showTrialRatio && (\n                                <div className=\"mb-2\">\n                                    <div className=\"text-xs font-medium text-blue-700 dark:text-blue-300\">\n                                        Trial Conversion Refund Rate:\n                                    </div>\n                                    <div className=\"text-sm font-bold text-blue-900 dark:text-blue-100\">\n                                        {(() => {\n                                            const revenue = trialConverted.actual_revenue || 0;\n                                            const estimatedRefunds = trialConverted.estimated_refunds || 0;\n                                            const refundRate = revenue > 0 ? (estimatedRefunds / revenue) * 100 : 0;\n                                            return `${estimatedRefunds.toFixed(2)} / ${revenue.toFixed(2)} = ${refundRate.toFixed(1)}%`;\n                                        })()}\n                                    </div>\n                                    <div className=\"text-xs text-blue-600 dark:text-blue-400\">\n                                        ${(trialConverted.estimated_refunds || 0).toFixed(2)} estimated refunds on ${(trialConverted.actual_revenue || 0).toFixed(2)} revenue\n                                    </div>\n                                </div>\n                            )}\n                            \n                            {showInitialRatio && (\n                                <div>\n                                    <div className=\"text-xs font-medium text-blue-700 dark:text-blue-300\">\n                                        Initial Purchase Refund Rate:\n                                    </div>\n                                    <div className=\"text-sm font-bold text-blue-900 dark:text-blue-100\">\n                                        {(() => {\n                                            const revenue = initialPurchase.actual_revenue || 0;\n                                            const estimatedRefunds = initialPurchase.estimated_refunds || 0;\n                                            const refundRate = revenue > 0 ? (estimatedRefunds / revenue) * 100 : 0;\n                                            return `${estimatedRefunds.toFixed(2)} / ${revenue.toFixed(2)} = ${refundRate.toFixed(1)}%`;\n                                        })()}\n                                    </div>\n                                    <div className=\"text-xs text-blue-600 dark:text-blue-400\">\n                                        ${(initialPurchase.estimated_refunds || 0).toFixed(2)} estimated refunds on ${(initialPurchase.actual_revenue || 0).toFixed(2)} revenue\n                                    </div>\n                                </div>\n                            )}\n                        </div>\n                    );\n                })()}\n                \n                <div>\n                    <div className=\"font-medium text-gray-700 dark:text-gray-300\">Formula:</div>\n                    <div className=\"font-mono text-xs bg-gray-100 dark:bg-gray-700 p-2 rounded\">\n                        {data.formula}\n                    </div>\n                </div>\n                \n                <div>\n                    <div className=\"font-medium text-gray-700 dark:text-gray-300\">Calculation:</div>\n                    <div className=\"font-mono text-xs bg-gray-100 dark:bg-gray-700 p-2 rounded\">\n                        {data.calculation}\n                    </div>\n                </div>\n                \n                <div>\n                    <div className=\"font-medium text-gray-700 dark:text-gray-300\">Components:</div>\n                    <div className=\"text-xs space-y-1\">\n                        {Object.entries(data.components || {}).map(([key, value]) => (\n                            <div key={key} className=\"flex justify-between\">\n                                <span className=\"text-gray-600 dark:text-gray-400\">{key}:</span>\n                                <span className=\"font-mono\">{value}</span>\n                            </div>\n                        ))}\n                    </div>\n                </div>\n                \n                <div className=\"border-t pt-2\">\n                    <div className=\"flex justify-between font-medium\">\n                        <span>Result:</span>\n                        <span className=\"text-green-600 dark:text-green-400\">{data.result}</span>\n                    </div>\n                </div>\n            </div>\n        </div>\n    );\n};\n\nconst CohortAnalyzerPage = () => {\n    const initialFilters = {\n        date_from_str: '',\n        date_to_str: '',\n        optional_filters: [], // [{id: uuid, property_name: '', property_values: [], property_source: 'event/user'}]\n    };\n\n    const [filters, setFilters] = useState(initialFilters);\n    const [availableEventProperties, setAvailableEventProperties] = useState([]);\n    const [availableUserProperties, setAvailableUserProperties] = useState([]);\n    const [propertyValueOptions, setPropertyValueOptions] = useState({}); // { 'prop_key': ['val1', 'val2'] }\n\n    const [isLoading, setIsLoading] = useState(false);\n    const [analysisResult, setAnalysisResult] = useState(null);\n    const [error, setError] = useState(null);\n    \n    const [showLifecycleTables, setShowLifecycleTables] = useState(false);\n    const [activePropertyDiscovery, setActivePropertyDiscovery] = useState(false);\n    const [propertyDiscoveryMessage, setPropertyDiscoveryMessage] = useState('');\n    const [isInitializing, setIsInitializing] = useState(true);\n    \n    // User timeline state\n    const [userTimelineData, setUserTimelineData] = useState(null);\n    const [isLoadingTimeline, setIsLoadingTimeline] = useState(false);\n    const [timelineError, setTimelineError] = useState(null);\n    \n    // Event Revenue Timeline state - NEW FEATURE\n    const [eventRevenueTimelineData, setEventRevenueTimelineData] = useState(null);\n    const [isLoadingEventRevenueTimeline, setIsLoadingEventRevenueTimeline] = useState(false);\n    const [eventRevenueTimelineError, setEventRevenueTimelineError] = useState(null);\n    const [selectedUserId, setSelectedUserId] = useState('');\n    const [selectedProductId, setSelectedProductId] = useState('');\n    const [availableUsers, setAvailableUsers] = useState([]);\n    const [availableProducts, setAvailableProducts] = useState([]);\n    \n    // Add state for cohort definition warning\n    const [cohortDefinitionWarning, setCohortDefinitionWarning] = useState(null);\n    \n    // Add state for tooltip\n    const [tooltipData, setTooltipData] = useState(null);\n    const [tooltipPosition, setTooltipPosition] = useState({ x: 0, y: 0 });\n\n    // Add state for product selection at component level\n    const [selectedProducts, setSelectedProducts] = React.useState({});\n\n    // State for lifecycle table global product selection (single selector for all tables)\n    const [globalSelectedProduct, setGlobalSelectedProduct] = React.useState(\"\");\n    \n    // State for chart modal\n    const [showChartModal, setShowChartModal] = React.useState(false);\n\n    // Load saved filters from localStorage on component mount\n    useEffect(() => {\n        const savedFilters = localStorage.getItem('cohortAnalyzerFilters');\n        if (savedFilters) {\n            try {\n                const parsedFilters = JSON.parse(savedFilters);\n                setFilters(prev => ({\n                    ...prev,\n                    ...parsedFilters,\n                    optional_filters: parsedFilters.optional_filters || [] // Ensure optional_filters exists\n                }));\n            } catch (error) {\n                console.error('Error loading saved filters:', error);\n            }\n        }\n    }, []);\n\n    // Save filters to localStorage whenever they change\n    useEffect(() => {\n        const filtersToSave = {\n            date_from_str: filters.date_from_str,\n            date_to_str: filters.date_to_str,\n            optional_filters: filters.optional_filters\n        };\n        localStorage.setItem('cohortAnalyzerFilters', JSON.stringify(filtersToSave));\n    }, [filters.date_from_str, filters.date_to_str, filters.optional_filters]);\n\n    // Define fetchDiscoverableProperties BEFORE it's used in the useEffect\n    const fetchDiscoverableProperties = useCallback(async () => {\n        try {\n            const data = await api.getDiscoverableCohortProperties();\n            setAvailableEventProperties(data.event_properties || []);\n            setAvailableUserProperties(data.user_properties || []);\n            \n            // Check if we got an empty response and need to enable properties\n            if ((!data.event_properties || data.event_properties.length === 0) && \n                (!data.user_properties || data.user_properties.length === 0)) {\n                if (data.status === \"discovery_initiated\") {\n                    setPropertyDiscoveryMessage(data.message || \"Property discovery auto-triggered. Please wait...\");\n                    setActivePropertyDiscovery(true);\n                    // Poll for completion\n                    const checkDiscoveryInterval = setInterval(async () => {\n                        try {\n                            const status = await api.getPropertyDiscoveryStatus();\n                            if (status.status === 'completed') {\n                                clearInterval(checkDiscoveryInterval);\n                                setActivePropertyDiscovery(false);\n                                setPropertyDiscoveryMessage(\"Discovery completed! Refreshing properties...\");\n                                // Refresh properties after a delay\n                                setTimeout(fetchDiscoverableProperties, 1000);\n                            }\n                        } catch (err) {\n                            console.error(\"Error checking discovery status:\", err);\n                        }\n                    }, 3000);\n                }\n            }\n        } catch (err) {\n            console.error(\"Error fetching discoverable properties:\", err);\n            if (err.code === \"tables_missing\") {\n                // Specific error for missing tables - try to enable properties automatically\n                try {\n                    await api.enableCohortProperties();\n                    setPropertyDiscoveryMessage(\"Property system initialized. Please wait while we discover properties...\");\n                    // Give time for the initialization and then try again\n                    setTimeout(fetchDiscoverableProperties, 2000);\n                } catch (enableErr) {\n                    setError(\"Could not initialize property system. Please try again or check server logs.\");\n                }\n            } else {\n                setError(\"Could not load filter property lists. Try triggering discovery or check console.\");\n            }\n        }\n    }, []);\n\n    const getPropertyDiscoveryStatus = useCallback(async () => {\n        try {\n            const status = await api.getPropertyDiscoveryStatus();\n            if (status.active) {\n                setActivePropertyDiscovery(true);\n                setPropertyDiscoveryMessage(status.message || \"Property discovery in progress...\");\n            } else if (status.status === 'completed') {\n                setActivePropertyDiscovery(false);\n            }\n        } catch (err) {\n            console.error(\"Error checking discovery status:\", err);\n        }\n    }, []);\n\n    // Initialize properties and fetch discoverable properties on mount\n    useEffect(() => {\n        const initializeProperties = async () => {\n            setIsInitializing(true);\n            try {\n                // First try to enable properties to ensure tables exist\n                await api.enableCohortProperties();\n                // Check discovery status\n                await getPropertyDiscoveryStatus();\n                // Then fetch the properties\n                await fetchDiscoverableProperties();\n            } catch (err) {\n                console.error(\"Error initializing properties:\", err);\n                setError(\"Could not initialize property system. Please check server logs.\");\n            } finally {\n                setIsInitializing(false);\n            }\n        };\n        \n        initializeProperties();\n    }, [fetchDiscoverableProperties, getPropertyDiscoveryStatus]);\n\n    const handleFilterChange = (type, value, index = -1) => {\n        setFilters(prev => {\n            const newFilters = { ...prev };\n            if (type === 'date_from_str' || type === 'date_to_str') {\n                newFilters[type] = value;\n            } else if (type === 'optional_filter_property') {\n                newFilters.optional_filters[index].property_name = value;\n                newFilters.optional_filters[index].property_values = []; // Reset values\n                if (value) fetchPropertyValues(value, 'user', 'optional_filter_' + index);\n            } else if (type === 'optional_filter_values') {\n                // Assuming value is an array from a multi-select component\n                newFilters.optional_filters[index].property_values = value;\n            } else if (type.startsWith('optional_filter_')) {\n                const field = type.substring('optional_filter_'.length); // 'property', 'values', 'source'\n                if (field === 'property') {\n                    newFilters.optional_filters[index].property_name = value;\n                    newFilters.optional_filters[index].property_values = []; // Reset values\n                    if (value && newFilters.optional_filters[index].property_source) {\n                        fetchPropertyValues(value, newFilters.optional_filters[index].property_source, `optional_filter_${index}`);\n                    }\n                } else if (field === 'values') {\n                    newFilters.optional_filters[index].property_values = value; // Assuming array\n                } else if (field === 'source') {\n                    newFilters.optional_filters[index].property_source = value;\n                    // If property name already exists, re-fetch values for new source\n                    if (newFilters.optional_filters[index].property_name) {\n                         fetchPropertyValues(newFilters.optional_filters[index].property_name, value, `optional_filter_${index}`);\n                    }\n                }\n            }\n            return newFilters;\n        });\n    };\n\n    const fetchPropertyValues = async (propertyName, propertySource, filterIdentifier) => {\n        if (!propertyName || !propertySource) return;\n        try {\n            const data = await api.getDiscoverableCohortPropertyValues(propertyName, propertySource);\n            setPropertyValueOptions(prev => ({ ...prev, [filterIdentifier + '_' + propertyName]: data.values || [] }));\n        } catch (err) {\n            console.error(`Error fetching values for ${propertyName}:`, err);\n             setPropertyValueOptions(prev => ({ ...prev, [filterIdentifier + '_' + propertyName]: [] }));\n        }\n    };\n\n    const addOptionalFilter = () => {\n        setFilters(prev => ({\n            ...prev,\n            optional_filters: [...prev.optional_filters, { id: Date.now().toString(), property_name: '', property_values: [], property_source: 'event' }]\n        }));\n    };\n\n    const removeOptionalFilter = (idToRemove) => {\n        setFilters(prev => ({\n            ...prev,\n            optional_filters: prev.optional_filters.filter(f => f.id !== idToRemove)\n        }));\n    };\n\n    const handleSubmit = async (e) => {\n        e.preventDefault();\n        setIsLoading(true);\n        setError(null);\n        setAnalysisResult(null);\n        setUserTimelineData(null);\n        setTimelineError(null);\n        \n        // Reset event revenue timeline state\n        setEventRevenueTimelineData(null);\n        setEventRevenueTimelineError(null);\n        setSelectedUserId('');\n        setSelectedProductId('');\n        \n        // Reset warning state\n        setCohortDefinitionWarning(null);\n        \n        try {\n            // Basic validation\n            if (!filters.date_from_str || !filters.date_to_str) {\n                throw new Error(\"Start Date and End Date are required.\");\n            }\n\n            // Remove the check that requires primary filter when secondary filters exist\n            // We'll allow analysis without a primary filter\n            \n            // Check primary filter has values if property is selected\n            if (filters.optional_filters.length > 0 && filters.optional_filters[0].property_name && filters.optional_filters[0].property_values.length === 0) {\n                throw new Error(\"Please select values for the optional filters or clear the property selection.\");\n            }\n\n            // Validate secondary filters\n            for (const filter of filters.optional_filters) {\n                if (!filter.property_name || filter.property_values.length === 0) {\n                    throw new Error(`Optional filter is incomplete. Please select both property and values for all filters or remove unused ones.`);\n                }\n            }\n\n            // Define precise cohort filtering requirements for the backend\n            // Define precise cohort filtering requirements for the backend\n            // This ensures ONLY users with a trial started event in the specified date range are included\n            const cohortFilters = {\n                ...filters,\n                enforce_trial_started: true, // Add flag to inform backend to enforce trial started requirement\n                cohort_definition: {\n                    required_event: \"RC Trial started\",\n                    date_range: {\n                        from: filters.date_from_str,\n                        to: filters.date_to_str\n                    },\n                    strict_filtering: true // Only include events from users in this cohort\n                }\n            };\n\n            const result = await api.analyzeCohortData(cohortFilters);\n            if (result.error) {\n                setError(result.error);\n            } else {\n                // Verify that the backend properly applied our cohort definition\n                // by checking if trial_started user count matches the total cohort users\n                if (result.cohort_event_occurrence && \n                    result.cohort_event_occurrence.trial_started && \n                    result.summary_stats && \n                    result.summary_stats.total_users_in_final_cohort) {\n                    \n                    const trialStartedUsers = result.cohort_event_occurrence.trial_started.user_count;\n                    const totalCohortUsers = result.summary_stats.total_users_in_final_cohort;\n                    \n                    // The counts should match if cohort definition was applied correctly\n                    if (trialStartedUsers !== totalCohortUsers) {\n                        const warningMessage = \n                            `Warning: Cohort definition may not be correctly applied. ` +\n                            `Cohort users (${totalCohortUsers}) should equal ` +\n                            `trial started users (${trialStartedUsers}).`;\n                        \n                        console.warn(warningMessage);\n                        setCohortDefinitionWarning(warningMessage);\n                    }\n                }\n                \n                setAnalysisResult(result);\n                // Fetch timeline data after successful analysis\n                fetchUserTimeline();\n                // Fetch event revenue timeline data (aggregate mode)\n                fetchEventRevenueTimeline();\n            }\n        } catch (err) {\n            console.error(\"Analysis error:\", err);\n            setError(err.message || \"Analysis failed. Please check that you have selected valid filter criteria.\");\n        }\n        setIsLoading(false);\n    };\n\n    const fetchUserTimeline = async () => {\n        setIsLoadingTimeline(true);\n        try {\n            console.log('[DEBUG] fetchUserTimeline called with filters:', filters);\n            // Use only the basic filters that the unified pipeline expects\n            const timelineData = await api.getCohortUserTimeline(filters);\n            console.log('[DEBUG] fetchUserTimeline response:', timelineData);\n            if (timelineData.error) {\n                console.log('[DEBUG] fetchUserTimeline error:', timelineData.error);\n                setTimelineError(timelineData.error);\n            } else {\n                console.log('[DEBUG] Setting userTimelineData:', timelineData);\n                setUserTimelineData(timelineData);\n            }\n        } catch (err) {\n            console.error(\"Timeline fetch error:\", err);\n            setTimelineError(err.message || \"Could not load user timeline data.\");\n        }\n        setIsLoadingTimeline(false);\n    };\n    \n    const fetchEventRevenueTimeline = async (distinctId = null, productId = null) => {\n        setIsLoadingEventRevenueTimeline(true);\n        setEventRevenueTimelineError(null);\n        \n        try {\n            console.log('[DEBUG] fetchEventRevenueTimeline called with filters:', filters, 'distinctId:', distinctId, 'productId:', productId);\n            // Use only the basic filters that the unified pipeline expects\n            const timelineData = await api.getUserEventRevenueTimeline(filters, distinctId, productId);\n            console.log('[DEBUG] fetchEventRevenueTimeline response:', timelineData);\n            if (timelineData.error) {\n                console.log('[DEBUG] fetchEventRevenueTimeline error:', timelineData.error);\n                setEventRevenueTimelineError(timelineData.error);\n            } else {\n                console.log('[DEBUG] Setting eventRevenueTimelineData:', timelineData);\n                setEventRevenueTimelineData(timelineData);\n                \n                // Update available users and products from the response\n                if (timelineData.available_users) {\n                    setAvailableUsers(timelineData.available_users);\n                }\n                if (timelineData.available_products) {\n                    setAvailableProducts(timelineData.available_products);\n                }\n            }\n        } catch (err) {\n            console.error(\"Event revenue timeline fetch error:\", err);\n            setEventRevenueTimelineError(err.message || \"Could not load event revenue timeline data.\");\n        }\n        setIsLoadingEventRevenueTimeline(false);\n    };\n    \n    // Function to determine cell state based on user's event history\n    // Returns the event state for a day (used for cell background color)\n    const getCellState = (userProductKey, date, eventMap) => {\n        // If this user has no events on this date, return default state\n        if (!eventMap[userProductKey] || !eventMap[userProductKey][date]) {\n            // Look for the most recent event before this date to maintain state\n            let mostRecentEventDate = null;\n            let mostRecentState = 'default';\n            \n            if (eventMap[userProductKey]) {\n                // Find the most recent event before this date\n                for (const eventDate in eventMap[userProductKey]) {\n                    if (eventDate <= date && (!mostRecentEventDate || eventDate > mostRecentEventDate)) {\n                        mostRecentEventDate = eventDate;\n                        // Get the last event of that day which would determine state going forward\n                        const events = eventMap[userProductKey][eventDate];\n                        const lastEvent = events[events.length - 1];\n                        \n                        // Determine the state based on the last event\n                        if (lastEvent.type === 'RC Trial started') {\n                            mostRecentState = 'trial_started';\n                        } else if (lastEvent.type === 'RC Trial converted') {\n                            mostRecentState = 'trial_converted';\n                        } else if (lastEvent.type === 'RC Trial cancelled') {\n                            mostRecentState = 'trial_cancelled';\n                        } else if (lastEvent.type === 'RC Initial purchase') {\n                            mostRecentState = 'trial_converted';  // Use same color as trial converted\n                        } else if (lastEvent.type === 'RC Renewal') {\n                            mostRecentState = 'trial_converted';  // Use same color for renewals\n                        } else if (lastEvent.type === 'RC Cancellation') {\n                            mostRecentState = lastEvent.has_refund ? 'refunded' : 'conversion_cancelled';\n                        }\n                    }\n                }\n            }\n            \n            return mostRecentState;\n        }\n        \n        // Get the first event for this user on this date (which determines cell color)\n        const firstEvent = eventMap[userProductKey][date][0];\n        \n        // Return cell state based on the first event type\n        if (firstEvent.type === 'RC Trial started') {\n            return 'trial_started';\n        } else if (firstEvent.type === 'RC Trial converted') {\n            return 'trial_converted';\n        } else if (firstEvent.type === 'RC Trial cancelled') {\n            return 'trial_cancelled';\n        } else if (firstEvent.type === 'RC Initial purchase') {\n            return 'trial_converted';  // Use same color as trial converted for initial purchase\n        } else if (firstEvent.type === 'RC Renewal') {\n            return 'trial_converted';  // Use same color for renewals\n        } else if (firstEvent.type === 'RC Cancellation') {\n            // If cancellation has refund flag, use refunded color\n            return firstEvent.has_refund ? 'refunded' : 'conversion_cancelled';\n        }\n        \n        return 'default';\n    };\n    \n    // Function to get events for a specific date (returns an array of events)\n    const getEventsForDate = (userProductKey, date, eventMap) => {\n        if (!eventMap[userProductKey] || !eventMap[userProductKey][date]) {\n            return [];\n        }\n        return eventMap[userProductKey][date];\n    };\n\n    const triggerPropertyDiscovery = async () => {\n        setActivePropertyDiscovery(true);\n        setPropertyDiscoveryMessage('Property discovery initiated...');\n        try {\n            const result = await api.triggerCohortPropertyDiscovery(); // Updated API method name\n            setPropertyDiscoveryMessage(result.message + \" Refresh page after a few moments to see updated filter options.\");\n            // Optionally, could poll for completion or auto-refresh discoverable props\n            setTimeout(() => fetchDiscoverableProperties(), 5000); // Re-fetch after a delay\n        } catch (err) {\n             setPropertyDiscoveryMessage('Error triggering discovery: ' + (err.message || 'Unknown error'));\n        }\n        // setActivePropertyDiscovery(false); // Keep message displayed\n    }\n\n    const renderLifecycleTable = (title, ratesData, denominatorKey = \"rate_denominator_count\") => {\n        // Add debugging\n        console.log(`[DEBUG] renderLifecycleTable called for \"${title}\"`);\n        console.log(`[DEBUG] ratesData:`, ratesData);\n        \n        if (!ratesData) {\n            console.log(`[DEBUG] No ratesData for \"${title}\"`);\n            return <p className=\"text-sm text-gray-500 dark:text-gray-300\">Lifecycle rate data not available for {title}.</p>;\n        }\n        \n        // Handle new product-based format\n        const isNewFormat = ratesData.rates_by_product || ratesData.aggregate_rates;\n        console.log(`[DEBUG] isNewFormat: ${isNewFormat} for \"${title}\"`);\n        \n        if (isNewFormat) {\n            const aggregateRates = ratesData.aggregate_rates;\n            const productRates = ratesData.rates_by_product || {};\n            \n            console.log(`[DEBUG] aggregateRates:`, aggregateRates);\n            console.log(`[DEBUG] productRates:`, productRates);\n            \n            if (!aggregateRates || !aggregateRates.rates_by_day || Object.keys(aggregateRates.rates_by_day).length === 0) {\n                console.log(`[DEBUG] No valid aggregateRates for \"${title}\"`);\n                \n                // Show raw data for debugging\n                return (\n                    <div className=\"mb-6 p-4 bg-yellow-50 dark:bg-yellow-900/30 rounded-lg\">\n                        <h4 className=\"text-lg font-semibold text-gray-900 dark:text-white mb-2\">{title} - Debug Info</h4>\n                        <p className=\"text-sm text-gray-600 dark:text-gray-400 mb-2\">Raw data structure (for debugging):</p>\n                        <pre className=\"text-xs bg-gray-100 dark:bg-gray-800 p-2 rounded overflow-x-auto\">\n                            {JSON.stringify(ratesData, null, 2)}\n                        </pre>\n                    </div>\n                );\n            }\n            \n            // Determine which rates to display based on global product selector\n            const displayRates = globalSelectedProduct && productRates[globalSelectedProduct] \n                ? productRates[globalSelectedProduct] \n                : aggregateRates;\n            \n            const ratesByDay = displayRates.rates_by_day;\n            const sortedDays = Object.keys(ratesByDay).map(Number).sort((a, b) => a - b);\n            \n            // Prepare row data for the transposed table\n            const rowData = [\n                {\n                    metric: \"Raw Daily Cancellation %\",\n                    dataKey: \"raw_daily_cancellation_rate\"\n                },\n                {\n                    metric: \"Smoothed Daily Cancellation %\", \n                    dataKey: \"smoothed_daily_cancellation_rate\"\n                },\n                {\n                    metric: \"Raw Cumulative Cancellation %\",\n                    dataKey: \"raw_cumulative_cancellation_rate\"\n                },\n                {\n                    metric: \"Smoothed Cumulative Cancellation %\",\n                    dataKey: \"smoothed_cumulative_cancellation_rate\"\n                },\n                {\n                    metric: \"Raw Daily Refund %\",\n                    dataKey: \"raw_daily_refund_rate\"\n                },\n                {\n                    metric: \"Smoothed Daily Refund %\",\n                    dataKey: \"smoothed_daily_refund_rate\"\n                },\n                {\n                    metric: \"Raw Cumulative Refund %\",\n                    dataKey: \"raw_cumulative_refund_rate\"\n                },\n                {\n                    metric: \"Smoothed Cumulative Refund %\",\n                    dataKey: \"smoothed_cumulative_refund_rate\"\n                }\n            ];\n            \n            return (\n                <div className=\"mb-6\">\n                    <h4 className=\"text-lg font-semibold text-gray-900 dark:text-white mb-4\">{title}</h4>\n                    \n                    {/* Smoothing Information */}\n                    <div className=\"mb-4 p-3 bg-blue-50 dark:bg-blue-900/30 rounded-lg\">\n                        <h5 className=\"font-semibold text-blue-800 dark:text-blue-200 mb-2\">Smoothing Method Information</h5>\n                        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm text-blue-700 dark:text-blue-300\">\n                            <div>\n                                <p><strong>Method:</strong> {displayRates.smoothing_method || 'none'}</p>\n                                <p><strong>Quality:</strong> {displayRates.smoothing_quality || 'N/A'}</p>\n                                <p><strong>Sample Size:</strong> {displayRates.total_sample_size || 0}</p>\n                            </div>\n                            {displayRates.smoothing_details && (\n                                <div>\n                                    <p><strong>Data Characteristics:</strong></p>\n                                    <ul className=\"ml-4 mt-1\">\n                                        {displayRates.smoothing_details.cancellation && (\n                                            <>\n                                                <li>Early Concentration: {displayRates.smoothing_details.cancellation.early_concentration}</li>\n                                                <li>Sparsity: {displayRates.smoothing_details.cancellation.sparsity}</li>\n                                                <li>Max Rate: {displayRates.smoothing_details.cancellation.max_rate}</li>\n                                            </>\n                                        )}\n                                    </ul>\n                                </div>\n                            )}\n                        </div>\n                    </div>\n                    \n                    {/* Transposed Table with Frozen First Column */}\n                    <div className=\"border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden\">\n                        <div className=\"flex\">\n                            {/* Frozen First Column */}\n                            <div className=\"bg-gray-50 dark:bg-gray-800 border-r border-gray-200 dark:border-gray-700\">\n                                <div className=\"px-4 py-3 font-medium text-gray-900 dark:text-white border-b border-gray-200 dark:border-gray-700\">\n                                    Metric\n                                </div>\n                                {rowData.map((row, index) => (\n                                    <div key={index} className={`px-4 py-3 text-sm border-b border-gray-200 dark:border-gray-700 ${\n                                        index % 2 === 0 ? 'bg-white dark:bg-gray-900' : 'bg-gray-50 dark:bg-gray-800'\n                                    } text-gray-900 dark:text-white font-medium`}>\n                                        {row.metric}\n                                    </div>\n                                ))}\n                            </div>\n                            \n                            {/* Scrollable Data Columns */}\n                            <div className=\"flex-1 overflow-x-auto\">\n                                <div className=\"flex\">\n                                    {sortedDays.map((day) => {\n                                        const dayStr = day.toString();\n                                        const dayData = ratesByDay[dayStr];\n                                        \n                                        return (\n                                            <div key={dayStr} className=\"min-w-[100px] border-r border-gray-200 dark:border-gray-700 last:border-r-0\">\n                                                {/* Header */}\n                                                <div className=\"px-4 py-3 bg-gray-50 dark:bg-gray-800 font-medium text-gray-900 dark:text-white text-center border-b border-gray-200 dark:border-gray-700\">\n                                                    Day {day}\n                                                </div>\n                                                \n                                                {/* Data Cells */}\n                                                {rowData.map((row, index) => (\n                                                    <div key={index} className={`px-4 py-3 text-sm text-center border-b border-gray-200 dark:border-gray-700 ${\n                                                        index % 2 === 0 ? 'bg-white dark:bg-gray-900' : 'bg-gray-50 dark:bg-gray-800'\n                                                    } text-gray-500 dark:text-gray-300`}>\n                                                        {dayData ? (dayData[row.dataKey] || 0).toFixed(2) : '0.00'}%\n                                                    </div>\n                                                ))}\n                                            </div>\n                                        );\n                                    })}\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            );\n        }\n        \n        // Fall back to legacy format handling if needed\n        if (!ratesData.rates_by_day || Object.keys(ratesData.rates_by_day).length === 0) {\n            return <p className=\"text-sm text-gray-500 dark:text-gray-300\">No lifecycle rate data available for {title}.</p>;\n        }\n        \n        const sortedDays = Object.keys(ratesData.rates_by_day).map(Number).sort((a, b) => a - b);\n        const ratesDenominator = ratesData[denominatorKey] || 0;\n        \n        // Legacy format with transposed layout\n        const legacyRowData = [\n            { metric: \"Daily Cancel %\", dataKey: \"cancelled_daily_pct\" },\n            { metric: \"Cumulative Cancel %\", dataKey: \"cancelled_cumulative_pct\" },\n            { metric: \"Daily Convert %\", dataKey: \"converted_daily_pct\" },\n            { metric: \"Cumulative Convert %\", dataKey: \"converted_cumulative_pct\" }\n        ];\n        \n        return (\n            <div className=\"mb-6\">\n                <h4 className=\"text-lg font-semibold mb-2 text-gray-900 dark:text-white\">{title}</h4>\n                <p className=\"text-sm text-gray-600 dark:text-gray-400 mb-3\">\n                    Based on {ratesDenominator} users. {ratesData.message}\n                </p>\n                \n                {/* Transposed Legacy Table */}\n                <div className=\"border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden\">\n                    <div className=\"flex\">\n                        {/* Frozen First Column */}\n                        <div className=\"bg-gray-50 dark:bg-gray-800 border-r border-gray-200 dark:border-gray-700\">\n                            <div className=\"px-4 py-3 font-medium text-gray-900 dark:text-white border-b border-gray-200 dark:border-gray-700\">\n                                Metric\n                            </div>\n                            {legacyRowData.map((row, index) => (\n                                <div key={index} className={`px-4 py-3 text-sm border-b border-gray-200 dark:border-gray-700 ${\n                                    index % 2 === 0 ? 'bg-white dark:bg-gray-900' : 'bg-gray-50 dark:bg-gray-800'\n                                } text-gray-900 dark:text-white font-medium`}>\n                                    {row.metric}\n                                </div>\n                            ))}\n                        </div>\n                        \n                        {/* Scrollable Data Columns */}\n                        <div className=\"flex-1 overflow-x-auto\">\n                            <div className=\"flex\">\n                                {sortedDays.map((day) => {\n                                    const dayStr = day.toString();\n                                    const dayData = ratesData.rates_by_day[dayStr];\n                                    \n                                    return (\n                                        <div key={dayStr} className=\"min-w-[100px] border-r border-gray-200 dark:border-gray-700 last:border-r-0\">\n                                            {/* Header */}\n                                            <div className=\"px-4 py-3 bg-gray-50 dark:bg-gray-800 font-medium text-gray-900 dark:text-white text-center border-b border-gray-200 dark:border-gray-700\">\n                                                Day {day}\n                                            </div>\n                                            \n                                            {/* Data Cells */}\n                                            {legacyRowData.map((row, index) => (\n                                                <div key={index} className={`px-4 py-3 text-sm text-center border-b border-gray-200 dark:border-gray-700 ${\n                                                    index % 2 === 0 ? 'bg-white dark:bg-gray-900' : 'bg-gray-50 dark:bg-gray-800'\n                                                } text-gray-500 dark:text-gray-300`}>\n                                                    {dayData ? (dayData[row.dataKey] || 0).toFixed(2) : '0.00'}%\n                                                </div>\n                                            ))}\n                                        </div>\n                                    );\n                                })}\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        );\n    };\n\n    const formatCurrency = (value) => {\n        if (value === null || value === undefined) return \"N/A\";\n        return value.toLocaleString('en-US', { style: 'currency', currency: 'USD' });\n    };\n    \n    // Prepare data for the chart\n    const chartData = analysisResult?.daily_data.map(d => {\n        const actualNetRevenue = d.cumulative_revenue_actual_net || 0;\n        // Dotted line: actual net cumulative revenue + (estimated additional from pending trials) + (net effect of estimated future refunds on actual revenue)\n        // The estimated_future_refunds_on_actual_revenue_amount is an *amount* to be subtracted.\n        const projectedNetRevenue = actualNetRevenue + \n                                    (d.estimated_additional_revenue_from_pending_trials_net_refund || 0) -\n                                    (d.estimated_future_refunds_on_actual_revenue_amount || 0);\n        \n        const trialsStarted = d.daily_trials_started || 0;\n        const trialsConverted = d.daily_trials_converted_actual || 0;\n        const trialsCancelled = d.daily_trials_cancelled_actual || 0;\n        const trialsEnded = trialsConverted + trialsCancelled;\n        const trialsPending = d.daily_trials_started - trialsEnded;\n        \n        return {\n            date: d.date,\n            // Absolute values - Daily\n            daily_trials_started: trialsStarted,\n            daily_trials_ended: trialsEnded,\n            daily_trials_pending: trialsPending,\n            daily_conversions: trialsConverted,\n            daily_conversions_net_refunds: trialsConverted - (d.daily_refund_count_actual || 0),\n            daily_estimated_conversions_net_refunds: trialsConverted - (d.daily_estimated_refunds || 0),\n            daily_refunds: d.daily_refund_count_actual || 0,\n            \n            // Money values - Daily\n            daily_revenue: d.daily_revenue_actual || 0,\n            daily_revenue_net: d.daily_revenue_actual_net || 0,\n            daily_estimated_revenue: d.daily_estimated_revenue || 0,\n            \n            // Absolute values - Cumulative\n            cumulative_trials_started: d.cumulative_trials_started || 0,\n            cumulative_trials_ended: (d.cumulative_trials_converted_actual || 0) + (d.cumulative_trials_cancelled_actual || 0),\n            cumulative_trials_pending: d.cumulative_trials_started - ((d.cumulative_trials_converted_actual || 0) + (d.cumulative_trials_cancelled_actual || 0)),\n            cumulative_conversions: d.cumulative_trials_converted_actual || 0,\n            cumulative_conversions_net_refunds: (d.cumulative_trials_converted_actual || 0) - (d.cumulative_refund_count_actual || 0),\n            cumulative_estimated_conversions_net_refunds: (d.cumulative_trials_converted_actual || 0) - (d.cumulative_estimated_refunds || 0),\n            cumulative_refunds: d.cumulative_refund_count_actual || 0,\n            \n            // Money values - Cumulative\n            cumulative_revenue: d.cumulative_revenue_actual || 0,\n            cumulative_revenue_net: actualNetRevenue,\n            cumulative_estimated_revenue: projectedNetRevenue,\n        };\n    }) || [];\n    \n    const [visibleAbsoluteMetrics, setVisibleAbsoluteMetrics] = useState({\n        daily_trials_started: true,\n        daily_trials_ended: false,\n        daily_trials_pending: false,\n        daily_conversions: true,\n        daily_conversions_net_refunds: false,\n        daily_estimated_conversions_net_refunds: false,\n        daily_refunds: false,\n        cumulative_trials_started: true,\n        cumulative_trials_ended: false,\n        cumulative_trials_pending: false,\n        cumulative_conversions: true,\n        cumulative_conversions_net_refunds: false,\n        cumulative_estimated_conversions_net_refunds: false,\n        cumulative_refunds: false,\n    });\n    \n    const [visibleMoneyMetrics, setVisibleMoneyMetrics] = useState({\n        daily_revenue: true,\n        daily_revenue_net: false,\n        daily_estimated_revenue: false,\n        cumulative_revenue: false,\n        cumulative_revenue_net: true,\n        cumulative_estimated_revenue: true,\n    });\n\n    const toggleAbsoluteMetric = (metricKey) => {\n        setVisibleAbsoluteMetrics(prev => ({...prev, [metricKey]: !prev[metricKey]}));\n    };\n    \n    const toggleMoneyMetric = (metricKey) => {\n        setVisibleMoneyMetrics(prev => ({...prev, [metricKey]: !prev[metricKey]}));\n    };\n\n    // Add this function to determine which styles to use based on dark mode detection\n    const getSelectTheme = () => {\n        const isDarkMode = document.documentElement.classList.contains('dark') || \n                          window.matchMedia('(prefers-color-scheme: dark)').matches;\n        return isDarkMode ? darkModeSelectStyles : customSelectStyles;\n    };\n\n    // Chart Modal Component\n    const ChartModal = () => {\n        if (!showChartModal || !analysisResult?.lifecycle_rates) return null;\n\n        const lifecycleRates = analysisResult.lifecycle_rates;\n        \n        // Get chart data for different scenarios\n        const getChartData = (ratesData, title, type = 'cancellation_refund') => {\n            if (!ratesData?.rates_by_day) return null;\n\n            const days = Object.keys(ratesData.rates_by_day).map(Number).sort((a, b) => a - b);\n            \n            let datasets = [];\n            \n            if (type === 'cancellation_refund') {\n                // Cancellation/Refund scenario\n                datasets = [\n                    {\n                        label: 'Raw Cumulative Cancellation %',\n                        data: days.map(day => ratesData.rates_by_day[day.toString()]?.raw_cumulative_cancellation_rate || 0),\n                        borderColor: 'rgb(255, 99, 132)',\n                        backgroundColor: 'rgba(255, 99, 132, 0.1)',\n                        borderDash: [],\n                        tension: 0.1\n                    },\n                    {\n                        label: 'Smoothed Cumulative Cancellation %',\n                        data: days.map(day => ratesData.rates_by_day[day.toString()]?.smoothed_cumulative_cancellation_rate || 0),\n                        borderColor: 'rgb(255, 99, 132)',\n                        backgroundColor: 'rgba(255, 99, 132, 0.3)',\n                        borderDash: [5, 5],\n                        tension: 0.1\n                    },\n                    {\n                        label: 'Raw Cumulative Refund %',\n                        data: days.map(day => ratesData.rates_by_day[day.toString()]?.raw_cumulative_refund_rate || 0),\n                        borderColor: 'rgb(54, 162, 235)',\n                        backgroundColor: 'rgba(54, 162, 235, 0.1)',\n                        borderDash: [],\n                        tension: 0.1\n                    },\n                    {\n                        label: 'Smoothed Cumulative Refund %',\n                        data: days.map(day => ratesData.rates_by_day[day.toString()]?.smoothed_cumulative_refund_rate || 0),\n                        borderColor: 'rgb(54, 162, 235)',\n                        backgroundColor: 'rgba(54, 162, 235, 0.3)',\n                        borderDash: [5, 5],\n                        tension: 0.1\n                    }\n                ];\n            } else if (type === 'conversion_cancellation') {\n                // Trial Conversion/Cancellation scenario\n                datasets = [\n                    {\n                        label: 'Raw Cumulative Conversion %',\n                        data: days.map(day => ratesData.rates_by_day[day.toString()]?.raw_cumulative_conversion_rate || 0),\n                        borderColor: 'rgb(75, 192, 192)',\n                        backgroundColor: 'rgba(75, 192, 192, 0.1)',\n                        borderDash: [],\n                        tension: 0.1\n                    },\n                    {\n                        label: 'Smoothed Cumulative Conversion %',\n                        data: days.map(day => ratesData.rates_by_day[day.toString()]?.smoothed_cumulative_conversion_rate || 0),\n                        borderColor: 'rgb(75, 192, 192)',\n                        backgroundColor: 'rgba(75, 192, 192, 0.3)',\n                        borderDash: [5, 5],\n                        tension: 0.1\n                    },\n                    {\n                        label: 'Raw Cumulative Cancellation %',\n                        data: days.map(day => ratesData.rates_by_day[day.toString()]?.raw_cumulative_cancellation_rate || 0),\n                        borderColor: 'rgb(255, 99, 132)',\n                        backgroundColor: 'rgba(255, 99, 132, 0.1)',\n                        borderDash: [],\n                        tension: 0.1\n                    },\n                    {\n                        label: 'Smoothed Cumulative Cancellation %',\n                        data: days.map(day => ratesData.rates_by_day[day.toString()]?.smoothed_cumulative_cancellation_rate || 0),\n                        borderColor: 'rgb(255, 99, 132)',\n                        backgroundColor: 'rgba(255, 99, 132, 0.3)',\n                        borderDash: [5, 5],\n                        tension: 0.1\n                    }\n                ];\n            }\n\n            return {\n                labels: days.map(day => `Day ${day}`),\n                datasets: datasets\n            };\n        };\n\n        const chartOptions = {\n            responsive: true,\n            plugins: {\n                legend: {\n                    position: 'top',\n                },\n                title: {\n                    display: true,\n                    text: 'Raw vs Smoothed Cumulative Rates'\n                }\n            },\n            scales: {\n                y: {\n                    beginAtZero: true,\n                    title: {\n                        display: true,\n                        text: 'Percentage (%)'\n                    }\n                },\n                x: {\n                    title: {\n                        display: true,\n                        text: 'Days'\n                    }\n                }\n            }\n        };\n\n        // Determine which rates to use based on global product selector\n        const getDisplayRates = (ratesData) => {\n            if (!ratesData) return null;\n            if (globalSelectedProduct && ratesData.rates_by_product && ratesData.rates_by_product[globalSelectedProduct]) {\n                return ratesData.rates_by_product[globalSelectedProduct];\n            }\n            return ratesData.aggregate_rates || ratesData;\n        };\n\n        const trialToOutcomeRates = getDisplayRates(lifecycleRates.trial_to_outcome_rates);\n        const cancellationRefundRates = getDisplayRates(lifecycleRates.trial_to_cancellation_rates || lifecycleRates.trial_to_refund_rates);\n\n        return (\n            <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\n                <div className=\"bg-white dark:bg-gray-800 rounded-lg max-w-6xl w-full max-h-[90vh] overflow-y-auto\">\n                    <div className=\"p-6\">\n                        <div className=\"flex justify-between items-center mb-6\">\n                            <h2 className=\"text-2xl font-bold text-gray-900 dark:text-white\">\n                                Lifecycle Rate Charts\n                            </h2>\n                            <button\n                                onClick={() => setShowChartModal(false)}\n                                className=\"p-2 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200\"\n                            >\n                                <XCircle size={24} />\n                            </button>\n                        </div>\n\n                        <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n                            {/* Trial to Outcome Chart */}\n                            {trialToOutcomeRates && (\n                                <div className=\"bg-gray-50 dark:bg-gray-700 p-4 rounded-lg\">\n                                    <h3 className=\"text-lg font-semibold mb-4 text-gray-900 dark:text-white\">\n                                        Trial to Outcome (Conversion vs Cancellation)\n                                    </h3>\n                                    <ChartLine \n                                        data={getChartData(trialToOutcomeRates, 'Trial to Outcome', 'conversion_cancellation')}\n                                        options={chartOptions}\n                                    />\n                                </div>\n                            )}\n\n                            {/* Cancellation/Refund Chart */}\n                            {cancellationRefundRates && (\n                                <div className=\"bg-gray-50 dark:bg-gray-700 p-4 rounded-lg\">\n                                    <h3 className=\"text-lg font-semibold mb-4 text-gray-900 dark:text-white\">\n                                        Cancellation vs Refund Rates\n                                    </h3>\n                                    <ChartLine \n                                        data={getChartData(cancellationRefundRates, 'Cancellation vs Refund', 'cancellation_refund')}\n                                        options={chartOptions}\n                                    />\n                                </div>\n                            )}\n                        </div>\n\n                        <div className=\"mt-6 text-sm text-gray-600 dark:text-gray-400\">\n                            <p><strong>Legend:</strong></p>\n                            <ul className=\"list-disc list-inside mt-2\">\n                                <li>Solid lines represent raw data</li>\n                                <li>Dashed lines represent smoothed curves</li>\n                                <li>The smoothing algorithm first smooths cumulative rates, then derives daily rates</li>\n                            </ul>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        );\n    };\n\n    return (\n        <div className=\"p-6 max-w-full mx-auto bg-white dark:bg-gray-800 min-h-screen\">\n            <h1 className=\"text-3xl font-bold mb-6 text-gray-800 dark:text-white border-b pb-2 border-gray-200 dark:border-gray-600\">Cohort Analyzer</h1>\n\n            {isInitializing ? (\n                <div className=\"flex items-center justify-center p-8 bg-white dark:bg-gray-700 rounded-lg shadow-md\">\n                    <Loader className=\"animate-spin mr-2 text-indigo-600 dark:text-indigo-400\" />\n                    <p className=\"text-gray-700 dark:text-white\">Initializing cohort analyzer...</p>\n                </div>\n            ) : (\n                <form onSubmit={handleSubmit} className=\"bg-white dark:bg-gray-700 p-6 rounded-lg shadow-md mb-8\">\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6 border-b border-gray-200 dark:border-gray-600 pb-6\">\n                        <div>\n                            <label htmlFor=\"date_from_str\" className=\"block text-sm font-medium text-gray-700 dark:text-white mb-2\">Start Date *</label>\n                            <input type=\"date\" id=\"date_from_str\" value={filters.date_from_str} onChange={e => handleFilterChange('date_from_str', e.target.value)}\n                                className=\"mt-1 block w-full p-2.5 border border-gray-300 dark:border-gray-500 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm bg-white dark:bg-gray-600 text-gray-900 dark:text-white\" required />\n                        </div>\n                        <div>\n                            <label htmlFor=\"date_to_str\" className=\"block text-sm font-medium text-gray-700 dark:text-white mb-2\">End Date *</label>\n                            <input type=\"date\" id=\"date_to_str\" value={filters.date_to_str} onChange={e => handleFilterChange('date_to_str', e.target.value)}\n                                className=\"mt-1 block w-full p-2.5 border border-gray-300 dark:border-gray-500 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm bg-white dark:bg-gray-600 text-gray-900 dark:text-white\" required />\n                        </div>\n                    </div>\n\n                    {/* Optional Filters Section */}\n                    <div className=\"mb-6 p-5 border rounded-md border-teal-200 dark:border-teal-500 bg-teal-50 dark:bg-teal-900/40\">\n                        <div className=\"flex justify-between items-center mb-3\">\n                            <h3 className=\"text-lg font-semibold text-gray-800 dark:text-white\">Additional Event/User Property Filters</h3>\n                            <button \n                                type=\"button\" \n                                onClick={addOptionalFilter}\n                                className=\"p-1.5 bg-teal-100 dark:bg-teal-600 text-teal-700 dark:text-white rounded-full hover:bg-teal-200 dark:hover:bg-teal-500 transition-colors\"\n                            >\n                                <PlusCircle size={18} />\n                            </button>\n                        </div>\n                        {filters.optional_filters.length === 0 && (\n                            <p className=\"text-sm text-gray-600 dark:text-gray-300 italic mb-2\">No additional filters. Click the + button to add a filter.</p>\n                        )}\n                        {filters.optional_filters.map((filter, index) => (\n                            <div key={filter.id} className=\"grid grid-cols-1 md:grid-cols-4 gap-3 items-end mb-4 p-4 border-t dark:border-gray-600 bg-white dark:bg-gray-600 rounded-md shadow-sm\">\n                                <div>\n                                    <label className=\"block text-xs font-medium text-gray-600 dark:text-white mb-1\">Source Type</label>\n                                    <select value={filter.property_source}\n                                            onChange={e => handleFilterChange(`optional_filter_source`, e.target.value, index)}\n                                            className=\"block w-full p-2 border border-gray-300 dark:border-gray-500 rounded-md shadow-sm focus:ring-teal-500 focus:border-teal-500 sm:text-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-white\">\n                                        <option value=\"event\">Event Property</option>\n                                        <option value=\"user\">User Property</option>\n                                    </select>\n                                </div>\n                                <div>\n                                    <label className=\"block text-xs font-medium text-gray-600 dark:text-white mb-1\">Property Name</label>\n                                    <select value={filter.property_name}\n                                            onChange={e => handleFilterChange(`optional_filter_property`, e.target.value, index)}\n                                            className=\"block w-full p-2 border border-gray-300 dark:border-gray-500 rounded-md shadow-sm focus:ring-teal-500 focus:border-teal-500 sm:text-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-white\">\n                                        <option value=\"\">-- Select Property --</option>\n                                        {(filter.property_source === 'event' ? availableEventProperties : availableUserProperties).map(p => <option key={p.key} value={p.key}>{p.display_name || p.key}</option>)}\n                                    </select>\n                                </div>\n                                <div>\n                                    <label className=\"block text-xs font-medium text-gray-600 dark:text-white mb-1\">Property Value(s)</label>\n                                    <Select\n                                        isMulti\n                                        isDisabled={!filter.property_name || !filter.property_source}\n                                        options={(propertyValueOptions[`optional_filter_${index}_` + filter.property_name] || []).map(val => ({ value: val, label: val }))}\n                                        value={filter.property_values.map(val => ({ value: val, label: val }))}\n                                        onChange={(selected) => handleFilterChange(`optional_filter_values`, selected ? selected.map(option => option.value) : [], index)}\n                                        styles={getSelectTheme()}\n                                        placeholder=\"Select values...\"\n                                    />\n                                </div>\n                                <div className=\"flex justify-end\">\n                                    <button type=\"button\" onClick={() => removeOptionalFilter(filter.id)}\n                                            className=\"p-1.5 bg-red-100 dark:bg-red-700 text-red-600 dark:text-white rounded-full hover:bg-red-200 dark:hover:bg-red-600 transition-colors\">\n                                        <XCircle size={18} />\n                                    </button>\n                                </div>\n                            </div>\n                        ))}\n                    </div>\n\n                    <div className=\"flex items-center justify-between mt-8\">\n                        <button type=\"submit\" disabled={isLoading}\n                                className=\"px-6 py-2.5 bg-indigo-600 text-white font-semibold rounded-md shadow hover:bg-indigo-700 disabled:opacity-50 flex items-center transition-colors\">\n                            {isLoading ? (\n                                <>\n                                    <Loader className=\"animate-spin mr-2\" size={16} />\n                                    Analyzing...\n                                </>\n                            ) : 'Analyze Cohort'}\n                        </button>\n                        <button type=\"button\" onClick={triggerPropertyDiscovery} disabled={activePropertyDiscovery}\n                                className=\"px-5 py-2.5 bg-teal-600 text-white text-sm font-medium rounded-md hover:bg-teal-700 disabled:opacity-50 flex items-center transition-colors\">\n                            {activePropertyDiscovery ? (\n                                <>\n                                    <Loader className=\"animate-spin mr-2\" size={16} />\n                                    Discovery Running...\n                                </>\n                            ) : \"Discover Filter Properties\"}\n                        </button>\n                    </div>\n                    {propertyDiscoveryMessage && (\n                        <div className=\"mt-3 p-3 bg-teal-50 dark:bg-teal-900/40 border border-teal-200 dark:border-teal-600 rounded-md\">\n                            <p className=\"text-sm text-teal-700 dark:text-teal-300\">{propertyDiscoveryMessage}</p>\n                        </div>\n                    )}\n                </form>\n            )}\n\n            {error && (\n                <div className=\"my-4 p-4 bg-red-100 dark:bg-red-800 text-red-700 dark:text-white rounded-md shadow-md border border-red-300 dark:border-red-600\">\n                    <div className=\"flex items-center\">\n                        <AlertTriangle className=\"mr-2 flex-shrink-0\" />\n                        <div>\n                            <span className=\"font-medium block\">Analysis Error:</span>\n                            <span className=\"block mt-1\">{error}</span>\n                        </div>\n                    </div>\n                </div>\n            )}\n            \n            {cohortDefinitionWarning && (\n                <div className=\"my-4 p-4 bg-yellow-100 dark:bg-yellow-800 text-yellow-700 dark:text-white rounded-md shadow-md border border-yellow-300 dark:border-yellow-600\">\n                    <div className=\"flex items-center\">\n                        <AlertTriangle className=\"mr-2 flex-shrink-0\" />\n                        <div>\n                            <span className=\"font-medium block\">Cohort Definition Warning:</span>\n                            <span className=\"block mt-1\">{cohortDefinitionWarning}</span>\n                            <span className=\"block mt-1 text-sm italic\">The backend may not be correctly filtering users based on trial started events.</span>\n                        </div>\n                    </div>\n                </div>\n            )}\n\n            {analysisResult && (\n                <div className=\"mt-8 bg-white dark:bg-gray-700 p-6 rounded-lg shadow-md\">\n                    <h2 className=\"text-2xl font-bold mb-4 text-gray-800 dark:text-white\">Analysis Results</h2>\n                    \n                    {/* Add the filter stats display component */}\n                    {analysisResult.filter_stats && (\n                        <FilterStatsDisplay filterStats={analysisResult.filter_stats} />\n                    )}\n                    \n                    <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6\">\n                        <div className=\"p-4 bg-gray-50 dark:bg-gray-600 rounded-md\">\n                            <h3 className=\"font-semibold text-gray-700 dark:text-white\">Cohort Users (Trial Started)</h3>\n                            <p className=\"text-2xl font-bold text-indigo-600 dark:text-indigo-300\">{analysisResult.summary_stats?.total_users_in_final_cohort || 0}</p>\n                            <p className=\"text-xs text-gray-500 dark:text-gray-300\">Unique users who had an 'RC Trial started' event in the selected date range (and match primary filter if applied).</p>\n                        </div>\n                        <div className=\"p-4 bg-gray-50 dark:bg-gray-600 rounded-md\">\n                            <h3 className=\"font-semibold text-gray-700 dark:text-white\">Events Analyzed (Cohort Only)</h3>\n                            <p className=\"text-2xl font-bold text-indigo-600 dark:text-indigo-300\">{analysisResult.summary_stats?.total_events_analyzed || 0}</p>\n                            <p className=\"text-xs text-gray-500 dark:text-gray-300\">Events from users in the trial started cohort</p>\n                        </div>\n                        <div className=\"p-4 bg-gray-50 dark:bg-gray-600 rounded-md\">\n                            <h3 className=\"font-semibold text-gray-700 dark:text-white\">Cohort ARPC (Overall)</h3>\n                            <p className=\"text-2xl font-bold text-indigo-600 dark:text-indigo-300\">{formatCurrency(analysisResult.summary_stats?.arpc_cohort)}</p>\n                            <p className=\"text-xs text-gray-500 dark:text-gray-300\">Basis: {analysisResult.summary_stats?.arpc_datapoints} users. {analysisResult.summary_stats?.arpc_calculation_basis}</p>\n                            <p className=\"text-xs text-gray-500 dark:text-gray-300 italic\">See per-product breakdown below</p>\n                        </div>\n                    </div>\n\n                    {/* Per-Product ARPC Breakdown - REDESIGNED FOR COMPACTNESS */}\n                    {eventRevenueTimelineData && eventRevenueTimelineData.arpc_per_product && Object.keys(eventRevenueTimelineData.arpc_per_product).length > 0 && (\n                        <div className=\"mb-6\">\n                            <h3 className=\"font-semibold text-gray-700 dark:text-white mb-3\">ARPC Per Product</h3>\n                            <div className=\"bg-gray-50 dark:bg-gray-600 rounded-lg p-3\">\n                                <div className=\"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-3\">\n                                    {Object.entries(eventRevenueTimelineData.arpc_per_product).map(([productId, arpcData]) => (\n                                        <div key={productId} className=\"bg-white dark:bg-gray-700 rounded-md p-3 border border-gray-200 dark:border-gray-600\">\n                                            <div className=\"text-xs font-medium text-gray-600 dark:text-gray-300 truncate\" title={productId}>\n                                                {productId}\n                                            </div>\n                                            <div className=\"text-lg font-bold text-green-600 dark:text-green-400 leading-tight\">\n                                                {typeof arpcData === 'object' ? formatCurrency(arpcData.arpc) : formatCurrency(arpcData)}\n                                            </div>\n                                            {typeof arpcData === 'object' && (\n                                                <div className=\"text-xs text-gray-500 dark:text-gray-400 mt-1 space-y-0.5\">\n                                                    <div>{arpcData.event_count} events</div>\n                                                    <div>{arpcData.unique_users} users</div>\n                                                    <div className=\"font-medium\">{formatCurrency(arpcData.total_revenue)}</div>\n                                                </div>\n                                            )}\n                                        </div>\n                                    ))}\n                                </div>\n                            </div>\n                        </div>\n                    )}\n\n                    {analysisResult.event_user_counts && (\n                        <div className=\"mb-6\">\n                            <h3 className=\"font-semibold text-gray-700 dark:text-white mb-3\">Unique Users Per Event Type</h3>\n                            <div className=\"overflow-x-auto\">\n                                <table className=\"min-w-full text-sm border dark:border-gray-600\">\n                                    <thead className=\"bg-gray-50 dark:bg-gray-700\">\n                                        <tr>\n                                            <th className=\"p-2 border-b dark:border-gray-600 text-left text-gray-700 dark:text-white\">Event Type</th>\n                                            <th className=\"p-2 border-b dark:border-gray-600 text-left text-gray-700 dark:text-white\">Unique Users</th>\n                                            <th className=\"p-2 border-b dark:border-gray-600 text-left text-gray-700 dark:text-white\">Total Events</th>\n                                            <th className=\"p-2 border-b dark:border-gray-600 text-left text-gray-700 dark:text-white\">Events Per User</th>\n                                        </tr>\n                                    </thead>\n                                    <tbody className=\"bg-white dark:bg-gray-800\">\n                                        {Object.entries(analysisResult.event_user_counts).map(([eventType, counts], index) => (\n                                            <tr key={eventType} className={index % 2 === 0 ? '' : 'bg-gray-50 dark:bg-gray-700'}>\n                                                <td className=\"p-2 border-b dark:border-gray-600 font-medium text-gray-700 dark:text-gray-300\">{eventType}</td>\n                                                <td className=\"p-2 border-b dark:border-gray-600 text-gray-700 dark:text-gray-300\">{counts.unique_users || 0}</td>\n                                                <td className=\"p-2 border-b dark:border-gray-600 text-gray-700 dark:text-gray-300\">{counts.total_events || 0}</td>\n                                                <td className=\"p-2 border-b dark:border-gray-600 text-gray-700 dark:text-gray-300\">\n                                                    {counts.unique_users > 0 ? (counts.total_events / counts.unique_users).toFixed(2) : '0.00'}\n                                                </td>\n                                            </tr>\n                                        ))}\n                                    </tbody>\n                                </table>\n                            </div>\n                        </div>\n                    )}\n\n                    {/* Cohort Event Occurrence Table */}\n                    {analysisResult.cohort_event_occurrence && (\n                        <div className=\"mb-6\">\n                            <h3 className=\"font-semibold text-gray-700 dark:text-white mb-3\">Cohort Event Occurrence</h3>\n                            <p className=\"text-sm text-gray-600 dark:text-gray-300 mb-2\">\n                                Number of users in the cohort who have had each event at least once. \n                                <span className=\"italic\"> Note: Cohort is defined as users in the database who have a \"Trial started\" event within the selected date range. All other users are excluded.</span>\n                            </p>\n                            <div className=\"overflow-x-auto\">\n                                <table className=\"min-w-full text-sm border dark:border-gray-600\">\n                                    <thead className=\"bg-gray-50 dark:bg-gray-700\">\n                                        <tr>\n                                            <th className=\"p-2 border-b dark:border-gray-600 text-left text-gray-700 dark:text-white\">Event</th>\n                                            <th className=\"p-2 border-b dark:border-gray-600 text-left text-gray-700 dark:text-white\">User Count</th>\n                                            <th className=\"p-2 border-b dark:border-gray-600 text-left text-gray-700 dark:text-white\">% of Cohort</th>\n                                        </tr>\n                                    </thead>\n                                    <tbody className=\"bg-white dark:bg-gray-800\">\n                                        {/* Trial Started */}\n                                        <tr className=\"bg-indigo-50 dark:bg-indigo-900/30\">\n                                            <td className=\"p-2 border-b dark:border-gray-600 font-medium text-gray-700 dark:text-white\">Trial Started</td>\n                                            <td className=\"p-2 border-b dark:border-gray-600 text-gray-700 dark:text-gray-300\">\n                                                {analysisResult.cohort_event_occurrence.trial_started?.user_count?.toLocaleString() || '0'}\n                                            </td>\n                                            <td className=\"p-2 border-b dark:border-gray-600 text-gray-700 dark:text-gray-300\">\n                                                100%\n                                            </td>\n                                        </tr>\n                                        \n                                        {/* Trial Ended */}\n                                        <tr>\n                                            <td className=\"p-2 border-b dark:border-gray-600 font-medium text-gray-700 dark:text-gray-300\">Trial Ended (Total)</td>\n                                            <td className=\"p-2 border-b dark:border-gray-600 text-gray-700 dark:text-gray-300\">\n                                                {analysisResult.cohort_event_occurrence.trial_ended?.user_count?.toLocaleString() || '0'}\n                                            </td>\n                                            <td className=\"p-2 border-b dark:border-gray-600 text-gray-700 dark:text-gray-300\">\n                                                {analysisResult.cohort_event_occurrence.trial_ended?.percentage ? \n                                                    analysisResult.cohort_event_occurrence.trial_ended.percentage.toFixed(1) + '%' : '0%'}\n                                            </td>\n                                        </tr>\n                                        \n                                        {/* Trial Converted */}\n                                        <tr className=\"bg-gray-50 dark:bg-gray-700 pl-4\">\n                                            <td className=\"p-2 border-b dark:border-gray-600 pl-8 text-gray-700 dark:text-gray-300\">→ Trial Converted</td>\n                                            <td className=\"p-2 border-b dark:border-gray-600 text-gray-700 dark:text-gray-300\">\n                                                {analysisResult.cohort_event_occurrence.trial_converted?.user_count?.toLocaleString() || '0'}\n                                            </td>\n                                            <td className=\"p-2 border-b dark:border-gray-600 text-gray-700 dark:text-gray-300\">\n                                                {analysisResult.cohort_event_occurrence.trial_converted?.percentage ? \n                                                    analysisResult.cohort_event_occurrence.trial_converted.percentage.toFixed(1) + '%' : '0%'}\n                                            </td>\n                                        </tr>\n                                        \n                                        {/* Trial Cancelled */}\n                                        <tr className=\"bg-gray-50 dark:bg-gray-700\">\n                                            <td className=\"p-2 border-b dark:border-gray-600 pl-8 text-gray-700 dark:text-gray-300\">→ Trial Cancelled</td>\n                                            <td className=\"p-2 border-b dark:border-gray-600 text-gray-700 dark:text-gray-300\">\n                                                {analysisResult.cohort_event_occurrence.trial_cancelled?.user_count?.toLocaleString() || '0'}\n                                            </td>\n                                            <td className=\"p-2 border-b dark:border-gray-600 text-gray-700 dark:text-gray-300\">\n                                                {analysisResult.cohort_event_occurrence.trial_cancelled?.percentage ? \n                                                    analysisResult.cohort_event_occurrence.trial_cancelled.percentage.toFixed(1) + '%' : '0%'}\n                                            </td>\n                                        </tr>\n                                        \n                                        {/* Initial Purchase */}\n                                        <tr>\n                                            <td className=\"p-2 border-b dark:border-gray-600 font-medium text-gray-700 dark:text-gray-300\">Initial Purchase</td>\n                                            <td className=\"p-2 border-b dark:border-gray-600 text-gray-700 dark:text-gray-300\">\n                                                {analysisResult.cohort_event_occurrence.initial_purchase?.user_count?.toLocaleString() || '0'}\n                                            </td>\n                                            <td className=\"p-2 border-b dark:border-gray-600 text-gray-700 dark:text-gray-300\">\n                                                {analysisResult.cohort_event_occurrence.initial_purchase?.percentage ? \n                                                    analysisResult.cohort_event_occurrence.initial_purchase.percentage.toFixed(1) + '%' : '0%'}\n                                            </td>\n                                        </tr>\n                                        \n                                        {/* Renewal */}\n                                        <tr className=\"bg-gray-50 dark:bg-gray-700\">\n                                            <td className=\"p-2 border-b dark:border-gray-600 font-medium text-gray-700 dark:text-gray-300\">Renewal</td>\n                                            <td className=\"p-2 border-b dark:border-gray-600 text-gray-700 dark:text-gray-300\">\n                                                {analysisResult.cohort_event_occurrence.renewal?.user_count?.toLocaleString() || '0'}\n                                            </td>\n                                            <td className=\"p-2 border-b dark:border-gray-600 text-gray-700 dark:text-gray-300\">\n                                                {analysisResult.cohort_event_occurrence.renewal?.percentage ? \n                                                    analysisResult.cohort_event_occurrence.renewal.percentage.toFixed(1) + '%' : '0%'}\n                                            </td>\n                                        </tr>\n                                        \n                                        {/* RC Cancellation */}\n                                        <tr>\n                                            <td className=\"p-2 border-b dark:border-gray-600 font-medium text-gray-700 dark:text-gray-300\">RC Cancellation (Total)</td>\n                                            <td className=\"p-2 border-b dark:border-gray-600 text-gray-700 dark:text-gray-300\">\n                                                {analysisResult.cohort_event_occurrence.rc_cancellation?.user_count?.toLocaleString() || '0'}\n                                            </td>\n                                            <td className=\"p-2 border-b dark:border-gray-600 text-gray-700 dark:text-gray-300\">\n                                                {analysisResult.cohort_event_occurrence.rc_cancellation?.percentage ? \n                                                    analysisResult.cohort_event_occurrence.rc_cancellation.percentage.toFixed(1) + '%' : '0%'}\n                                            </td>\n                                        </tr>\n                                        \n                                        {/* RC Refund (revenue < 0) */}\n                                        <tr className=\"bg-gray-50 dark:bg-gray-700\">\n                                            <td className=\"p-2 border-b dark:border-gray-600 pl-8 text-gray-700 dark:text-gray-300\">→ Refund (revenue &lt; 0)</td>\n                                            <td className=\"p-2 border-b dark:border-gray-600 text-gray-700 dark:text-gray-300\">\n                                                {analysisResult.cohort_event_occurrence.rc_refund?.user_count?.toLocaleString() || '0'}\n                                            </td>\n                                            <td className=\"p-2 border-b dark:border-gray-600 text-gray-700 dark:text-gray-300\">\n                                                {analysisResult.cohort_event_occurrence.rc_refund?.percentage ? \n                                                    analysisResult.cohort_event_occurrence.rc_refund.percentage.toFixed(1) + '%' : '0%'}\n                                            </td>\n                                        </tr>\n                                        \n                                        {/* RC Cancelled (revenue = 0) */}\n                                        <tr className=\"bg-gray-50 dark:bg-gray-700\">\n                                            <td className=\"p-2 border-b dark:border-gray-600 pl-8 text-gray-700 dark:text-gray-300\">→ Cancelled (revenue = 0)</td>\n                                            <td className=\"p-2 border-b dark:border-gray-600 text-gray-700 dark:text-gray-300\">\n                                                {analysisResult.cohort_event_occurrence.rc_cancel_no_refund?.user_count?.toLocaleString() || '0'}\n                                            </td>\n                                            <td className=\"p-2 border-b dark:border-gray-600 text-gray-700 dark:text-gray-300\">\n                                                {analysisResult.cohort_event_occurrence.rc_cancel_no_refund?.percentage ? \n                                                    analysisResult.cohort_event_occurrence.rc_cancel_no_refund.percentage.toFixed(1) + '%' : '0%'}\n                                            </td>\n                                        </tr>\n                                    </tbody>\n                                </table>\n                            </div>\n                        </div>\n                    )}\n\n                    <div className=\"mb-4\">\n                        <button onClick={() => setShowLifecycleTables(!showLifecycleTables)}\n                                className=\"text-indigo-600 dark:text-indigo-300 hover:underline text-sm mb-2\">\n                            {showLifecycleTables ? <ChevronDown className=\"inline mr-1\" size={16}/> : <ChevronRight className=\"inline mr-1\" size={16}/>}\n                            Show/Hide Lifecycle Rate Tables\n                        </button>\n                        {/* DEBUG: Moved outside JSX */}\n                        {(() => {\n                            console.log('[DEBUG] showLifecycleTables:', showLifecycleTables, 'lifecycle_rates exists:', !!analysisResult?.lifecycle_rates);\n                            if (showLifecycleTables && analysisResult?.lifecycle_rates) {\n                                console.log('[DEBUG] Lifecycle tables section should render!', analysisResult.lifecycle_rates);\n                                console.log('[DEBUG] Available lifecycle rate keys:', Object.keys(analysisResult.lifecycle_rates));\n                            }\n                            return null;\n                        })()}\n                    </div>\n\n                    {/* Fixed: Replaced IIFE with direct conditional rendering */}\n                    {showLifecycleTables && analysisResult?.lifecycle_rates && (\n                        <div className=\"space-y-6 mb-8 p-4 border-t dark:border-gray-600\">\n                            {/* System Information Banner */}\n                            <div className=\"mb-6 p-4 bg-blue-50 dark:bg-blue-900/30 rounded-lg border border-blue-200 dark:border-blue-700\">\n                                <h3 className=\"text-lg font-semibold text-blue-800 dark:text-blue-200 mb-3\">\n                                    Enhanced Product-Based Lifecycle Analysis System\n                                </h3>\n                                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm text-blue-700 dark:text-blue-300\">\n                                    <div>\n                                        <h4 className=\"font-semibold mb-2\">Key Improvements:</h4>\n                                        <ul className=\"list-disc ml-5 space-y-1\">\n                                            <li><strong>Fixed Cumulative Calculation:</strong> Now shows actual percentage of cohort that performs action, not forced 100%</li>\n                                            <li><strong>Product-Level Granularity:</strong> Analyze lifecycle patterns per product ID</li>\n                                            <li><strong>Intelligent Smoothing:</strong> Adaptive smoothing that handles high-early, low-later patterns effectively</li>\n                                            <li><strong>Extended Lookback:</strong> Automatically extends lookback 30-60 days when sample size &lt; 100</li>\n                                        </ul>\n                                    </div>\n                                    <div>\n                                        <h4 className=\"font-semibold mb-2\">Metrics Displayed:</h4>\n                                        <ul className=\"list-disc ml-5 space-y-1\">\n                                            <li><strong>Raw Daily Rates:</strong> Actual percentage of cohort performing action on specific day</li>\n                                            <li><strong>Smoothed Daily Rates:</strong> Algorithm-enhanced rates accounting for data sparsity</li>\n                                            <li><strong>Cumulative Rates:</strong> Total percentage who have performed action by day X (using smoothed data)</li>\n                                            <li><strong>Separate Tracking:</strong> 14 days for refunds, 400 days for cancellations</li>\n                                        </ul>\n                                    </div>\n                                </div>\n                            </div>\n\n                            {/* Global Product Selector for Lifecycle Tables */}\n                            {(() => {\n                                // Get all available product IDs from lifecycle rates\n                                const allAvailableProducts = new Set();\n                                const lifecycleRates = analysisResult.lifecycle_rates || {};\n                                \n                                Object.values(lifecycleRates).forEach(rateData => {\n                                    if (rateData && rateData.rates_by_product) {\n                                        Object.keys(rateData.rates_by_product).forEach(productId => {\n                                            allAvailableProducts.add(productId);\n                                        });\n                                    }\n                                });\n                                \n                                const productList = Array.from(allAvailableProducts).sort();\n                                \n                                if (productList.length > 0) {\n                                    return (\n                                        <div className=\"mb-6 p-4 bg-green-50 dark:bg-green-900/30 rounded-lg border border-green-200 dark:border-green-700\">\n                                            <div className=\"flex items-center justify-between\">\n                                                <div>\n                                                    <h4 className=\"font-semibold text-green-800 dark:text-green-200 mb-1\">Product Analysis Filter</h4>\n                                                    <p className=\"text-sm text-green-700 dark:text-green-300\">\n                                                        Select a specific product to analyze, or view aggregate data across all products.\n                                                    </p>\n                                                </div>\n                                                <div className=\"flex items-center space-x-3\">\n                                                    <label className=\"text-sm font-medium text-green-700 dark:text-green-300\">\n                                                        Product:\n                                                    </label>\n                                                    <select \n                                                        value={globalSelectedProduct}\n                                                        onChange={(e) => setGlobalSelectedProduct(e.target.value)}\n                                                        className=\"px-4 py-2 border border-green-300 dark:border-green-600 rounded-md text-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-green-500 focus:border-green-500\"\n                                                    >\n                                                        <option value=\"\">All Products (Aggregate)</option>\n                                                        {productList.map(productId => (\n                                                            <option key={productId} value={productId}>\n                                                                Product {productId}\n                                                            </option>\n                                                        ))}\n                                                    </select>\n                                                    <button\n                                                        onClick={() => setShowChartModal(true)}\n                                                        className=\"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white text-sm rounded-md transition-colors duration-200 flex items-center space-x-2\"\n                                                    >\n                                                        <span>📊</span>\n                                                        <span>View Charts</span>\n                                                    </button>\n                                                </div>\n                                            </div>\n                                        </div>\n                                    );\n                                }\n                                return null;\n                            })()}\n\n                            {/* Lifecycle Rate Tables */}\n                            <div className=\"space-y-8\">\n                                {/* Trial Conversion to Cancellation/Refund */}\n                                {analysisResult.lifecycle_rates.trial_to_cancellation_rates && (\n                                    renderLifecycleTable(\"Trial Converted -> Cancellation Rates\", analysisResult.lifecycle_rates.trial_to_cancellation_rates)\n                                )}\n                                \n                                {analysisResult.lifecycle_rates.trial_to_refund_rates && (\n                                    renderLifecycleTable(\"Trial Converted -> Refund Rates\", analysisResult.lifecycle_rates.trial_to_refund_rates)\n                                )}\n                                \n                                {/* Initial Purchase to Cancellation/Refund */}\n                                {analysisResult.lifecycle_rates.initial_purchase_to_cancellation_rates && (\n                                    renderLifecycleTable(\"Initial Purchase -> Cancellation Rates\", analysisResult.lifecycle_rates.initial_purchase_to_cancellation_rates)\n                                )}\n                                \n                                {analysisResult.lifecycle_rates.initial_purchase_to_refund_rates && (\n                                    renderLifecycleTable(\"Initial Purchase -> Refund Rates\", analysisResult.lifecycle_rates.initial_purchase_to_refund_rates)\n                                )}\n                                \n                                {/* Renewal to Cancellation/Refund */}\n                                {analysisResult.lifecycle_rates.renewal_to_cancellation_rates && (\n                                    renderLifecycleTable(\"Renewal -> Cancellation Rates\", analysisResult.lifecycle_rates.renewal_to_cancellation_rates)\n                                )}\n                                \n                                {analysisResult.lifecycle_rates.renewal_to_refund_rates && (\n                                    renderLifecycleTable(\"Renewal -> Refund Rates\", analysisResult.lifecycle_rates.renewal_to_refund_rates)\n                                )}\n                                \n                                {/* Legacy format support */}\n                                {analysisResult.lifecycle_rates.trial_to_outcome_rates && (\n                                    renderLifecycleTable(\"Trial to Outcome Rates\", analysisResult.lifecycle_rates.trial_to_outcome_rates)\n                                )}\n                            </div>\n                        </div>\n                    )}\n\n                    <h3 className=\"text-xl font-semibold mb-3 text-gray-700 dark:text-white\">Daily Performance Charts</h3>\n                    \n                    {/* Absolute Values Chart */}\n                    <div className=\"mb-6\">\n                        <h4 className=\"font-semibold text-gray-700 dark:text-white mb-2\">Absolute Values</h4>\n                        <div className=\"mb-4 flex flex-wrap gap-2\">\n                            {Object.keys(visibleAbsoluteMetrics).map(key => (\n                                <button key={key} onClick={() => toggleAbsoluteMetric(key)}\n                                        className={`px-3 py-1 text-xs rounded-full ${visibleAbsoluteMetrics[key] ? 'bg-blue-500 text-white' : 'bg-gray-200 dark:bg-gray-600 text-gray-700 dark:text-white'}`}>\n                                    {key.split('_').join(' ')}\n                                </button>\n                            ))}\n                        </div>\n                        <div className=\"h-80 w-full mb-8 bg-gray-50 dark:bg-gray-700 p-4 rounded-lg\">\n                            <ResponsiveContainer width=\"100%\" height=\"100%\">\n                                <LineChart data={chartData} margin={{ top: 5, right: 30, left: 20, bottom: 5 }}>\n                                    <CartesianGrid strokeDasharray=\"3 3\" />\n                                    <XAxis dataKey=\"date\" />\n                                    <YAxis />\n                                    <Tooltip formatter={(value) => typeof value === 'number' ? value.toLocaleString() : value} />\n                                    <ChartLegend />\n                                    \n                                    {/* Daily metrics */}\n                                    {visibleAbsoluteMetrics.daily_trials_started && (\n                                        <Line type=\"monotone\" dataKey=\"daily_trials_started\" stroke=\"#8884d8\" name=\"Daily Trials Started\" />\n                                    )}\n                                    {visibleAbsoluteMetrics.daily_trials_ended && (\n                                        <Line type=\"monotone\" dataKey=\"daily_trials_ended\" stroke=\"#82ca9d\" name=\"Daily Trials Ended\" />\n                                    )}\n                                    {visibleAbsoluteMetrics.daily_trials_pending && (\n                                        <Line type=\"monotone\" dataKey=\"daily_trials_pending\" stroke=\"#ffc658\" name=\"Daily Trials Pending\" />\n                                    )}\n                                    {visibleAbsoluteMetrics.daily_conversions && (\n                                        <Line type=\"monotone\" dataKey=\"daily_conversions\" stroke=\"#ff7300\" name=\"Daily Conversions\" />\n                                    )}\n                                    {visibleAbsoluteMetrics.daily_conversions_net_refunds && (\n                                        <Line type=\"monotone\" dataKey=\"daily_conversions_net_refunds\" stroke=\"#ff0000\" name=\"Daily Conv. Net Refunds\" />\n                                    )}\n                                    {visibleAbsoluteMetrics.daily_estimated_conversions_net_refunds && (\n                                        <Line type=\"monotone\" dataKey=\"daily_estimated_conversions_net_refunds\" stroke=\"#b967ff\" name=\"Daily Est. Conv. Net Refunds\" />\n                                    )}\n                                    {visibleAbsoluteMetrics.daily_refunds && (\n                                        <Line type=\"monotone\" dataKey=\"daily_refunds\" stroke=\"#ff67b3\" name=\"Daily Refunds\" />\n                                    )}\n                                    \n                                    {/* Cumulative metrics */}\n                                    {visibleAbsoluteMetrics.cumulative_trials_started && (\n                                        <Line type=\"monotone\" dataKey=\"cumulative_trials_started\" stroke=\"#8884d8\" strokeDasharray=\"5 5\" name=\"Cum. Trials Started\" />\n                                    )}\n                                    {visibleAbsoluteMetrics.cumulative_trials_ended && (\n                                        <Line type=\"monotone\" dataKey=\"cumulative_trials_ended\" stroke=\"#82ca9d\" strokeDasharray=\"5 5\" name=\"Cum. Trials Ended\" />\n                                    )}\n                                    {visibleAbsoluteMetrics.cumulative_trials_pending && (\n                                        <Line type=\"monotone\" dataKey=\"cumulative_trials_pending\" stroke=\"#ffc658\" strokeDasharray=\"5 5\" name=\"Cum. Trials Pending\" />\n                                    )}\n                                    {visibleAbsoluteMetrics.cumulative_conversions && (\n                                        <Line type=\"monotone\" dataKey=\"cumulative_conversions\" stroke=\"#ff7300\" strokeDasharray=\"5 5\" name=\"Cum. Conversions\" />\n                                    )}\n                                    {visibleAbsoluteMetrics.cumulative_conversions_net_refunds && (\n                                        <Line type=\"monotone\" dataKey=\"cumulative_conversions_net_refunds\" stroke=\"#ff0000\" strokeDasharray=\"5 5\" name=\"Cum. Conv. Net Refunds\" />\n                                    )}\n                                    {visibleAbsoluteMetrics.cumulative_estimated_conversions_net_refunds && (\n                                        <Line type=\"monotone\" dataKey=\"cumulative_estimated_conversions_net_refunds\" stroke=\"#b967ff\" strokeDasharray=\"5 5\" name=\"Cum. Est. Conv. Net Refunds\" />\n                                    )}\n                                    {visibleAbsoluteMetrics.cumulative_refunds && (\n                                        <Line type=\"monotone\" dataKey=\"cumulative_refunds\" stroke=\"#ff67b3\" strokeDasharray=\"5 5\" name=\"Cum. Refunds\" />\n                                    )}\n                                </LineChart>\n                            </ResponsiveContainer>\n                        </div>\n                    </div>\n                    \n                    {/* Money Values Chart */}\n                    <div className=\"mb-6\">\n                        <h4 className=\"font-semibold text-gray-700 dark:text-white mb-2\">Revenue Values</h4>\n                        <div className=\"mb-4 flex flex-wrap gap-2\">\n                            {Object.keys(visibleMoneyMetrics).map(key => (\n                                <button key={key} onClick={() => toggleMoneyMetric(key)}\n                                        className={`px-3 py-1 text-xs rounded-full ${visibleMoneyMetrics[key] ? 'bg-green-500 text-white' : 'bg-gray-200 dark:bg-gray-600 text-gray-700 dark:text-white'}`}>\n                                    {key.split('_').join(' ')}\n                                </button>\n                            ))}\n                        </div>\n                        <div className=\"h-80 w-full mb-8 bg-gray-50 dark:bg-gray-700 p-4 rounded-lg\">\n                            <ResponsiveContainer width=\"100%\" height=\"100%\">\n                                <LineChart data={chartData} margin={{ top: 5, right: 30, left: 20, bottom: 5 }}>\n                                    <CartesianGrid strokeDasharray=\"3 3\" />\n                                    <XAxis dataKey=\"date\" />\n                                    <YAxis />\n                                    <Tooltip formatter={(value) => formatCurrency(value)} />\n                                    <ChartLegend />\n                                    \n                                    {/* Daily metrics */}\n                                    {visibleMoneyMetrics.daily_revenue && (\n                                        <Line type=\"monotone\" dataKey=\"daily_revenue\" stroke=\"#00b300\" name=\"Daily Revenue\" />\n                                    )}\n                                    {visibleMoneyMetrics.daily_revenue_net && (\n                                        <Line type=\"monotone\" dataKey=\"daily_revenue_net\" stroke=\"#00e600\" name=\"Daily Net Revenue\" />\n                                    )}\n                                    {visibleMoneyMetrics.daily_estimated_revenue && (\n                                        <Line type=\"monotone\" dataKey=\"daily_estimated_revenue\" stroke=\"#4dff4d\" name=\"Daily Est. Revenue\" />\n                                    )}\n                                    \n                                    {/* Cumulative metrics */}\n                                    {visibleMoneyMetrics.cumulative_revenue && (\n                                        <Line type=\"monotone\" dataKey=\"cumulative_revenue\" stroke=\"#009900\" strokeDasharray=\"5 5\" name=\"Cum. Revenue\" />\n                                    )}\n                                    {visibleMoneyMetrics.cumulative_revenue_net && (\n                                        <Line type=\"monotone\" dataKey=\"cumulative_revenue_net\" stroke=\"#00cc00\" strokeDasharray=\"5 5\" name=\"Cum. Net Revenue\" />\n                                    )}\n                                    {visibleMoneyMetrics.cumulative_estimated_revenue && (\n                                        <Line type=\"monotone\" dataKey=\"cumulative_estimated_revenue\" stroke=\"#00e600\" strokeDasharray=\"5 5\" name=\"Cum. Est. Revenue\" />\n                                    )}\n                                </LineChart>\n                            </ResponsiveContainer>\n                        </div>\n                    </div>\n                </div>\n            )}\n                    \n            {/* Event Revenue Timeline Table - NEW FEATURE - MOVED ABOVE USER TIMELINE - ENHANCED WITH ALL METRICS */}\n            {eventRevenueTimelineData ? (\n                <div className=\"mb-8 bg-white dark:bg-gray-700 p-6 rounded-lg shadow-md\">\n                    <div className=\"flex justify-between items-center mb-4\">\n                        <h2 className=\"text-2xl font-bold text-gray-800 dark:text-white\">Daily Event & Revenue Timeline</h2>\n                        <div className=\"flex gap-2\">\n                            <span className=\"text-sm font-medium px-3 py-1 bg-blue-100 text-blue-800 dark:bg-blue-800 dark:text-blue-100 rounded-full\">\n                                {selectedUserId && selectedProductId ? 'Detailed View' : 'Aggregate View'}\n                            </span>\n                        </div>\n                    </div>\n                    \n                    {/* User and Product Selection */}\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6 p-4 border rounded-lg bg-gray-50 dark:bg-gray-600\">\n                        <div>\n                            <label htmlFor=\"user-select\" className=\"block text-sm font-medium text-gray-700 dark:text-white mb-2\">\n                                Select User (Optional)\n                            </label>\n                            <Select\n                                id=\"user-select\"\n                                isClearable\n                                isSearchable\n                                options={availableUsers.map(user => ({ \n                                    value: user, \n                                    label: user \n                                }))}\n                                value={selectedUserId ? { value: selectedUserId, label: selectedUserId } : null}\n                                onChange={(selected) => {\n                                    const newUserId = selected ? selected.value : '';\n                                    setSelectedUserId(newUserId);\n                                    fetchEventRevenueTimeline(newUserId, selectedProductId);\n                                }}\n                                styles={getSelectTheme()}\n                                placeholder=\"Type to search users...\"\n                            />\n                        </div>\n                        <div>\n                            <label htmlFor=\"product-select\" className=\"block text-sm font-medium text-gray-700 dark:text-white mb-2\">\n                                Select Product (Optional)\n                            </label>\n                            <Select\n                                id=\"product-select\"\n                                isClearable\n                                isSearchable\n                                options={availableProducts.map(product => ({ \n                                    value: product, \n                                    label: product \n                                }))}\n                                value={selectedProductId ? { value: selectedProductId, label: selectedProductId } : null}\n                                onChange={(selected) => {\n                                    const newProductId = selected ? selected.value : '';\n                                    setSelectedProductId(newProductId);\n                                    fetchEventRevenueTimeline(selectedUserId, newProductId);\n                                }}\n                                styles={getSelectTheme()}\n                                placeholder=\"Type to search products...\"\n                            />\n                        </div>\n                    </div>\n                    \n                    {/* Enhanced Event Revenue Timeline Table */}\n                    <div className=\"overflow-x-auto\">\n                        <table className=\"min-w-full text-sm border dark:border-gray-600\">\n                            <thead className=\"bg-gray-50 dark:bg-gray-700\">\n                                <tr>\n                                    <th className=\"p-2 border-b dark:border-gray-600 text-left text-gray-700 dark:text-white sticky left-0 bg-gray-50 dark:bg-gray-700 z-10 min-w-[200px]\">\n                                        Metric\n                                    </th>\n                                    {eventRevenueTimelineData.dates.map(date => (\n                                        <th key={date} className=\"p-2 border-b dark:border-gray-600 text-center text-gray-700 dark:text-white whitespace-nowrap min-w-[80px]\">\n                                            {date}\n                                        </th>\n                                    ))}\n                                </tr>\n                            </thead>\n                            <tbody className=\"bg-white dark:bg-gray-800\">\n                                {(() => {\n                                    // Define all metrics with their categories and data extraction logic\n                                    const metrics = [\n                                        // Daily Absolute Values\n                                        {\n                                            key: 'daily_trial_started',\n                                            label: 'Trial Started',\n                                            category: 'daily_absolute',\n                                            categoryLabel: 'Daily Absolute Values',\n                                            getValue: (date, index) => {\n                                                const chartDay = chartData ? chartData.find(d => d.date === date) : null;\n                                                const eventRows = eventRevenueTimelineData.event_rows || {};\n                                                return (selectedUserId || selectedProductId) ? \n                                                    (eventRows.trial_started?.[date] || 0) : \n                                                    (eventRows.trial_started?.[date] || chartDay?.daily_trials_started || 0);\n                                            }\n                                        },\n                                        {\n                                            key: 'daily_trial_pending',\n                                            label: 'Trial Pending',\n                                            category: 'daily_absolute',\n                                            getValue: (date, index) => {\n                                                // FIXED: Use the backend-calculated trial_pending value directly\n                                                const eventRows = eventRevenueTimelineData.event_rows || {};\n                                                return eventRows.trial_pending?.[date] || 0;\n                                            }\n                                        },\n                                        {\n                                            key: 'daily_trial_ended',\n                                            label: 'Trial Ended',\n                                            category: 'daily_absolute',\n                                            getValue: (date, index) => {\n                                                const eventRows = eventRevenueTimelineData.event_rows || {};\n                                                return eventRows.trial_ended?.[date] || 0;\n                                            }\n                                        },\n                                        {\n                                            key: 'daily_trial_cancelled',\n                                            label: 'Trial Cancelled',\n                                            category: 'daily_absolute',\n                                            getValue: (date, index) => {\n                                                const eventRows = eventRevenueTimelineData.event_rows || {};\n                                                return eventRows.trial_canceled?.[date] || 0;\n                                            }\n                                        },\n                                        {\n                                            key: 'daily_trial_converted',\n                                            label: 'Trial Converted',\n                                            category: 'daily_absolute',\n                                            getValue: (date, index) => {\n                                                const chartDay = chartData ? chartData.find(d => d.date === date) : null;\n                                                const eventRows = eventRevenueTimelineData.event_rows || {};\n                                                return (selectedUserId || selectedProductId) ? \n                                                    (eventRows.trial_converted?.[date] || 0) : \n                                                    (eventRows.trial_converted?.[date] || chartDay?.daily_conversions || 0);\n                                            }\n                                        },\n                                        {\n                                            key: 'daily_initial_purchase',\n                                            label: 'Initial Purchase',\n                                            category: 'daily_absolute',\n                                            getValue: (date, index) => {\n                                                const eventRows = eventRevenueTimelineData.event_rows || {};\n                                                return eventRows.initial_purchase?.[date] || 0;\n                                            }\n                                        },\n                                        {\n                                            key: 'daily_subscription_active',\n                                            label: 'Subscription Active',\n                                            category: 'daily_absolute',\n                                            getValue: (date, index) => {\n                                                // FIXED: Use the backend-calculated subscription_active value directly\n                                                const eventRows = eventRevenueTimelineData.event_rows || {};\n                                                return eventRows.subscription_active?.[date] || 0;\n                                            }\n                                        },\n                                        {\n                                            key: 'daily_subscription_cancelled',\n                                            label: 'Subscription Cancelled',\n                                            category: 'daily_absolute',\n                                            getValue: (date, index) => {\n                                                const eventRows = eventRevenueTimelineData.event_rows || {};\n                                                return eventRows.subscription_cancelled?.[date] || 0;\n                                            }\n                                        },\n                                        {\n                                            key: 'daily_refund',\n                                            label: 'Refund',\n                                            category: 'daily_absolute',\n                                            getValue: (date, index) => {\n                                                const chartDay = chartData ? chartData.find(d => d.date === date) : null;\n                                                const eventRows = eventRevenueTimelineData.event_rows || {};\n                                                return (selectedUserId || selectedProductId) ? \n                                                    (eventRows.refund?.[date] || 0) : \n                                                    (eventRows.refund?.[date] || chartDay?.daily_refunds || 0);\n                                            }\n                                        },\n                                        \n                                        // Daily Revenue\n                                        {\n                                            key: 'daily_revenue',\n                                            label: 'Revenue (Actual)',\n                                            category: 'daily_revenue',\n                                            categoryLabel: 'Daily Revenue',\n                                            getValue: (date, index) => {\n                                                const chartDay = chartData ? chartData.find(d => d.date === date) : null;\n                                                const estimateRows = eventRevenueTimelineData.estimate_rows || {};\n                                                const value = (selectedUserId || selectedProductId) ? \n                                                    (estimateRows.current_revenue?.[date] || 0) : \n                                                    (estimateRows.current_revenue?.[date] || chartDay?.daily_revenue || 0);\n                                                return formatCurrency(value);\n                                            }\n                                        },\n                                        {\n                                            key: 'daily_est_revenue',\n                                            label: 'Est. Revenue',\n                                            category: 'daily_revenue',\n                                            isEstimatedRevenue: true,\n                                            getValue: (date, index) => {\n                                                const chartDay = chartData ? chartData.find(d => d.date === date) : null;\n                                                const estimateRows = eventRevenueTimelineData.estimate_rows || {};\n                                                const value = (selectedUserId || selectedProductId) ? \n                                                    (estimateRows.estimated_net_revenue?.[date] || 0) : \n                                                    (estimateRows.estimated_revenue?.[date] || chartDay?.daily_estimated_revenue || 0);\n                                                return formatCurrency(value);\n                                            },\n                                            getTooltipData: (date, index) => {\n                                                // Mock calculation data - this would come from the backend in reality\n                                                const chartDay = chartData ? chartData.find(d => d.date === date) : null;\n                                                const estimateRows = eventRevenueTimelineData.estimate_rows || {};\n                                                const actualValue = (selectedUserId || selectedProductId) ? \n                                                    (estimateRows.estimated_net_revenue?.[date] || 0) : \n                                                    (estimateRows.estimated_revenue?.[date] || chartDay?.daily_estimated_revenue || 0);\n                                                \n                                                // Mock data structure - backend should provide this\n                                                return {\n                                                    formula: \"Est_Revenue = (Active_Trials × Trial_Conv_Rate × Avg_Revenue) + (Active_Subs × (1 - Churn_Rate) × Avg_Revenue) - (Expected_Refunds × Avg_Refund)\",\n                                                    calculation: `(${chartDay?.daily_trials_pending || 0} × 0.15 × $9.99) + (${chartDay?.daily_trials_pending || 0} × 0.95 × $9.99) - (${chartDay?.daily_refunds || 0} × $9.99)`,\n                                                    components: {\n                                                        \"Active Trials\": chartDay?.daily_trials_pending || 0,\n                                                        \"Trial Conversion Rate\": \"15%\",\n                                                        \"Active Subscriptions\": \"N/A\",\n                                                        \"Churn Rate\": \"5%\",\n                                                        \"Avg Revenue\": \"$9.99\",\n                                                        \"Expected Refunds\": chartDay?.daily_refunds || 0,\n                                                        \"Avg Refund\": \"$9.99\"\n                                                    },\n                                                    result: formatCurrency(actualValue)\n                                                };\n                                            }\n                                        },\n                                        \n                                        // Cumulative Absolute Values\n                                        {\n                                            key: 'cumulative_trial_started',\n                                            label: 'Trial Started',\n                                            category: 'cumulative_absolute',\n                                            categoryLabel: 'Cumulative Absolute Values',\n                                            getValue: (date, index) => {\n                                                const chartDay = chartData ? chartData.find(d => d.date === date) : null;\n                                                const eventRows = eventRevenueTimelineData.event_rows || {};\n                                                return (selectedUserId || selectedProductId) ? \n                                                    eventRevenueTimelineData.dates.slice(0, index + 1).reduce((sum, d) => sum + (eventRows.trial_started?.[d] || 0), 0) : \n                                                    (chartDay?.cumulative_trials_started || 0);\n                                            }\n                                        },\n                                        {\n                                            key: 'cumulative_trial_pending',\n                                            label: 'Trial Pending',\n                                            category: 'cumulative_absolute',\n                                            getValue: (date, index) => {\n                                                // This is a point-in-time value, same as daily pending\n                                                const eventRows = eventRevenueTimelineData.event_rows || {};\n                                                return eventRows.trial_pending?.[date] || 0;\n                                            }\n                                        },\n                                        {\n                                            key: 'cumulative_trial_ended',\n                                            label: 'Trial Ended',\n                                            category: 'cumulative_absolute',\n                                            getValue: (date, index) => {\n                                                const eventRows = eventRevenueTimelineData.event_rows || {};\n                                                return eventRevenueTimelineData.dates.slice(0, index + 1).reduce((sum, d) => sum + (eventRows.trial_ended?.[d] || 0), 0);\n                                            }\n                                        },\n                                        {\n                                            key: 'cumulative_trial_cancelled',\n                                            label: 'Trial Cancelled',\n                                            category: 'cumulative_absolute',\n                                            getValue: (date, index) => {\n                                                const eventRows = eventRevenueTimelineData.event_rows || {};\n                                                return (selectedUserId || selectedProductId) ? \n                                                    eventRevenueTimelineData.dates.slice(0, index + 1).reduce((sum, d) => sum + (eventRows.trial_canceled?.[d] || 0), 0) : \n                                                    (chartData ? chartData.slice(0, index + 1).reduce((sum, d) => sum + (eventRows.trial_canceled?.[d.date] || 0), 0) : 0);\n                                            }\n                                        },\n                                        {\n                                            key: 'cumulative_trial_converted',\n                                            label: 'Trial Converted',\n                                            category: 'cumulative_absolute',\n                                            getValue: (date, index) => {\n                                                const chartDay = chartData ? chartData.find(d => d.date === date) : null;\n                                                const eventRows = eventRevenueTimelineData.event_rows || {};\n                                                return (selectedUserId || selectedProductId) ? \n                                                    eventRevenueTimelineData.dates.slice(0, index + 1).reduce((sum, d) => sum + (eventRows.trial_converted?.[d] || 0), 0) : \n                                                    (chartDay?.cumulative_conversions || 0);\n                                            }\n                                        },\n                                        {\n                                            key: 'cumulative_initial_purchase',\n                                            label: 'Initial Purchase',\n                                            category: 'cumulative_absolute',\n                                            getValue: (date, index) => {\n                                                const eventRows = eventRevenueTimelineData.event_rows || {};\n                                                return (selectedUserId || selectedProductId) ? \n                                                    eventRevenueTimelineData.dates.slice(0, index + 1).reduce((sum, d) => sum + (eventRows.initial_purchase?.[d] || 0), 0) : \n                                                    (eventRows.cumulative_initial_purchase?.[date] || 0);\n                                            }\n                                        },\n                                        {\n                                            key: 'cumulative_subscription_active',\n                                            label: 'Subscription Active',\n                                            category: 'cumulative_absolute',\n                                            getValue: (date, index) => {\n                                                // This is a point-in-time value, same as daily subscription_active\n                                                const eventRows = eventRevenueTimelineData.event_rows || {};\n                                                return eventRows.subscription_active?.[date] || 0;\n                                            }\n                                        },\n                                        {\n                                            key: 'cumulative_subscription_cancelled',\n                                            label: 'Subscription Cancelled',\n                                            category: 'cumulative_absolute',\n                                            getValue: (date, index) => {\n                                                const eventRows = eventRevenueTimelineData.event_rows || {};\n                                                return eventRevenueTimelineData.dates.slice(0, index + 1).reduce((sum, d) => sum + (eventRows.subscription_cancelled?.[d] || 0), 0);\n                                            }\n                                        },\n                                        {\n                                            key: 'cumulative_refund',\n                                            label: 'Refund',\n                                            category: 'cumulative_absolute',\n                                            getValue: (date, index) => {\n                                                const chartDay = chartData ? chartData.find(d => d.date === date) : null;\n                                                const eventRows = eventRevenueTimelineData.event_rows || {};\n                                                return (selectedUserId || selectedProductId) ? \n                                                    eventRevenueTimelineData.dates.slice(0, index + 1).reduce((sum, d) => sum + (eventRows.refund?.[d] || 0), 0) : \n                                                    (chartDay?.cumulative_refunds || 0);\n                                            }\n                                        },\n                                        \n                                        // Cumulative Revenue\n                                        {\n                                            key: 'cumulative_revenue',\n                                            label: 'Revenue (Actual)',\n                                            category: 'cumulative_revenue',\n                                            categoryLabel: 'Cumulative Revenue',\n                                            getValue: (date, index) => {\n                                                const chartDay = chartData ? chartData.find(d => d.date === date) : null;\n                                                const estimateRows = eventRevenueTimelineData.estimate_rows || {};\n                                                const value = (selectedUserId || selectedProductId) ? \n                                                    eventRevenueTimelineData.dates.slice(0, index + 1).reduce((sum, d) => sum + (estimateRows.current_revenue?.[d] || 0), 0) : \n                                                    (chartDay?.cumulative_revenue || 0);\n                                                return formatCurrency(value);\n                                            }\n                                        },\n                                        {\n                                            key: 'cumulative_est_revenue',\n                                            label: 'Est. Revenue',\n                                            category: 'cumulative_revenue',\n                                            isEstimatedRevenue: true,\n                                            getValue: (date, index) => {\n                                                const chartDay = chartData ? chartData.find(d => d.date === date) : null;\n                                                const estimateRows = eventRevenueTimelineData.estimate_rows || {};\n                                                const value = (selectedUserId || selectedProductId) ? \n                                                    eventRevenueTimelineData.dates.slice(0, index + 1).reduce((sum, d) => sum + (estimateRows.estimated_net_revenue?.[d] || 0), 0) : \n                                                    (chartDay?.cumulative_estimated_revenue || 0);\n                                                return formatCurrency(value);\n                                            },\n                                            getTooltipData: (date, index) => {\n                                                const chartDay = chartData ? chartData.find(d => d.date === date) : null;\n                                                const estimateRows = eventRevenueTimelineData.estimate_rows || {};\n                                                const actualValue = (selectedUserId || selectedProductId) ? \n                                                    eventRevenueTimelineData.dates.slice(0, index + 1).reduce((sum, d) => sum + (estimateRows.estimated_net_revenue?.[d] || 0), 0) : \n                                                    (chartDay?.cumulative_estimated_revenue || 0);\n                                                \n                                                return {\n                                                    formula: \"Cumulative_Est_Revenue = Σ(Daily_Est_Revenue) from start to date\",\n                                                    calculation: `Sum of daily estimated revenue from start date to ${date}`,\n                                                    components: {\n                                                        \"Period\": `Start to ${date}`,\n                                                        \"Days\": index + 1,\n                                                        \"Avg Daily Est\": formatCurrency(actualValue / (index + 1)),\n                                                    },\n                                                    result: formatCurrency(actualValue)\n                                                };\n                                            }\n                                        }\n                                    ];\n\n                                    // Group metrics by category for styling\n                                    const categoryColors = {\n                                        daily_absolute: 'bg-blue-50 dark:bg-blue-900/30',\n                                        daily_revenue: 'bg-green-50 dark:bg-green-900/30', \n                                        cumulative_absolute: 'bg-indigo-50 dark:bg-indigo-900/30',\n                                        cumulative_revenue: 'bg-emerald-50 dark:bg-emerald-900/30'\n                                    };\n\n                                    return metrics.map((metric, metricIndex) => {\n                                        const isFirstInCategory = metricIndex === 0 || metrics[metricIndex - 1].category !== metric.category;\n                                        \n                                        return (\n                                            <React.Fragment key={metric.key}>\n                                                {/* Category header row */}\n                                                {isFirstInCategory && metric.categoryLabel && (\n                                                    <tr className={`${categoryColors[metric.category]} border-t-2 border-gray-300 dark:border-gray-500`}>\n                                                        <td colSpan={eventRevenueTimelineData.dates.length + 1} className=\"p-2 border-b dark:border-gray-600 text-center font-semibold text-gray-700 dark:text-white\">\n                                                            {metric.categoryLabel}\n                                                        </td>\n                                                    </tr>\n                                                )}\n                                                \n                                                {/* Metric data row */}\n                                                <tr className={metricIndex % 2 === 0 ? '' : 'bg-gray-50 dark:bg-gray-700'}>\n                                                    <td className=\"p-2 border-b dark:border-gray-600 font-medium text-gray-700 dark:text-gray-300 sticky left-0 z-10 bg-inherit\">\n                                                        {metric.label}\n                                                    </td>\n                                                    {eventRevenueTimelineData.dates.map((date, dateIndex) => (\n                                                        <td \n                                                            key={date} \n                                                            className={`p-2 border-b dark:border-gray-600 text-center text-gray-700 dark:text-gray-300 whitespace-nowrap ${\n                                                                metric.isEstimatedRevenue ? 'cursor-help hover:bg-yellow-50 dark:hover:bg-yellow-900/20' : ''\n                                                            }`}\n                                                            onMouseEnter={metric.isEstimatedRevenue ? (e) => {\n                                                                const tooltipData = metric.getTooltipData(date, dateIndex);\n                                                                setTooltipData(tooltipData);\n                                                                setTooltipPosition({ x: e.clientX, y: e.clientY });\n                                                            } : undefined}\n                                                            onMouseLeave={metric.isEstimatedRevenue ? () => {\n                                                                setTooltipData(null);\n                                                            } : undefined}\n                                                        >\n                                                            {metric.getValue(date, dateIndex)}\n                                                        </td>\n                                                    ))}\n                                                </tr>\n                                            </React.Fragment>\n                                        );\n                                    });\n                                })()}\n                            </tbody>\n                        </table>\n                    </div>\n                </div>\n            ) : isLoadingEventRevenueTimeline ? (\n                <div className=\"flex items-center justify-center p-8 bg-white dark:bg-gray-700 rounded-lg shadow-md my-4\">\n                    <Loader className=\"animate-spin mr-2 text-indigo-600 dark:text-indigo-400\" />\n                    <p className=\"text-gray-700 dark:text-white\">Loading event revenue timeline...</p>\n                </div>\n            ) : eventRevenueTimelineError ? (\n                <div className=\"my-4 p-4 bg-yellow-100 dark:bg-yellow-800 text-yellow-700 dark:text-white rounded-md shadow-md border border-yellow-300 dark:border-yellow-600\">\n                    <div className=\"flex items-center\">\n                        <AlertTriangle className=\"mr-2 flex-shrink-0\" />\n                        <div>\n                            <span className=\"font-medium block\">Event Revenue Timeline Error:</span>\n                            <span className=\"block mt-1\">{eventRevenueTimelineError}</span>\n                        </div>\n                    </div>\n                </div>\n            ) : null}\n\n            {/* User Timeline Table */}\n            {userTimelineData ? (\n                <div className=\"mb-8\">\n                    <div className=\"flex justify-between items-center mb-3\">\n                        <h3 className=\"text-xl font-semibold text-gray-700 dark:text-white\">User Timeline</h3>\n                        <div className=\"flex gap-2\">\n                            <span className=\"text-sm font-medium px-3 py-1 bg-blue-100 text-blue-800 dark:bg-blue-800 dark:text-blue-100 rounded-full\">\n                                {userTimelineData.unique_users_count || userTimelineData.total_users} Unique Users\n                            </span>\n                            <span className=\"text-sm font-medium px-3 py-1 bg-green-100 text-green-800 dark:bg-green-800 dark:text-green-100 rounded-full\">\n                                {userTimelineData.total_user_product_combinations || userTimelineData.users?.length} User-Product Combinations\n                            </span>\n                            <span className=\"text-sm font-medium px-3 py-1 bg-purple-100 text-purple-800 dark:bg-purple-800 dark:text-purple-100 rounded-full\">\n                                {userTimelineData.valid_product_ids?.length || 0} Unique Products\n                            </span>\n                        </div>\n                    </div>\n                    \n                    {/* Add filter stats display for timeline too */}\n                    {userTimelineData.filter_stats && (\n                        <FilterStatsDisplay filterStats={userTimelineData.filter_stats} />\n                    )}\n                    \n                    {/* Legend */}\n                    <div className=\"mb-4\">\n                        <div className=\"flex flex-wrap gap-3 mb-2\">\n                            <div className={`px-3 py-2 rounded ${timelineColors.default.bg} ${timelineColors.default.text}`}>No Event</div>\n                            <div className={`px-3 py-2 rounded ${timelineColors.trial_started.bg} ${timelineColors.trial_started.text}`}>Trial Started</div>\n                            <div className={`px-3 py-2 rounded ${timelineColors.trial_converted.bg} ${timelineColors.trial_converted.text}`}>Trial Converted</div>\n                            <div className={`px-3 py-2 rounded ${timelineColors.trial_cancelled.bg} ${timelineColors.trial_cancelled.text}`}>Trial Cancelled</div>\n                            <div className={`px-3 py-2 rounded ${timelineColors.conversion_cancelled.bg} ${timelineColors.conversion_cancelled.text}`}>Conversion Cancelled</div>\n                            <div className={`px-3 py-2 rounded ${timelineColors.refunded.bg} ${timelineColors.refunded.text}`}>Refunded</div>\n                        </div>\n                        <div className=\"relative flex items-center bg-gray-100 dark:bg-gray-700 p-2 rounded text-sm\">\n                            <span className=\"mr-2\">Multiple events on the same day:</span>\n                            <div className=\"flex items-center\">\n                                <div className=\"relative mr-8 px-4 py-2 rounded bg-green-100 dark:bg-green-900/50\" style={{minWidth: \"180px\"}}>\n                                    <span className=\"text-green-800 dark:text-green-200\">Trial Converted</span>\n                                    <div className=\"absolute top-0 right-0 -mt-1 -mr-1 bg-blue-500 text-white text-[8px] rounded-full w-4 h-4 flex items-center justify-center\">\n                                        3\n                                    </div>\n                                    <div className=\"mt-1 flex flex-col gap-1 w-full\">\n                                        <div className=\"px-1 py-0.5 text-[9px] w-full text-center rounded bg-yellow-100 dark:bg-yellow-900/50 text-yellow-800 dark:text-yellow-200\">\n                                            Trial started\n                                        </div>\n                                        <div className=\"px-1 py-0.5 text-[9px] w-full text-center rounded bg-red-50 dark:bg-red-900/30 text-red-600 dark:text-red-300\">\n                                            Refunded\n                                        </div>\n                                    </div>\n                                </div>\n                                <span className=\"text-gray-600 dark:text-gray-300\">The cell is colored by the first event, with a counter and full-text badges for each additional event</span>\n                            </div>\n                        </div>\n                    </div>\n                    \n                    <div className=\"overflow-x-auto\">\n                        <table className=\"min-w-full text-sm border dark:border-gray-600\">\n                            <thead className=\"bg-gray-50 dark:bg-gray-700\">\n                                <tr>\n                                    <th className=\"p-2 border-b dark:border-gray-600 text-left text-gray-700 dark:text-white sticky left-0 bg-gray-50 dark:bg-gray-700 z-10\">User ID</th>\n                                    <th className=\"p-2 border-b dark:border-gray-600 text-left text-gray-700 dark:text-white sticky left-[150px] bg-gray-50 dark:bg-gray-700 z-10\">Product ID</th>\n                                    {userTimelineData.dates.map(date => (\n                                        <th key={date} className=\"p-2 border-b dark:border-gray-600 text-center text-gray-700 dark:text-white whitespace-nowrap\">{date}</th>\n                                    ))}\n                                </tr>\n                            </thead>\n                            <tbody className=\"bg-white dark:bg-gray-800\">\n                                {userTimelineData.users.map((user, index) => {\n                                    // Get background colors for alternating users (not user-product rows)\n                                    const isNewUser = index === 0 || userTimelineData.users[index-1].id !== user.id;\n                                    const userBgClass = isNewUser ? (index % 4 < 2 ? 'bg-white dark:bg-gray-800' : 'bg-gray-50 dark:bg-gray-700') : ''; \n                                    \n                                    return (\n                                    <tr key={user.user_product_key} className={userBgClass}>\n                                        <td className=\"p-2 border-b dark:border-gray-600 font-medium text-gray-700 dark:text-gray-300 sticky left-0 z-10\" style={{backgroundColor: 'inherit'}}>\n                                            {isNewUser ? user.id : ''}\n                                        </td>\n                                        <td className=\"p-2 border-b dark:border-gray-600 font-medium text-green-700 dark:text-green-300 sticky left-[150px] z-10\" style={{backgroundColor: 'inherit'}}>\n                                            {user.product_id}\n                                        </td>\n                                        {userTimelineData.dates.map(date => {\n                                            const cellState = getCellState(user.user_product_key, date, userTimelineData.events);\n                                            const events = getEventsForDate(user.user_product_key, date, userTimelineData.events);\n                                            const hasEvents = events.length > 0;\n                                            \n                                            return (\n                                                <td key={date} \n                                                    className={`p-2 border dark:border-gray-600 text-xs relative ${timelineColors[cellState].bg}`}>\n                                                    {hasEvents ? (\n                                                        <div className=\"flex flex-col items-center\">\n                                                            {/* Main event - full display */}\n                                                            <div className={`text-center w-full ${timelineColors[cellState].text} font-medium`}>\n                                                                {events[0].type.replace('RC ', '')}\n                                                            </div>\n                                                            \n                                                            {/* Show badges for multiple events with full names */}\n                                                            {events.length > 1 && (\n                                                                <div className=\"mt-1 flex flex-col items-center w-full gap-1\">\n                                                                    {/* Skip the first event (already shown above) and show badges for additional events */}\n                                                                    {events.slice(1).map((additionalEvent, idx) => {\n                                                                        const eventType = additionalEvent.type.replace('RC ', '');\n                                                                        let badgeState = 'default';\n                                                                        \n                                                                        // Determine appropriate color for this event\n                                                                        if (additionalEvent.type === 'RC Trial started') badgeState = 'trial_started';\n                                                                        else if (additionalEvent.type === 'RC Trial converted') badgeState = 'trial_converted';\n                                                                        else if (additionalEvent.type === 'RC Trial cancelled') badgeState = 'trial_cancelled';\n                                                                        else if (additionalEvent.type === 'RC Cancellation') {\n                                                                            badgeState = additionalEvent.has_refund ? 'refunded' : 'conversion_cancelled';\n                                                                        } else if (additionalEvent.type === 'RC Initial purchase') {\n                                                                            badgeState = 'trial_converted';\n                                                                        } else if (additionalEvent.type === 'RC Renewal') {\n                                                                            badgeState = 'trial_converted';\n                                                                        }\n                                                                        \n                                                                        return (\n                                                                            <div \n                                                                                key={idx} \n                                                                                className={`px-1 py-0.5 text-[9px] w-full text-center rounded ${timelineColors[badgeState].bg} ${timelineColors[badgeState].text}`}\n                                                                                title={`${eventType} at ${additionalEvent.time} for ${additionalEvent.product_id}`}\n                                                                            >\n                                                                                {eventType}\n                                                                            </div>\n                                                                        );\n                                                                    })}\n                                                                </div>\n                                                            )}\n                                                            \n                                                            {/* Show a small indicator when there are multiple events */}\n                                                            {events.length > 1 && (\n                                                                <div className=\"absolute top-0 right-0 -mt-1 -mr-1 bg-blue-500 text-white text-[8px] rounded-full w-4 h-4 flex items-center justify-center\">\n                                                                    {events.length}\n                                                                </div>\n                                                            )}\n                                                        </div>\n                                                    ) : ''}\n                                                </td>\n                                            );\n                                        })}\n                                    </tr>\n                                );})}\n                            </tbody>\n                        </table>\n                    </div>\n                </div>\n            ) : isLoadingTimeline ? (\n                <div className=\"flex items-center justify-center p-8 bg-white dark:bg-gray-700 rounded-lg shadow-md my-4\">\n                    <Loader className=\"animate-spin mr-2 text-indigo-600 dark:text-indigo-400\" />\n                    <p className=\"text-gray-700 dark:text-white\">Loading user timeline data...</p>\n                </div>\n            ) : timelineError ? (\n                <div className=\"my-4 p-4 bg-yellow-100 dark:bg-yellow-800 text-yellow-700 dark:text-white rounded-md shadow-md border border-yellow-300 dark:border-yellow-600\">\n                    <div className=\"flex items-center\">\n                        <AlertTriangle className=\"mr-2 flex-shrink-0\" />\n                        <div>\n                            <span className=\"font-medium block\">Timeline Error:</span>\n                            <span className=\"block mt-1\">{timelineError}</span>\n                        </div>\n                    </div>\n                </div>\n            ) : null}\n            \n            {/* Estimated Revenue Tooltip */}\n            <EstimatedRevenueTooltip \n                data={tooltipData} \n                position={tooltipPosition} \n                onClose={() => setTooltipData(null)} \n            />\n            <ChartModal />\n        </div>\n    );\n};\n\nexport default CohortAnalyzerPage;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}