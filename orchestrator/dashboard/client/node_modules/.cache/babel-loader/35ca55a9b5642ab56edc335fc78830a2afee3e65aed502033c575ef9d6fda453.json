{"ast":null,"code":"import React,{useState}from'react';import{LineChart,X,HelpCircle}from'lucide-react';import{LineChart as RechartsLineChart,Line,XAxis,YAxis,CartesianGrid,Tooltip,Legend,ResponsiveContainer}from'recharts';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const LifecycleRatesTable=_ref=>{var _data$data,_data$data2,_data$data2$structure,_data$data3,_data$structured_form;let{data}=_ref;const[globalSelectedProduct,setGlobalSelectedProduct]=useState(null);const[showChartModal,setShowChartModal]=useState(false);const[chartModalData,setChartModalData]=useState(null);const[showBreakdownModal,setShowBreakdownModal]=useState(false);const[breakdownModalData,setBreakdownModalData]=useState(null);// Handle different data structures - debug mode vs regular mode\nlet lifecycleData=null;// Debug: Log the actual data structure\nconsole.log('LifecycleRatesTable received data:',data);if(data!==null&&data!==void 0&&(_data$data=data.data)!==null&&_data$data!==void 0&&_data$data.lifecycle_rates){// Regular mode: data.data.lifecycle_rates\nlifecycleData=data.data.lifecycle_rates;console.log('Using regular mode lifecycle_rates:',lifecycleData);}else if(data!==null&&data!==void 0&&(_data$data2=data.data)!==null&&_data$data2!==void 0&&(_data$data2$structure=_data$data2.structured_format)!==null&&_data$data2$structure!==void 0&&_data$data2$structure.lifecycle_analysis){// Debug mode: data.data.structured_format.lifecycle_analysis\nlifecycleData=data.data.structured_format.lifecycle_analysis;console.log('Using debug mode structured_format.lifecycle_analysis:',lifecycleData);}else if(data!==null&&data!==void 0&&(_data$data3=data.data)!==null&&_data$data3!==void 0&&_data$data3.legacy_format){// Debug mode: data.data.legacy_format (fallback)\nconst legacyData=data.data.legacy_format;console.log('Using debug mode legacy_format:',legacyData);lifecycleData={aggregate:{trial_to_outcome:{rates_by_day:legacyData.lifecycle_rates||{},smoothing_method:legacyData.smoothing_method||'none',smoothing_quality:legacyData.smoothing_quality||'N/A',total_sample_size:legacyData.total_sample_size||0}},per_product:{},metadata:{calculation_method:'legacy_format',message:'Data from legacy format'}};}else if(data!==null&&data!==void 0&&(_data$structured_form=data.structured_format)!==null&&_data$structured_form!==void 0&&_data$structured_form.lifecycle_analysis){// Debug mode: structured_format.lifecycle_analysis (direct)\nlifecycleData=data.structured_format.lifecycle_analysis;console.log('Using direct structured_format.lifecycle_analysis:',lifecycleData);}else if(data!==null&&data!==void 0&&data.legacy_format){// Debug mode: legacy_format (direct)\nconst legacyData=data.legacy_format;console.log('Using direct legacy_format:',legacyData);lifecycleData={aggregate:{trial_to_outcome:{rates_by_day:legacyData.lifecycle_rates||{},smoothing_method:legacyData.smoothing_method||'none',smoothing_quality:legacyData.smoothing_quality||'N/A',total_sample_size:legacyData.total_sample_size||0}},per_product:{},metadata:{calculation_method:'legacy_format',message:'Data from legacy format'}};}console.log('Final lifecycleData:',lifecycleData);if(!lifecycleData){return/*#__PURE__*/_jsx(\"div\",{className:\"text-center py-8\",children:/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-500 dark:text-gray-400\",children:\"No lifecycle data available. Run an analysis to see results.\"})});}// The backend returns: { aggregate: { trial_to_outcome: {...}, ... }, per_product: { product_id: { trial_to_outcome: {...}, ... } } }\nconst aggregate=lifecycleData.aggregate||{};const perProduct=lifecycleData.per_product||{};console.log('Aggregate data:',aggregate);console.log('Per product data:',perProduct);// Function to extract lookback information from rate calculation data\nconst extractLookbackInfo=(rateCalculationData,tableTitle)=>{// The backend stores lookback info in the rate calculation results\n// Look for extension_days_used and user count breakdown\nif(!rateCalculationData)return null;// Check if this is the new product-based format from lifecycle_calculator.py\nconst aggregateRates=rateCalculationData.aggregate_rates;const extensionInfo=rateCalculationData.extension_info;if(aggregateRates&&extensionInfo){// Extract extension information from the backend data\nconst extensionDays=aggregateRates.extension_days_used||(extensionInfo===null||extensionInfo===void 0?void 0:extensionInfo.extension_days_used)||0;const totalSampleSize=aggregateRates.total_sample_size||(extensionInfo===null||extensionInfo===void 0?void 0:extensionInfo.total_sample_size)||0;const attempts=aggregateRates.extension_attempts||(extensionInfo===null||extensionInfo===void 0?void 0:extensionInfo.attempts_made)||1;const perProductInfo=(extensionInfo===null||extensionInfo===void 0?void 0:extensionInfo.per_product_info)||{};if(extensionDays>0&&Object.keys(perProductInfo).length>0){// Use real per-product breakdown from backend\nlet breakdown={};// Aggregate the breakdown from per-product info\nObject.values(perProductInfo).forEach(productInfo=>{const extensionDays=productInfo.extension_days_used||0;const sampleSize=productInfo.final_sample_size||0;if(extensionDays===0){breakdown['0']=(breakdown['0']||0)+sampleSize;}else if(extensionDays===30){breakdown['30']=(breakdown['30']||0)+sampleSize;}else if(extensionDays===60){breakdown['60']=(breakdown['60']||0)+sampleSize;}});return{extensionDays,totalSize:totalSampleSize,breakdown,attempts,perProductInfo};}}return null;};// Function to simulate lookback information based on typical patterns (fallback only)\nconst simulateLookbackInfo=(ratesData,tableTitle)=>{var _ratesData$aggregate_;// This is now only used as a fallback when backend data is not available\nconst sampleSize=(ratesData===null||ratesData===void 0?void 0:(_ratesData$aggregate_=ratesData.aggregate_rates)===null||_ratesData$aggregate_===void 0?void 0:_ratesData$aggregate_.total_sample_size)||(ratesData===null||ratesData===void 0?void 0:ratesData.total_sample_size)||0;// Only simulate for very specific cases where we know lookback is typically needed\nif(tableTitle.includes('Renewal')&&sampleSize<10){return{extensionDays:60,totalSize:sampleSize,breakdown:{'0':Math.floor(sampleSize*0.3),'30':Math.floor(sampleSize*0.3),'60':Math.floor(sampleSize*0.4)}};}return null;};// Function to render sample size with lookback information\nconst renderSampleSizeInfo=(displayRates,globalSelectedProduct,tableTitle,rateCalculationData,isShowingProductData,isShowingFallbackData)=>{const sampleSize=displayRates.total_sample_size||0;const lookbackInfo=extractLookbackInfo(rateCalculationData,tableTitle);// Check if we have product data but it's below threshold\nlet productSampleSize=0;let isBelowThreshold=false;if(globalSelectedProduct&&rateCalculationData.rates_by_product&&rateCalculationData.rates_by_product[globalSelectedProduct]){productSampleSize=rateCalculationData.rates_by_product[globalSelectedProduct].total_sample_size||0;isBelowThreshold=productSampleSize>0&&productSampleSize<10;}// Get the actual extension days used for the current display\nlet actualExtensionDays=0;if(isShowingProductData&&globalSelectedProduct&&rateCalculationData.rates_by_product&&rateCalculationData.rates_by_product[globalSelectedProduct]){actualExtensionDays=rateCalculationData.rates_by_product[globalSelectedProduct].extension_days_used||0;}else if(!isShowingProductData&&rateCalculationData.aggregate_rates){actualExtensionDays=rateCalculationData.aggregate_rates.extension_days_used||0;}return/*#__PURE__*/_jsxs(\"div\",{className:\"mb-4 p-3 bg-gray-50 dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between\",children:[/*#__PURE__*/_jsxs(\"p\",{className:\"text-sm text-gray-600 dark:text-gray-400\",children:[\"Based on \",/*#__PURE__*/_jsx(\"span\",{className:\"font-semibold text-gray-900 dark:text-white\",children:sampleSize}),\" users\",isShowingProductData&&/*#__PURE__*/_jsxs(\"span\",{className:\"ml-2 text-green-600 dark:text-green-400\",children:[\"(Product: \",globalSelectedProduct,\")\"]}),isShowingFallbackData&&!isBelowThreshold&&/*#__PURE__*/_jsxs(\"span\",{className:\"ml-2 text-orange-600 dark:text-orange-400\",children:[\"(Aggregate data - \",globalSelectedProduct,\" has no data for this lifecycle)\"]}),isShowingFallbackData&&isBelowThreshold&&/*#__PURE__*/_jsxs(\"span\",{className:\"ml-2 text-orange-600 dark:text-orange-400\",children:[\"(Aggregate data - \",globalSelectedProduct,\" has only \",productSampleSize,\" users, minimum 10 required)\"]}),!globalSelectedProduct&&/*#__PURE__*/_jsx(\"span\",{className:\"ml-2 text-blue-600 dark:text-blue-400\",children:\"(All Products - Aggregate)\"})]}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>openBreakdownModal(tableTitle,rateCalculationData),className:\"ml-2 p-1 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 transition-colors\",title:\"View detailed breakdown by product\",children:/*#__PURE__*/_jsx(HelpCircle,{size:16})})]}),actualExtensionDays>0&&/*#__PURE__*/_jsxs(\"div\",{className:\"mt-2 p-2 bg-yellow-50 dark:bg-yellow-900/30 rounded border border-yellow-200 dark:border-yellow-700\",children:[/*#__PURE__*/_jsxs(\"p\",{className:\"text-xs text-yellow-800 dark:text-yellow-200\",children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Lookback Applied:\"}),\" Extended \",actualExtensionDays,\" days to capture more starter events\"]}),lookbackInfo&&lookbackInfo.breakdown&&/*#__PURE__*/_jsx(\"div\",{className:\"mt-1 text-xs text-yellow-700 dark:text-yellow-300\",children:Object.entries(lookbackInfo.breakdown).map(_ref2=>{let[days,count]=_ref2;return/*#__PURE__*/_jsxs(\"span\",{className:\"mr-3\",children:[days==='0'?'Base period':\"+\".concat(days,\" days\"),\": \",count,\" users\"]},days);})})]})]});};// Get all available product IDs from lifecycle rates\nconst getAllAvailableProducts=()=>{const allAvailableProducts=new Set();// Check per_product structure first (correct structure from lifecycle_calculator.py)\nif(perProduct&&Object.keys(perProduct).length>0){Object.keys(perProduct).forEach(productId=>{allAvailableProducts.add(productId);});}// Also check aggregate rates for product-based data\nif(aggregate&&typeof aggregate==='object'){Object.values(aggregate).forEach(rateData=>{if(rateData&&rateData.rates_by_product){Object.keys(rateData.rates_by_product).forEach(productId=>{allAvailableProducts.add(productId);});}});}return Array.from(allAvailableProducts).sort();};const productList=getAllAvailableProducts();// Function to open chart modal\nconst openChartModal=(title,ratesData)=>{setChartModalData({title,ratesData});setShowChartModal(true);};// Function to close chart modal\nconst closeChartModal=()=>{setChartModalData(null);setShowChartModal(false);};// Function to open breakdown modal\nconst openBreakdownModal=(title,rateCalculationData)=>{setBreakdownModalData({title,rateCalculationData});setShowBreakdownModal(true);};// Function to close breakdown modal\nconst closeBreakdownModal=()=>{setBreakdownModalData(null);setShowBreakdownModal(false);};// Function to render lifecycle table with precise requirements\nconst renderLifecycleTable=function(title,ratesData){let denominatorKey=arguments.length>2&&arguments[2]!==undefined?arguments[2]:\"rate_denominator_count\";if(!ratesData){return/*#__PURE__*/_jsx(\"div\",{className:\"mb-4 p-3 bg-gray-50 dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between\",children:[/*#__PURE__*/_jsx(\"h4\",{className:\"text-sm font-medium text-gray-900 dark:text-white\",children:title}),/*#__PURE__*/_jsx(\"span\",{className:\"text-xs text-gray-500 dark:text-gray-400\",children:\"No data available\"})]})});}// Determine table type from title to show only relevant metrics\nconst isCancellationTable=title.toLowerCase().includes('cancelled');const isRefundTable=title.toLowerCase().includes('refund');const isTrialOutcomeTable=title.toLowerCase().includes('trial started');// Handle the correct data structure from lifecycle_calculator.py\n// The backend now returns complete rate calculation data including extension_info\nconsole.log('renderLifecycleTable - title:',title,'ratesData:',ratesData);// Check if we have the new complete structure or the old direct structure\nlet aggregateRates,ratesByProduct,rateExtensionInfo;if(ratesData.aggregate_rates){// New complete structure\naggregateRates=ratesData.aggregate_rates;ratesByProduct=ratesData.rates_by_product||{};rateExtensionInfo=ratesData.extension_info||{};}else{// Old direct structure (fallback)\naggregateRates=ratesData;ratesByProduct={};rateExtensionInfo={};}// Get per-product data for this specific rate type\nconst currentTableKey=title.toLowerCase().includes('trial started')?'trial_to_outcome':title.toLowerCase().includes('trial converted')&&title.toLowerCase().includes('cancelled')?'trial_converted_to_cancellation':title.toLowerCase().includes('trial converted')&&title.toLowerCase().includes('refund')?'trial_converted_to_refund':title.toLowerCase().includes('initial purchase')&&title.toLowerCase().includes('cancelled')?'initial_purchase_to_cancellation':title.toLowerCase().includes('initial purchase')&&title.toLowerCase().includes('refund')?'initial_purchase_to_refund':title.toLowerCase().includes('renewal')&&title.toLowerCase().includes('cancelled')?'renewal_to_cancellation':title.toLowerCase().includes('renewal')&&title.toLowerCase().includes('refund')?'renewal_to_refund':null;// For the new structure, we already have the rates_by_product for this specific lifecycle type\n// For the old structure, we need to get it from the per-product data\nif(!ratesData.aggregate_rates&&currentTableKey){Object.keys(perProduct).forEach(productId=>{if(perProduct[productId][currentTableKey]){ratesByProduct[productId]=perProduct[productId][currentTableKey];}});}if(!aggregateRates||!aggregateRates.rates_by_day||Object.keys(aggregateRates.rates_by_day).length===0){return/*#__PURE__*/_jsx(\"div\",{className:\"mb-4 p-3 bg-gray-50 dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between\",children:[/*#__PURE__*/_jsx(\"h4\",{className:\"text-sm font-medium text-gray-900 dark:text-white\",children:title}),/*#__PURE__*/_jsx(\"span\",{className:\"text-xs text-gray-500 dark:text-gray-400\",children:\"No data available\"})]})});}// Use global product selection to determine which rates to display\n// If a product is selected but doesn't have data for this lifecycle type, fall back to aggregate\nlet displayRates=aggregateRates;let isShowingProductData=false;let isShowingFallbackData=false;if(globalSelectedProduct){// Add null checks to prevent undefined access errors\nif(ratesByProduct&&ratesByProduct[globalSelectedProduct]){const productSampleSize=ratesByProduct[globalSelectedProduct].total_sample_size||0;// Only show product-specific data if it has at least 10 users\nif(productSampleSize>=10){// Product has sufficient data for this lifecycle type\ndisplayRates=ratesByProduct[globalSelectedProduct];isShowingProductData=true;}else{// Product has data but insufficient sample size - use aggregate as fallback\ndisplayRates=aggregateRates;isShowingFallbackData=true;}}else{// Product selected but no data for this lifecycle type - use aggregate as fallback\ndisplayRates=aggregateRates;isShowingFallbackData=true;}}const ratesByDay=displayRates.rates_by_day;const sortedDays=Object.keys(ratesByDay).map(Number).sort((a,b)=>a-b);// Get sample size for display\nconst sampleSize=displayRates.total_sample_size||0;// Create a mock rateCalculationData structure for the lookback info function\n// But use real extension info from the backend if available\nlet extensionInfo={extension_days_used:displayRates.extension_days_used||0,total_sample_size:sampleSize,attempts_made:displayRates.extension_attempts||1,per_product_info:{}};// Use real extension info from the backend if available\nif(rateExtensionInfo&&Object.keys(rateExtensionInfo).length>0){extensionInfo=rateExtensionInfo;}// If we have a selected product, make sure its info is included\nif(globalSelectedProduct&&ratesByProduct[globalSelectedProduct]){const productRates=ratesByProduct[globalSelectedProduct];if(!extensionInfo.per_product_info[globalSelectedProduct]){extensionInfo.per_product_info[globalSelectedProduct]={extension_days_used:productRates.extension_days_used||0,final_sample_size:productRates.total_sample_size||0,attempts_made:productRates.extension_attempts||1,user_counts_by_step:productRates.user_counts_by_step||{}};}}const mockRateCalculationData={aggregate_rates:displayRates,rates_by_product:ratesByProduct,extension_info:extensionInfo};// Prepare row data based on table type - only 4 rows per table\nlet rowData=[];if(isTrialOutcomeTable){// Trial Started table - show only cancellation metrics\nrowData=[{metric:\"Raw Daily Cancellation %\",dataKey:\"raw_daily_cancellation_rate\",bgClass:\"bg-red-50 dark:bg-red-900/20\",textClass:\"text-red-700 dark:text-red-300\"},{metric:\"Smoothed Daily Cancellation %\",dataKey:\"smoothed_daily_cancellation_rate\",bgClass:\"bg-red-100 dark:bg-red-900/30\",textClass:\"text-red-800 dark:text-red-200\"},{metric:\"Raw Cumulative Cancellation %\",dataKey:\"raw_cumulative_cancellation_rate\",bgClass:\"bg-red-150 dark:bg-red-900/40\",textClass:\"text-red-800 dark:text-red-200\"},{metric:\"Smoothed Cumulative Cancellation %\",dataKey:\"smoothed_cumulative_cancellation_rate\",bgClass:\"bg-red-200 dark:bg-red-900/50\",textClass:\"text-red-900 dark:text-red-100\"}];}else if(isCancellationTable){// Cancellation table - red theme\nrowData=[{metric:\"Raw Daily Cancellation %\",dataKey:\"raw_daily_cancellation_rate\",bgClass:\"bg-red-50 dark:bg-red-900/20\",textClass:\"text-red-700 dark:text-red-300\"},{metric:\"Smoothed Daily Cancellation %\",dataKey:\"smoothed_daily_cancellation_rate\",bgClass:\"bg-red-100 dark:bg-red-900/30\",textClass:\"text-red-800 dark:text-red-200\"},{metric:\"Raw Cumulative Cancellation %\",dataKey:\"raw_cumulative_cancellation_rate\",bgClass:\"bg-red-150 dark:bg-red-900/40\",textClass:\"text-red-800 dark:text-red-200\"},{metric:\"Smoothed Cumulative Cancellation %\",dataKey:\"smoothed_cumulative_cancellation_rate\",bgClass:\"bg-red-200 dark:bg-red-900/50\",textClass:\"text-red-900 dark:text-red-100\"}];}else if(isRefundTable){// Refund table - blue theme\nrowData=[{metric:\"Raw Daily Refund %\",dataKey:\"raw_daily_refund_rate\",bgClass:\"bg-blue-50 dark:bg-blue-900/20\",textClass:\"text-blue-700 dark:text-blue-300\"},{metric:\"Smoothed Daily Refund %\",dataKey:\"smoothed_daily_refund_rate\",bgClass:\"bg-blue-100 dark:bg-blue-900/30\",textClass:\"text-blue-800 dark:text-blue-200\"},{metric:\"Raw Cumulative Refund %\",dataKey:\"raw_cumulative_refund_rate\",bgClass:\"bg-blue-150 dark:bg-blue-900/40\",textClass:\"text-blue-800 dark:text-blue-200\"},{metric:\"Smoothed Cumulative Refund %\",dataKey:\"smoothed_cumulative_refund_rate\",bgClass:\"bg-blue-200 dark:bg-blue-900/50\",textClass:\"text-blue-900 dark:text-blue-100\"}];}return/*#__PURE__*/_jsxs(\"div\",{className:\"mb-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between mb-4\",children:[/*#__PURE__*/_jsx(\"h4\",{className:\"text-lg font-semibold text-gray-900 dark:text-white\",children:title}),/*#__PURE__*/_jsxs(\"button\",{onClick:()=>openChartModal(title,ratesData),className:\"px-3 py-1 bg-blue-600 hover:bg-blue-700 text-white text-sm rounded-md transition-colors duration-200 flex items-center space-x-1\",children:[/*#__PURE__*/_jsx(LineChart,{size:16}),/*#__PURE__*/_jsx(\"span\",{children:\"Chart\"})]})]}),renderSampleSizeInfo(displayRates,globalSelectedProduct,title,mockRateCalculationData,isShowingProductData,isShowingFallbackData),/*#__PURE__*/_jsxs(\"div\",{className:\"mb-4 p-3 bg-blue-50 dark:bg-blue-900/30 rounded-lg\",children:[/*#__PURE__*/_jsx(\"h5\",{className:\"font-semibold text-blue-800 dark:text-blue-200 mb-2\",children:\"Smoothing Method Information\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm text-blue-700 dark:text-blue-300\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Method:\"}),\" \",displayRates.smoothing_method||'none']}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Quality:\"}),\" \",displayRates.smoothing_quality||'N/A']}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Sample Size:\"}),\" \",sampleSize]})]}),displayRates.smoothing_details&&/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{children:/*#__PURE__*/_jsx(\"strong\",{children:\"Data Characteristics:\"})}),/*#__PURE__*/_jsx(\"ul\",{className:\"ml-4 mt-1\",children:displayRates.smoothing_details.cancellation&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"li\",{children:[\"Early Concentration: \",displayRates.smoothing_details.cancellation.early_concentration]}),/*#__PURE__*/_jsxs(\"li\",{children:[\"Sparsity: \",displayRates.smoothing_details.cancellation.sparsity]}),/*#__PURE__*/_jsxs(\"li\",{children:[\"Max Rate: \",displayRates.smoothing_details.cancellation.max_rate]})]})})]})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"bg-gray-50 dark:bg-gray-800 border-r border-gray-200 dark:border-gray-700\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"px-4 py-3 font-medium text-gray-900 dark:text-white border-b border-gray-200 dark:border-gray-700\",children:\"Metric\"}),rowData.map((row,index)=>/*#__PURE__*/_jsx(\"div\",{className:\"px-4 py-3 text-sm border-b border-gray-200 dark:border-gray-700 \".concat(row.bgClass,\" \").concat(row.textClass,\" font-medium\"),children:row.metric},index))]}),/*#__PURE__*/_jsx(\"div\",{className:\"flex-1 overflow-x-auto\",children:/*#__PURE__*/_jsx(\"div\",{className:\"flex\",children:sortedDays.map(day=>{const dayStr=day.toString();const dayData=ratesByDay[dayStr];return/*#__PURE__*/_jsxs(\"div\",{className:\"min-w-[100px] border-r border-gray-200 dark:border-gray-700 last:border-r-0\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"px-4 py-3 bg-gray-50 dark:bg-gray-800 font-medium text-gray-900 dark:text-white text-center border-b border-gray-200 dark:border-gray-700\",children:[\"Day \",day]}),rowData.map((row,index)=>/*#__PURE__*/_jsxs(\"div\",{className:\"px-4 py-3 text-sm text-center border-b border-gray-200 dark:border-gray-700 \".concat(row.bgClass,\" \").concat(row.textClass),children:[dayData?(dayData[row.dataKey]||0).toFixed(2):'0.00',\"%\"]},index))]},dayStr);})})})]})})]});};// Chart Modal Component\nconst ChartModal=()=>{if(!chartModalData)return null;const{title,ratesData}=chartModalData;// Determine table type from title\nconst isCancellationTable=title.toLowerCase().includes('cancelled');const isRefundTable=title.toLowerCase().includes('refund');const isTrialOutcomeTable=title.toLowerCase().includes('trial started');const prepareChartData=()=>{// Handle the correct data structure from lifecycle_calculator.py\n// ratesData might be the complete structure with aggregate_rates, rates_by_product, etc.\n// OR it might be the direct rates data\nconsole.log('Chart ratesData:',ratesData);// Determine the correct rates to use based on current product selection and data structure\nlet displayRates=null;if(ratesData.aggregate_rates){// New complete structure - use the same logic as the table\nconst aggregateRates=ratesData.aggregate_rates;const ratesByProduct=ratesData.rates_by_product||{};if(globalSelectedProduct&&ratesByProduct[globalSelectedProduct]){const productSampleSize=ratesByProduct[globalSelectedProduct].total_sample_size||0;if(productSampleSize>=10){displayRates=ratesByProduct[globalSelectedProduct];}else{displayRates=aggregateRates;}}else{displayRates=aggregateRates;}}else if(ratesData.rates_by_day){// Direct rates structure\ndisplayRates=ratesData;}else{console.log('No valid rates structure found in:',ratesData);return[];}if(!displayRates||!displayRates.rates_by_day){console.log('No rates_by_day found in displayRates:',displayRates);return[];}const ratesByDay=displayRates.rates_by_day;const sortedDays=Object.keys(ratesByDay).map(Number).sort((a,b)=>a-b);console.log('Chart sortedDays:',sortedDays);console.log('Chart ratesByDay sample:',ratesByDay[sortedDays[0]]);return sortedDays.map(day=>{const dayData=ratesByDay[day.toString()];const chartPoint={day};if(isTrialOutcomeTable){// Trial Started table - show only cancellation metrics\nchartPoint.rawDailyCancellation=(dayData===null||dayData===void 0?void 0:dayData.raw_daily_cancellation_rate)||0;chartPoint.smoothedDailyCancellation=(dayData===null||dayData===void 0?void 0:dayData.smoothed_daily_cancellation_rate)||0;chartPoint.rawCumulativeCancellation=(dayData===null||dayData===void 0?void 0:dayData.raw_cumulative_cancellation_rate)||0;chartPoint.smoothedCumulativeCancellation=(dayData===null||dayData===void 0?void 0:dayData.smoothed_cumulative_cancellation_rate)||0;// Add conversion probability data for trial-to-outcome tables\nchartPoint.conversionProbabilityFromDayOnward=((dayData===null||dayData===void 0?void 0:dayData.conversion_probability_from_day_onward)||0)*100;// Convert to percentage\nchartPoint.survivalProbabilityThisDay=((dayData===null||dayData===void 0?void 0:dayData.survival_probability_this_day)||0)*100;// Convert to percentage\n}else if(isCancellationTable){// Only cancellation metrics for cancellation tables\nchartPoint.rawDailyCancellation=(dayData===null||dayData===void 0?void 0:dayData.raw_daily_cancellation_rate)||0;chartPoint.smoothedDailyCancellation=(dayData===null||dayData===void 0?void 0:dayData.smoothed_daily_cancellation_rate)||0;chartPoint.rawCumulativeCancellation=(dayData===null||dayData===void 0?void 0:dayData.raw_cumulative_cancellation_rate)||0;chartPoint.smoothedCumulativeCancellation=(dayData===null||dayData===void 0?void 0:dayData.smoothed_cumulative_cancellation_rate)||0;}else if(isRefundTable){// Only refund metrics for refund tables\nchartPoint.rawDailyRefund=(dayData===null||dayData===void 0?void 0:dayData.raw_daily_refund_rate)||0;chartPoint.smoothedDailyRefund=(dayData===null||dayData===void 0?void 0:dayData.smoothed_daily_refund_rate)||0;chartPoint.rawCumulativeRefund=(dayData===null||dayData===void 0?void 0:dayData.raw_cumulative_refund_rate)||0;chartPoint.smoothedCumulativeRefund=(dayData===null||dayData===void 0?void 0:dayData.smoothed_cumulative_refund_rate)||0;// Add refund probability data for refund tables\nchartPoint.totalRefundProbability=((dayData===null||dayData===void 0?void 0:dayData.total_refund_probability)||0)*100;// Convert to percentage\nchartPoint.noRefundProbability=((dayData===null||dayData===void 0?void 0:dayData.no_refund_probability)||0)*100;// Convert to percentage\n}return chartPoint;});};const customTooltip=_ref3=>{let{active,payload,label}=_ref3;if(active&&payload&&payload.length){return/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white dark:bg-gray-800 p-3 border border-gray-200 dark:border-gray-700 rounded-lg shadow-lg\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"font-semibold text-gray-900 dark:text-white\",children:\"Day \".concat(label)}),payload.map((entry,index)=>/*#__PURE__*/_jsx(\"p\",{style:{color:entry.color},className:\"text-sm\",children:\"\".concat(entry.name,\": \").concat(entry.value.toFixed(2),\"%\")},index))]});}return null;};const chartData=prepareChartData();// Define lines based on table type\nconst getChartLines=()=>{if(isTrialOutcomeTable){return[{dataKey:'rawDailyCancellation',name:'Raw Daily Cancellation',stroke:'#dc2626',strokeDasharray:'0'},{dataKey:'smoothedDailyCancellation',name:'Smoothed Daily Cancellation',stroke:'#dc2626',strokeDasharray:'5 5'},{dataKey:'rawCumulativeCancellation',name:'Raw Cumulative Cancellation',stroke:'#b91c1c',strokeDasharray:'0'},{dataKey:'smoothedCumulativeCancellation',name:'Smoothed Cumulative Cancellation',stroke:'#b91c1c',strokeDasharray:'5 5'}];}else if(isCancellationTable){return[{dataKey:'rawDailyCancellation',name:'Raw Daily Cancellation',stroke:'#dc2626',strokeDasharray:'0'},{dataKey:'smoothedDailyCancellation',name:'Smoothed Daily Cancellation',stroke:'#dc2626',strokeDasharray:'5 5'},{dataKey:'rawCumulativeCancellation',name:'Raw Cumulative Cancellation',stroke:'#b91c1c',strokeDasharray:'0'},{dataKey:'smoothedCumulativeCancellation',name:'Smoothed Cumulative Cancellation',stroke:'#b91c1c',strokeDasharray:'5 5'}];}else if(isRefundTable){return[{dataKey:'rawDailyRefund',name:'Raw Daily Refund',stroke:'#2563eb',strokeDasharray:'0'},{dataKey:'smoothedDailyRefund',name:'Smoothed Daily Refund',stroke:'#2563eb',strokeDasharray:'5 5'},{dataKey:'rawCumulativeRefund',name:'Raw Cumulative Refund',stroke:'#1d4ed8',strokeDasharray:'0'},{dataKey:'smoothedCumulativeRefund',name:'Smoothed Cumulative Refund',stroke:'#1d4ed8',strokeDasharray:'5 5'}];}return[];};// Define conversion probability lines for trial-to-outcome tables\nconst getConversionProbabilityLines=()=>{if(isTrialOutcomeTable){return[{dataKey:'conversionProbabilityFromDayOnward',name:'Conversion Probability from Day Onward',stroke:'#059669',strokeDasharray:'0',strokeWidth:3},{dataKey:'survivalProbabilityThisDay',name:'Daily Survival Probability',stroke:'#10b981',strokeDasharray:'5 5',strokeWidth:2}];}return[];};// Define refund probability lines for refund tables\nconst getRefundProbabilityLines=()=>{if(isRefundTable){return[{dataKey:'totalRefundProbability',name:'Total Refund Probability',stroke:'#dc2626',strokeDasharray:'0',strokeWidth:3},{dataKey:'noRefundProbability',name:'No Refund Probability (Retention)',stroke:'#059669',strokeDasharray:'5 5',strokeWidth:3}];}return[];};const chartLines=getChartLines();const conversionProbabilityLines=getConversionProbabilityLines();const refundProbabilityLines=getRefundProbabilityLines();return/*#__PURE__*/_jsx(\"div\",{className:\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\",children:/*#__PURE__*/_jsx(\"div\",{className:\"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-6xl w-full max-h-[90vh] overflow-y-auto\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"p-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between items-center mb-6\",children:[/*#__PURE__*/_jsxs(\"h3\",{className:\"text-xl font-semibold text-gray-900 dark:text-white\",children:[title,\" - Lifecycle Charts\"]}),/*#__PURE__*/_jsx(\"button\",{onClick:closeChartModal,className:\"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200\",children:/*#__PURE__*/_jsx(X,{size:24})})]}),/*#__PURE__*/_jsx(\"div\",{className:\"mb-6 p-4 bg-gray-50 dark:bg-gray-700 rounded-lg\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between\",children:[/*#__PURE__*/_jsxs(\"span\",{className:\"text-sm font-medium text-gray-900 dark:text-white\",children:[\"Current Filter: \",globalSelectedProduct||'All Products (Aggregate)']}),/*#__PURE__*/_jsx(\"span\",{className:\"text-xs text-gray-600 dark:text-gray-400\",children:\"Use the main product toggle to change filter\"})]})}),chartData.length>0?/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-8\",children:[isTrialOutcomeTable&&conversionProbabilityLines.length>0&&/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h4\",{className:\"text-lg font-semibold text-gray-900 dark:text-white mb-4\",children:\"\\uD83C\\uDFAF Revenue Estimation: Conversion Probabilities\"}),/*#__PURE__*/_jsx(\"div\",{className:\"mb-4 p-3 bg-green-50 dark:bg-green-900/30 rounded-lg\",children:/*#__PURE__*/_jsxs(\"p\",{className:\"text-sm text-green-800 dark:text-green-200\",children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Conversion Probability from Day Onward:\"}),\" Shows the likelihood that a user on day X will convert by the end of the trial. This is used in revenue estimation: \",/*#__PURE__*/_jsx(\"code\",{children:\"Expected Revenue = P_convert(x) \\xD7 P_not_refunded \\xD7 ARPU\"})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"h-80\",children:/*#__PURE__*/_jsx(ResponsiveContainer,{width:\"100%\",height:\"100%\",children:/*#__PURE__*/_jsxs(RechartsLineChart,{data:chartData,children:[/*#__PURE__*/_jsx(CartesianGrid,{strokeDasharray:\"3 3\"}),/*#__PURE__*/_jsx(XAxis,{dataKey:\"day\",label:{value:'Trial Day',position:'insideBottom',offset:-5}}),/*#__PURE__*/_jsx(YAxis,{label:{value:'Probability (%)',angle:-90,position:'insideLeft'},domain:[0,100]}),/*#__PURE__*/_jsx(Tooltip,{content:customTooltip}),/*#__PURE__*/_jsx(Legend,{}),conversionProbabilityLines.map((line,index)=>/*#__PURE__*/_jsx(Line,{type:\"monotone\",dataKey:line.dataKey,stroke:line.stroke,strokeDasharray:line.strokeDasharray,name:line.name,strokeWidth:line.strokeWidth||2,dot:{r:4}},index))]})})})]}),isRefundTable&&refundProbabilityLines.length>0&&/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h4\",{className:\"text-lg font-semibold text-gray-900 dark:text-white mb-4\",children:\"\\uD83D\\uDCB0 Revenue Estimation: Refund Probabilities\"}),/*#__PURE__*/_jsx(\"div\",{className:\"mb-4 p-3 bg-blue-50 dark:bg-blue-900/30 rounded-lg\",children:/*#__PURE__*/_jsxs(\"p\",{className:\"text-sm text-blue-800 dark:text-blue-200\",children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Total Refund Probability:\"}),\" The total likelihood of refunding within the refund window.\",/*#__PURE__*/_jsx(\"strong\",{children:\" No Refund Probability:\"}),\" Used in revenue estimation as the retention component.\"]})}),/*#__PURE__*/_jsx(\"div\",{className:\"h-80\",children:/*#__PURE__*/_jsx(ResponsiveContainer,{width:\"100%\",height:\"100%\",children:/*#__PURE__*/_jsxs(RechartsLineChart,{data:chartData,children:[/*#__PURE__*/_jsx(CartesianGrid,{strokeDasharray:\"3 3\"}),/*#__PURE__*/_jsx(XAxis,{dataKey:\"day\",label:{value:'Days Since Conversion',position:'insideBottom',offset:-5}}),/*#__PURE__*/_jsx(YAxis,{label:{value:'Probability (%)',angle:-90,position:'insideLeft'},domain:[0,100]}),/*#__PURE__*/_jsx(Tooltip,{content:customTooltip}),/*#__PURE__*/_jsx(Legend,{}),refundProbabilityLines.map((line,index)=>/*#__PURE__*/_jsx(Line,{type:\"monotone\",dataKey:line.dataKey,stroke:line.stroke,strokeDasharray:line.strokeDasharray,name:line.name,strokeWidth:line.strokeWidth||2,dot:{r:4}},index))]})})})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h4\",{className:\"text-lg font-semibold text-gray-900 dark:text-white mb-4\",children:\"Daily Rates Chart\"}),/*#__PURE__*/_jsx(\"div\",{className:\"h-80\",children:/*#__PURE__*/_jsx(ResponsiveContainer,{width:\"100%\",height:\"100%\",children:/*#__PURE__*/_jsxs(RechartsLineChart,{data:chartData,children:[/*#__PURE__*/_jsx(CartesianGrid,{strokeDasharray:\"3 3\"}),/*#__PURE__*/_jsx(XAxis,{dataKey:\"day\",label:{value:'Days',position:'insideBottom',offset:-5}}),/*#__PURE__*/_jsx(YAxis,{label:{value:'Rate (%)',angle:-90,position:'insideLeft'}}),/*#__PURE__*/_jsx(Tooltip,{content:customTooltip}),/*#__PURE__*/_jsx(Legend,{}),chartLines.filter(line=>line.dataKey.includes('Daily')||line.dataKey.includes('daily')).map((line,index)=>/*#__PURE__*/_jsx(Line,{type:\"monotone\",dataKey:line.dataKey,stroke:line.stroke,strokeDasharray:line.strokeDasharray,name:line.name,strokeWidth:2,dot:{r:3}},index))]})})})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h4\",{className:\"text-lg font-semibold text-gray-900 dark:text-white mb-4\",children:\"Cumulative Rates Chart\"}),/*#__PURE__*/_jsx(\"div\",{className:\"h-80\",children:/*#__PURE__*/_jsx(ResponsiveContainer,{width:\"100%\",height:\"100%\",children:/*#__PURE__*/_jsxs(RechartsLineChart,{data:chartData,children:[/*#__PURE__*/_jsx(CartesianGrid,{strokeDasharray:\"3 3\"}),/*#__PURE__*/_jsx(XAxis,{dataKey:\"day\",label:{value:'Days',position:'insideBottom',offset:-5}}),/*#__PURE__*/_jsx(YAxis,{label:{value:'Rate (%)',angle:-90,position:'insideLeft'}}),/*#__PURE__*/_jsx(Tooltip,{content:customTooltip}),/*#__PURE__*/_jsx(Legend,{}),chartLines.filter(line=>line.dataKey.includes('Cumulative')||line.dataKey.includes('cumulative')).map((line,index)=>/*#__PURE__*/_jsx(Line,{type:\"monotone\",dataKey:line.dataKey,stroke:line.stroke,strokeDasharray:line.strokeDasharray,name:line.name,strokeWidth:2,dot:{r:3}},index))]})})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mt-6 p-4 bg-blue-50 dark:bg-blue-900/30 rounded-lg\",children:[/*#__PURE__*/_jsx(\"h5\",{className:\"font-semibold text-blue-800 dark:text-blue-200 mb-2\",children:\"Chart Information\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-sm text-blue-700 dark:text-blue-300 space-y-1\",children:[/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Solid lines:\"}),\" Raw data points\"]}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Dashed lines:\"}),\" Smoothed data (when available)\"]}),isTrialOutcomeTable&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Red colors:\"}),\" Cancellation metrics (Trial Started \\u2192 Cancelled)\"]}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Green colors:\"}),\" Conversion probabilities (used for revenue estimation)\"]}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Thick green line:\"}),\" Pre-calculated conversion probability from each day onward\"]})]}),isCancellationTable&&/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Red colors:\"}),\" Cancellation metrics\"]}),isRefundTable&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Blue colors:\"}),\" Refund metrics\"]}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Red/Green colors:\"}),\" Refund probabilities (used for revenue estimation)\"]}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Thick lines:\"}),\" Pre-calculated total refund probabilities\"]})]})]})]})]}):/*#__PURE__*/_jsx(\"div\",{className:\"text-center py-8\",children:/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-500 dark:text-gray-400\",children:\"No chart data available for this lifecycle analysis.\"})})]})})});};// Breakdown Modal Component\nconst BreakdownModal=()=>{if(!breakdownModalData)return null;const{title,rateCalculationData}=breakdownModalData;// Extract per-product information from the rate calculation data\nconst extensionInfo=rateCalculationData.extension_info;const perProductInfo=(extensionInfo===null||extensionInfo===void 0?void 0:extensionInfo.per_product_info)||{};const aggregateRates=rateCalculationData.aggregate_rates;const ratesByProduct=rateCalculationData.rates_by_product||{};// Get ALL products from the global product list, not just ones with data for this lifecycle\nconst allAvailableProducts=getAllAvailableProducts();return/*#__PURE__*/_jsx(\"div\",{className:\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\",children:/*#__PURE__*/_jsx(\"div\",{className:\"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"p-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between items-center mb-6\",children:[/*#__PURE__*/_jsxs(\"h3\",{className:\"text-xl font-semibold text-gray-900 dark:text-white\",children:[title,\" - Product Breakdown\"]}),/*#__PURE__*/_jsx(\"button\",{onClick:closeBreakdownModal,className:\"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200\",children:/*#__PURE__*/_jsx(X,{size:24})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mb-6 p-4 bg-blue-50 dark:bg-blue-900/30 rounded-lg\",children:[/*#__PURE__*/_jsx(\"h4\",{className:\"text-lg font-semibold text-blue-800 dark:text-blue-200 mb-2\",children:\"Aggregate Summary\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm\",children:[/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsxs(\"p\",{className:\"text-blue-700 dark:text-blue-300\",children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Total Users:\"}),\" \",(aggregateRates===null||aggregateRates===void 0?void 0:aggregateRates.total_sample_size)||0]})}),/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsxs(\"p\",{className:\"text-blue-700 dark:text-blue-300\",children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Extension Used:\"}),\" \",(aggregateRates===null||aggregateRates===void 0?void 0:aggregateRates.extension_days_used)||0,\" days\"]})}),/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsxs(\"p\",{className:\"text-blue-700 dark:text-blue-300\",children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Products with Data:\"}),\" \",Object.keys(ratesByProduct).length]})})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-4\",children:[/*#__PURE__*/_jsxs(\"h4\",{className:\"text-lg font-semibold text-gray-900 dark:text-white\",children:[\"Per-Product Details (\",allAvailableProducts.length,\" products)\"]}),allAvailableProducts.map(productId=>{const productInfo=perProductInfo[productId]||{};const productRates=ratesByProduct[productId]||{};const finalSampleSize=productInfo.final_sample_size||productRates.total_sample_size||0;const extensionDays=productInfo.extension_days_used||productRates.extension_days_used||0;const attempts=productInfo.attempts_made||productRates.extension_attempts||1;// Determine status\nlet status='No Data';let statusColor='text-gray-500';let bgColor='bg-gray-50 dark:bg-gray-700';if(finalSampleSize>=10){status='Sufficient Data';statusColor='text-green-600 dark:text-green-400';bgColor='bg-green-50 dark:bg-green-900/20';}else if(finalSampleSize>0){status='Insufficient Data (<10 users)';statusColor='text-orange-600 dark:text-orange-400';bgColor='bg-orange-50 dark:bg-orange-900/20';}// Create lookback breakdown text\nlet lookbackText='No lookback data available';if(productInfo.final_sample_size!==undefined||productRates.total_sample_size!==undefined){// Check if we have detailed step-by-step breakdown from backend\nconst stepCounts=productInfo.user_counts_by_step;if(stepCounts){const base=stepCounts.base||0;const thirtyDays=stepCounts[\"30_days\"]||0;const sixtyDays=stepCounts[\"60_days\"]||0;if(extensionDays===0){lookbackText=\"Base: \".concat(base);}else if(extensionDays===30){lookbackText=\"Base: \".concat(base,\", +0-30: \").concat(thirtyDays);}else if(extensionDays===60){lookbackText=\"Base: \".concat(base,\", +0-30: \").concat(thirtyDays,\", +31-60: \").concat(sixtyDays);}}else{// Fallback to old format if detailed breakdown not available\nif(extensionDays===0){lookbackText=\"Base: \".concat(finalSampleSize);}else if(extensionDays===30){lookbackText=\"Base: ?, +0-30: \".concat(finalSampleSize,\" (final)\");}else if(extensionDays===60){lookbackText=\"Base: ?, +0-30: ?, +31-60: \".concat(finalSampleSize,\" (final)\");}}}return/*#__PURE__*/_jsxs(\"div\",{className:\"p-4 rounded-lg border \".concat(bgColor,\" border-gray-200 dark:border-gray-600\"),children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between mb-2\",children:[/*#__PURE__*/_jsx(\"h5\",{className:\"font-medium text-gray-900 dark:text-white\",children:productId}),/*#__PURE__*/_jsx(\"span\",{className:\"text-sm font-medium \".concat(statusColor),children:status})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-4 gap-4 text-sm text-gray-600 dark:text-gray-400\",children:[/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Final Users:\"}),\" \",finalSampleSize]})}),/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Extension:\"}),\" \",extensionDays,\" days\"]})}),/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Attempts:\"}),\" \",attempts]})}),/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Used in Display:\"}),\" \",globalSelectedProduct===productId?finalSampleSize>=10?'Yes (Product-specific)':'No (Fallback to aggregate)':'N/A']})})]}),/*#__PURE__*/_jsx(\"div\",{className:\"mt-2 text-xs text-gray-500 dark:text-gray-400\",children:/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Lookback breakdown:\"}),\" \",lookbackText]})})]},productId);})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mt-6 p-4 bg-gray-50 dark:bg-gray-700 rounded-lg\",children:[/*#__PURE__*/_jsx(\"h5\",{className:\"font-semibold text-gray-800 dark:text-gray-200 mb-2\",children:\"How This Works\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-sm text-gray-600 dark:text-gray-400 space-y-1\",children:[/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Lookback Strategy:\"}),\" Each product tries to reach 100+ users by extending lookback period (Base \\u2192 +0-30 days \\u2192 +31-60 days)\"]}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Display Logic:\"}),\" Product-specific data shown only if \\u226510 users, otherwise falls back to aggregate\"]}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Aggregate:\"}),\" Combined data from all products that have sufficient data\"]}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Current Filter:\"}),\" \",globalSelectedProduct||'All Products (Aggregate)']}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Note:\"}),\" Products with \\\"No Data\\\" for this lifecycle type don't participate in the aggregate calculation\"]})]})]})]})})});};if(!data){return/*#__PURE__*/_jsx(\"div\",{className:\"p-6 bg-gray-50 dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700\",children:/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-500 dark:text-gray-400\",children:\"No lifecycle rate data available.\"})});}// Define the exact order of tables as requested\nconst lifecycleTableOrder=[{key:'trial_to_outcome',title:'Trial Started → Cancelled',dataKey:'trial_to_outcome'},{key:'trial_converted_to_cancellation',title:'Trial Converted → Cancelled',dataKey:'trial_converted_to_cancellation'},{key:'trial_converted_to_refund',title:'Trial Converted → Refunded',dataKey:'trial_converted_to_refund'},{key:'initial_purchase_to_cancellation',title:'Initial Purchase → Cancelled',dataKey:'initial_purchase_to_cancellation'},{key:'initial_purchase_to_refund',title:'Initial Purchase → Refunded',dataKey:'initial_purchase_to_refund'},{key:'renewal_to_cancellation',title:'Renewal → Cancelled',dataKey:'renewal_to_cancellation'},{key:'renewal_to_refund',title:'Renewal → Refunded',dataKey:'renewal_to_refund'}];return/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-6\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"p-4 bg-blue-50 dark:bg-blue-900/30 rounded-lg border border-blue-200 dark:border-blue-700\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg font-semibold text-blue-800 dark:text-blue-200\",children:\"Lifecycle Analysis - Product Filter\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-blue-600 dark:text-blue-300\",children:globalSelectedProduct?\"Showing data for: \".concat(globalSelectedProduct):'Showing aggregate data across all products'}),/*#__PURE__*/_jsx(\"p\",{className:\"text-xs text-blue-500 dark:text-blue-400 mt-1\",children:\"Note: Product-specific data requires minimum 10 users per lifecycle type. Tables with fewer users will show aggregate data.\"})]}),/*#__PURE__*/_jsxs(\"select\",{value:globalSelectedProduct||'',onChange:e=>setGlobalSelectedProduct(e.target.value||null),className:\"px-4 py-2 border border-blue-300 dark:border-blue-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"All Products (Aggregate)\"}),productList.map(productId=>/*#__PURE__*/_jsx(\"option\",{value:productId,children:productId},productId))]})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"space-y-8\",children:lifecycleTableOrder.map(tableConfig=>{// Add safety check for aggregate data\nconst ratesData=aggregate&&aggregate[tableConfig.dataKey]?aggregate[tableConfig.dataKey]:null;if(!ratesData){return/*#__PURE__*/_jsx(\"div\",{className:\"mb-4 p-3 bg-gray-50 dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between\",children:[/*#__PURE__*/_jsx(\"h4\",{className:\"text-sm font-medium text-gray-900 dark:text-white\",children:tableConfig.title}),/*#__PURE__*/_jsx(\"span\",{className:\"text-xs text-gray-500 dark:text-gray-400\",children:\"No data available\"})]})},tableConfig.key);}return renderLifecycleTable(tableConfig.title,ratesData);})}),showChartModal&&/*#__PURE__*/_jsx(ChartModal,{}),showBreakdownModal&&/*#__PURE__*/_jsx(BreakdownModal,{})]});};export default LifecycleRatesTable;","map":{"version":3,"names":["React","useState","LineChart","X","HelpCircle","RechartsLineChart","Line","XAxis","YAxis","CartesianGrid","Tooltip","Legend","ResponsiveContainer","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","LifecycleRatesTable","_ref","_data$data","_data$data2","_data$data2$structure","_data$data3","_data$structured_form","data","globalSelectedProduct","setGlobalSelectedProduct","showChartModal","setShowChartModal","chartModalData","setChartModalData","showBreakdownModal","setShowBreakdownModal","breakdownModalData","setBreakdownModalData","lifecycleData","console","log","lifecycle_rates","structured_format","lifecycle_analysis","legacy_format","legacyData","aggregate","trial_to_outcome","rates_by_day","smoothing_method","smoothing_quality","total_sample_size","per_product","metadata","calculation_method","message","className","children","perProduct","extractLookbackInfo","rateCalculationData","tableTitle","aggregateRates","aggregate_rates","extensionInfo","extension_info","extensionDays","extension_days_used","totalSampleSize","attempts","extension_attempts","attempts_made","perProductInfo","per_product_info","Object","keys","length","breakdown","values","forEach","productInfo","sampleSize","final_sample_size","totalSize","simulateLookbackInfo","ratesData","_ratesData$aggregate_","includes","Math","floor","renderSampleSizeInfo","displayRates","isShowingProductData","isShowingFallbackData","lookbackInfo","productSampleSize","isBelowThreshold","rates_by_product","actualExtensionDays","onClick","openBreakdownModal","title","size","entries","map","_ref2","days","count","concat","getAllAvailableProducts","allAvailableProducts","Set","productId","add","rateData","Array","from","sort","productList","openChartModal","closeChartModal","closeBreakdownModal","renderLifecycleTable","denominatorKey","arguments","undefined","isCancellationTable","toLowerCase","isRefundTable","isTrialOutcomeTable","ratesByProduct","rateExtensionInfo","currentTableKey","ratesByDay","sortedDays","Number","a","b","productRates","user_counts_by_step","mockRateCalculationData","rowData","metric","dataKey","bgClass","textClass","smoothing_details","cancellation","early_concentration","sparsity","max_rate","row","index","day","dayStr","toString","dayData","toFixed","ChartModal","prepareChartData","chartPoint","rawDailyCancellation","raw_daily_cancellation_rate","smoothedDailyCancellation","smoothed_daily_cancellation_rate","rawCumulativeCancellation","raw_cumulative_cancellation_rate","smoothedCumulativeCancellation","smoothed_cumulative_cancellation_rate","conversionProbabilityFromDayOnward","conversion_probability_from_day_onward","survivalProbabilityThisDay","survival_probability_this_day","rawDailyRefund","raw_daily_refund_rate","smoothedDailyRefund","smoothed_daily_refund_rate","rawCumulativeRefund","raw_cumulative_refund_rate","smoothedCumulativeRefund","smoothed_cumulative_refund_rate","totalRefundProbability","total_refund_probability","noRefundProbability","no_refund_probability","customTooltip","_ref3","active","payload","label","entry","style","color","name","value","chartData","getChartLines","stroke","strokeDasharray","getConversionProbabilityLines","strokeWidth","getRefundProbabilityLines","chartLines","conversionProbabilityLines","refundProbabilityLines","width","height","position","offset","angle","domain","content","line","type","dot","r","filter","BreakdownModal","finalSampleSize","status","statusColor","bgColor","lookbackText","stepCounts","base","thirtyDays","sixtyDays","lifecycleTableOrder","key","onChange","e","target","tableConfig"],"sources":["/Users/joshuakaufman/untitled folder 3/orchestrator/dashboard/client/src/cohort-pipeline/components/LifecycleRatesTable.js"],"sourcesContent":["import React, { useState } from 'react';\nimport { LineChart, X, HelpCircle } from 'lucide-react';\nimport { LineChart as RechartsLineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer } from 'recharts';\n\nconst LifecycleRatesTable = ({ data }) => {\n    const [globalSelectedProduct, setGlobalSelectedProduct] = useState(null);\n    const [showChartModal, setShowChartModal] = useState(false);\n    const [chartModalData, setChartModalData] = useState(null);\n    const [showBreakdownModal, setShowBreakdownModal] = useState(false);\n    const [breakdownModalData, setBreakdownModalData] = useState(null);\n\n    // Handle different data structures - debug mode vs regular mode\n    let lifecycleData = null;\n\n    // Debug: Log the actual data structure\n    console.log('LifecycleRatesTable received data:', data);\n\n    if (data?.data?.lifecycle_rates) {\n        // Regular mode: data.data.lifecycle_rates\n        lifecycleData = data.data.lifecycle_rates;\n        console.log('Using regular mode lifecycle_rates:', lifecycleData);\n    } else if (data?.data?.structured_format?.lifecycle_analysis) {\n        // Debug mode: data.data.structured_format.lifecycle_analysis\n        lifecycleData = data.data.structured_format.lifecycle_analysis;\n        console.log('Using debug mode structured_format.lifecycle_analysis:', lifecycleData);\n    } else if (data?.data?.legacy_format) {\n        // Debug mode: data.data.legacy_format (fallback)\n        const legacyData = data.data.legacy_format;\n        console.log('Using debug mode legacy_format:', legacyData);\n        lifecycleData = {\n            aggregate: {\n                trial_to_outcome: {\n                    rates_by_day: legacyData.lifecycle_rates || {},\n                    smoothing_method: legacyData.smoothing_method || 'none',\n                    smoothing_quality: legacyData.smoothing_quality || 'N/A',\n                    total_sample_size: legacyData.total_sample_size || 0\n                }\n            },\n            per_product: {},\n            metadata: {\n                calculation_method: 'legacy_format',\n                message: 'Data from legacy format'\n            }\n        };\n    } else if (data?.structured_format?.lifecycle_analysis) {\n        // Debug mode: structured_format.lifecycle_analysis (direct)\n        lifecycleData = data.structured_format.lifecycle_analysis;\n        console.log('Using direct structured_format.lifecycle_analysis:', lifecycleData);\n    } else if (data?.legacy_format) {\n        // Debug mode: legacy_format (direct)\n        const legacyData = data.legacy_format;\n        console.log('Using direct legacy_format:', legacyData);\n        lifecycleData = {\n            aggregate: {\n                trial_to_outcome: {\n                    rates_by_day: legacyData.lifecycle_rates || {},\n                    smoothing_method: legacyData.smoothing_method || 'none',\n                    smoothing_quality: legacyData.smoothing_quality || 'N/A',\n                    total_sample_size: legacyData.total_sample_size || 0\n                }\n            },\n            per_product: {},\n            metadata: {\n                calculation_method: 'legacy_format',\n                message: 'Data from legacy format'\n            }\n        };\n    }\n\n    console.log('Final lifecycleData:', lifecycleData);\n\n    if (!lifecycleData) {\n        return (\n            <div className=\"text-center py-8\">\n                <p className=\"text-gray-500 dark:text-gray-400\">\n                    No lifecycle data available. Run an analysis to see results.\n                </p>\n            </div>\n        );\n    }\n\n    // The backend returns: { aggregate: { trial_to_outcome: {...}, ... }, per_product: { product_id: { trial_to_outcome: {...}, ... } } }\n    const aggregate = lifecycleData.aggregate || {};\n    const perProduct = lifecycleData.per_product || {};\n\n    console.log('Aggregate data:', aggregate);\n    console.log('Per product data:', perProduct);\n\n    // Function to extract lookback information from rate calculation data\n    const extractLookbackInfo = (rateCalculationData, tableTitle) => {\n        // The backend stores lookback info in the rate calculation results\n        // Look for extension_days_used and user count breakdown\n        \n        if (!rateCalculationData) return null;\n        \n        // Check if this is the new product-based format from lifecycle_calculator.py\n        const aggregateRates = rateCalculationData.aggregate_rates;\n        const extensionInfo = rateCalculationData.extension_info;\n        \n        if (aggregateRates && extensionInfo) {\n            // Extract extension information from the backend data\n            const extensionDays = aggregateRates.extension_days_used || extensionInfo?.extension_days_used || 0;\n            const totalSampleSize = aggregateRates.total_sample_size || extensionInfo?.total_sample_size || 0;\n            const attempts = aggregateRates.extension_attempts || extensionInfo?.attempts_made || 1;\n            const perProductInfo = extensionInfo?.per_product_info || {};\n            \n            if (extensionDays > 0 && Object.keys(perProductInfo).length > 0) {\n                // Use real per-product breakdown from backend\n                let breakdown = {};\n                \n                // Aggregate the breakdown from per-product info\n                Object.values(perProductInfo).forEach(productInfo => {\n                    const extensionDays = productInfo.extension_days_used || 0;\n                    const sampleSize = productInfo.final_sample_size || 0;\n                    \n                    if (extensionDays === 0) {\n                        breakdown['0'] = (breakdown['0'] || 0) + sampleSize;\n                    } else if (extensionDays === 30) {\n                        breakdown['30'] = (breakdown['30'] || 0) + sampleSize;\n                    } else if (extensionDays === 60) {\n                        breakdown['60'] = (breakdown['60'] || 0) + sampleSize;\n                    }\n                });\n                \n                return {\n                    extensionDays,\n                    totalSize: totalSampleSize,\n                    breakdown,\n                    attempts,\n                    perProductInfo\n                };\n            }\n        }\n        \n        return null;\n    };\n\n    // Function to simulate lookback information based on typical patterns (fallback only)\n    const simulateLookbackInfo = (ratesData, tableTitle) => {\n        // This is now only used as a fallback when backend data is not available\n        const sampleSize = ratesData?.aggregate_rates?.total_sample_size || ratesData?.total_sample_size || 0;\n        \n        // Only simulate for very specific cases where we know lookback is typically needed\n        if (tableTitle.includes('Renewal') && sampleSize < 10) {\n            return {\n                extensionDays: 60,\n                totalSize: sampleSize,\n                breakdown: {\n                    '0': Math.floor(sampleSize * 0.3),\n                    '30': Math.floor(sampleSize * 0.3),\n                    '60': Math.floor(sampleSize * 0.4)\n                }\n            };\n        }\n        \n        return null;\n    };\n\n    // Function to render sample size with lookback information\n    const renderSampleSizeInfo = (displayRates, globalSelectedProduct, tableTitle, rateCalculationData, isShowingProductData, isShowingFallbackData) => {\n        const sampleSize = displayRates.total_sample_size || 0;\n        const lookbackInfo = extractLookbackInfo(rateCalculationData, tableTitle);\n\n        // Check if we have product data but it's below threshold\n        let productSampleSize = 0;\n        let isBelowThreshold = false;\n        if (globalSelectedProduct && rateCalculationData.rates_by_product && rateCalculationData.rates_by_product[globalSelectedProduct]) {\n            productSampleSize = rateCalculationData.rates_by_product[globalSelectedProduct].total_sample_size || 0;\n            isBelowThreshold = productSampleSize > 0 && productSampleSize < 10;\n        }\n\n        // Get the actual extension days used for the current display\n        let actualExtensionDays = 0;\n        if (isShowingProductData && globalSelectedProduct && rateCalculationData.rates_by_product && rateCalculationData.rates_by_product[globalSelectedProduct]) {\n            actualExtensionDays = rateCalculationData.rates_by_product[globalSelectedProduct].extension_days_used || 0;\n        } else if (!isShowingProductData && rateCalculationData.aggregate_rates) {\n            actualExtensionDays = rateCalculationData.aggregate_rates.extension_days_used || 0;\n        }\n\n    return (\n            <div className=\"mb-4 p-3 bg-gray-50 dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700\">\n                <div className=\"flex items-center justify-between\">\n                    <p className=\"text-sm text-gray-600 dark:text-gray-400\">\n                        Based on <span className=\"font-semibold text-gray-900 dark:text-white\">{sampleSize}</span> users\n                        {isShowingProductData && (\n                            <span className=\"ml-2 text-green-600 dark:text-green-400\">\n                                (Product: {globalSelectedProduct})\n                            </span>\n                        )}\n                        {isShowingFallbackData && !isBelowThreshold && (\n                            <span className=\"ml-2 text-orange-600 dark:text-orange-400\">\n                                (Aggregate data - {globalSelectedProduct} has no data for this lifecycle)\n                            </span>\n                        )}\n                        {isShowingFallbackData && isBelowThreshold && (\n                            <span className=\"ml-2 text-orange-600 dark:text-orange-400\">\n                                (Aggregate data - {globalSelectedProduct} has only {productSampleSize} users, minimum 10 required)\n                            </span>\n                        )}\n                        {!globalSelectedProduct && (\n                            <span className=\"ml-2 text-blue-600 dark:text-blue-400\">\n                                (All Products - Aggregate)\n                            </span>\n                        )}\n                    </p>\n                    \n                    <button\n                        onClick={() => openBreakdownModal(tableTitle, rateCalculationData)}\n                        className=\"ml-2 p-1 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 transition-colors\"\n                        title=\"View detailed breakdown by product\"\n                    >\n                        <HelpCircle size={16} />\n                    </button>\n                </div>\n                \n                {actualExtensionDays > 0 && (\n                    <div className=\"mt-2 p-2 bg-yellow-50 dark:bg-yellow-900/30 rounded border border-yellow-200 dark:border-yellow-700\">\n                        <p className=\"text-xs text-yellow-800 dark:text-yellow-200\">\n                            <strong>Lookback Applied:</strong> Extended {actualExtensionDays} days to capture more starter events\n                        </p>\n                        {lookbackInfo && lookbackInfo.breakdown && (\n                            <div className=\"mt-1 text-xs text-yellow-700 dark:text-yellow-300\">\n                                {Object.entries(lookbackInfo.breakdown).map(([days, count]) => (\n                                    <span key={days} className=\"mr-3\">\n                                        {days === '0' ? 'Base period' : `+${days} days`}: {count} users\n                                    </span>\n                                ))}\n                        </div>\n                        )}\n                    </div>\n                )}\n                        </div>\n        );\n    };\n\n    // Get all available product IDs from lifecycle rates\n    const getAllAvailableProducts = () => {\n        const allAvailableProducts = new Set();\n        \n        // Check per_product structure first (correct structure from lifecycle_calculator.py)\n        if (perProduct && Object.keys(perProduct).length > 0) {\n            Object.keys(perProduct).forEach(productId => {\n                allAvailableProducts.add(productId);\n            });\n        }\n        \n        // Also check aggregate rates for product-based data\n        if (aggregate && typeof aggregate === 'object') {\n            Object.values(aggregate).forEach(rateData => {\n                if (rateData && rateData.rates_by_product) {\n                    Object.keys(rateData.rates_by_product).forEach(productId => {\n                        allAvailableProducts.add(productId);\n                    });\n                }\n            });\n        }\n        \n        return Array.from(allAvailableProducts).sort();\n    };\n\n    const productList = getAllAvailableProducts();\n\n    // Function to open chart modal\n    const openChartModal = (title, ratesData) => {\n        setChartModalData({ title, ratesData });\n        setShowChartModal(true);\n    };\n\n    // Function to close chart modal\n    const closeChartModal = () => {\n        setChartModalData(null);\n        setShowChartModal(false);\n    };\n\n    // Function to open breakdown modal\n    const openBreakdownModal = (title, rateCalculationData) => {\n        setBreakdownModalData({ title, rateCalculationData });\n        setShowBreakdownModal(true);\n    };\n\n    // Function to close breakdown modal\n    const closeBreakdownModal = () => {\n        setBreakdownModalData(null);\n        setShowBreakdownModal(false);\n    };\n\n    // Function to render lifecycle table with precise requirements\n    const renderLifecycleTable = (title, ratesData, denominatorKey = \"rate_denominator_count\") => {\n        if (!ratesData) {\n            return (\n                <div className=\"mb-4 p-3 bg-gray-50 dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700\">\n                    <div className=\"flex items-center justify-between\">\n                        <h4 className=\"text-sm font-medium text-gray-900 dark:text-white\">{title}</h4>\n                        <span className=\"text-xs text-gray-500 dark:text-gray-400\">No data available</span>\n                    </div>\n                </div>\n            );\n        }\n\n        // Determine table type from title to show only relevant metrics\n        const isCancellationTable = title.toLowerCase().includes('cancelled');\n        const isRefundTable = title.toLowerCase().includes('refund');\n        const isTrialOutcomeTable = title.toLowerCase().includes('trial started');\n\n        // Handle the correct data structure from lifecycle_calculator.py\n        // The backend now returns complete rate calculation data including extension_info\n        \n        console.log('renderLifecycleTable - title:', title, 'ratesData:', ratesData);\n        \n        // Check if we have the new complete structure or the old direct structure\n        let aggregateRates, ratesByProduct, rateExtensionInfo;\n        \n        if (ratesData.aggregate_rates) {\n            // New complete structure\n            aggregateRates = ratesData.aggregate_rates;\n            ratesByProduct = ratesData.rates_by_product || {};\n            rateExtensionInfo = ratesData.extension_info || {};\n        } else {\n            // Old direct structure (fallback)\n            aggregateRates = ratesData;\n            ratesByProduct = {};\n            rateExtensionInfo = {};\n        }\n        \n        // Get per-product data for this specific rate type\n        const currentTableKey = title.toLowerCase().includes('trial started') ? 'trial_to_outcome' :\n                               title.toLowerCase().includes('trial converted') && title.toLowerCase().includes('cancelled') ? 'trial_converted_to_cancellation' :\n                               title.toLowerCase().includes('trial converted') && title.toLowerCase().includes('refund') ? 'trial_converted_to_refund' :\n                               title.toLowerCase().includes('initial purchase') && title.toLowerCase().includes('cancelled') ? 'initial_purchase_to_cancellation' :\n                               title.toLowerCase().includes('initial purchase') && title.toLowerCase().includes('refund') ? 'initial_purchase_to_refund' :\n                               title.toLowerCase().includes('renewal') && title.toLowerCase().includes('cancelled') ? 'renewal_to_cancellation' :\n                               title.toLowerCase().includes('renewal') && title.toLowerCase().includes('refund') ? 'renewal_to_refund' : null;\n        \n        // For the new structure, we already have the rates_by_product for this specific lifecycle type\n        // For the old structure, we need to get it from the per-product data\n        if (!ratesData.aggregate_rates && currentTableKey) {\n            Object.keys(perProduct).forEach(productId => {\n                if (perProduct[productId][currentTableKey]) {\n                    ratesByProduct[productId] = perProduct[productId][currentTableKey];\n                }\n            });\n        }\n        \n        if (!aggregateRates || !aggregateRates.rates_by_day || Object.keys(aggregateRates.rates_by_day).length === 0) {\n            return (\n                <div className=\"mb-4 p-3 bg-gray-50 dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700\">\n                    <div className=\"flex items-center justify-between\">\n                        <h4 className=\"text-sm font-medium text-gray-900 dark:text-white\">{title}</h4>\n                        <span className=\"text-xs text-gray-500 dark:text-gray-400\">No data available</span>\n                    </div>\n                </div>\n            );\n        }\n        \n        // Use global product selection to determine which rates to display\n        // If a product is selected but doesn't have data for this lifecycle type, fall back to aggregate\n        let displayRates = aggregateRates;\n        let isShowingProductData = false;\n        let isShowingFallbackData = false;\n        \n        if (globalSelectedProduct) {\n            // Add null checks to prevent undefined access errors\n            if (ratesByProduct && ratesByProduct[globalSelectedProduct]) {\n                const productSampleSize = ratesByProduct[globalSelectedProduct].total_sample_size || 0;\n                \n                // Only show product-specific data if it has at least 10 users\n                if (productSampleSize >= 10) {\n                    // Product has sufficient data for this lifecycle type\n                    displayRates = ratesByProduct[globalSelectedProduct];\n                    isShowingProductData = true;\n                } else {\n                    // Product has data but insufficient sample size - use aggregate as fallback\n                    displayRates = aggregateRates;\n                    isShowingFallbackData = true;\n                }\n            } else {\n                // Product selected but no data for this lifecycle type - use aggregate as fallback\n                displayRates = aggregateRates;\n                isShowingFallbackData = true;\n            }\n        }\n        \n        const ratesByDay = displayRates.rates_by_day;\n        const sortedDays = Object.keys(ratesByDay).map(Number).sort((a, b) => a - b);\n        \n        // Get sample size for display\n        const sampleSize = displayRates.total_sample_size || 0;\n        \n        // Create a mock rateCalculationData structure for the lookback info function\n        // But use real extension info from the backend if available\n        let extensionInfo = {\n            extension_days_used: displayRates.extension_days_used || 0,\n            total_sample_size: sampleSize,\n            attempts_made: displayRates.extension_attempts || 1,\n            per_product_info: {}\n        };\n        \n        // Use real extension info from the backend if available\n        if (rateExtensionInfo && Object.keys(rateExtensionInfo).length > 0) {\n            extensionInfo = rateExtensionInfo;\n        }\n        \n        // If we have a selected product, make sure its info is included\n        if (globalSelectedProduct && ratesByProduct[globalSelectedProduct]) {\n            const productRates = ratesByProduct[globalSelectedProduct];\n            if (!extensionInfo.per_product_info[globalSelectedProduct]) {\n                extensionInfo.per_product_info[globalSelectedProduct] = {\n                    extension_days_used: productRates.extension_days_used || 0,\n                    final_sample_size: productRates.total_sample_size || 0,\n                    attempts_made: productRates.extension_attempts || 1,\n                    user_counts_by_step: productRates.user_counts_by_step || {}\n                };\n            }\n        }\n        \n        const mockRateCalculationData = {\n            aggregate_rates: displayRates,\n            rates_by_product: ratesByProduct,\n            extension_info: extensionInfo\n        };\n        \n        // Prepare row data based on table type - only 4 rows per table\n        let rowData = [];\n        \n        if (isTrialOutcomeTable) {\n            // Trial Started table - show only cancellation metrics\n            rowData = [\n                {\n                    metric: \"Raw Daily Cancellation %\",\n                    dataKey: \"raw_daily_cancellation_rate\",\n                    bgClass: \"bg-red-50 dark:bg-red-900/20\",\n                    textClass: \"text-red-700 dark:text-red-300\"\n                },\n                {\n                    metric: \"Smoothed Daily Cancellation %\", \n                    dataKey: \"smoothed_daily_cancellation_rate\",\n                    bgClass: \"bg-red-100 dark:bg-red-900/30\",\n                    textClass: \"text-red-800 dark:text-red-200\"\n                },\n                {\n                    metric: \"Raw Cumulative Cancellation %\",\n                    dataKey: \"raw_cumulative_cancellation_rate\",\n                    bgClass: \"bg-red-150 dark:bg-red-900/40\",\n                    textClass: \"text-red-800 dark:text-red-200\"\n                },\n                {\n                    metric: \"Smoothed Cumulative Cancellation %\",\n                    dataKey: \"smoothed_cumulative_cancellation_rate\",\n                    bgClass: \"bg-red-200 dark:bg-red-900/50\",\n                    textClass: \"text-red-900 dark:text-red-100\"\n                }\n            ];\n        } else if (isCancellationTable) {\n            // Cancellation table - red theme\n            rowData = [\n                {\n                    metric: \"Raw Daily Cancellation %\",\n                    dataKey: \"raw_daily_cancellation_rate\",\n                    bgClass: \"bg-red-50 dark:bg-red-900/20\",\n                    textClass: \"text-red-700 dark:text-red-300\"\n                },\n                {\n                    metric: \"Smoothed Daily Cancellation %\", \n                    dataKey: \"smoothed_daily_cancellation_rate\",\n                    bgClass: \"bg-red-100 dark:bg-red-900/30\",\n                    textClass: \"text-red-800 dark:text-red-200\"\n                },\n                {\n                    metric: \"Raw Cumulative Cancellation %\",\n                    dataKey: \"raw_cumulative_cancellation_rate\",\n                    bgClass: \"bg-red-150 dark:bg-red-900/40\",\n                    textClass: \"text-red-800 dark:text-red-200\"\n                },\n                {\n                    metric: \"Smoothed Cumulative Cancellation %\",\n                    dataKey: \"smoothed_cumulative_cancellation_rate\",\n                    bgClass: \"bg-red-200 dark:bg-red-900/50\",\n                    textClass: \"text-red-900 dark:text-red-100\"\n                }\n            ];\n        } else if (isRefundTable) {\n            // Refund table - blue theme\n            rowData = [\n                {\n                    metric: \"Raw Daily Refund %\",\n                    dataKey: \"raw_daily_refund_rate\",\n                    bgClass: \"bg-blue-50 dark:bg-blue-900/20\",\n                    textClass: \"text-blue-700 dark:text-blue-300\"\n                },\n                {\n                    metric: \"Smoothed Daily Refund %\",\n                    dataKey: \"smoothed_daily_refund_rate\",\n                    bgClass: \"bg-blue-100 dark:bg-blue-900/30\",\n                    textClass: \"text-blue-800 dark:text-blue-200\"\n                },\n                {\n                    metric: \"Raw Cumulative Refund %\",\n                    dataKey: \"raw_cumulative_refund_rate\",\n                    bgClass: \"bg-blue-150 dark:bg-blue-900/40\",\n                    textClass: \"text-blue-800 dark:text-blue-200\"\n                },\n                {\n                    metric: \"Smoothed Cumulative Refund %\",\n                    dataKey: \"smoothed_cumulative_refund_rate\",\n                    bgClass: \"bg-blue-200 dark:bg-blue-900/50\",\n                    textClass: \"text-blue-900 dark:text-blue-100\"\n                }\n            ];\n        }\n\n        return (\n            <div className=\"mb-6\">\n                <div className=\"flex items-center justify-between mb-4\">\n                    <h4 className=\"text-lg font-semibold text-gray-900 dark:text-white\">{title}</h4>\n                    <button\n                        onClick={() => openChartModal(title, ratesData)}\n                        className=\"px-3 py-1 bg-blue-600 hover:bg-blue-700 text-white text-sm rounded-md transition-colors duration-200 flex items-center space-x-1\"\n                    >\n                        <LineChart size={16} />\n                        <span>Chart</span>\n                    </button>\n                </div>\n                \n                {renderSampleSizeInfo(displayRates, globalSelectedProduct, title, mockRateCalculationData, isShowingProductData, isShowingFallbackData)}\n\n                {/* Smoothing Information */}\n                <div className=\"mb-4 p-3 bg-blue-50 dark:bg-blue-900/30 rounded-lg\">\n                    <h5 className=\"font-semibold text-blue-800 dark:text-blue-200 mb-2\">Smoothing Method Information</h5>\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm text-blue-700 dark:text-blue-300\">\n                        <div>\n                            <p><strong>Method:</strong> {displayRates.smoothing_method || 'none'}</p>\n                            <p><strong>Quality:</strong> {displayRates.smoothing_quality || 'N/A'}</p>\n                            <p><strong>Sample Size:</strong> {sampleSize}</p>\n                        </div>\n                        {displayRates.smoothing_details && (\n                            <div>\n                                <p><strong>Data Characteristics:</strong></p>\n                                <ul className=\"ml-4 mt-1\">\n                                    {displayRates.smoothing_details.cancellation && (\n                                        <>\n                                            <li>Early Concentration: {displayRates.smoothing_details.cancellation.early_concentration}</li>\n                                            <li>Sparsity: {displayRates.smoothing_details.cancellation.sparsity}</li>\n                                            <li>Max Rate: {displayRates.smoothing_details.cancellation.max_rate}</li>\n                                        </>\n                                    )}\n                                </ul>\n                        </div>\n                        )}\n                    </div>\n                </div>\n                \n                {/* Transposed Table with Frozen First Column and Color Coordination */}\n                <div className=\"border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden\">\n                    <div className=\"flex\">\n                        {/* Frozen First Column */}\n                        <div className=\"bg-gray-50 dark:bg-gray-800 border-r border-gray-200 dark:border-gray-700\">\n                            <div className=\"px-4 py-3 font-medium text-gray-900 dark:text-white border-b border-gray-200 dark:border-gray-700\">\n                                Metric\n                            </div>\n                            {rowData.map((row, index) => (\n                                <div key={index} className={`px-4 py-3 text-sm border-b border-gray-200 dark:border-gray-700 ${row.bgClass} ${row.textClass} font-medium`}>\n                                    {row.metric}\n                                </div>\n                            ))}\n                        </div>\n\n                        {/* Scrollable Data Columns */}\n                        <div className=\"flex-1 overflow-x-auto\">\n                            <div className=\"flex\">\n                                {sortedDays.map((day) => {\n                                    const dayStr = day.toString();\n                                    const dayData = ratesByDay[dayStr];\n                                    \n                                    return (\n                                        <div key={dayStr} className=\"min-w-[100px] border-r border-gray-200 dark:border-gray-700 last:border-r-0\">\n                                            {/* Header */}\n                                            <div className=\"px-4 py-3 bg-gray-50 dark:bg-gray-800 font-medium text-gray-900 dark:text-white text-center border-b border-gray-200 dark:border-gray-700\">\n                                                Day {day}\n                                            </div>\n                                            \n                                            {/* Data Cells */}\n                                            {rowData.map((row, index) => (\n                                                <div key={index} className={`px-4 py-3 text-sm text-center border-b border-gray-200 dark:border-gray-700 ${row.bgClass} ${row.textClass}`}>\n                                                    {dayData ? (dayData[row.dataKey] || 0).toFixed(2) : '0.00'}%\n                                                </div>\n                                            ))}\n                                        </div>\n                                    );\n                                })}\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        );\n    };\n\n    // Chart Modal Component\n    const ChartModal = () => {\n        if (!chartModalData) return null;\n\n        const { title, ratesData } = chartModalData;\n        \n        // Determine table type from title\n        const isCancellationTable = title.toLowerCase().includes('cancelled');\n        const isRefundTable = title.toLowerCase().includes('refund');\n        const isTrialOutcomeTable = title.toLowerCase().includes('trial started');\n        \n        const prepareChartData = () => {\n            // Handle the correct data structure from lifecycle_calculator.py\n            // ratesData might be the complete structure with aggregate_rates, rates_by_product, etc.\n            // OR it might be the direct rates data\n            \n            console.log('Chart ratesData:', ratesData);\n            \n            // Determine the correct rates to use based on current product selection and data structure\n            let displayRates = null;\n            \n            if (ratesData.aggregate_rates) {\n                // New complete structure - use the same logic as the table\n                const aggregateRates = ratesData.aggregate_rates;\n                const ratesByProduct = ratesData.rates_by_product || {};\n                \n                if (globalSelectedProduct && ratesByProduct[globalSelectedProduct]) {\n                    const productSampleSize = ratesByProduct[globalSelectedProduct].total_sample_size || 0;\n                    if (productSampleSize >= 10) {\n                        displayRates = ratesByProduct[globalSelectedProduct];\n                    } else {\n                        displayRates = aggregateRates;\n                    }\n                } else {\n                    displayRates = aggregateRates;\n                }\n            } else if (ratesData.rates_by_day) {\n                // Direct rates structure\n                displayRates = ratesData;\n            } else {\n                console.log('No valid rates structure found in:', ratesData);\n                return [];\n            }\n            \n            if (!displayRates || !displayRates.rates_by_day) {\n                console.log('No rates_by_day found in displayRates:', displayRates);\n                return [];\n            }\n            \n            const ratesByDay = displayRates.rates_by_day;\n            const sortedDays = Object.keys(ratesByDay).map(Number).sort((a, b) => a - b);\n            \n            console.log('Chart sortedDays:', sortedDays);\n            console.log('Chart ratesByDay sample:', ratesByDay[sortedDays[0]]);\n            \n            return sortedDays.map(day => {\n                const dayData = ratesByDay[day.toString()];\n                const chartPoint = { day };\n                \n                if (isTrialOutcomeTable) {\n                    // Trial Started table - show only cancellation metrics\n                    chartPoint.rawDailyCancellation = dayData?.raw_daily_cancellation_rate || 0;\n                    chartPoint.smoothedDailyCancellation = dayData?.smoothed_daily_cancellation_rate || 0;\n                    chartPoint.rawCumulativeCancellation = dayData?.raw_cumulative_cancellation_rate || 0;\n                    chartPoint.smoothedCumulativeCancellation = dayData?.smoothed_cumulative_cancellation_rate || 0;\n                    \n                    // Add conversion probability data for trial-to-outcome tables\n                    chartPoint.conversionProbabilityFromDayOnward = (dayData?.conversion_probability_from_day_onward || 0) * 100; // Convert to percentage\n                    chartPoint.survivalProbabilityThisDay = (dayData?.survival_probability_this_day || 0) * 100; // Convert to percentage\n                } else if (isCancellationTable) {\n                    // Only cancellation metrics for cancellation tables\n                    chartPoint.rawDailyCancellation = dayData?.raw_daily_cancellation_rate || 0;\n                    chartPoint.smoothedDailyCancellation = dayData?.smoothed_daily_cancellation_rate || 0;\n                    chartPoint.rawCumulativeCancellation = dayData?.raw_cumulative_cancellation_rate || 0;\n                    chartPoint.smoothedCumulativeCancellation = dayData?.smoothed_cumulative_cancellation_rate || 0;\n                } else if (isRefundTable) {\n                    // Only refund metrics for refund tables\n                    chartPoint.rawDailyRefund = dayData?.raw_daily_refund_rate || 0;\n                    chartPoint.smoothedDailyRefund = dayData?.smoothed_daily_refund_rate || 0;\n                    chartPoint.rawCumulativeRefund = dayData?.raw_cumulative_refund_rate || 0;\n                    chartPoint.smoothedCumulativeRefund = dayData?.smoothed_cumulative_refund_rate || 0;\n                    \n                    // Add refund probability data for refund tables\n                    chartPoint.totalRefundProbability = (dayData?.total_refund_probability || 0) * 100; // Convert to percentage\n                    chartPoint.noRefundProbability = (dayData?.no_refund_probability || 0) * 100; // Convert to percentage\n                }\n                \n                return chartPoint;\n            });\n        };\n\n        const customTooltip = ({ active, payload, label }) => {\n            if (active && payload && payload.length) {\n                return (\n                    <div className=\"bg-white dark:bg-gray-800 p-3 border border-gray-200 dark:border-gray-700 rounded-lg shadow-lg\">\n                        <p className=\"font-semibold text-gray-900 dark:text-white\">{`Day ${label}`}</p>\n                        {payload.map((entry, index) => (\n                            <p key={index} style={{ color: entry.color }} className=\"text-sm\">\n                                {`${entry.name}: ${entry.value.toFixed(2)}%`}\n                            </p>\n                        ))}\n                            </div>\n                );\n            }\n            return null;\n        };\n\n        const chartData = prepareChartData();\n        \n        // Define lines based on table type\n        const getChartLines = () => {\n            if (isTrialOutcomeTable) {\n                return [\n                    { dataKey: 'rawDailyCancellation', name: 'Raw Daily Cancellation', stroke: '#dc2626', strokeDasharray: '0' },\n                    { dataKey: 'smoothedDailyCancellation', name: 'Smoothed Daily Cancellation', stroke: '#dc2626', strokeDasharray: '5 5' },\n                    { dataKey: 'rawCumulativeCancellation', name: 'Raw Cumulative Cancellation', stroke: '#b91c1c', strokeDasharray: '0' },\n                    { dataKey: 'smoothedCumulativeCancellation', name: 'Smoothed Cumulative Cancellation', stroke: '#b91c1c', strokeDasharray: '5 5' }\n                ];\n            } else if (isCancellationTable) {\n                return [\n                    { dataKey: 'rawDailyCancellation', name: 'Raw Daily Cancellation', stroke: '#dc2626', strokeDasharray: '0' },\n                    { dataKey: 'smoothedDailyCancellation', name: 'Smoothed Daily Cancellation', stroke: '#dc2626', strokeDasharray: '5 5' },\n                    { dataKey: 'rawCumulativeCancellation', name: 'Raw Cumulative Cancellation', stroke: '#b91c1c', strokeDasharray: '0' },\n                    { dataKey: 'smoothedCumulativeCancellation', name: 'Smoothed Cumulative Cancellation', stroke: '#b91c1c', strokeDasharray: '5 5' }\n                ];\n            } else if (isRefundTable) {\n                return [\n                    { dataKey: 'rawDailyRefund', name: 'Raw Daily Refund', stroke: '#2563eb', strokeDasharray: '0' },\n                    { dataKey: 'smoothedDailyRefund', name: 'Smoothed Daily Refund', stroke: '#2563eb', strokeDasharray: '5 5' },\n                    { dataKey: 'rawCumulativeRefund', name: 'Raw Cumulative Refund', stroke: '#1d4ed8', strokeDasharray: '0' },\n                    { dataKey: 'smoothedCumulativeRefund', name: 'Smoothed Cumulative Refund', stroke: '#1d4ed8', strokeDasharray: '5 5' }\n                ];\n            }\n            \n            return [];\n        };\n\n        // Define conversion probability lines for trial-to-outcome tables\n        const getConversionProbabilityLines = () => {\n            if (isTrialOutcomeTable) {\n                return [\n                    { dataKey: 'conversionProbabilityFromDayOnward', name: 'Conversion Probability from Day Onward', stroke: '#059669', strokeDasharray: '0', strokeWidth: 3 },\n                    { dataKey: 'survivalProbabilityThisDay', name: 'Daily Survival Probability', stroke: '#10b981', strokeDasharray: '5 5', strokeWidth: 2 }\n                ];\n            }\n            return [];\n        };\n\n        // Define refund probability lines for refund tables\n        const getRefundProbabilityLines = () => {\n            if (isRefundTable) {\n                return [\n                    { dataKey: 'totalRefundProbability', name: 'Total Refund Probability', stroke: '#dc2626', strokeDasharray: '0', strokeWidth: 3 },\n                    { dataKey: 'noRefundProbability', name: 'No Refund Probability (Retention)', stroke: '#059669', strokeDasharray: '5 5', strokeWidth: 3 }\n                ];\n            }\n            return [];\n        };\n\n        const chartLines = getChartLines();\n        const conversionProbabilityLines = getConversionProbabilityLines();\n        const refundProbabilityLines = getRefundProbabilityLines();\n\n        return (\n            <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\n                <div className=\"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-6xl w-full max-h-[90vh] overflow-y-auto\">\n                    <div className=\"p-6\">\n                        <div className=\"flex justify-between items-center mb-6\">\n                            <h3 className=\"text-xl font-semibold text-gray-900 dark:text-white\">\n                                {title} - Lifecycle Charts\n                            </h3>\n                            <button\n                                onClick={closeChartModal}\n                                className=\"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200\"\n                            >\n                                <X size={24} />\n                            </button>\n                        </div>\n\n                        {/* Product Filter Display */}\n                        <div className=\"mb-6 p-4 bg-gray-50 dark:bg-gray-700 rounded-lg\">\n                            <div className=\"flex items-center justify-between\">\n                                <span className=\"text-sm font-medium text-gray-900 dark:text-white\">\n                                    Current Filter: {globalSelectedProduct || 'All Products (Aggregate)'}\n                                </span>\n                                <span className=\"text-xs text-gray-600 dark:text-gray-400\">\n                                    Use the main product toggle to change filter\n                                </span>\n                            </div>\n                        </div>\n\n                        {chartData.length > 0 ? (\n                            <div className=\"space-y-8\">\n                                {/* Conversion Probability Chart - Only for Trial-to-Outcome */}\n                                {isTrialOutcomeTable && conversionProbabilityLines.length > 0 && (\n                                    <div>\n                                        <h4 className=\"text-lg font-semibold text-gray-900 dark:text-white mb-4\">\n                                            🎯 Revenue Estimation: Conversion Probabilities\n                                        </h4>\n                                        <div className=\"mb-4 p-3 bg-green-50 dark:bg-green-900/30 rounded-lg\">\n                                            <p className=\"text-sm text-green-800 dark:text-green-200\">\n                                                <strong>Conversion Probability from Day Onward:</strong> Shows the likelihood that a user on day X will convert by the end of the trial.\n                                                This is used in revenue estimation: <code>Expected Revenue = P_convert(x) × P_not_refunded × ARPU</code>\n                                            </p>\n                                        </div>\n                                        <div className=\"h-80\">\n                                            <ResponsiveContainer width=\"100%\" height=\"100%\">\n                                                <RechartsLineChart data={chartData}>\n                                                    <CartesianGrid strokeDasharray=\"3 3\" />\n                                                    <XAxis \n                                                        dataKey=\"day\" \n                                                        label={{ value: 'Trial Day', position: 'insideBottom', offset: -5 }}\n                                                    />\n                                                    <YAxis \n                                                        label={{ value: 'Probability (%)', angle: -90, position: 'insideLeft' }}\n                                                        domain={[0, 100]}\n                                                    />\n                                                    <Tooltip content={customTooltip} />\n                                                    <Legend />\n                                                    {conversionProbabilityLines.map((line, index) => (\n                                                        <Line\n                                                            key={index}\n                                                            type=\"monotone\"\n                                                            dataKey={line.dataKey}\n                                                            stroke={line.stroke}\n                                                            strokeDasharray={line.strokeDasharray}\n                                                            name={line.name}\n                                                            strokeWidth={line.strokeWidth || 2}\n                                                            dot={{ r: 4 }}\n                                                        />\n                                                    ))}\n                                                </RechartsLineChart>\n                                            </ResponsiveContainer>\n                                        </div>\n                                    </div>\n                                )}\n\n                                {/* Refund Probability Chart - Only for Refund Tables */}\n                                {isRefundTable && refundProbabilityLines.length > 0 && (\n                                    <div>\n                                        <h4 className=\"text-lg font-semibold text-gray-900 dark:text-white mb-4\">\n                                            💰 Revenue Estimation: Refund Probabilities\n                                        </h4>\n                                        <div className=\"mb-4 p-3 bg-blue-50 dark:bg-blue-900/30 rounded-lg\">\n                                            <p className=\"text-sm text-blue-800 dark:text-blue-200\">\n                                                <strong>Total Refund Probability:</strong> The total likelihood of refunding within the refund window.\n                                                <strong> No Refund Probability:</strong> Used in revenue estimation as the retention component.\n                                            </p>\n                                        </div>\n                                        <div className=\"h-80\">\n                                            <ResponsiveContainer width=\"100%\" height=\"100%\">\n                                                <RechartsLineChart data={chartData}>\n                                                    <CartesianGrid strokeDasharray=\"3 3\" />\n                                                    <XAxis \n                                                        dataKey=\"day\" \n                                                        label={{ value: 'Days Since Conversion', position: 'insideBottom', offset: -5 }}\n                                                    />\n                                                    <YAxis \n                                                        label={{ value: 'Probability (%)', angle: -90, position: 'insideLeft' }}\n                                                        domain={[0, 100]}\n                                                    />\n                                                    <Tooltip content={customTooltip} />\n                                                    <Legend />\n                                                    {refundProbabilityLines.map((line, index) => (\n                                                        <Line\n                                                            key={index}\n                                                            type=\"monotone\"\n                                                            dataKey={line.dataKey}\n                                                            stroke={line.stroke}\n                                                            strokeDasharray={line.strokeDasharray}\n                                                            name={line.name}\n                                                            strokeWidth={line.strokeWidth || 2}\n                                                            dot={{ r: 4 }}\n                                                        />\n                                                    ))}\n                                                </RechartsLineChart>\n                                            </ResponsiveContainer>\n                                        </div>\n                                    </div>\n                                )}\n\n                                {/* Daily and Cumulative Charts for all tables */}\n                                {/* Daily Rates Chart */}\n                        <div>\n                                    <h4 className=\"text-lg font-semibold text-gray-900 dark:text-white mb-4\">\n                                        Daily Rates Chart\n                                    </h4>\n                                    <div className=\"h-80\">\n                                        <ResponsiveContainer width=\"100%\" height=\"100%\">\n                                            <RechartsLineChart data={chartData}>\n                                                <CartesianGrid strokeDasharray=\"3 3\" />\n                                                <XAxis \n                                                    dataKey=\"day\" \n                                                    label={{ value: 'Days', position: 'insideBottom', offset: -5 }}\n                                                />\n                                                <YAxis \n                                                    label={{ value: 'Rate (%)', angle: -90, position: 'insideLeft' }}\n                                                />\n                                                <Tooltip content={customTooltip} />\n                                                <Legend />\n                                                {chartLines\n                                                    .filter(line => line.dataKey.includes('Daily') || line.dataKey.includes('daily'))\n                                                    .map((line, index) => (\n                                                        <Line\n                                                            key={index}\n                                                            type=\"monotone\"\n                                                            dataKey={line.dataKey}\n                                                            stroke={line.stroke}\n                                                            strokeDasharray={line.strokeDasharray}\n                                                            name={line.name}\n                                                            strokeWidth={2}\n                                                            dot={{ r: 3 }}\n                                                        />\n                                                    ))\n                                                }\n                                            </RechartsLineChart>\n                                        </ResponsiveContainer>\n                            </div>\n                        </div>\n\n                                {/* Cumulative Rates Chart */}\n                        <div>\n                                    <h4 className=\"text-lg font-semibold text-gray-900 dark:text-white mb-4\">\n                                        Cumulative Rates Chart\n                                    </h4>\n                                    <div className=\"h-80\">\n                                        <ResponsiveContainer width=\"100%\" height=\"100%\">\n                                            <RechartsLineChart data={chartData}>\n                                                <CartesianGrid strokeDasharray=\"3 3\" />\n                                                <XAxis \n                                                    dataKey=\"day\" \n                                                    label={{ value: 'Days', position: 'insideBottom', offset: -5 }}\n                                                />\n                                                <YAxis \n                                                    label={{ value: 'Rate (%)', angle: -90, position: 'insideLeft' }}\n                                                />\n                                                <Tooltip content={customTooltip} />\n                                                <Legend />\n                                                {chartLines\n                                                    .filter(line => line.dataKey.includes('Cumulative') || line.dataKey.includes('cumulative'))\n                                                    .map((line, index) => (\n                                                        <Line\n                                                            key={index}\n                                                            type=\"monotone\"\n                                                            dataKey={line.dataKey}\n                                                            stroke={line.stroke}\n                                                            strokeDasharray={line.strokeDasharray}\n                                                            name={line.name}\n                                                            strokeWidth={2}\n                                                            dot={{ r: 3 }}\n                                                        />\n                                                    ))\n                                                }\n                                            </RechartsLineChart>\n                                        </ResponsiveContainer>\n                                    </div>\n                                </div>\n\n                                {/* Chart Information */}\n                                <div className=\"mt-6 p-4 bg-blue-50 dark:bg-blue-900/30 rounded-lg\">\n                                    <h5 className=\"font-semibold text-blue-800 dark:text-blue-200 mb-2\">Chart Information</h5>\n                                    <div className=\"text-sm text-blue-700 dark:text-blue-300 space-y-1\">\n                                        <p><strong>Solid lines:</strong> Raw data points</p>\n                                        <p><strong>Dashed lines:</strong> Smoothed data (when available)</p>\n                                        {isTrialOutcomeTable && (\n                                            <>\n                                                <p><strong>Red colors:</strong> Cancellation metrics (Trial Started → Cancelled)</p>\n                                                <p><strong>Green colors:</strong> Conversion probabilities (used for revenue estimation)</p>\n                                                <p><strong>Thick green line:</strong> Pre-calculated conversion probability from each day onward</p>\n                                            </>\n                                        )}\n                                        {isCancellationTable && <p><strong>Red colors:</strong> Cancellation metrics</p>}\n                                        {isRefundTable && (\n                                            <>\n                                                <p><strong>Blue colors:</strong> Refund metrics</p>\n                                                <p><strong>Red/Green colors:</strong> Refund probabilities (used for revenue estimation)</p>\n                                                <p><strong>Thick lines:</strong> Pre-calculated total refund probabilities</p>\n                                            </>\n                                        )}\n                                    </div>\n                                </div>\n                            </div>\n                        ) : (\n                            <div className=\"text-center py-8\">\n                                <p className=\"text-gray-500 dark:text-gray-400\">\n                                    No chart data available for this lifecycle analysis.\n                                </p>\n                        </div>\n                        )}\n                    </div>\n                </div>\n            </div>\n        );\n    };\n\n    // Breakdown Modal Component\n    const BreakdownModal = () => {\n        if (!breakdownModalData) return null;\n\n        const { title, rateCalculationData } = breakdownModalData;\n        \n        // Extract per-product information from the rate calculation data\n        const extensionInfo = rateCalculationData.extension_info;\n        const perProductInfo = extensionInfo?.per_product_info || {};\n        const aggregateRates = rateCalculationData.aggregate_rates;\n        const ratesByProduct = rateCalculationData.rates_by_product || {};\n        \n        // Get ALL products from the global product list, not just ones with data for this lifecycle\n        const allAvailableProducts = getAllAvailableProducts();\n\n        return (\n            <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\n                <div className=\"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto\">\n                    <div className=\"p-6\">\n                        <div className=\"flex justify-between items-center mb-6\">\n                            <h3 className=\"text-xl font-semibold text-gray-900 dark:text-white\">\n                                {title} - Product Breakdown\n                            </h3>\n                            <button\n                                onClick={closeBreakdownModal}\n                                className=\"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200\"\n                            >\n                                <X size={24} />\n                            </button>\n                        </div>\n\n                        {/* Aggregate Summary */}\n                        <div className=\"mb-6 p-4 bg-blue-50 dark:bg-blue-900/30 rounded-lg\">\n                            <h4 className=\"text-lg font-semibold text-blue-800 dark:text-blue-200 mb-2\">\n                                Aggregate Summary\n                            </h4>\n                            <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm\">\n                                <div>\n                                    <p className=\"text-blue-700 dark:text-blue-300\">\n                                        <strong>Total Users:</strong> {aggregateRates?.total_sample_size || 0}\n                                    </p>\n                                </div>\n                                <div>\n                                    <p className=\"text-blue-700 dark:text-blue-300\">\n                                        <strong>Extension Used:</strong> {aggregateRates?.extension_days_used || 0} days\n                                    </p>\n                                </div>\n                                <div>\n                                    <p className=\"text-blue-700 dark:text-blue-300\">\n                                        <strong>Products with Data:</strong> {Object.keys(ratesByProduct).length}\n                                    </p>\n                                </div>\n                            </div>\n                        </div>\n\n                        {/* Per-Product Breakdown */}\n                        <div className=\"space-y-4\">\n                            <h4 className=\"text-lg font-semibold text-gray-900 dark:text-white\">\n                                Per-Product Details ({allAvailableProducts.length} products)\n                            </h4>\n                            \n                            {allAvailableProducts.map(productId => {\n                                const productInfo = perProductInfo[productId] || {};\n                                const productRates = ratesByProduct[productId] || {};\n                                const finalSampleSize = productInfo.final_sample_size || productRates.total_sample_size || 0;\n                                const extensionDays = productInfo.extension_days_used || productRates.extension_days_used || 0;\n                                const attempts = productInfo.attempts_made || productRates.extension_attempts || 1;\n                                \n                                // Determine status\n                                let status = 'No Data';\n                                let statusColor = 'text-gray-500';\n                                let bgColor = 'bg-gray-50 dark:bg-gray-700';\n                                \n                                if (finalSampleSize >= 10) {\n                                    status = 'Sufficient Data';\n                                    statusColor = 'text-green-600 dark:text-green-400';\n                                    bgColor = 'bg-green-50 dark:bg-green-900/20';\n                                } else if (finalSampleSize > 0) {\n                                    status = 'Insufficient Data (<10 users)';\n                                    statusColor = 'text-orange-600 dark:text-orange-400';\n                                    bgColor = 'bg-orange-50 dark:bg-orange-900/20';\n                                }\n                                \n                                // Create lookback breakdown text\n                                let lookbackText = 'No lookback data available';\n                                if (productInfo.final_sample_size !== undefined || productRates.total_sample_size !== undefined) {\n                                    // Check if we have detailed step-by-step breakdown from backend\n                                    const stepCounts = productInfo.user_counts_by_step;\n                                    if (stepCounts) {\n                                        const base = stepCounts.base || 0;\n                                        const thirtyDays = stepCounts[\"30_days\"] || 0;\n                                        const sixtyDays = stepCounts[\"60_days\"] || 0;\n                                        \n                                        if (extensionDays === 0) {\n                                            lookbackText = `Base: ${base}`;\n                                        } else if (extensionDays === 30) {\n                                            lookbackText = `Base: ${base}, +0-30: ${thirtyDays}`;\n                                        } else if (extensionDays === 60) {\n                                            lookbackText = `Base: ${base}, +0-30: ${thirtyDays}, +31-60: ${sixtyDays}`;\n                                        }\n                                    } else {\n                                        // Fallback to old format if detailed breakdown not available\n                                        if (extensionDays === 0) {\n                                            lookbackText = `Base: ${finalSampleSize}`;\n                                        } else if (extensionDays === 30) {\n                                            lookbackText = `Base: ?, +0-30: ${finalSampleSize} (final)`;\n                                        } else if (extensionDays === 60) {\n                                            lookbackText = `Base: ?, +0-30: ?, +31-60: ${finalSampleSize} (final)`;\n                                        }\n                                    }\n                                }\n                                \n                                return (\n                                    <div key={productId} className={`p-4 rounded-lg border ${bgColor} border-gray-200 dark:border-gray-600`}>\n                                        <div className=\"flex items-center justify-between mb-2\">\n                                            <h5 className=\"font-medium text-gray-900 dark:text-white\">\n                                                {productId}\n                                            </h5>\n                                            <span className={`text-sm font-medium ${statusColor}`}>\n                                                {status}\n                                            </span>\n                                        </div>\n                                        \n                                        <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4 text-sm text-gray-600 dark:text-gray-400\">\n                                            <div>\n                                                <p><strong>Final Users:</strong> {finalSampleSize}</p>\n                                            </div>\n                                            <div>\n                                                <p><strong>Extension:</strong> {extensionDays} days</p>\n                                            </div>\n                                            <div>\n                                                <p><strong>Attempts:</strong> {attempts}</p>\n                                            </div>\n                                            <div>\n                                                <p><strong>Used in Display:</strong> {\n                                                    globalSelectedProduct === productId \n                                                        ? (finalSampleSize >= 10 ? 'Yes (Product-specific)' : 'No (Fallback to aggregate)')\n                                                        : 'N/A'\n                                                }</p>\n                                            </div>\n                                        </div>\n                                        \n                                        <div className=\"mt-2 text-xs text-gray-500 dark:text-gray-400\">\n                                            <p><strong>Lookback breakdown:</strong> {lookbackText}</p>\n                                        </div>\n                                    </div>\n                                );\n                            })}\n                        </div>\n\n                        {/* Explanation */}\n                        <div className=\"mt-6 p-4 bg-gray-50 dark:bg-gray-700 rounded-lg\">\n                            <h5 className=\"font-semibold text-gray-800 dark:text-gray-200 mb-2\">How This Works</h5>\n                            <div className=\"text-sm text-gray-600 dark:text-gray-400 space-y-1\">\n                                <p><strong>Lookback Strategy:</strong> Each product tries to reach 100+ users by extending lookback period (Base → +0-30 days → +31-60 days)</p>\n                                <p><strong>Display Logic:</strong> Product-specific data shown only if ≥10 users, otherwise falls back to aggregate</p>\n                                <p><strong>Aggregate:</strong> Combined data from all products that have sufficient data</p>\n                                <p><strong>Current Filter:</strong> {globalSelectedProduct || 'All Products (Aggregate)'}</p>\n                                <p><strong>Note:</strong> Products with \"No Data\" for this lifecycle type don't participate in the aggregate calculation</p>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        );\n    };\n\n    if (!data) {\n        return (\n            <div className=\"p-6 bg-gray-50 dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700\">\n                <p className=\"text-gray-500 dark:text-gray-400\">\n                    No lifecycle rate data available.\n                </p>\n            </div>\n        );\n    }\n\n    // Define the exact order of tables as requested\n    const lifecycleTableOrder = [\n        {\n            key: 'trial_to_outcome',\n            title: 'Trial Started → Cancelled',\n            dataKey: 'trial_to_outcome'\n        },\n        {\n            key: 'trial_converted_to_cancellation',\n            title: 'Trial Converted → Cancelled',\n            dataKey: 'trial_converted_to_cancellation'\n        },\n        {\n            key: 'trial_converted_to_refund',\n            title: 'Trial Converted → Refunded',\n            dataKey: 'trial_converted_to_refund'\n        },\n        {\n            key: 'initial_purchase_to_cancellation',\n            title: 'Initial Purchase → Cancelled',\n            dataKey: 'initial_purchase_to_cancellation'\n        },\n        {\n            key: 'initial_purchase_to_refund',\n            title: 'Initial Purchase → Refunded',\n            dataKey: 'initial_purchase_to_refund'\n        },\n        {\n            key: 'renewal_to_cancellation',\n            title: 'Renewal → Cancelled',\n            dataKey: 'renewal_to_cancellation'\n        },\n        {\n            key: 'renewal_to_refund',\n            title: 'Renewal → Refunded',\n            dataKey: 'renewal_to_refund'\n        }\n    ];\n\n    return (\n        <div className=\"space-y-6\">\n            {/* Global Product Toggle */}\n            <div className=\"p-4 bg-blue-50 dark:bg-blue-900/30 rounded-lg border border-blue-200 dark:border-blue-700\">\n                <div className=\"flex items-center justify-between\">\n                    <div>\n                        <h3 className=\"text-lg font-semibold text-blue-800 dark:text-blue-200\">\n                            Lifecycle Analysis - Product Filter\n                        </h3>\n                        <p className=\"text-sm text-blue-600 dark:text-blue-300\">\n                            {globalSelectedProduct \n                                ? `Showing data for: ${globalSelectedProduct}` \n                                : 'Showing aggregate data across all products'\n                            }\n                        </p>\n                        <p className=\"text-xs text-blue-500 dark:text-blue-400 mt-1\">\n                            Note: Product-specific data requires minimum 10 users per lifecycle type. \n                            Tables with fewer users will show aggregate data.\n                        </p>\n                    </div>\n                    <select\n                        value={globalSelectedProduct || ''}\n                        onChange={(e) => setGlobalSelectedProduct(e.target.value || null)}\n                        className=\"px-4 py-2 border border-blue-300 dark:border-blue-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white\"\n                    >\n                        <option value=\"\">All Products (Aggregate)</option>\n                        {productList.map(productId => (\n                            <option key={productId} value={productId}>\n                                {productId}\n                            </option>\n                        ))}\n                    </select>\n                </div>\n            </div>\n\n            {/* Render tables in the specified order */}\n            <div className=\"space-y-8\">\n                {lifecycleTableOrder.map((tableConfig) => {\n                    // Add safety check for aggregate data\n                    const ratesData = aggregate && aggregate[tableConfig.dataKey] ? aggregate[tableConfig.dataKey] : null;\n                    \n                    if (!ratesData) {\n                        return (\n                            <div key={tableConfig.key} className=\"mb-4 p-3 bg-gray-50 dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700\">\n                                <div className=\"flex items-center justify-between\">\n                                    <h4 className=\"text-sm font-medium text-gray-900 dark:text-white\">{tableConfig.title}</h4>\n                                    <span className=\"text-xs text-gray-500 dark:text-gray-400\">No data available</span>\n                                </div>\n                            </div>\n                        );\n                    }\n\n                    return renderLifecycleTable(tableConfig.title, ratesData);\n                })}\n            </div>\n\n            {/* Chart Modal */}\n            {showChartModal && <ChartModal />}\n\n            {/* Breakdown Modal */}\n            {showBreakdownModal && <BreakdownModal />}\n        </div>\n    );\n};\n\nexport default LifecycleRatesTable; "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}