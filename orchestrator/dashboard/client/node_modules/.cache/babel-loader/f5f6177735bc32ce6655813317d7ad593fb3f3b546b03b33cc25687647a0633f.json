{"ast":null,"code":"import React from'react';import{X,Clock,TrendingUp,Users,DollarSign,User,Filter}from'lucide-react';import EventTimelineTableV3 from'../cohort-pipeline/components/EventTimelineTableV3';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const TimelineModal=_ref=>{let{isOpen,onClose,data,rowData}=_ref;// NEW: Add state for user selection\nconst[selectedUserId,setSelectedUserId]=React.useState('');if(!isOpen)return null;// Helper function to format currency\nconst formatCurrency=num=>{if(typeof num!=='number')return'$0';return'$'+num.toLocaleString(undefined,{minimumFractionDigits:2,maximumFractionDigits:2});};// Get row identifier for display\nconst getRowIdentifier=()=>{if(!rowData)return'Unknown';// Check what level this row is (campaign, adset, or ad)\nif(rowData.ad_name||rowData.name){return{type:'Ad',name:rowData.ad_name||rowData.name,id:rowData.ad_id};}else if(rowData.adset_name){return{type:'Ad Set',name:rowData.adset_name,id:rowData.adset_id};}else if(rowData.campaign_name){return{type:'Campaign',name:rowData.campaign_name,id:rowData.campaign_id};}return{type:'Item',name:'Unknown',id:'Unknown'};};// NEW: Extract available users for selection\nconst getAvailableUsers=()=>{var _data$stage_results,_data$stage_results$s,_data$data,_data$data$stage_resu,_data$data$stage_resu2,_data$data2;if(!data){return[];}// Handle V3 Refactored Pipeline format\nlet timelineResults=null;if(data!==null&&data!==void 0&&(_data$stage_results=data.stage_results)!==null&&_data$stage_results!==void 0&&(_data$stage_results$s=_data$stage_results.stage3)!==null&&_data$stage_results$s!==void 0&&_data$stage_results$s.timeline_results){timelineResults=data.stage_results.stage3.timeline_results;}else if(data!==null&&data!==void 0&&(_data$data=data.data)!==null&&_data$data!==void 0&&(_data$data$stage_resu=_data$data.stage_results)!==null&&_data$data$stage_resu!==void 0&&(_data$data$stage_resu2=_data$data$stage_resu.stage3)!==null&&_data$data$stage_resu2!==void 0&&_data$data$stage_resu2.timeline_results){timelineResults=data.data.stage_results.stage3.timeline_results;}else if(data!==null&&data!==void 0&&data.timeline_results){timelineResults=data.timeline_results;}else if(data!==null&&data!==void 0&&(_data$data2=data.data)!==null&&_data$data2!==void 0&&_data$data2.timeline_results){timelineResults=data.data.timeline_results;}if(!timelineResults){return[];}const users=new Set();// Extract users from user_daily_metrics (most accurate)\nif(timelineResults.user_daily_metrics){Object.keys(timelineResults.user_daily_metrics).forEach(userId=>{users.add(userId);});}// Extract users from user_timelines\nif(timelineResults.user_timelines){Object.keys(timelineResults.user_timelines).forEach(userId=>{users.add(userId);});}// Extract users from user_timelines_events\nif(timelineResults.user_timelines_events){Object.keys(timelineResults.user_timelines_events).forEach(userId=>{users.add(userId);});}return Array.from(users).sort();};// Get summary stats from timeline data\nconst getSummaryStats=()=>{var _data$stage_results2,_data$stage_results2$,_data$data3,_data$data3$stage_res,_data$data3$stage_res2,_data$data4;if(!data){return{totalUsers:0,totalActualRevenue:0,totalEstimatedRevenue:0};}// Handle V3 Refactored Pipeline format\nlet timelineResults=null;if(data!==null&&data!==void 0&&(_data$stage_results2=data.stage_results)!==null&&_data$stage_results2!==void 0&&(_data$stage_results2$=_data$stage_results2.stage3)!==null&&_data$stage_results2$!==void 0&&_data$stage_results2$.timeline_results){timelineResults=data.stage_results.stage3.timeline_results;}else if(data!==null&&data!==void 0&&(_data$data3=data.data)!==null&&_data$data3!==void 0&&(_data$data3$stage_res=_data$data3.stage_results)!==null&&_data$data3$stage_res!==void 0&&(_data$data3$stage_res2=_data$data3$stage_res.stage3)!==null&&_data$data3$stage_res2!==void 0&&_data$data3$stage_res2.timeline_results){timelineResults=data.data.stage_results.stage3.timeline_results;}else if(data!==null&&data!==void 0&&data.timeline_results){timelineResults=data.timeline_results;}else if(data!==null&&data!==void 0&&(_data$data4=data.data)!==null&&_data$data4!==void 0&&_data$data4.timeline_results){timelineResults=data.data.timeline_results;}if(!timelineResults){return{totalUsers:0,totalActualRevenue:0,totalEstimatedRevenue:0};}const aggregateStats=timelineResults.aggregate_stats||{};// Get estimated revenue from the last day of the timeline\nconst timelineData=timelineResults.timeline_data||{};const dates=Object.keys(timelineData).sort();const lastDate=dates[dates.length-1];const lastDayData=timelineData[lastDate]||{};const lastDayEstimatedRevenue=lastDayData.estimated_revenue||0;return{totalUsers:Object.keys(timelineResults.user_timelines||{}).length,totalActualRevenue:aggregateStats.total_actual_revenue||0,totalEstimatedRevenue:lastDayEstimatedRevenue};};// Prepare data for EventTimelineTableV3 component\nconst prepareTimelineData=()=>{var _data$stage_results3,_data$stage_results3$,_data$data5,_data$data5$stage_res,_data$data5$stage_res2,_data$data6;if(!data)return null;// Handle V3 Refactored Pipeline format - extract timeline results\nlet timelineResults=null;if(data!==null&&data!==void 0&&(_data$stage_results3=data.stage_results)!==null&&_data$stage_results3!==void 0&&(_data$stage_results3$=_data$stage_results3.stage3)!==null&&_data$stage_results3$!==void 0&&_data$stage_results3$.timeline_results){timelineResults=data.stage_results.stage3.timeline_results;}else if(data!==null&&data!==void 0&&(_data$data5=data.data)!==null&&_data$data5!==void 0&&(_data$data5$stage_res=_data$data5.stage_results)!==null&&_data$data5$stage_res!==void 0&&(_data$data5$stage_res2=_data$data5$stage_res.stage3)!==null&&_data$data5$stage_res2!==void 0&&_data$data5$stage_res2.timeline_results){timelineResults=data.data.stage_results.stage3.timeline_results;}else if(data!==null&&data!==void 0&&data.timeline_results){timelineResults=data.timeline_results;}else if(data!==null&&data!==void 0&&(_data$data6=data.data)!==null&&_data$data6!==void 0&&_data$data6.timeline_results){timelineResults=data.data.timeline_results;}if(!timelineResults)return null;const dates=Object.keys(timelineResults.timeline_data||{}).sort();const dailyMetrics=timelineResults.timeline_data||{};// Calculate cumulative metrics from daily data on the frontend\nconst cumulativeMetrics={};let cumulativeTotals={trial_started:0,trial_pending:0,trial_ended:0,trial_cancelled:0,trial_converted:0,initial_purchase:0,subscription_cancelled:0,refund_count:0,revenue:0,refund:0,revenue_net:0};// Calculate cumulative values for each date\ndates.forEach(date=>{const dayData=dailyMetrics[date]||{};// Add daily values to cumulative totals\ncumulativeTotals.trial_started+=dayData.trial_started||0;cumulativeTotals.trial_pending+=dayData.trial_pending||0;cumulativeTotals.trial_ended+=dayData.trial_ended||0;cumulativeTotals.trial_cancelled+=dayData.trial_cancelled||0;cumulativeTotals.trial_converted+=dayData.trial_converted||0;cumulativeTotals.initial_purchase+=dayData.initial_purchase||0;cumulativeTotals.subscription_cancelled+=dayData.subscription_cancelled||0;cumulativeTotals.refund_count+=dayData.refund_count||0;cumulativeTotals.revenue+=dayData.revenue||0;cumulativeTotals.refund+=dayData.refund||0;cumulativeTotals.revenue_net+=dayData.revenue_net||0;// Store cumulative values for this date with the field names EventTimelineTableV3 expects\ncumulativeMetrics[date]={cumulative_trial_started:cumulativeTotals.trial_started,cumulative_trial_pending:cumulativeTotals.trial_pending,cumulative_trial_ended:cumulativeTotals.trial_ended,cumulative_trial_cancelled:cumulativeTotals.trial_cancelled,cumulative_trial_converted:cumulativeTotals.trial_converted,cumulative_initial_purchase:cumulativeTotals.initial_purchase,cumulative_subscription_cancelled:cumulativeTotals.subscription_cancelled,cumulative_refund_count:cumulativeTotals.refund_count,cumulative_revenue:cumulativeTotals.revenue,cumulative_refund:cumulativeTotals.refund,cumulative_revenue_net:cumulativeTotals.revenue_net,// For state-based metrics, cumulative should show current daily value (not accumulated)\n// These represent current state, not cumulative totals\ncumulative_users:dayData.daily_users||0,// Current active users\nestimated_revenue:dayData.estimated_revenue||0,// Current estimated revenue\nsubscription_active:dayData.subscription_active||0// Current active subscriptions\n};});// Transform timeline results into the format expected by EventTimelineTableV3\nconst transformedData={data:{dates:dates,daily_metrics:dailyMetrics,cumulative_metrics:cumulativeMetrics,user_timelines:timelineResults.user_timelines||{},user_daily_metrics:timelineResults.user_daily_metrics||{}}};console.log('🔍 [TimelineModal] Timeline data received:',timelineResults.timeline_data);console.log('🔍 [TimelineModal] Sample daily data:',dates[0],dailyMetrics[dates[0]]);console.log('🔍 [TimelineModal] Calculated cumulative data:',dates[0],cumulativeMetrics[dates[0]]);console.log('🔍 [TimelineModal] Prepared data for EventTimelineTableV3:',transformedData);return transformedData;};const rowIdentifier=getRowIdentifier();const summaryStats=getSummaryStats();const timelineTableData=prepareTimelineData();const availableUsers=getAvailableUsers();// NEW: Helper function to get display name for user\nconst getUserDisplayName=userId=>{if(!userId)return'All Users (Aggregate)';// Extract the readable part from user ID\nif(userId.includes('#')){// Format: user#product, show just the user part with truncation\nconst userPart=userId.split('#')[0];return userPart.length>20?\"\".concat(userPart.substring(0,20),\"...\"):userPart;}// Regular user ID, truncate if too long\nreturn userId.length>25?\"\".concat(userId.substring(0,25),\"...\"):userId;};return/*#__PURE__*/_jsx(\"div\",{className:\"fixed inset-0 z-50 overflow-y-auto\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity\",onClick:onClose}),/*#__PURE__*/_jsx(\"span\",{className:\"hidden sm:inline-block sm:align-middle sm:h-screen\",\"aria-hidden\":\"true\",children:\"\\u200B\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"inline-block align-bottom bg-white dark:bg-gray-800 rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-2 sm:align-middle sm:max-w-[98vw] sm:w-full sm:h-[95vh]\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"bg-gradient-to-r from-blue-50 to-purple-50 dark:from-blue-900/20 dark:to-purple-900/20 px-6 py-4 border-b border-gray-200 dark:border-gray-700\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-3\",children:[/*#__PURE__*/_jsx(TrendingUp,{size:24,className:\"text-blue-600 dark:text-blue-400\"}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg font-semibold text-gray-900 dark:text-white\",children:\"Revenue Timeline Analysis\"}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-sm text-gray-600 dark:text-gray-400\",children:[rowIdentifier.type,\": \",rowIdentifier.name]})]})]}),/*#__PURE__*/_jsx(\"button\",{onClick:onClose,className:\"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors\",children:/*#__PURE__*/_jsx(X,{size:24})})]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"px-6 py-4 bg-gray-50 dark:bg-gray-900 border-b border-gray-200 dark:border-gray-700\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-4 flex-wrap\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-2\",children:[/*#__PURE__*/_jsx(Filter,{size:16,className:\"text-gray-600 dark:text-gray-400\"}),/*#__PURE__*/_jsx(\"span\",{className:\"text-sm font-medium text-gray-700 dark:text-gray-300\",children:\"Filters:\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-2\",children:[/*#__PURE__*/_jsx(User,{size:16,className:\"text-blue-600 dark:text-blue-400\"}),/*#__PURE__*/_jsx(\"label\",{className:\"text-sm text-gray-600 dark:text-gray-400\",children:\"User:\"}),/*#__PURE__*/_jsxs(\"select\",{value:selectedUserId,onChange:e=>setSelectedUserId(e.target.value),className:\"px-3 py-1 border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-700 text-gray-900 dark:text-white text-sm min-w-[200px]\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"All Users (Aggregate)\"}),availableUsers.map(userId=>/*#__PURE__*/_jsx(\"option\",{value:userId,children:getUserDisplayName(userId)},userId))]})]}),selectedUserId&&/*#__PURE__*/_jsx(\"button\",{onClick:()=>setSelectedUserId(''),className:\"px-3 py-1 text-sm bg-gray-200 dark:bg-gray-600 text-gray-700 dark:text-gray-300 rounded hover:bg-gray-300 dark:hover:bg-gray-500 transition-colors\",children:\"Clear Filters\"})]}),selectedUserId&&/*#__PURE__*/_jsxs(\"div\",{className:\"mt-2 text-sm text-blue-600 dark:text-blue-400\",children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Showing:\"}),/*#__PURE__*/_jsxs(\"span\",{children:[\" User: \",getUserDisplayName(selectedUserId)]})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"px-6 py-3 bg-gray-50 dark:bg-gray-900 border-b border-gray-200 dark:border-gray-700\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-3 gap-3\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"p-3 bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-2 mb-1\",children:[/*#__PURE__*/_jsx(Users,{size:16,className:\"text-blue-600 dark:text-blue-400\"}),/*#__PURE__*/_jsx(\"h4\",{className:\"text-sm font-semibold text-gray-900 dark:text-white\",children:\"Users\"})]}),/*#__PURE__*/_jsx(\"p\",{className:\"text-xl font-bold text-blue-600 dark:text-blue-400\",children:selectedUserId?'1':summaryStats.totalUsers})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"p-3 bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-2 mb-1\",children:[/*#__PURE__*/_jsx(DollarSign,{size:16,className:\"text-green-600 dark:text-green-400\"}),/*#__PURE__*/_jsx(\"h4\",{className:\"text-sm font-semibold text-gray-900 dark:text-white\",children:\"Actual Revenue\"})]}),/*#__PURE__*/_jsx(\"p\",{className:\"text-xl font-bold text-green-600 dark:text-green-400\",children:formatCurrency(summaryStats.totalActualRevenue)})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"p-3 bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-2 mb-1\",children:[/*#__PURE__*/_jsx(TrendingUp,{size:16,className:\"text-purple-600 dark:text-purple-400\"}),/*#__PURE__*/_jsx(\"h4\",{className:\"text-sm font-semibold text-gray-900 dark:text-white\",children:\"Estimated Revenue\"})]}),/*#__PURE__*/_jsx(\"p\",{className:\"text-xl font-bold text-purple-600 dark:text-purple-400\",children:formatCurrency(summaryStats.totalEstimatedRevenue)})]})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"flex-1 overflow-y-auto\",style:{height:'calc(95vh - 280px)'},children:timelineTableData?/*#__PURE__*/_jsx(EventTimelineTableV3,{data:timelineTableData,selectedUserId:selectedUserId}):/*#__PURE__*/_jsxs(\"div\",{className:\"text-center py-8\",children:[/*#__PURE__*/_jsx(Clock,{size:48,className:\"mx-auto text-gray-400 mb-4\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-600 dark:text-gray-400 mb-2\",children:\"No timeline data available\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-gray-500 dark:text-gray-500\",children:\"Run the pipeline analysis to generate timeline data\"})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"px-6 py-3 bg-gray-50 dark:bg-gray-900 border-t border-gray-200 dark:border-gray-700\",children:/*#__PURE__*/_jsx(\"div\",{className:\"flex justify-end\",children:/*#__PURE__*/_jsx(\"button\",{onClick:onClose,className:\"px-4 py-2 bg-gray-300 dark:bg-gray-600 text-gray-700 dark:text-gray-300 rounded hover:bg-gray-400 dark:hover:bg-gray-500 transition-colors\",children:\"Close\"})})})]})]})});};export default TimelineModal;","map":{"version":3,"names":["React","X","Clock","TrendingUp","Users","DollarSign","User","Filter","EventTimelineTableV3","jsx","_jsx","jsxs","_jsxs","TimelineModal","_ref","isOpen","onClose","data","rowData","selectedUserId","setSelectedUserId","useState","formatCurrency","num","toLocaleString","undefined","minimumFractionDigits","maximumFractionDigits","getRowIdentifier","ad_name","name","type","id","ad_id","adset_name","adset_id","campaign_name","campaign_id","getAvailableUsers","_data$stage_results","_data$stage_results$s","_data$data","_data$data$stage_resu","_data$data$stage_resu2","_data$data2","timelineResults","stage_results","stage3","timeline_results","users","Set","user_daily_metrics","Object","keys","forEach","userId","add","user_timelines","user_timelines_events","Array","from","sort","getSummaryStats","_data$stage_results2","_data$stage_results2$","_data$data3","_data$data3$stage_res","_data$data3$stage_res2","_data$data4","totalUsers","totalActualRevenue","totalEstimatedRevenue","aggregateStats","aggregate_stats","timelineData","timeline_data","dates","lastDate","length","lastDayData","lastDayEstimatedRevenue","estimated_revenue","total_actual_revenue","prepareTimelineData","_data$stage_results3","_data$stage_results3$","_data$data5","_data$data5$stage_res","_data$data5$stage_res2","_data$data6","dailyMetrics","cumulativeMetrics","cumulativeTotals","trial_started","trial_pending","trial_ended","trial_cancelled","trial_converted","initial_purchase","subscription_cancelled","refund_count","revenue","refund","revenue_net","date","dayData","cumulative_trial_started","cumulative_trial_pending","cumulative_trial_ended","cumulative_trial_cancelled","cumulative_trial_converted","cumulative_initial_purchase","cumulative_subscription_cancelled","cumulative_refund_count","cumulative_revenue","cumulative_refund","cumulative_revenue_net","cumulative_users","daily_users","subscription_active","transformedData","daily_metrics","cumulative_metrics","console","log","rowIdentifier","summaryStats","timelineTableData","availableUsers","getUserDisplayName","includes","userPart","split","concat","substring","className","children","onClick","size","value","onChange","e","target","map","style","height"],"sources":["/Users/joshuakaufman/untitled folder 3/orchestrator/dashboard/client/src/components/TimelineModal.js"],"sourcesContent":["import React from 'react';\nimport { X, Clock, TrendingUp, Users, DollarSign, User, Filter } from 'lucide-react';\nimport EventTimelineTableV3 from '../cohort-pipeline/components/EventTimelineTableV3';\n\nconst TimelineModal = ({ isOpen, onClose, data, rowData }) => {\n    // NEW: Add state for user selection\n    const [selectedUserId, setSelectedUserId] = React.useState('');\n\n    if (!isOpen) return null;\n\n    // Helper function to format currency\n    const formatCurrency = (num) => {\n        if (typeof num !== 'number') return '$0';\n        return '$' + num.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 });\n    };\n\n    // Get row identifier for display\n    const getRowIdentifier = () => {\n        if (!rowData) return 'Unknown';\n        \n        // Check what level this row is (campaign, adset, or ad)\n        if (rowData.ad_name || rowData.name) {\n            return {\n                type: 'Ad',\n                name: rowData.ad_name || rowData.name,\n                id: rowData.ad_id\n            };\n        } else if (rowData.adset_name) {\n            return {\n                type: 'Ad Set',\n                name: rowData.adset_name,\n                id: rowData.adset_id\n            };\n        } else if (rowData.campaign_name) {\n            return {\n                type: 'Campaign',\n                name: rowData.campaign_name,\n                id: rowData.campaign_id\n            };\n        }\n        \n        return {\n            type: 'Item',\n            name: 'Unknown',\n            id: 'Unknown'\n        };\n    };\n\n    // NEW: Extract available users for selection\n    const getAvailableUsers = () => {\n        if (!data) {\n            return [];\n        }\n\n        // Handle V3 Refactored Pipeline format\n        let timelineResults = null;\n        if (data?.stage_results?.stage3?.timeline_results) {\n            timelineResults = data.stage_results.stage3.timeline_results;\n        } else if (data?.data?.stage_results?.stage3?.timeline_results) {\n            timelineResults = data.data.stage_results.stage3.timeline_results;\n        } else if (data?.timeline_results) {\n            timelineResults = data.timeline_results;\n        } else if (data?.data?.timeline_results) {\n            timelineResults = data.data.timeline_results;\n        }\n\n        if (!timelineResults) {\n            return [];\n        }\n\n        const users = new Set();\n\n        // Extract users from user_daily_metrics (most accurate)\n        if (timelineResults.user_daily_metrics) {\n            Object.keys(timelineResults.user_daily_metrics).forEach(userId => {\n                users.add(userId);\n            });\n        }\n\n        // Extract users from user_timelines\n        if (timelineResults.user_timelines) {\n            Object.keys(timelineResults.user_timelines).forEach(userId => {\n                users.add(userId);\n            });\n        }\n\n        // Extract users from user_timelines_events\n        if (timelineResults.user_timelines_events) {\n            Object.keys(timelineResults.user_timelines_events).forEach(userId => {\n                users.add(userId);\n            });\n        }\n\n        return Array.from(users).sort();\n    };\n\n    // Get summary stats from timeline data\n    const getSummaryStats = () => {\n        if (!data) {\n            return {\n                totalUsers: 0,\n                totalActualRevenue: 0,\n                totalEstimatedRevenue: 0\n            };\n        }\n\n        // Handle V3 Refactored Pipeline format\n        let timelineResults = null;\n        if (data?.stage_results?.stage3?.timeline_results) {\n            timelineResults = data.stage_results.stage3.timeline_results;\n        } else if (data?.data?.stage_results?.stage3?.timeline_results) {\n            timelineResults = data.data.stage_results.stage3.timeline_results;\n        } else if (data?.timeline_results) {\n            timelineResults = data.timeline_results;\n        } else if (data?.data?.timeline_results) {\n            timelineResults = data.data.timeline_results;\n        }\n\n        if (!timelineResults) {\n            return {\n                totalUsers: 0,\n                totalActualRevenue: 0,\n                totalEstimatedRevenue: 0\n            };\n        }\n\n        const aggregateStats = timelineResults.aggregate_stats || {};\n        \n        // Get estimated revenue from the last day of the timeline\n        const timelineData = timelineResults.timeline_data || {};\n        const dates = Object.keys(timelineData).sort();\n        const lastDate = dates[dates.length - 1];\n        const lastDayData = timelineData[lastDate] || {};\n        const lastDayEstimatedRevenue = lastDayData.estimated_revenue || 0;\n        \n        return {\n            totalUsers: Object.keys(timelineResults.user_timelines || {}).length,\n            totalActualRevenue: aggregateStats.total_actual_revenue || 0,\n            totalEstimatedRevenue: lastDayEstimatedRevenue\n        };\n    };\n\n    // Prepare data for EventTimelineTableV3 component\n    const prepareTimelineData = () => {\n        if (!data) return null;\n\n        // Handle V3 Refactored Pipeline format - extract timeline results\n        let timelineResults = null;\n        if (data?.stage_results?.stage3?.timeline_results) {\n            timelineResults = data.stage_results.stage3.timeline_results;\n        } else if (data?.data?.stage_results?.stage3?.timeline_results) {\n            timelineResults = data.data.stage_results.stage3.timeline_results;\n        } else if (data?.timeline_results) {\n            timelineResults = data.timeline_results;\n        } else if (data?.data?.timeline_results) {\n            timelineResults = data.data.timeline_results;\n        }\n\n        if (!timelineResults) return null;\n\n        const dates = Object.keys(timelineResults.timeline_data || {}).sort();\n        const dailyMetrics = timelineResults.timeline_data || {};\n        \n        // Calculate cumulative metrics from daily data on the frontend\n        const cumulativeMetrics = {};\n        let cumulativeTotals = {\n            trial_started: 0,\n            trial_pending: 0,\n            trial_ended: 0,\n            trial_cancelled: 0,\n            trial_converted: 0,\n            initial_purchase: 0,\n            subscription_cancelled: 0,\n            refund_count: 0,\n            revenue: 0,\n            refund: 0,\n            revenue_net: 0\n        };\n\n        // Calculate cumulative values for each date\n        dates.forEach(date => {\n            const dayData = dailyMetrics[date] || {};\n            \n            // Add daily values to cumulative totals\n            cumulativeTotals.trial_started += dayData.trial_started || 0;\n            cumulativeTotals.trial_pending += dayData.trial_pending || 0;\n            cumulativeTotals.trial_ended += dayData.trial_ended || 0;\n            cumulativeTotals.trial_cancelled += dayData.trial_cancelled || 0;\n            cumulativeTotals.trial_converted += dayData.trial_converted || 0;\n            cumulativeTotals.initial_purchase += dayData.initial_purchase || 0;\n            cumulativeTotals.subscription_cancelled += dayData.subscription_cancelled || 0;\n            cumulativeTotals.refund_count += dayData.refund_count || 0;\n            cumulativeTotals.revenue += dayData.revenue || 0;\n            cumulativeTotals.refund += dayData.refund || 0;\n            cumulativeTotals.revenue_net += dayData.revenue_net || 0;\n\n            // Store cumulative values for this date with the field names EventTimelineTableV3 expects\n            cumulativeMetrics[date] = {\n                cumulative_trial_started: cumulativeTotals.trial_started,\n                cumulative_trial_pending: cumulativeTotals.trial_pending,\n                cumulative_trial_ended: cumulativeTotals.trial_ended,\n                cumulative_trial_cancelled: cumulativeTotals.trial_cancelled,\n                cumulative_trial_converted: cumulativeTotals.trial_converted,\n                cumulative_initial_purchase: cumulativeTotals.initial_purchase,\n                cumulative_subscription_cancelled: cumulativeTotals.subscription_cancelled,\n                cumulative_refund_count: cumulativeTotals.refund_count,\n                cumulative_revenue: cumulativeTotals.revenue,\n                cumulative_refund: cumulativeTotals.refund,\n                cumulative_revenue_net: cumulativeTotals.revenue_net,\n                \n                // For state-based metrics, cumulative should show current daily value (not accumulated)\n                // These represent current state, not cumulative totals\n                cumulative_users: dayData.daily_users || 0, // Current active users\n                estimated_revenue: dayData.estimated_revenue || 0, // Current estimated revenue\n                subscription_active: dayData.subscription_active || 0 // Current active subscriptions\n            };\n        });\n\n        // Transform timeline results into the format expected by EventTimelineTableV3\n        const transformedData = {\n            data: {\n                dates: dates,\n                daily_metrics: dailyMetrics,\n                cumulative_metrics: cumulativeMetrics,\n                user_timelines: timelineResults.user_timelines || {},\n                user_daily_metrics: timelineResults.user_daily_metrics || {}\n            }\n        };\n\n        console.log('🔍 [TimelineModal] Timeline data received:', timelineResults.timeline_data);\n        console.log('🔍 [TimelineModal] Sample daily data:', dates[0], dailyMetrics[dates[0]]);\n        console.log('🔍 [TimelineModal] Calculated cumulative data:', dates[0], cumulativeMetrics[dates[0]]);\n        console.log('🔍 [TimelineModal] Prepared data for EventTimelineTableV3:', transformedData);\n        return transformedData;\n    };\n\n    const rowIdentifier = getRowIdentifier();\n    const summaryStats = getSummaryStats();\n    const timelineTableData = prepareTimelineData();\n    const availableUsers = getAvailableUsers();\n\n    // NEW: Helper function to get display name for user\n    const getUserDisplayName = (userId) => {\n        if (!userId) return 'All Users (Aggregate)';\n        \n        // Extract the readable part from user ID\n        if (userId.includes('#')) {\n            // Format: user#product, show just the user part with truncation\n            const userPart = userId.split('#')[0];\n            return userPart.length > 20 ? `${userPart.substring(0, 20)}...` : userPart;\n        }\n        \n        // Regular user ID, truncate if too long\n        return userId.length > 25 ? `${userId.substring(0, 25)}...` : userId;\n    };\n\n    return (\n        <div className=\"fixed inset-0 z-50 overflow-y-auto\">\n            <div className=\"flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0\">\n                {/* Background overlay */}\n                <div \n                    className=\"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity\" \n                    onClick={onClose}\n                ></div>\n\n                {/* Modal positioning */}\n                <span className=\"hidden sm:inline-block sm:align-middle sm:h-screen\" aria-hidden=\"true\">&#8203;</span>\n\n                {/* Modal content - Made wider and taller to accommodate the table */}\n                <div className=\"inline-block align-bottom bg-white dark:bg-gray-800 rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-2 sm:align-middle sm:max-w-[98vw] sm:w-full sm:h-[95vh]\">\n                    {/* Header */}\n                    <div className=\"bg-gradient-to-r from-blue-50 to-purple-50 dark:from-blue-900/20 dark:to-purple-900/20 px-6 py-4 border-b border-gray-200 dark:border-gray-700\">\n                        <div className=\"flex items-center justify-between\">\n                            <div className=\"flex items-center gap-3\">\n                                <TrendingUp size={24} className=\"text-blue-600 dark:text-blue-400\" />\n                                <div>\n                                    <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white\">\n                                        Revenue Timeline Analysis\n                                    </h3>\n                                    <p className=\"text-sm text-gray-600 dark:text-gray-400\">\n                                        {rowIdentifier.type}: {rowIdentifier.name}\n                                    </p>\n                                </div>\n                            </div>\n                            <button\n                                onClick={onClose}\n                                className=\"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors\"\n                            >\n                                <X size={24} />\n                            </button>\n                        </div>\n                    </div>\n\n                    {/* NEW: User Selection Controls */}\n                    <div className=\"px-6 py-4 bg-gray-50 dark:bg-gray-900 border-b border-gray-200 dark:border-gray-700\">\n                        <div className=\"flex items-center gap-4 flex-wrap\">\n                            <div className=\"flex items-center gap-2\">\n                                <Filter size={16} className=\"text-gray-600 dark:text-gray-400\" />\n                                <span className=\"text-sm font-medium text-gray-700 dark:text-gray-300\">Filters:</span>\n                            </div>\n                            \n                            {/* User Selector */}\n                            <div className=\"flex items-center gap-2\">\n                                <User size={16} className=\"text-blue-600 dark:text-blue-400\" />\n                                <label className=\"text-sm text-gray-600 dark:text-gray-400\">User:</label>\n                                <select\n                                    value={selectedUserId}\n                                    onChange={(e) => setSelectedUserId(e.target.value)}\n                                    className=\"px-3 py-1 border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-700 text-gray-900 dark:text-white text-sm min-w-[200px]\"\n                                >\n                                    <option value=\"\">All Users (Aggregate)</option>\n                                    {availableUsers.map(userId => (\n                                        <option key={userId} value={userId}>\n                                            {getUserDisplayName(userId)}\n                                        </option>\n                                    ))}\n                                </select>\n                            </div>\n\n                            {/* Clear Filters Button */}\n                            {selectedUserId && (\n                                <button\n                                    onClick={() => setSelectedUserId('')}\n                                    className=\"px-3 py-1 text-sm bg-gray-200 dark:bg-gray-600 text-gray-700 dark:text-gray-300 rounded hover:bg-gray-300 dark:hover:bg-gray-500 transition-colors\"\n                                >\n                                    Clear Filters\n                                </button>\n                            )}\n                        </div>\n\n                        {/* Selection Status */}\n                        {selectedUserId && (\n                            <div className=\"mt-2 text-sm text-blue-600 dark:text-blue-400\">\n                                <strong>Showing:</strong>\n                                <span> User: {getUserDisplayName(selectedUserId)}</span>\n                            </div>\n                        )}\n                    </div>\n\n                    {/* Summary Cards - Simplified */}\n                    <div className=\"px-6 py-3 bg-gray-50 dark:bg-gray-900 border-b border-gray-200 dark:border-gray-700\">\n                        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-3\">\n                            <div className=\"p-3 bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700\">\n                                <div className=\"flex items-center gap-2 mb-1\">\n                                    <Users size={16} className=\"text-blue-600 dark:text-blue-400\" />\n                                    <h4 className=\"text-sm font-semibold text-gray-900 dark:text-white\">Users</h4>\n                                </div>\n                                <p className=\"text-xl font-bold text-blue-600 dark:text-blue-400\">\n                                    {selectedUserId ? '1' : summaryStats.totalUsers}\n                                </p>\n                            </div>\n\n                            <div className=\"p-3 bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700\">\n                                <div className=\"flex items-center gap-2 mb-1\">\n                                    <DollarSign size={16} className=\"text-green-600 dark:text-green-400\" />\n                                    <h4 className=\"text-sm font-semibold text-gray-900 dark:text-white\">Actual Revenue</h4>\n                                </div>\n                                <p className=\"text-xl font-bold text-green-600 dark:text-green-400\">\n                                    {formatCurrency(summaryStats.totalActualRevenue)}\n                                </p>\n                            </div>\n\n                            <div className=\"p-3 bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700\">\n                                <div className=\"flex items-center gap-2 mb-1\">\n                                    <TrendingUp size={16} className=\"text-purple-600 dark:text-purple-400\" />\n                                    <h4 className=\"text-sm font-semibold text-gray-900 dark:text-white\">Estimated Revenue</h4>\n                                </div>\n                                <p className=\"text-xl font-bold text-purple-600 dark:text-purple-400\">\n                                    {formatCurrency(summaryStats.totalEstimatedRevenue)}\n                                </p>\n                            </div>\n                        </div>\n                    </div>\n\n                    {/* EventTimelineTableV3 - Main Content */}\n                    <div className=\"flex-1 overflow-y-auto\" style={{ height: 'calc(95vh - 280px)' }}>\n                        {timelineTableData ? (\n                            <EventTimelineTableV3 \n                                data={timelineTableData}\n                                selectedUserId={selectedUserId}\n                            />\n                        ) : (\n                            <div className=\"text-center py-8\">\n                                <Clock size={48} className=\"mx-auto text-gray-400 mb-4\" />\n                                <p className=\"text-gray-600 dark:text-gray-400 mb-2\">\n                                    No timeline data available\n                                </p>\n                                <p className=\"text-sm text-gray-500 dark:text-gray-500\">\n                                    Run the pipeline analysis to generate timeline data\n                                </p>\n                            </div>\n                        )}\n                    </div>\n\n                    {/* Footer */}\n                    <div className=\"px-6 py-3 bg-gray-50 dark:bg-gray-900 border-t border-gray-200 dark:border-gray-700\">\n                        <div className=\"flex justify-end\">\n                            <button\n                                onClick={onClose}\n                                className=\"px-4 py-2 bg-gray-300 dark:bg-gray-600 text-gray-700 dark:text-gray-300 rounded hover:bg-gray-400 dark:hover:bg-gray-500 transition-colors\"\n                            >\n                                Close\n                            </button>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    );\n};\n\nexport default TimelineModal; "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}